"use strict";(self.webpackChunktechlife=self.webpackChunktechlife||[]).push([[89],{6089:(e,t,s)=>{s.r(t),s.d(t,{default:()=>x});var r=s(9379),a=s(5043),n=s(9944),l=s(184),o=s(614),i=s(9910),c=s(2397),d=s(579);const m=e=>{let{isOpen:t,onClose:s,type:r,title:n,message:i,theme:c}=e;const[m,u]=(0,a.useState)(!1);(0,a.useEffect)(()=>{if(t&&(u(!0),"success"===r||"error"===r)){const e=setTimeout(()=>{x()},3e3);return()=>clearTimeout(e)}},[t,r]);const x=()=>{u(!1),setTimeout(()=>s(),300)};if(!t)return null;return(0,d.jsx)("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-md flex justify-center items-center z-[200] transition-opacity duration-300 ".concat(m?"opacity-100":"opacity-0"),children:(0,d.jsxs)("div",{className:"p-6 rounded-3xl shadow-2xl w-full max-w-md m-4 border transform transition-all duration-300 ".concat(m?"scale-100 translate-y-0":"scale-95 translate-y-4"," ").concat("dark"===c?"bg-gray-800 border-gray-700":"bg-white border-gray-200"),children:[(0,d.jsxs)("div",{className:"flex items-center mb-4",children:[(()=>{switch(r){case"success":return(0,d.jsx)(l.A7C,{className:"w-6 h-6 text-green-500"});case"error":return(0,d.jsx)(l.BS8,{className:"w-6 h-6 text-red-500"});case"info":return(0,d.jsx)(l.__w,{className:"w-6 h-6 text-blue-500"});default:return null}})(),(0,d.jsx)("h3",{className:"text-xl font-bold ml-3 ".concat((()=>{switch(r){case"success":return"text-green-600 dark:text-green-400";case"error":return"text-red-600 dark:text-red-400";case"info":return"text-blue-600 dark:text-blue-400";default:return"dark"===c?"text-white":"text-gray-800"}})()),children:n}),"success"!==r&&"error"!==r&&(0,d.jsx)("button",{onClick:x,className:"ml-auto p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200",children:(0,d.jsx)(o.A,{size:20})})]}),(0,d.jsx)("p",{className:"".concat("dark"===c?"text-gray-300":"text-gray-600"),children:i}),("success"===r||"error"===r)&&(0,d.jsx)("div",{className:"mt-4 flex justify-end",children:(0,d.jsx)("button",{onClick:x,className:"px-4 py-2 rounded-lg font-medium transition-colors ".concat("success"===r?"bg-green-500 hover:bg-green-600 text-white":"bg-red-500 hover:bg-red-600 text-white"),children:"OK"})})]})})},u=e=>{let{isOpen:t,onClose:s,onConfirm:r,title:n,message:i,confirmText:c,isConfirming:m,theme:u,type:x="warning"}=e;const[g,b]=(0,a.useState)(!1);(0,a.useEffect)(()=>{t&&b(!0)},[t]);const h=()=>{b(!1),setTimeout(()=>s(),300)};if(!t)return null;return(0,d.jsx)("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-md flex justify-center items-center z-[200] transition-opacity duration-300 ".concat(g?"opacity-100":"opacity-0"),children:(0,d.jsxs)("div",{className:"p-6 rounded-3xl shadow-2xl w-full max-w-md m-4 border transform transition-all duration-300 ".concat(g?"scale-100 translate-y-0":"scale-95 translate-y-4"," ").concat("dark"===u?"bg-gray-800 border-gray-700":"bg-white border-gray-200"),children:[(0,d.jsxs)("div",{className:"flex items-center mb-4",children:[(()=>{switch(x){case"danger":return(0,d.jsx)(l.BS8,{className:"w-6 h-6 text-red-500"});case"warning":default:return(0,d.jsx)(l.BS8,{className:"w-6 h-6 text-yellow-500"});case"info":return(0,d.jsx)(l.__w,{className:"w-6 h-6 text-blue-500"})}})(),(0,d.jsx)("h3",{className:"text-xl font-bold ml-3 ".concat((()=>{switch(x){case"danger":return"text-red-600 dark:text-red-400";case"warning":default:return"text-yellow-600 dark:text-yellow-400";case"info":return"text-blue-600 dark:text-blue-400"}})()),children:n}),(0,d.jsx)("button",{onClick:h,className:"ml-auto p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200",children:(0,d.jsx)(o.A,{size:20})})]}),(0,d.jsx)("p",{className:"mb-6 ".concat("dark"===u?"text-gray-300":"text-gray-600"),children:i}),(0,d.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,d.jsx)("button",{onClick:h,className:"px-4 py-2 rounded-lg font-medium transition-colors ".concat("dark"===u?"bg-gray-600 hover:bg-gray-500 text-gray-200":"bg-gray-200 hover:bg-gray-300 text-gray-700"),children:"Cancel"}),(0,d.jsx)("button",{onClick:r,disabled:m,className:"px-4 py-2 rounded-lg font-medium text-white transition-colors flex items-center ".concat((()=>{switch(x){case"danger":return"bg-red-600 hover:bg-red-700";case"warning":default:return"bg-yellow-600 hover:bg-yellow-700";case"info":return"bg-blue-600 hover:bg-blue-700"}})()," ").concat(m?"opacity-75 cursor-not-allowed":""),children:m?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{className:"h-4 w-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Processing..."]}):c})]})]})})},x=()=>{var e,t;const{theme:s,permissionsdata:x,userData:g,setPermissionsData:b}=(0,a.useContext)(i.ob),[h,p]=(0,a.useState)({}),[y,f]=(0,a.useState)(!0),[w,v]=(0,a.useState)(!1),[j,N]=(0,a.useState)(null),[k,C]=(0,a.useState)({isOpen:!1,type:"",title:"",message:""}),[S,E]=(0,a.useState)({isOpen:!1,title:"",message:"",confirmText:"",onConfirm:null,type:"warning",isConfirming:!1}),[A,R]=(0,a.useState)(!1),O=null===g||void 0===g||null===(e=g.roles[0])||void 0===e?void 0:e.toUpperCase(),T=O||null;console.log("Searching for role:",T);const _=x.find(e=>e.roleName.trim()===T.trim());(0,a.useEffect)(()=>{_&&N(_)},[_]),console.log("Found object:",j);const[P,L]=(0,a.useState)(""),[D,U]=(0,a.useState)([]),[F,z]=(0,a.useState)(!1),[M,I]=(0,a.useState)(""),[B,Q]=(0,a.useState)(!1),[Z,V]=(0,a.useState)(!1),[W,H]=(0,a.useState)(null),K=(e,t,s)=>{C({isOpen:!0,type:e,title:t,message:s})},q=()=>{E({isOpen:!1,title:"",message:"",confirmText:"",onConfirm:null,type:"warning",isConfirming:!1})},G=e=>e?e.replace("ROLE_","").toLowerCase():null,J=()=>{if(!x||!Array.isArray(x))return{};const e={};return x.forEach(t=>{const s=G(t.roleName);s&&(e[s]={id:t.id,permissions:t.permissions?[...new Set(t.permissions)]:[]})}),e};(0,a.useEffect)(()=>{if(x&&Array.isArray(x)){const e=(()=>{if(!x||!Array.isArray(x))return[];const e=x.flatMap(e=>e.permissions||[]);return[...new Set(e)].map(e=>{let t=e.replace(/_/g," ").toLowerCase().replace(/\b\w/g,e=>e.toUpperCase());return"CREAT_USER"===e&&(t="Create User"),"DELETE_USER"===e&&(t="Delete User"),"CREATE_TASK"===e&&(t="Create Task"),"VIEW_TASKS"===e&&(t="View Tasks"),"VIEW_REPORTS"===e&&(t="View Reports"),"PERMISSIONS_BUTTENS"===e&&(t="Permissions Buttons"),"CREATE_HR"===e&&(t="Create HR"),{value:e,label:t}}).sort((e,t)=>e.label.localeCompare(t.label))})();U(e);const t=J();p(t),f(!1),R(!0)}else f(!1)},[x]);const X={};if(y)return(0,d.jsx)("div",{children:"Loading..."});const Y=Object.keys(h).sort();return(0,d.jsxs)(d.Fragment,{children:[F&&(0,d.jsx)("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-md flex items-center justify-center z-50",children:(0,d.jsxs)("div",{className:"p-6 rounded-3xl shadow-2xl w-full max-w-md m-4 border ".concat("dark"===s?"bg-gray-800 border-gray-700":"bg-white border-gray-200"),children:[(0,d.jsxs)("div",{className:"flex items-center mb-4",children:[(0,d.jsx)(l.__w,{className:"w-6 h-6 text-blue-500"}),(0,d.jsx)("h2",{className:"text-xl font-bold ml-3 ".concat("dark"===s?"text-white":"text-gray-800"),children:"Add a New Role"}),(0,d.jsx)("button",{onClick:()=>z(!1),className:"ml-auto p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200",children:(0,d.jsx)(o.A,{size:20})})]}),(0,d.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),!M.trim()||!M.toUpperCase().startsWith("ROLE_"))return void K("error","Invalid Role Name","Please enter a valid role name starting with 'ROLE_'.");const t=G(M);if(h[t])return void K("error","Role Already Exists","This role already exists.");Q(!0);const s={roleName:M.trim().toUpperCase(),permissions:[]};try{await c.ZQ.post("/role-access",s);const e=await c.ZQ.get("/role-access/all");b(e.data),z(!1),I(""),K("success","Role Created Successfully","Role '".concat(s.roleName,"' created successfully and UI has been updated!"))}catch(n){var r,a;console.error("Failed to create new role or refresh data:",n);const e=(null===(r=n.response)||void 0===r||null===(a=r.data)||void 0===a?void 0:a.message)||"An error occurred.";K("error","Role Creation Failed","Error: ".concat(e))}finally{Q(!1)}},children:[(0,d.jsx)("input",{type:"text",value:M,onChange:e=>I(e.target.value),placeholder:"ROLE_ROLENAME",className:"w-full p-3 border rounded-lg focus:outline-none focus:ring-2 mb-4 ".concat("dark"===s?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300")}),(0,d.jsxs)("div",{className:"flex justify-end gap-4",children:[(0,d.jsx)("button",{type:"button",onClick:()=>z(!1),className:"px-4 py-2 rounded-lg font-medium transition-colors ".concat("dark"===s?"bg-gray-600 hover:bg-gray-500 text-gray-200":"bg-gray-200 hover:bg-gray-300 text-gray-700"),disabled:B,children:"Cancel"}),(0,d.jsx)("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 disabled:bg-blue-400 flex items-center",disabled:B,children:B?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{className:"h-4 w-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Adding..."]}):"Add Role"})]})]})]})}),(0,d.jsx)("div",{className:"min-h-screen px-0 sm:px-4 md:px-6 lg:px-8 py-4 sm:py-6 ".concat("dark"===s?"bg-gray-900 text-white":"bg-gray-50 text-gray-800"),children:(0,d.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,d.jsxs)("div",{className:"mb-6 sm:mb-8 px-4 sm:px-0 flex justify-between items-center",children:[(0,d.jsxs)("div",{children:[(null===j||void 0===j||null===(t=j.permissions)||void 0===t?void 0:t.includes("DELETE_USER"))&&(0,d.jsx)("h1",{className:"text-2xl sm:text-3xl font-bold mb-2",children:"Permissions Management"}),(0,d.jsx)("p",{className:"text-sm ".concat("dark"===s?"text-gray-400":"text-gray-600"),children:"Configure role-based permissions"})]}),(0,d.jsx)("div",{children:(0,d.jsx)("button",{onClick:()=>{V(!Z),H(null)},className:"p-3 rounded-full transition-colors duration-200 ".concat(Z?"bg-blue-600 text-white":"dark"===s?"bg-gray-700 hover:bg-gray-600":"bg-gray-200 hover:bg-gray-300"),title:Z?"Cancel Edit":"Edit Roles",children:(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.5L14.732 3.732z"})})})})]}),(0,d.jsx)("div",{className:"p-4 sm:p-6 rounded-lg shadow-md mb-8 ".concat("dark"===s?"bg-gray-800":"bg-white"),children:(0,d.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start gap-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Add a New Permission"}),(0,d.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,d.jsx)("input",{type:"text",value:P,onChange:e=>L(e.target.value),placeholder:"Enter new permission label",className:"flex-grow p-3 border rounded-lg ".concat("dark"===s?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300")}),(0,d.jsx)("button",{type:"button",onClick:()=>{if(!P.trim())return void K("error","Validation Error","Please enter a label for the new permission.");const e=P.trim().toUpperCase().replace(/\s+/g,"_");if(D.some(t=>t.value===e))return void K("error","Duplicate Permission","A permission with this value already exists.");const t={value:e,label:P.trim()};U(e=>[...e,t].sort((e,t)=>e.label.localeCompare(t.label))),L(""),K("success","Permission Added","New permission has been added successfully.")},className:"px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700",children:"Add Permission"})]})]}),(0,d.jsxs)("div",{className:"flex-shrink-0 mt-4 sm:mt-0",children:[(0,d.jsx)("h3",{className:"text-lg font-semibold mb-2 text-transparent select-none hidden sm:block",children:"."}),(0,d.jsx)("button",{onClick:()=>z(!0),className:"w-full px-6 py-3 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700",children:"Add New Role"})]})]})}),(0,d.jsxs)("div",{className:"space-y-4 sm:space-y-6 md:space-y-8",children:[Y.map(e=>{const t=D.filter(t=>{var s,r;return null===(s=h[e])||void 0===s||null===(r=s.permissions)||void 0===r?void 0:r.includes(t.value)});return(0,d.jsx)("div",{className:"mx-4 sm:mx-0 rounded-lg shadow-md border transition-all duration-300 ".concat(W===e?"border-red-500 ring-2 ring-red-500/50":"dark"===s?"border-gray-700":"border-gray-200"),children:(0,d.jsxs)("div",{className:"p-4 sm:p-6 md:p-8 flex items-start gap-4",children:[Z&&(0,d.jsx)("input",{type:"checkbox",className:"mt-2 h-6 w-6 rounded border-gray-300 text-blue-600 focus:ring-blue-500 disabled:opacity-50 cursor-pointer",checked:W===e,onChange:()=>{return t=e,void H(e=>e===t?null:t);var t},disabled:null!==W&&W!==e}),(0,d.jsxs)("div",{className:"flex-grow",children:[(0,d.jsx)("h2",{className:"text-lg sm:text-xl font-semibold capitalize mb-4 pb-2 border-b ".concat("dark"===s?"border-gray-700":"border-gray-200"),children:e.replace(/_/g," ")}),(0,d.jsx)(n.Ay,{isMulti:!0,options:D,value:t,onChange:t=>((e,t)=>{const s=e?e.map(e=>e.value):[];p(e=>(0,r.A)((0,r.A)({},e),{},{[t]:(0,r.A)((0,r.A)({},e[t]),{},{permissions:s})}))})(t,e),styles:X,placeholder:"Select permissions...",closeMenuOnSelect:!1,isDisabled:Z}),(0,d.jsxs)("p",{className:"text-xs mt-3 ".concat("dark"===s?"text-gray-400":"text-gray-500"),children:[t.length," permission(s) selected"]})]})]})},e)}),(0,d.jsx)("div",{className:"pt-4 sm:pt-6 px-4 sm:px-0",children:(0,d.jsx)("div",{className:"flex flex-col sm:flex-row justify-end gap-3 sm:gap-4",children:Z?(0,d.jsx)("button",{type:"button",onClick:async()=>{if(!W)return void K("error","No Role Selected","Please select a role to delete.");const e="ROLE_".concat(W.toUpperCase());!function(e,t,s,r){E({isOpen:!0,title:e,message:t,confirmText:s,onConfirm:r,type:arguments.length>4&&void 0!==arguments[4]?arguments[4]:"warning",isConfirming:!1})}("Delete Role","Are you sure you want to delete the role: ".concat(e,"? This action cannot be undone."),"Delete Role",async()=>{E(e=>(0,r.A)((0,r.A)({},e),{},{isConfirming:!0}));try{const t="ADMIN";await c.ZQ.delete("role-access/delete/".concat(t,"/").concat(e));const s=await c.ZQ.get("/role-access/all");b(s.data),q(),K("success","Role Deleted","Role '".concat(e,"' has been deleted successfully.")),H(null),V(!1)}catch(a){var t,s;console.error("Failed to delete role:",a);const e=(null===(t=a.response)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.message)||"An error occurred while deleting the role.";q(),K("error","Delete Failed","Error: ".concat(e))}},"danger")},disabled:!W,className:"w-full sm:w-auto px-8 py-3 bg-red-600 text-white font-bold rounded-lg shadow-lg disabled:bg-red-400 disabled:cursor-not-allowed",children:"Delete Selected Role"}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("button",{type:"button",onClick:()=>{if(x&&Array.isArray(x)){const e=J();p(e),K("success","Permissions Reset","Permissions have been reset to their original state.")}},className:"w-full sm:w-auto px-6 py-3 border-2 rounded-lg font-semibold ".concat("dark"===s?"border-gray-600 text-gray-200 hover:bg-gray-600":"border-gray-300 text-gray-700 hover:bg-gray-100"),children:"Reset"}),(0,d.jsx)("button",{type:"button",onClick:async e=>{e.preventDefault(),v(!0);const t=Object.keys(h).map(e=>{const t={roleName:"ROLE_".concat(e.toUpperCase()),permissions:h[e].permissions||[]};return null!==h[e].id&&(t.id=h[e].id),t});try{await c.ZQ.post("role-access/updateAll",t);const e=await c.ZQ.get("/role-access/all");b(e.data),K("success","Permissions Saved","Permissions have been saved successfully!")}catch(a){var s,r;console.error("Error saving permissions:",a);const e=(null===(s=a.response)||void 0===s||null===(r=s.data)||void 0===r?void 0:r.message)||"An error occurred while saving permissions.";K("error","Save Failed","Error: ".concat(e))}finally{v(!1)}},disabled:w,className:"w-full sm:w-auto flex items-center justify-center gap-2 px-8 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-bold rounded-lg ".concat(w?"cursor-not-allowed opacity-75":"hover:shadow-lg"),children:w?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{className:"h-4 w-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Saving..."]}):"Save Permissions"})]})})})]})]})}),(0,d.jsx)(m,{isOpen:k.isOpen,onClose:()=>{C({isOpen:!1,type:"",title:"",message:""})},type:k.type,title:k.title,message:k.message,theme:s}),(0,d.jsx)(u,{isOpen:S.isOpen,onClose:q,onConfirm:S.onConfirm,title:S.title,message:S.message,confirmText:S.confirmText,isConfirming:S.isConfirming,theme:s,type:S.type})]})}}}]);
//# sourceMappingURL=89.e8c2b7af.chunk.js.map