"use strict";(self.webpackChunktechlife=self.webpackChunktechlife||[]).push([[89],{6089:(e,s,r)=>{r.r(s),r.d(s,{default:()=>i});var t=r(5043),l=r(3679),a=r(9910),o=r(2397),n=r(579);const i=()=>{var e,s;const{theme:r,permissionsdata:i,userData:d,setPermissionsData:c}=(0,t.useContext)(a.ob),[u,m]=(0,t.useState)({}),[p,b]=(0,t.useState)(!0),[g,x]=(0,t.useState)(!1),[h,y]=(0,t.useState)(null),[f,v]=(0,t.useState)(!1),w=null===d||void 0===d||null===(e=d.roles[0])||void 0===e?void 0:e.toUpperCase(),j=w||null;console.log("Searching for role:",j);const N=i.find(e=>e.roleName.trim()===j.trim());(0,t.useEffect)(()=>{N&&y(N)},[N]),console.log("Found object:",h);const[E,k]=(0,t.useState)(""),[C,S]=(0,t.useState)([]),[A,R]=(0,t.useState)(!1),[_,L]=(0,t.useState)(""),[T,U]=(0,t.useState)(!1),[P,O]=(0,t.useState)(!1),[D,$]=(0,t.useState)(null),M=e=>e?e.replace("ROLE_","").toLowerCase():null,I=()=>{if(!i||!Array.isArray(i))return{};const e={};return i.forEach(s=>{const r=M(s.roleName);r&&(e[r]={id:s.id,permissions:s.permissions?[...new Set(s.permissions)]:[]})}),e};(0,t.useEffect)(()=>{if(i&&Array.isArray(i)){const e=(()=>{if(!i||!Array.isArray(i))return[];const e=i.flatMap(e=>e.permissions||[]);return[...new Set(e)].map(e=>{let s=e.replace(/_/g," ").toLowerCase().replace(/\b\w/g,e=>e.toUpperCase());return"CREAT_USER"===e&&(s="Create User"),"DELETE_USER"===e&&(s="Delete User"),"CREATE_TASK"===e&&(s="Create Task"),"VIEW_TASKS"===e&&(s="View Tasks"),"VIEW_REPORTS"===e&&(s="View Reports"),"PERMISSIONS_BUTTENS"===e&&(s="Permissions Buttons"),"CREATE_HR"===e&&(s="Create HR"),{value:e,label:s}}).sort((e,s)=>e.label.localeCompare(s.label))})();S(e);const s=I();m(s),b(!1),v(!0)}else b(!1)},[i]);const Q={};if(p)return(0,n.jsx)("div",{children:"Loading..."});const Z=Object.keys(u).sort();return(0,n.jsxs)(n.Fragment,{children:[A&&(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,n.jsxs)("div",{className:"p-6 rounded-lg shadow-xl "+("dark"===r?"bg-gray-800":"bg-white"),children:[(0,n.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Add a New Role"}),(0,n.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),!_.trim()||!_.toUpperCase().startsWith("ROLE_"))return void alert("Please enter a valid role name starting with 'ROLE_'.");const s=M(_);if(u[s])return void alert("This role already exists.");U(!0);const r={roleName:_.trim().toUpperCase(),permissions:[]};try{await o.ZQ.post("/role-access",r);const e=await o.ZQ.get("/role-access/all");c(e.data),R(!1),L(""),alert(`Role '${r.roleName}' created successfully and UI has been updated!`)}catch(a){var t,l;console.error("Failed to create new role or refresh data:",a);const e=(null===(t=a.response)||void 0===t||null===(l=t.data)||void 0===l?void 0:l.message)||"An error occurred.";alert(`Error: ${e}`)}finally{U(!1)}},children:[(0,n.jsx)("input",{type:"text",value:_,onChange:e=>L(e.target.value),placeholder:"ROLE_ROLENAME",className:"w-full p-3 border rounded-lg focus:outline-none focus:ring-2 mb-4 "+("dark"===r?"bg-gray-700 border-gray-600":"bg-white border-gray-300")}),(0,n.jsxs)("div",{className:"flex justify-end gap-4",children:[(0,n.jsx)("button",{type:"button",onClick:()=>R(!1),className:"px-4 py-2 rounded "+("dark"===r?"bg-gray-600":"bg-gray-200"),disabled:T,children:"Cancel"}),(0,n.jsx)("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 disabled:bg-blue-400",disabled:T,children:T?"Adding...":"Add Role"})]})]})]})}),(0,n.jsx)("div",{className:"min-h-screen px-0 sm:px-4 md:px-6 lg:px-8 py-4 sm:py-6 "+("dark"===r?"bg-gray-900 text-white":"bg-gray-50 text-gray-800"),children:(0,n.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,n.jsxs)("div",{className:"mb-6 sm:mb-8 px-4 sm:px-0 flex justify-between items-center",children:[(0,n.jsxs)("div",{children:[(null===h||void 0===h||null===(s=h.permissions)||void 0===s?void 0:s.includes("DELETE_USER"))&&(0,n.jsx)("h1",{className:"text-2xl sm:text-3xl font-bold mb-2",children:"Permissions Management"}),(0,n.jsx)("p",{className:"text-sm "+("dark"===r?"text-gray-400":"text-gray-600"),children:"Configure role-based permissions"})]}),(0,n.jsx)("div",{children:(0,n.jsx)("button",{onClick:()=>{O(!P),$(null)},className:"p-3 rounded-full transition-colors duration-200 "+(P?"bg-blue-600 text-white":"dark"===r?"bg-gray-700 hover:bg-gray-600":"bg-gray-200 hover:bg-gray-300"),title:P?"Cancel Edit":"Edit Roles",children:(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.5L14.732 3.732z"})})})})]}),(0,n.jsx)("div",{className:"p-4 sm:p-6 rounded-lg shadow-md mb-8 "+("dark"===r?"bg-gray-800":"bg-white"),children:(0,n.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Add a New Permission"}),(0,n.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,n.jsx)("input",{type:"text",value:E,onChange:e=>k(e.target.value),placeholder:"Enter new permission label",className:"flex-grow p-3 border rounded-lg "+("dark"===r?"bg-gray-700 border-gray-600":"bg-white border-gray-300")}),(0,n.jsx)("button",{type:"button",onClick:()=>{if(!E.trim())return void alert("Please enter a label for the new permission.");const e=E.trim().toUpperCase().replace(/\s+/g,"_");if(C.some(s=>s.value===e))return void alert("A permission with this value already exists.");const s={value:e,label:E.trim()};S(e=>[...e,s].sort((e,s)=>e.label.localeCompare(s.label))),k("")},className:"px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700",children:"Add Permission"})]})]}),(0,n.jsxs)("div",{className:"flex-shrink-0 mt-4 sm:mt-0",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold mb-2 text-transparent select-none hidden sm:block",children:"."}),(0,n.jsx)("button",{onClick:()=>R(!0),className:"w-full px-6 py-3 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700",children:"Add New Role"})]})]})}),(0,n.jsxs)("div",{className:"space-y-4 sm:space-y-6 md:space-y-8",children:[Z.map(e=>{const s=C.filter(s=>{var r,t;return null===(r=u[e])||void 0===r||null===(t=r.permissions)||void 0===t?void 0:t.includes(s.value)});return(0,n.jsx)("div",{className:"mx-4 sm:mx-0 rounded-lg shadow-md border transition-all duration-300 "+(D===e?"border-red-500 ring-2 ring-red-500/50":"dark"===r?"border-gray-700":"border-gray-200"),children:(0,n.jsxs)("div",{className:"p-4 sm:p-6 md:p-8 flex items-start gap-4",children:[P&&(0,n.jsx)("input",{type:"checkbox",className:"mt-2 h-6 w-6 rounded border-gray-300 text-blue-600 focus:ring-blue-500 disabled:opacity-50 cursor-pointer",checked:D===e,onChange:()=>{return s=e,void $(e=>e===s?null:s);var s},disabled:null!==D&&D!==e}),(0,n.jsxs)("div",{className:"flex-grow",children:[(0,n.jsx)("h2",{className:"text-lg sm:text-xl font-semibold capitalize mb-4 pb-2 border-b "+("dark"===r?"border-gray-700":"border-gray-200"),children:e.replace(/_/g," ")}),(0,n.jsx)(l.Ay,{isMulti:!0,options:C,value:s,onChange:s=>((e,s)=>{const r=e?e.map(e=>e.value):[];m(e=>({...e,[s]:{...e[s],permissions:r}}))})(s,e),styles:Q,placeholder:"Select permissions...",closeMenuOnSelect:!1,isDisabled:P}),(0,n.jsxs)("p",{className:"text-xs mt-3 "+("dark"===r?"text-gray-400":"text-gray-500"),children:[s.length," permission(s) selected"]})]})]})},e)}),(0,n.jsx)("div",{className:"pt-4 sm:pt-6 px-4 sm:px-0",children:(0,n.jsx)("div",{className:"flex flex-col sm:flex-row justify-end gap-3 sm:gap-4",children:P?(0,n.jsx)("button",{type:"button",onClick:async()=>{if(!D)return void alert("Please select a role to delete.");const e=`ROLE_${D.toUpperCase()}`;if(window.confirm(`Are you sure you want to delete the role: ${e}? This action cannot be undone.`))try{const s="ADMIN";await o.ZQ.delete(`role-access/delete/${s}/${e}`);const r=await o.ZQ.get("/role-access/all");c(r.data),alert(`Role '${e}' has been deleted successfully.`),$(null),O(!1)}catch(t){var s,r;console.error("Failed to delete role:",t);const e=(null===(s=t.response)||void 0===s||null===(r=s.data)||void 0===r?void 0:r.message)||"An error occurred while deleting the role.";alert(`Error: ${e}`)}},disabled:!D,className:"w-full sm:w-auto px-8 py-3 bg-red-600 text-white font-bold rounded-lg shadow-lg disabled:bg-red-400 disabled:cursor-not-allowed",children:"Delete Selected Role"}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("button",{type:"button",onClick:()=>{if(i&&Array.isArray(i)){const e=I();m(e),alert("Permissions have been reset to their original state.")}},className:"w-full sm:w-auto px-6 py-3 border-2 rounded-lg font-semibold "+("dark"===r?"border-gray-600":"border-gray-300"),children:"Reset"}),(0,n.jsx)("button",{type:"button",onClick:async e=>{e.preventDefault(),x(!0);const s=Object.keys(u).map(e=>{const s={roleName:`ROLE_${e.toUpperCase()}`,permissions:u[e].permissions||[]};return null!==u[e].id&&(s.id=u[e].id),s});try{await o.ZQ.post("role-access/updateAll",s);const e=await o.ZQ.get("/role-access/all");c(e.data),alert("Permissions have been saved successfully!")}catch(l){var r,t;console.error("Error saving permissions:",l);const e=(null===(r=l.response)||void 0===r||null===(t=r.data)||void 0===t?void 0:t.message)||"An error occurred while saving permissions.";alert(`Error: ${e}`)}finally{x(!1)}},disabled:g,className:"w-full sm:w-auto flex items-center justify-center gap-2 px-8 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-bold rounded-lg "+(g?"cursor-not-allowed":""),children:g?"Saving...":"Save Permissions"})]})})})]})]})})]})}}}]);
//# sourceMappingURL=89.87abd664.chunk.js.map