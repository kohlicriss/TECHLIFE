{"version":3,"file":"static/js/89.aefef72c.chunk.js","mappings":"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","sources":["TechLife/HRMS/Components/Permissions/PermissionsPage.jsx"],"sourcesContent":["import React, { useState, useContext, useEffect } from 'react';\r\nimport Select from 'react-select';\r\nimport { Context } from '../HrmsContext';\r\nimport { authApi } from '../../../../axiosInstance';\r\n\r\nconst PermissionsPage = () => {\r\n  const { theme, permissionsdata, userData, setPermissionsData } = useContext(Context);\r\n  const [permissions, setPermissions] = useState({});\r\n  const [loading, setLoading] = useState(true);\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const [matchedObject,setMatchedObject]=useState(null)\r\n\r\n  const [isLoaded, setIsLoaded] = useState(false);\r\nconst userRole = userData?.roles[0]?.toUpperCase();\r\n\r\nconst loggedinuserRole = userRole ? userRole : null;\r\n\r\nconsole.log('Searching for role:',loggedinuserRole);\r\n\r\nconst matchedRoleObject = permissionsdata.find(\r\n  role => role.roleName.trim() === loggedinuserRole.trim()\r\n);\r\n\r\nuseEffect(() => {\r\n  if (matchedRoleObject) {\r\n    setMatchedObject(matchedRoleObject);\r\n  }\r\n}, [matchedRoleObject]);\r\n\r\nconsole.log('Found object:', matchedObject);\r\n  \r\n  const [newPermissionLabel, setNewPermissionLabel] = useState('');\r\n  const [allPermissionOptions, setAllPermissionOptions] = useState([]);\r\n\r\n  const [isAddRoleModalOpen, setIsAddRoleModalOpen] = useState(false);\r\n  const [newRoleName, setNewRoleName] = useState('');\r\n  const [isAddingRole, setIsAddingRole] = useState(false);\r\n\r\n  const [isEditMode, setIsEditMode] = useState(false);\r\n  const [roleToDelete, setRoleToDelete] = useState(null);\r\n\r\n  const createPermissionOptionsFromAPI = () => {\r\n    if (!permissionsdata || !Array.isArray(permissionsdata)) return [];\r\n    const allPermissionsFromAPI = permissionsdata.flatMap(role => role.permissions || []);\r\n    const uniquePermissions = [...new Set(allPermissionsFromAPI)];\r\n    const permissionOptions = uniquePermissions.map(permission => {\r\n      let label = permission.replace(/_/g, ' ').toLowerCase().replace(/\\b\\w/g, l => l.toUpperCase());\r\n      if (permission === 'CREAT_USER') label = 'Create User';\r\n      if (permission === 'DELETE_USER') label = 'Delete User';\r\n      if (permission === 'CREATE_TASK') label = 'Create Task';\r\n      if (permission === 'VIEW_TASKS') label = 'View Tasks';\r\n      if (permission === 'VIEW_REPORTS') label = 'View Reports';\r\n      if (permission === 'PERMISSIONS_BUTTENS') label = 'Permissions Buttons';\r\n      if (permission === 'CREATE_HR') label = 'Create HR';\r\n      return { value: permission, label };\r\n    });\r\n    return permissionOptions.sort((a, b) => a.label.localeCompare(b.label));\r\n  };\r\n\r\n  const mapAPIRoleToKey = (apiRoleName) => {\r\n    if (!apiRoleName) return null;\r\n    return apiRoleName.replace('ROLE_', '').toLowerCase();\r\n  };\r\n\r\n  const initializePermissionsFromAPI = () => {\r\n    if (!permissionsdata || !Array.isArray(permissionsdata)) return {};\r\n    const initialPermissions = {};\r\n    permissionsdata.forEach(apiRole => {\r\n      const roleKey = mapAPIRoleToKey(apiRole.roleName);\r\n      if (roleKey) {\r\n        initialPermissions[roleKey] = {\r\n          id: apiRole.id,\r\n          permissions: apiRole.permissions ? [...new Set(apiRole.permissions)] : []\r\n        };\r\n      }\r\n    });\r\n    return initialPermissions;\r\n  };\r\n  \r\n  const handleAddPermission = () => {\r\n    if (!newPermissionLabel.trim()) {\r\n      alert(\"Please enter a label for the new permission.\");\r\n      return;\r\n    }\r\n    const newPermissionValue = newPermissionLabel.trim().toUpperCase().replace(/\\s+/g, '_');\r\n    if (allPermissionOptions.some(option => option.value === newPermissionValue)) {\r\n      alert(\"A permission with this value already exists.\");\r\n      return;\r\n    }\r\n    const newPermission = { value: newPermissionValue, label: newPermissionLabel.trim() };\r\n    setAllPermissionOptions(prevOptions => [...prevOptions, newPermission].sort((a, b) => a.label.localeCompare(b.label)));\r\n    setNewPermissionLabel('');\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (permissionsdata && Array.isArray(permissionsdata)) {\r\n      const permissionOptions = createPermissionOptionsFromAPI();\r\n      setAllPermissionOptions(permissionOptions);\r\n      const initializedPermissions = initializePermissionsFromAPI();\r\n      setPermissions(initializedPermissions);\r\n      setLoading(false);\r\n      setIsLoaded(true);\r\n    } else { setLoading(false); }\r\n  }, [permissionsdata]);\r\n\r\n  const handleSelectionChange = (selectedOptions, role) => {\r\n    const selectedValues = selectedOptions ? selectedOptions.map(option => option.value) : [];\r\n    setPermissions(prev => ({\r\n      ...prev,\r\n      [role]: { ...prev[role], permissions: selectedValues }\r\n    }));\r\n  };\r\n\r\n  const handleAddNewRole = async (e) => {\r\n    e.preventDefault();\r\n    if (!newRoleName.trim() || !newRoleName.toUpperCase().startsWith('ROLE_')) {\r\n      alert(\"Please enter a valid role name starting with 'ROLE_'.\");\r\n      return;\r\n    }\r\n    const roleKey = mapAPIRoleToKey(newRoleName);\r\n    if (permissions[roleKey]) {\r\n      alert(\"This role already exists.\");\r\n      return;\r\n    }\r\n    setIsAddingRole(true);\r\n    const newRoleDto = {\r\n      roleName: newRoleName.trim().toUpperCase(),\r\n      permissions: []\r\n    };\r\n    try {\r\n      await authApi.post('/role-access', newRoleDto);\r\n      const response = await authApi.get('/role-access/all');\r\n      setPermissionsData(response.data);\r\n      setIsAddRoleModalOpen(false);\r\n      setNewRoleName('');\r\n      alert(`Role '${newRoleDto.roleName}' created successfully and UI has been updated!`);\r\n    } catch (error) {\r\n      console.error(\"Failed to create new role or refresh data:\", error);\r\n      const errorMessage = error.response?.data?.message || \"An error occurred.\";\r\n      alert(`Error: ${errorMessage}`);\r\n    } finally {\r\n      setIsAddingRole(false);\r\n    }\r\n  };\r\n\r\n  // *** MODIFIED FUNCTION ***\r\n  // Now sends the updated permissions to the `role-access/updateAll` endpoint.\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    setIsSubmitting(true);\r\n\r\n    const transformedPermissions = Object.keys(permissions).map(key => {\r\n      const rolePayload = {\r\n        roleName: `ROLE_${key.toUpperCase()}`,\r\n        permissions: permissions[key].permissions || [],\r\n      };\r\n      if (permissions[key].id !== null) {\r\n        rolePayload.id = permissions[key].id;\r\n      }\r\n      return rolePayload;\r\n    });\r\n\r\n    try {\r\n      // Hitting the new endpoint as requested\r\n      await authApi.post('role-access/updateAll', transformedPermissions);\r\n\r\n      // Refresh data from the server to ensure UI is in sync\r\n      const response = await authApi.get('/role-access/all');\r\n      setPermissionsData(response.data);\r\n\r\n      alert(\"Permissions have been saved successfully!\");\r\n\r\n    } catch (error) {\r\n      console.error(\"Error saving permissions:\", error);\r\n      const errorMessage = error.response?.data?.message || \"An error occurred while saving permissions.\";\r\n      alert(`Error: ${errorMessage}`);\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  const handleReset = () => {\r\n    if (permissionsdata && Array.isArray(permissionsdata)) {\r\n        const initializedPermissions = initializePermissionsFromAPI();\r\n        setPermissions(initializedPermissions);\r\n        alert(\"Permissions have been reset to their original state.\");\r\n    }\r\n  };\r\n\r\n  const handleCheckboxChange = (roleKey) => {\r\n    setRoleToDelete(prev => (prev === roleKey ? null : roleKey));\r\n  };\r\n\r\n  const handleDeleteRole = async () => {\r\n    if (!roleToDelete) {\r\n      alert(\"Please select a role to delete.\");\r\n      return;\r\n    }\r\n    const roleToDeleteName = `ROLE_${roleToDelete.toUpperCase()}`;\r\n    if (!window.confirm(`Are you sure you want to delete the role: ${roleToDeleteName}? This action cannot be undone.`)) {\r\n      return;\r\n    }\r\n    try {\r\n      const callerRole = 'ADMIN';\r\n      await authApi.delete(`role-access/delete/${callerRole}/${roleToDeleteName}`);\r\n      const response = await authApi.get('/role-access/all');\r\n      setPermissionsData(response.data);\r\n      alert(`Role '${roleToDeleteName}' has been deleted successfully.`);\r\n      setRoleToDelete(null);\r\n      setIsEditMode(false);\r\n    } catch (error) {\r\n      console.error(\"Failed to delete role:\", error);\r\n      const errorMessage = error.response?.data?.message || \"An error occurred while deleting the role.\";\r\n      alert(`Error: ${errorMessage}`);\r\n    }\r\n  };\r\n\r\n  const customSelectStyles = { /* Your custom styles */ };\r\n  if (loading) { return <div>Loading...</div> }\r\n  const rolesToRender = Object.keys(permissions).sort();\r\n\r\n  return (\r\n    <>\r\n      {isAddRoleModalOpen && (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\r\n          <div className={`p-6 rounded-lg shadow-xl ${theme === 'dark' ? 'bg-gray-800' : 'bg-white'}`}>\r\n            <h2 className=\"text-xl font-bold mb-4\">Add a New Role</h2>\r\n            <form onSubmit={handleAddNewRole}>\r\n              <input\r\n                type=\"text\"\r\n                value={newRoleName}\r\n                onChange={(e) => setNewRoleName(e.target.value)}\r\n                placeholder=\"ROLE_ROLENAME\"\r\n                className={`w-full p-3 border rounded-lg focus:outline-none focus:ring-2 mb-4 ${theme === 'dark' ? 'bg-gray-700 border-gray-600' : 'bg-white border-gray-300'}`}\r\n              />\r\n              <div className=\"flex justify-end gap-4\">\r\n                <button type=\"button\" onClick={() => setIsAddRoleModalOpen(false)} className={`px-4 py-2 rounded ${theme === 'dark' ? 'bg-gray-600' : 'bg-gray-200'}`} disabled={isAddingRole}>Cancel</button>\r\n                <button type=\"submit\" className=\"px-4 py-2 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 disabled:bg-blue-400\" disabled={isAddingRole}>\r\n                  {isAddingRole ? 'Adding...' : 'Add Role'}\r\n                </button>\r\n              </div>\r\n            </form>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      <div className={`min-h-screen px-0 sm:px-4 md:px-6 lg:px-8 py-4 sm:py-6 ${theme === 'dark' ? 'bg-gray-900 text-white' : 'bg-gray-50 text-gray-800'}`}>\r\n        <div className=\"max-w-6xl mx-auto\">\r\n          <div className=\"mb-6 sm:mb-8 px-4 sm:px-0 flex justify-between items-center\">\r\n            <div>\r\n{matchedObject?.permissions?.includes(\"DELETE_USER\") && (\r\n  <h1 className=\"text-2xl sm:text-3xl font-bold mb-2\">\r\n    Permissions Management\r\n  </h1>\r\n)}\r\n              <p className={`text-sm ${theme === 'dark' ? 'text-gray-400' : 'text-gray-600'}`}>Configure role-based permissions</p>\r\n            </div>\r\n            <div>\r\n              <button \r\n                onClick={() => { setIsEditMode(!isEditMode); setRoleToDelete(null); }}\r\n                className={`p-3 rounded-full transition-colors duration-200 ${isEditMode ? 'bg-blue-600 text-white' : (theme === 'dark' ? 'bg-gray-700 hover:bg-gray-600' : 'bg-gray-200 hover:bg-gray-300')}`}\r\n                title={isEditMode ? \"Cancel Edit\" : \"Edit Roles\"}\r\n              >\r\n                <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-6 w-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.5L14.732 3.732z\" /></svg>\r\n              </button>\r\n            </div>\r\n          </div>\r\n          \r\n          <div className={`p-4 sm:p-6 rounded-lg shadow-md mb-8 ${theme === 'dark' ? 'bg-gray-800' : 'bg-white'}`}>\r\n            <div className=\"flex flex-col sm:flex-row justify-between items-start gap-4\">\r\n              <div>\r\n                <h3 className=\"text-lg font-semibold mb-2\">Add a New Permission</h3>\r\n                <div className=\"flex flex-col sm:flex-row gap-4\">\r\n                  <input type=\"text\" value={newPermissionLabel} onChange={(e) => setNewPermissionLabel(e.target.value)} placeholder=\"Enter new permission label\" className={`flex-grow p-3 border rounded-lg ${theme === 'dark' ? 'bg-gray-700 border-gray-600' : 'bg-white border-gray-300'}`} />\r\n                  <button type=\"button\" onClick={handleAddPermission} className=\"px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700\">Add Permission</button>\r\n                </div>\r\n              </div>\r\n              <div className=\"flex-shrink-0 mt-4 sm:mt-0\">\r\n                 <h3 className=\"text-lg font-semibold mb-2 text-transparent select-none hidden sm:block\">.</h3>\r\n                 <button onClick={() => setIsAddRoleModalOpen(true)} className=\"w-full px-6 py-3 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700\">Add New Role</button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          \r\n          <div className=\"space-y-4 sm:space-y-6 md:space-y-8\">\r\n            {rolesToRender.map((role) => {\r\n              const selectedPermissionsForRole = allPermissionOptions.filter(\r\n                option => permissions[role]?.permissions?.includes(option.value)\r\n              );\r\n              return (\r\n                <div key={role} className={`mx-4 sm:mx-0 rounded-lg shadow-md border transition-all duration-300 ${roleToDelete === role ? 'border-red-500 ring-2 ring-red-500/50' : (theme === 'dark' ? 'border-gray-700' : 'border-gray-200')}`}>\r\n                  <div className=\"p-4 sm:p-6 md:p-8 flex items-start gap-4\">\r\n                    {isEditMode && (\r\n                      <input type=\"checkbox\" className=\"mt-2 h-6 w-6 rounded border-gray-300 text-blue-600 focus:ring-blue-500 disabled:opacity-50 cursor-pointer\" checked={roleToDelete === role} onChange={() => handleCheckboxChange(role)} disabled={roleToDelete !== null && roleToDelete !== role} />\r\n                    )}\r\n                    <div className=\"flex-grow\">\r\n                      <h2 className={`text-lg sm:text-xl font-semibold capitalize mb-4 pb-2 border-b ${theme === 'dark' ? 'border-gray-700' : 'border-gray-200'}`}>{role.replace(/_/g, ' ')}</h2>\r\n                      <Select isMulti options={allPermissionOptions} value={selectedPermissionsForRole} onChange={selectedOptions => handleSelectionChange(selectedOptions, role)} styles={customSelectStyles} placeholder=\"Select permissions...\" closeMenuOnSelect={false} isDisabled={isEditMode} />\r\n                      <p className={`text-xs mt-3 ${theme === 'dark' ? 'text-gray-400' : 'text-gray-500'}`}>{selectedPermissionsForRole.length} permission(s) selected</p>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              );\r\n            })}\r\n            \r\n            <div className=\"pt-4 sm:pt-6 px-4 sm:px-0\">\r\n              <div className=\"flex flex-col sm:flex-row justify-end gap-3 sm:gap-4\">\r\n                {isEditMode ? (\r\n                  <button type=\"button\" onClick={handleDeleteRole} disabled={!roleToDelete} className=\"w-full sm:w-auto px-8 py-3 bg-red-600 text-white font-bold rounded-lg shadow-lg disabled:bg-red-400 disabled:cursor-not-allowed\">Delete Selected Role</button>\r\n                ) : (\r\n                  <>\r\n                    <button type=\"button\" onClick={handleReset} className={`w-full sm:w-auto px-6 py-3 border-2 rounded-lg font-semibold ${theme === 'dark' ? 'border-gray-600' : 'border-gray-300'}`}>Reset</button>\r\n                    <button type=\"button\" onClick={handleSubmit} disabled={isSubmitting} className={`w-full sm:w-auto flex items-center justify-center gap-2 px-8 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-bold rounded-lg ${isSubmitting ? 'cursor-not-allowed' : ''}`}>{isSubmitting ? 'Saving...' : 'Save Permissions'}</button>\r\n                  </>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default PermissionsPage;\r\n"],"names":["PermissionsPage","_userData$roles$","_matchedObject$permis","theme","permissionsdata","userData","setPermissionsData","useContext","Context","permissions","setPermissions","useState","loading","setLoading","isSubmitting","setIsSubmitting","matchedObject","setMatchedObject","isLoaded","setIsLoaded","userRole","roles","toUpperCase","loggedinuserRole","console","log","matchedRoleObject","find","role","roleName","trim","useEffect","newPermissionLabel","setNewPermissionLabel","allPermissionOptions","setAllPermissionOptions","isAddRoleModalOpen","setIsAddRoleModalOpen","newRoleName","setNewRoleName","isAddingRole","setIsAddingRole","isEditMode","setIsEditMode","roleToDelete","setRoleToDelete","mapAPIRoleToKey","apiRoleName","replace","toLowerCase","initializePermissionsFromAPI","Array","isArray","initialPermissions","forEach","apiRole","roleKey","id","Set","permissionOptions","createPermissionOptionsFromAPI","allPermissionsFromAPI","flatMap","map","permission","label","l","value","sort","a","b","localeCompare","initializedPermissions","customSelectStyles","_jsx","children","rolesToRender","Object","keys","_jsxs","_Fragment","className","onSubmit","async","e","preventDefault","startsWith","alert","newRoleDto","authApi","post","response","get","data","error","_error$response","_error$response$data","errorMessage","message","type","onChange","target","placeholder","onClick","disabled","includes","title","xmlns","fill","viewBox","stroke","strokeLinecap","strokeLinejoin","strokeWidth","d","handleAddPermission","newPermissionValue","some","option","newPermission","prevOptions","selectedPermissionsForRole","filter","_permissions$role","_permissions$role$per","checked","handleCheckboxChange","prev","Select","isMulti","options","selectedOptions","handleSelectionChange","selectedValues","styles","closeMenuOnSelect","isDisabled","length","roleToDeleteName","window","confirm","callerRole","delete","_error$response3","_error$response3$data","handleReset","transformedPermissions","key","rolePayload","_error$response2","_error$response2$data"],"sourceRoot":""}