{"version":3,"file":"static/js/654.5205f6b6.chunk.js","mappings":"kKAYA,IAAIA,GAAe,EACfC,EAAc,GAElB,MAAMC,EAAe,SAACC,GAAyB,IAAlBC,EAAKC,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAG,KACjCJ,EAAYO,QAAQC,IACZN,EACAM,EAAKC,OAAOP,GAEZM,EAAKE,QAAQP,KAGrBH,EAAc,EAClB,EAEMW,EAAuBC,IACzB,MAAMC,EAAWC,EAAAA,EAAMC,OAAO,CAC1BH,QAASA,IA4Eb,OAzEAC,EAASG,aAAaC,QAAQC,IACzBC,IACG,MAAMhB,EAAQiB,aAAaC,QAAQ,eAKnC,OAJIlB,IACAgB,EAAOG,QAAuB,cAAI,UAAUnB,KAEhDoB,QAAQC,IAAI,sCAAuCL,EAAOG,SACnDH,GAEVjB,GAAUuB,QAAQhB,OAAOP,IAG9BW,EAASG,aAAaU,SAASR,IAC1BQ,GAAaA,EACdC,UAAkB,IAADC,EACb,MAAMC,EAAkB3B,EAAMiB,OAE9B,GAA+B,OAAb,QAAdS,EAAA1B,EAAMwB,gBAAQ,IAAAE,OAAA,EAAdA,EAAgBE,UAAmBD,EAAgBE,OAAQ,CAC3D,GAAIhC,EACA,OAAO,IAAI0B,QAAQ,CAACf,EAASD,KACzBT,EAAYgC,KAAK,CAAEtB,UAASD,aAE/BwB,KAAK9B,IACF0B,EAAgBP,QAAuB,cAAI,UAAUnB,IAC9CU,EAASgB,KAEnBK,MAAMC,GAAOV,QAAQhB,OAAO0B,IAGjCN,EAAgBE,QAAS,EACzBhC,GAAe,EAEf,MAAMqC,EAAWhB,aAAaC,QAAQ,eACtCE,QAAQC,IAAI,kCAAwBZ,gBAAuBwB,GAE3D,IACI,MAAMC,QAAwBvB,EAAAA,EAAMwB,KAjEnC,mEAmEG,CAAC,EACD,CAAEC,iBAAiB,KAGjB,YAAEC,GAAgBH,EAAgBI,KACxCrB,aAAasB,QAAQ,cAAeF,GACpCjB,QAAQC,IAAI,8BAAoBZ,KAAY4B,GAExCX,EAAgBY,gBAAgBE,WAChCd,EAAgBY,KA1ExC,SAAuBG,GACnB,MAAMC,EAAc,IAAIF,SACxB,IAAK,IAAKG,EAAKC,KAAUH,EAASI,UAC9BH,EAAYI,OAAOH,EAAKC,GAE5B,OAAOF,CACX,CAoE+CK,CAAcrB,EAAgBY,OAGzDxC,EAAa,KAAMuC,GAEnB,MAAMW,EAAcxC,EAAoBC,GAGxC,OAFAiB,EAAgBP,QAAuB,cAAI,UAAUkB,IAE9CW,EAAYtB,EAEvB,CAAE,MAAOuB,GAKL,OAJA7B,QAAQrB,MAAM,qCAAsCkD,GACpDhC,aAAaiC,QACbC,OAAOC,SAASC,KAAO,SACvBvD,EAAamD,GACN3B,QAAQhB,OAAO2C,EAE1B,CAAC,QACGrD,GAAe,CACnB,CACJ,CAEA,OAAO0B,QAAQhB,OAAOP,KAIvBW,GAGXyC,OAAOG,iBAAiB,UAAYC,IACd,gBAAdA,EAAMZ,KACNvB,QAAQC,IAAI,6CAAoCkC,EAAMC,YAGvD,MAAMC,EAAUjD,EAAoB,iDAa9BkD,EAAclC,eAAOmC,EAAYC,GAAiC,IAAzBC,EAAI5D,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAG,EAAG6D,EAAI7D,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAG,GACrE,IACE,MAAMsB,QAAiBkC,EAAQM,IAAI,SAASJ,KAAcC,UAAeC,UAAaC,KAEtF,OADA1C,QAAQC,IAAI,8BAA8BwC,KAAStC,GAC5CA,EAASe,IAClB,CAAE,MAAOvC,GAEP,OADAqB,QAAQrB,MAAM,qCAAqC6D,KAAW7D,GACvD,EACT,CACF,E,cCpIO,MAAMiE,EAA0BA,CAACC,EAAMC,KAC1C,IAAKD,EAAKE,aAAoC,iBAArBF,EAAKE,YAC5B,MAAO,GAGT,MAAMC,EAAqBH,EAAKE,YAC1BE,EAASJ,EAAKK,sBAAwBJ,EAAgB,QAAU,GAEtE,GAAID,EAAKM,gBACL,OAAQN,EAAKM,gBAAgBC,eACzB,IAAK,QAAS,OAAOH,EAAS,qBAC9B,IAAK,QAAS,OAAOA,EAAS,6BAC9B,IAAK,OAAQ,OAAOA,EAAS,gBAAMD,IACnC,IAAK,UAAW,MAAO,2BAG/B,OAAIA,EAAmBK,MAAM,+BAClBJ,EAAS,qBAEhBD,EAAmBK,MAAM,8BAClBJ,EAAS,6BAEhBD,EAAmBK,MAAM,gDAClBJ,EAAS,gBAAMD,IAGnBC,EAASD,GAoCPM,EAAkCC,IAC3C,IAAIC,EACJ,IACI,GAAID,EAAOC,UAAW,CAClB,MAAMC,EAAWC,OAAOH,EAAOC,WAC/BA,EAAY,IAAIG,KAAKF,EAASG,SAAS,KAAOH,EAAWA,EAAW,KAAKI,aAC7E,MACIL,EADOD,EAAOO,MAAQP,EAAOQ,KACjB,IAAIJ,KAAK,GAAGJ,EAAOO,QAAQP,EAAOQ,YAAYF,eAE9C,IAAIF,MAAOE,aAE/B,CAAE,MAAOG,GACLR,GAAY,IAAIG,MAAOE,aAC3B,CAEA,IAAII,EAAc,OACdC,EAAUX,EAAOW,SAAW,KAE5BX,EAAOY,SAEuCF,EAD1CV,EAAOa,SACHb,EAAOa,SAASC,WAAW,UAAyB,QAC/Cd,EAAOa,SAASC,WAAW,UAAyB,QACpDd,EAAOa,SAASC,WAAW,UAAyB,QAC1C,OAEfd,EAAOY,SAASd,MAAM,+BAA8C,QAC/DE,EAAOY,SAASd,MAAM,yBAAwC,QAC9DE,EAAOY,SAASd,MAAM,sBAAqC,QACjD,OAEhBE,EAAOe,MAAwB,SAAhBf,EAAOe,OAC7BL,EAAcV,EAAOe,KAAKC,eAG9B,MAAMC,EAAkBjB,EAAOkB,IAAMlB,EAAOmB,UAE5C,IAAKR,GAAW,CAAC,QAAS,QAAS,QAAS,QAAQS,SAASV,IAAgBO,EAAiB,CAE1FN,EAAU,GADM7B,EAAAA,GAAQuC,SAASvF,qBACCmF,GACtC,CAEIjB,EAAOsB,YACPZ,EAAc,WAGlB,MAAMa,EAAUvB,EAAOkB,IAAMlB,EAAOmB,UAEpC,MAAO,CACHD,GAAIK,EACJJ,UAAWI,EACXC,QAASxB,EAAOwB,QAChBC,OAAQzB,EAAOyB,OACfxB,UAAWA,EACXjD,QAAyB,IAAhBgD,EAAO0B,MAA2C,SAA1BvB,OAAOH,EAAO2B,QAAsB,OAAS,OAC9EC,KAAMlB,EACNmB,SAAU7B,EAAO6B,WAAY,EAC7BC,SAAU9B,EAAO+B,SAAU,EAC3BnB,SAAUZ,EAAOY,UAAY,KAC7BD,QAASA,EACTqB,SAAUhC,EAAOgC,UAAY,KAC7BC,SAAUjC,EAAOiC,UAAY,EAC7BC,SAAUlC,EAAOkC,UAAY,KAC7BC,YAAanC,EAAOoC,YAAa,EACjCC,cAAerC,EAAOqC,eAAiB,KACvCC,UAAWtC,EAAOuC,QAClBA,QAASvC,EAAOuC,QAAU,CACtBd,OAAQzB,EAAOuC,QAAQC,SACvBhB,QAASxB,EAAOuC,QAAQf,QACxBiB,kBAAmBzC,EAAOuC,QAAQE,kBAClCb,KAAM5B,EAAOuC,QAAQX,MACrB,O,oDC3GZ,MAAMc,EAAkBC,IACpB,IAAKA,GAAmB,IAAVA,EAAa,MAAO,UAClC,MAEMC,EAAIC,KAAKC,MAAMD,KAAKnG,IAAIiG,GAASE,KAAKnG,IAFlC,OAGV,OAAOqG,YAAYJ,EAAQE,KAAKG,IAHtB,KAG6BJ,IAAIK,QAAQ,IAAM,IAF3C,CAAC,QAAS,KAAM,KAAM,KAAM,MAE2BL,IAGnEM,EAAWC,IAA2C,IAADC,EAAA,IAAzC,SAAExC,EAAQ,UAAEyC,EAAY,YAAYF,EAClD,MAAMG,EAAoB,OAAR1C,QAAQ,IAARA,GAA0B,QAAlBwC,EAARxC,EAAU2C,MAAM,KAAKC,aAAK,IAAAJ,OAAlB,EAARA,EAA4BpC,cAC9C,MAAI,CAAC,OAAOI,SAASkC,IAAmBG,EAAAA,EAAAA,KAACC,EAAAA,IAAS,CAACL,UAAW,gBAAgBA,MAC1E,CAAC,MAAO,QAAQjC,SAASkC,IAAmBG,EAAAA,EAAAA,KAACE,EAAAA,IAAU,CAACN,UAAW,iBAAiBA,MACpF,CAAC,MAAO,QAAQjC,SAASkC,IAAmBG,EAAAA,EAAAA,KAACG,EAAAA,IAAgB,CAACP,UAAW,mBAAmBA,MAC5F,CAAC,MAAO,QAAQjC,SAASkC,IAAmBG,EAAAA,EAAAA,KAACI,EAAAA,GAAW,CAACR,UAAW,kBAAkBA,MACtF,CAAC,MAAO,MAAO,MAAMjC,SAASkC,IAAmBG,EAAAA,EAAAA,KAACK,EAAAA,IAAa,CAACT,UAAW,mBAAmBA,MAC9F,CAAC,MAAO,MAAO,OAAQ,MAAO,QAAQjC,SAASkC,IAAmBG,EAAAA,EAAAA,KAACM,EAAAA,IAAO,CAACV,UAAW,mBAAmBA,MACzG,CAAC,MAAO,MAAO,OAAOjC,SAASkC,IAAmBG,EAAAA,EAAAA,KAACO,EAAAA,IAAW,CAACX,UAAW,iBAAiBA,OACxFI,EAAAA,EAAAA,KAACQ,EAAAA,IAAS,CAACZ,UAAW,iBAAiBA,OAG5Ca,EAAcC,IAA2B,IAA1B,IAAEC,EAAG,YAAEC,GAAaF,EACrC,MAAMG,EAAc,GAAGxF,EAAQuC,SAASvF,qBAAqBsI,EAAIjD,YAE3DK,GACF+C,EAAAA,EAAAA,MAAA,OAAKlB,UAAW,gEAA+DgB,EAAc,cAAgB,eAAgBG,SAAA,EACzHf,EAAAA,EAAAA,KAAA,OAAKJ,UAAU,2CAA0CmB,UACrDf,EAAAA,EAAAA,KAACP,EAAQ,CAACtC,SAAUwD,EAAIxD,SAAUyC,UAAU,gBAEhDkB,EAAAA,EAAAA,MAAA,OAAKlB,UAAU,iCAAgCmB,SAAA,EAC3Cf,EAAAA,EAAAA,KAAA,KAAGJ,UAAW,2BAA0BgB,EAAc,aAAe,iBAAkBG,SAAEJ,EAAIxD,YAC7F6C,EAAAA,EAAAA,KAAA,KAAGJ,UAAW,YAAWgB,EAAc,gBAAkB,iBAAkBG,SAAE9B,EAAe0B,EAAIpC,gBAEpGyB,EAAAA,EAAAA,KAAA,OACIgB,QAAUhE,IACNA,EAAEiE,iBACFjE,EAAEkE,kBACFnG,OAAOoG,KAAKN,EAAa,WAE7BjB,UAAU,kJAAiJmB,UAE3Jf,EAAAA,EAAAA,KAACoB,EAAAA,IAAU,CAAC1F,KAAM,UAI9B,OAAQkF,EAAmH7C,GAArGiC,EAAAA,EAAAA,KAAA,OAAKgB,QAASA,IAAMjG,OAAOoG,KAAKN,EAAa,UAAWjB,UAAU,iBAAgBmB,SAAEhD,KAGxGsD,EAAcC,IAAoE,IAAnE,IAAEC,EAAG,QAAErE,EAAO,SAAEsE,EAAQ,gBAAEC,EAAkB,EAAC,SAAElD,EAAW,GAAG+C,EAC9E,MAAMI,GAAWC,EAAAA,EAAAA,QAAO,OACjBC,EAAWC,IAAgBC,EAAAA,EAAAA,WAAS,IACpCC,EAAUC,IAAeF,EAAAA,EAAAA,UAAS,IAClCtD,EAAUyD,IAAeH,EAAAA,EAAAA,UAASL,IAClCS,EAAUC,IAAeL,EAAAA,EAAAA,UAASP,GAAO,OACzCa,EAAeC,IAAoBP,EAAAA,EAAAA,WAAS,IAEnDQ,EAAAA,EAAAA,WAAU,KACN,MAAMC,EAAQb,EAASc,QACvB,IAAKD,EAAO,OAEZ,MAAME,EAAeA,KACbF,EAAM/D,WAAakE,KAAYH,EAAM/D,SAAW,GAChDyD,EAAYM,EAAM/D,WAGpBmE,EAAeA,IAAMX,EAAYO,EAAMK,aACvCC,EAAcA,IAAMhB,GAAa,GAMvC,OAJAU,EAAMrH,iBAAiB,iBAAkBuH,GACzCF,EAAMrH,iBAAiB,aAAcyH,GACrCJ,EAAMrH,iBAAiB,QAAS2H,GAEzB,KACHN,EAAMO,oBAAoB,iBAAkBL,GAC5CF,EAAMO,oBAAoB,aAAcH,GACxCJ,EAAMO,oBAAoB,QAASD,KAExC,CAACX,IAEJ,MAAMa,EAAiB3J,UACnB,IAAIgJ,EAAJ,CACAC,GAAiB,GACjB,IACI,MAAMlJ,QAAiB6J,MAAM9F,GACvB+F,QAAa9J,EAAS8J,OACtBC,EAAWC,IAAIC,gBAAgBH,GACrCd,EAAYe,EAChB,CAAE,MAAOvL,GACLqB,QAAQrB,MAAM,4BAA6BA,EAC/C,CAAC,QACG0K,GAAiB,EACrB,CAXyB,GAwBvBgB,EAActG,IAChB,IAAKA,GAAQA,IAAS2F,IAAU,MAAO,OAGvC,MAAO,GAFStD,KAAKC,MAAMtC,EAAO,OAClBqC,KAAKC,MAAMtC,EAAO,IACLuG,WAAWC,SAAS,EAAG,QAGlDC,EAAqBhF,EAAYuD,EAAWvD,EAAY,IAAM,EAEpE,OAAK0D,GAuBDpB,EAAAA,EAAAA,MAAA,OAAKlB,UAAU,mCAAkCmB,SAAA,EAC7Cf,EAAAA,EAAAA,KAAA,SAAOyD,IAAK/B,EAAUH,IAAKW,EAAUwB,QAAQ,cAC7C1D,EAAAA,EAAAA,KAAA,UAAQgB,QA5CQ2C,KACfjC,EAASc,UACVZ,EACAF,EAASc,QAAQoB,QAEjBlC,EAASc,QAAQqB,OAAOlK,MAAMqD,GAAKhE,QAAQrB,MAAM,qBAAsBqF,IAE3E6E,GAAcD,KAqCwBhC,UAAW,0EAAyE4B,EAAW,yBAA2B,wCAAyCT,SAChMa,GAAY5B,EAAAA,EAAAA,KAAC8D,EAAAA,IAAO,CAACpI,KAAM,MAASsE,EAAAA,EAAAA,KAAC+D,EAAAA,IAAM,CAACrI,KAAM,GAAIkE,UAAU,YAErEkB,EAAAA,EAAAA,MAAA,OAAKlB,UAAU,yCAAwCmB,SAAA,EACnDf,EAAAA,EAAAA,KAAA,OAAKJ,UAAU,uDAAuDoB,QAAUhE,IAC5E,IAAKwB,EAAU,OACf,MAAMwF,EAAOhH,EAAEiH,cAAcC,wBAEvBC,GADSnH,EAAEoH,QAAUJ,EAAKK,MACNL,EAAKM,MAAS9F,EACpCkD,EAASc,UAASd,EAASc,QAAQI,YAAcuB,IACvDpD,UACEf,EAAAA,EAAAA,KAAA,OAAKuE,MAAO,CAAED,MAAO,GAAGd,MAAyB5D,UAAW,wBAAuB4B,EAAW,WAAa,oBAE/GxB,EAAAA,EAAAA,KAAA,QAAMJ,UAAW,0BAAyB4B,EAAW,gBAAkB,iBAAkBT,SAAEsC,EAAW7E,YApC1GsC,EAAAA,EAAAA,MAAA,OAAKlB,UAAU,mCAAkCmB,SAAA,CAC5CqB,GACGpC,EAAAA,EAAAA,KAAA,OAAKJ,UAAU,kGAAiGmB,UAC5Gf,EAAAA,EAAAA,KAAA,OAAKJ,UAAU,iEAGnBI,EAAAA,EAAAA,KAAA,UAAQgB,QAAS+B,EAAgBnD,UAAU,mJAAkJmB,UACzLf,EAAAA,EAAAA,KAACoB,EAAAA,IAAU,CAAC1F,KAAM,QAG1BoF,EAAAA,EAAAA,MAAA,OAAKlB,UAAU,yCAAwCmB,SAAA,EACnDf,EAAAA,EAAAA,KAAA,KAAGJ,UAAU,wBAAuBmB,SAAC,mBACrCD,EAAAA,EAAAA,MAAA,OAAKlB,UAAU,yCAAwCmB,SAAA,EACnDf,EAAAA,EAAAA,KAAA,QAAMJ,UAAU,wBAAuBmB,SAAE9B,EAAeV,MACxDyB,EAAAA,EAAAA,KAAA,QAAMJ,UAAU,wBAAuBmB,SAAEsC,EAAW7E,eA2BtEgG,EAAkBA,KACpB1D,EAAAA,EAAAA,MAAA,OAAKlB,UAAU,gBAAemB,SAAA,EAC1BD,EAAAA,EAAAA,MAAA,OAAKlB,UAAU,qCAAoCmB,SAAA,EAC/Cf,EAAAA,EAAAA,KAAA,OAAKJ,UAAU,kEACfI,EAAAA,EAAAA,KAAA,OAAKJ,UAAU,uDAEnBkB,EAAAA,EAAAA,MAAA,OAAKlB,UAAU,mCAAkCmB,SAAA,EAC7Cf,EAAAA,EAAAA,KAAA,OAAKJ,UAAU,oDACfI,EAAAA,EAAAA,KAAA,OAAKJ,UAAU,qEAEnBkB,EAAAA,EAAAA,MAAA,OAAKlB,UAAU,qCAAoCmB,SAAA,EAC/Cf,EAAAA,EAAAA,KAAA,OAAKJ,UAAU,kEACfI,EAAAA,EAAAA,KAAA,OAAKJ,UAAU,uDAEnBkB,EAAAA,EAAAA,MAAA,OAAKlB,UAAU,mCAAkCmB,SAAA,EAC7Cf,EAAAA,EAAAA,KAAA,OAAKJ,UAAU,oDACfI,EAAAA,EAAAA,KAAA,OAAKJ,UAAU,qEAEnBkB,EAAAA,EAAAA,MAAA,OAAKlB,UAAU,qCAAoCmB,SAAA,EAC/Cf,EAAAA,EAAAA,KAAA,OAAKJ,UAAU,kEACfI,EAAAA,EAAAA,KAAA,OAAKJ,UAAU,yDAorD3B,QAppDA,SAAwB6E,GAAgF,IAA/E,YAAEC,EAAaC,MAAOC,EAAY,cAAEC,EAAa,QAAEC,EAAO,eAAEC,GAAgBN,EACjG,MAAOO,EAAUC,IAAenD,EAAAA,EAAAA,UAAS,CAAEoD,OAAQ,GAAIC,iBAAkB,MAClEC,EAAYC,IAAiBvD,EAAAA,EAAAA,UAAS,KACtCwD,EAAcC,IAAmBzD,EAAAA,EAAAA,UAAS,OAC1C0D,EAASC,IAAc3D,EAAAA,EAAAA,UAAS,KAChC4D,EAAUC,IAAe7D,EAAAA,EAAAA,UAAS,CAAC,IACnC8D,EAAmBC,IAAwB/D,EAAAA,EAAAA,WAAS,IACpDgE,EAAYC,IAAiBjE,EAAAA,EAAAA,WAAS,IACtCkE,EAAiBC,IAAsBnE,EAAAA,EAAAA,WAAS,IAChDoE,EAAaC,IAAkBrE,EAAAA,EAAAA,WAAS,IACxCsE,EAAcC,IAAmBvE,EAAAA,EAAAA,WAAS,IAC1CwE,EAAiBC,IAAsBzE,EAAAA,EAAAA,UAAS,CAAC,IACjD0E,EAAaC,IAAkB3E,EAAAA,EAAAA,UAAS,CAAE4E,SAAS,EAAOC,EAAG,EAAGC,EAAG,EAAGpB,QAAS,KAAMqB,MAAO,QAC5FC,EAAaC,IAAkBjF,EAAAA,EAAAA,UAAS,CAAE+E,MAAO,KAAMG,gBAAiB,MACxEC,EAAYC,IAAiBpF,EAAAA,EAAAA,UAAS,OACtCqF,EAAaC,IAAkBtF,EAAAA,EAAAA,UAAS,OACxCuF,EAAeC,IAAoBxF,EAAAA,EAAAA,UAAS,OAC5CyF,EAAgBC,IAAqB1F,EAAAA,EAAAA,UAAS,CAAE4E,SAAS,EAAOlB,QAAS,QACzEiC,GAAmBC,KAAwB5F,EAAAA,EAAAA,UAAS,KACpD6F,GAAmBC,KAAwB9F,EAAAA,EAAAA,UAAS,KACpD+F,GAAgBC,KAAqBhG,EAAAA,EAAAA,WAAS,IAC9CiG,GAAoBC,KAAyBlG,EAAAA,EAAAA,WAAS,IACtDmG,GAAsBC,KAA2BpG,EAAAA,EAAAA,WAAS,IAC1DqG,GAAoBC,KAAyBtG,EAAAA,EAAAA,UAAS,aACtDuG,GAAcC,KAAmBxG,EAAAA,EAAAA,UAAS,KAC1CyG,GAAoBC,KAAyB1G,EAAAA,EAAAA,WAAS,IACtD2G,GAAaC,KAAkB5G,EAAAA,EAAAA,UAAS,OACxC6G,GAAiBC,KAAsB9G,EAAAA,EAAAA,WAAS,IAChD+G,GAAaC,KAAkBhH,EAAAA,EAAAA,WAAS,IACxCiH,GAAkBC,KAAuBlH,EAAAA,EAAAA,WAAS,IAClDmH,GAAaC,KAAkBpH,EAAAA,EAAAA,UAAS,CAAC,IACzCqH,GAAcC,KAAmBtH,EAAAA,EAAAA,UAAS,CAAC,IAC3CuH,GAAiBC,KAAsBxH,EAAAA,EAAAA,UAAS,CAAC,IACjDyH,GAAwBC,KAA6B1H,EAAAA,EAAAA,WAAS,IAC9D2H,GAAoBC,KAAyB5H,EAAAA,EAAAA,WAAS,IACtD6H,GAAkBC,KAAuB9H,EAAAA,EAAAA,UAAS,GAEnD+H,IAAmBlI,EAAAA,EAAAA,QAAO,MAC1BmI,IAAmBnI,EAAAA,EAAAA,QAAO,MAC1BoI,IAAcpI,EAAAA,EAAAA,QAAO,MACrBqI,IAAmBrI,EAAAA,EAAAA,QAAO,CAAC,GAC3BsI,IAAetI,EAAAA,EAAAA,QAAO,MACtBuI,IAAmBvI,EAAAA,EAAAA,QAAO,MAC1BwI,IAAiBxI,EAAAA,EAAAA,QAAO,IACxByI,IAAiBzI,EAAAA,EAAAA,QAAO,MACxB0I,IAAiB1I,EAAAA,EAAAA,QAAO,MACxB2I,IAAc3I,EAAAA,EAAAA,QAAO,MACrB4I,IAAoB5I,EAAAA,EAAAA,QAAO,MAC3B6I,IAAiB7I,EAAAA,EAAAA,QAAO,MACxB8I,IAAkB9I,EAAAA,EAAAA,QAAO,MACzB+I,IAAgB/I,EAAAA,EAAAA,QAAO,MACvBgJ,IAAsBhJ,EAAAA,EAAAA,QAAO,MAC7BiJ,IAAuBjJ,EAAAA,EAAAA,QAAO,MAC9BkJ,IAAwBlJ,EAAAA,EAAAA,SAAO,GAC/BmJ,IAAgBnJ,EAAAA,EAAAA,QAAO,CAAC,GAExBoJ,IAAgBC,EAAAA,EAAAA,SAAQ,KAC1B,GAAsB,qBAAXjQ,QAA0BA,OAAOC,SAASiQ,SAAStN,SAAS,SAAU,CAE7E,OADe,IAAIuN,gBAAgBnQ,OAAOC,SAASmQ,QACrCxP,IAAI,KACtB,CACA,OAAO,MACR,IAuCGyP,GAAiB,WAA0B,IAAzBC,EAAQxT,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAG,SAC3BiS,GAAiBtH,SACjBsH,GAAiBtH,QAAQ8I,SAAS,CAC9BC,IAAKzB,GAAiBtH,QAAQgJ,aAC9BH,SAAUA,IAGlBzB,GAAoB,EACxB,GAEAtH,EAAAA,EAAAA,WAAU,KACN,GAAIsC,EAAc,CACd,MAAM6G,EAAiB,CACnBvG,OAAQN,EAAaM,OAAOwG,IAAIC,GAC5BA,EAAKnQ,OAAO8H,aAAeyH,GACrB,IAAKY,EAAMC,mBAAoB,GAC/BD,GAEVxG,iBAAkBP,EAAaO,iBAAiBuG,IAAIC,GAChDA,EAAKnQ,OAAO8H,aAAeyH,GACrB,IAAKY,EAAMC,mBAAoB,GAC/BD,IAGd1G,EAAYwG,GACZ7C,IAAmB,EACvB,GACD,CAAChE,EAAcmG,KAElB,MAAMc,IAAmBC,EAAAA,EAAAA,aAAY1S,MAAOoC,EAAQuQ,KAChD,KAAKA,EAAU,GAAKxC,IAAwC,IAAZwC,GAAiBnG,GAAjE,CAIImG,EAAU,GACVvC,IAA0B,GAC1BqB,GAAsBrI,SAAU,GAEhCqD,GAAqB,GAGzB,IACI,MAAMmG,QAAoB1Q,EAAYoJ,EAAYjH,GAAIjC,EAAQuQ,EAAS,IAGvE,GAFA/S,QAAQC,IAAI,6BAA8B,iCAAkC+S,GAEjD,IAAvBA,EAAYlU,OAEZ,YADAwR,GAAmB2C,IAAI,IAAUA,EAAM,CAACzQ,IAAS,KAIrD,MAAM0Q,EAAsBF,EAAYN,IAAIpP,GAEtC6P,EAAgBrC,GAAiBtH,QACjC4J,EAAuBD,EAAgBA,EAAcX,aAAe,EACpEa,EAAoBF,EAAgBA,EAAcG,UAAY,EAEpE3G,EAAYsG,IAAI,IACTA,EACH,CAACzQ,GAAqB,IAAZuQ,EACJG,EACA,IAAIA,KAAyBD,EAAKzQ,IAAW,OAGnDuQ,EAAU,GACVQ,sBAAsB,KACdJ,IACAA,EAAcG,UAAaH,EAAcX,aAAeY,EAAwBC,KAKjE,IAAvBL,EAAYlU,QACZwR,GAAmB2C,IAAI,IAAUA,EAAM,CAACzQ,IAAS,IAGzD,CAAE,MAAO7D,GACLqB,QAAQrB,MAAM,oCAAoC6D,KAAW7D,EACjE,CAAC,QACOoU,EAAU,GACVvC,IAA0B,GAC1BgD,WAAW,KAAQ3B,GAAsBrI,SAAU,GAAU,MAE7DqD,GAAqB,EAE7B,CApDA,GAqDD,CAACnB,EAAYjH,GAAI8L,GAAwB3D,EAAmBtK,KAC/DgH,EAAAA,EAAAA,WAAU,KACN,IAAKgD,EAAc,OAEnB,MAAM9J,EAAS8J,EAAa9J,OAE5B4N,GAAgB6C,IAAI,IAAUA,EAAM,CAACzQ,GAAS,KAC9C8N,GAAmB2C,IAAI,IAAUA,EAAM,CAACzQ,IAAS,KACjDmK,EAAYsG,IAAI,IAAUA,EAAM,CAACzQ,GAAS,MAE1CqQ,GAAiBrQ,EAAQ,GAEEpC,WACvB,IACI,MAAMqT,OFrNUrT,OAAOoC,EAAQkR,EAAUC,KACvD,IACE,MAAMxT,QAAiBkC,EAAQM,IAAI,SAASH,qBAA0BkR,YAAmBC,KAEzF,OADA3T,QAAQC,IAAI,YAAaE,GAClBA,EAASe,IAClB,CAAE,MAAOvC,GAEP,OADAqB,QAAQrB,MAAM,2CAA2C6D,KAAW7D,GAC7D,IACT,GE6M0CiV,CAAiBpR,EAAQ8J,EAAanH,KAAMuG,EAAYjH,IACpF6J,EAAiBmF,EACrB,CAAE,MAAO9U,GACLqB,QAAQrB,MAAM,kCAAmCA,GACjD2P,EAAiB,KACrB,GAEJuF,IAED,CAACvH,EAAcZ,EAAYjH,KAE9B,MAAMqP,IAAoBhB,EAAAA,EAAAA,aAAY,CAACtQ,EAAQgK,KAC3CP,EAAYgH,IACR,MAAMc,EAAcpB,IAChB,GAAIA,EAAKnQ,SAAWA,EAAQ,CACxB,MAAMwR,EAAcxH,GAA4B,YAAjBA,EAAQrH,OAAuBqH,EAAQ3H,WAAa2H,EAAQxH,SAAW0G,EAAYjH,KAAkB,OAAZ6H,QAAY,IAAZA,OAAY,EAAZA,EAAc9J,UAAWA,EAE3IyR,EAAe,CACjBlR,YAAayJ,EAAWA,EAAQrI,UAAYqI,EAAQzH,QAAW,GAC/D5B,gBAAiBqJ,EAAUA,EAAQrH,KAAK/B,cAAgB,KACxDF,oBAAqBsJ,EAAUA,EAAQxH,OAAS,MAGpD,MAAO,IACA2N,EACH5P,YAAayJ,EAAU5J,EAAwBqR,EAAcvI,EAAYjH,IAAM,eAC/EyP,sBAA6B,OAAP1H,QAAO,IAAPA,OAAO,EAAPA,EAAShJ,YAAa,IAAIG,KAAK,GAAGE,cACxD+O,oBAAqBD,EAAKC,oBAAsB,IAAMoB,EAAc,EAAI,GAEhF,CACA,OAAOrB,GAMX,MAAO,CAAEzG,OAHS+G,EAAK/G,OAAOwG,IAAIqB,GAGN5H,iBAFT8G,EAAK9G,iBAAiBuG,IAAIqB,OAIlD,CAACrI,EAAYjH,GAAI6H,IAEd6H,IAAoBrB,EAAAA,EAAAA,aAAasB,IACnC,MAAMC,EAAYvD,GAAiBtH,QAC7B8K,GAAwBD,GACvBA,EAAU7B,aAAe6B,EAAUf,UAAYe,EAAUE,aAAgB,IAG1EC,EAAaC,KAAKC,MAAMN,EAAQO,MAItC,GAHA3U,QAAQC,IAAI,oCAAqC,mCAAoCuU,GACrFxU,QAAQC,IAAI,8BAA+BuU,GAEnB,kBAApBA,EAAWrP,KAA0B,CACrC,MAAM,OAAE5E,EAAM,OAAEiC,EAAM,WAAEoS,GAAeJ,EAoBvC,YAlBA7H,EAAYkI,IACR,MAAMC,EAAiC,WAAX,OAAZxI,QAAY,IAAZA,OAAY,EAAZA,EAAcnH,MAAmBqP,EAAWO,QAAUvS,EAChEwS,EAAeH,EAAaC,IAAY,GACxCG,EAAY1U,EAAOgE,cAEnB2Q,EAAkBF,EAAatC,IAAI/K,IACrC,GAAIiN,EAAWjQ,SAASgD,EAAIjD,WAAY,CACpC,GAAkB,SAAduQ,EACA,MAAO,IAAKtN,EAAKpH,OAAQ,QAE7B,GAAkB,cAAd0U,GAA4C,SAAftN,EAAIpH,OACjC,MAAO,IAAKoH,EAAKpH,OAAQ,YAEjC,CACA,OAAOoH,IAEX,MAAO,IAAKkN,EAAc,CAACC,GAAUI,IAG7C,CAGA,GAAwB,eAApBV,EAAWrP,KAAuB,CAClC,MAAMgQ,EAAYX,EAAWJ,QACvBgB,EAAcD,EAAUJ,UAAYI,EAAUnQ,SAAW0G,EAAYjH,GAAK0Q,EAAUE,SAAWF,EAAUnQ,QAK/G,aAHgB,OAAZsH,QAAY,IAAZA,OAAY,EAAZA,EAAc9J,UAAW4S,GACzB9G,EAAiB6G,GAIzB,CAAO,GAAwB,iBAApBX,EAAWrP,KAAyB,CAC3C,MAAMmQ,EAAed,EAAWJ,QAEhC,IAAIgB,EAWJ,OATIA,EADsB,UAAtB9I,EAAanH,KACCmQ,EAAaP,QAEbO,EAAavP,WAAa2F,EAAYjH,GAC9C6Q,EAAaC,WACbD,EAAavP,eAEP,OAAZuG,QAAY,IAAZA,OAAY,EAAZA,EAAc9J,UAAW4S,GACzB9G,EAAiB,MAGzB,CAEA,MAAMkH,EAAkBhB,EAClBiB,EAAgBD,EAAgBT,UAAYS,EAAgBxQ,SAAW0G,EAAYjH,GAAK+Q,EAAgBH,SAAWG,EAAgBxQ,QAEzI,IAAKyQ,EAED,YADAzV,QAAQ0V,KAAK,2CAA4CF,GAI7D,GAAIA,EAAgB3Q,WAAsC,YAAzB2Q,EAAgBrQ,KAwB7C,YAvBAwH,EAAYkI,IACR,MAAMG,EAAeH,EAAaY,IAAkB,GACpD,IAAIE,GAAiB,EAErB,GAAIX,EAAalW,OAAS,EAAG,CACzB,MAAMiE,EAAciS,EAAaA,EAAalW,OAAS,GACvD6W,EAAiB5S,EAAY2B,YAAc8Q,EAAgB9Q,WAAa3B,EAAY0B,KAAO+Q,EAAgB9Q,SAC/G,CAEA,MAAMwQ,EAAkBF,EAAatC,IAAI/K,GACjCA,EAAIjD,YAAc8Q,EAAgB9Q,WAAaiD,EAAIlD,KAAO+Q,EAAgB9Q,UACnE,IAAKiD,EAAKxC,KAAM,UAAWJ,QAAS,2BAA4BZ,SAAU,KAAMoB,SAAU,KAAMV,WAAW,GAE/G8C,GAGX,GAAIgO,EAAgB,CAChB,MAAMC,EAAiBV,EAAgBpW,OAAS,EAAIoW,EAAgBA,EAAgBpW,OAAS,GAAK,KAClGgV,GAAkB2B,EAAeG,EACrC,CAEA,MAAO,IAAKf,EAAc,CAACY,GAAgBP,KAKnD,GAAIM,EAAgBpQ,SAwBhB,YAvBAuH,EAAYkI,IACR,MAAMG,EAAeH,EAAaY,IAAkB,GAE9CP,EAAkBF,EAAatC,IAAI/K,IACrC,GAAIA,EAAIjD,YAAc8Q,EAAgB/Q,IAAMkD,EAAIjD,YAAc8Q,EAAgB9Q,UAAW,CACrF,MAAMmR,EAAa,IACZlO,EACH5C,QAASyQ,EAAgBzQ,QACzBK,UAAU,GAOd,OAJI4P,EAAalW,OAAS,GAAKkW,EAAaA,EAAalW,OAAS,GAAG4F,YAAciD,EAAIjD,WACnFoP,GAAkB2B,EAAeI,GAG9BA,CACX,CAEA,OAAOlO,IAGX,MAAO,IAAKkN,EAAc,CAACY,GAAgBP,KAKnB5R,EAA+BkS,GAE/D7I,EAAYkI,IACR,MAAMG,EAAeH,EAAaY,IAAkB,GAC9CK,EAAgBN,EAAgB9Q,WAAa8Q,EAAgB/Q,GAGnE,GAD6BuQ,EAAae,KAAKC,GAAKA,EAAEtR,YAAcoR,GAA8B,SAAbE,EAAEzV,QAEnF,OAAOsU,EAGX,IAAIoB,EAAkB,IAAIjB,GACtBkB,GAAmB,EACnBC,EAAwB,KAE5B,MAAMC,EAAcZ,EAAgBxQ,SAAW0G,EAAYjH,IAAM+Q,EAAgBa,UAC3EC,EAA0Bd,EAAgBxQ,SAAW0G,EAAYjH,KAAO+Q,EAAgBa,UACxFE,EAAaf,EAAgBxQ,SAAW0G,EAAYjH,GAE1D,GAAI2R,EAAa,CACb,MAAMI,EAAkBP,EAAgBQ,UAAUT,GAAKA,EAAEvR,KAAO+Q,EAAgBa,WAChF,GAAIG,GAAmB,EAAG,CACtB,MAAME,EAA2BpT,EAA+BkS,GAChES,EAAgBO,GAAmB,IAAKP,EAAgBO,MAAqBE,EAA0BnW,OAAQ,QAC/G4V,EAAwBF,EAAgBO,GACxCN,GAAmB,CACvB,CACJ,MAAO,GAAII,EAAyB,CAChC,MAAME,EAAkBP,EAAgBU,cAAcX,GAAkB,YAAbA,EAAEzV,QAAwByV,EAAEhR,SAAW0G,EAAYjH,IAC9G,GAAI+R,GAAmB,EAAG,CACtB,MAAME,EAA2BpT,EAA+BkS,GAChES,EAAgBO,GAAmB,IAAKP,EAAgBO,MAAqBE,EAA0BnW,OAAQ,QAC/G4V,EAAwBF,EAAgBO,GACxCN,GAAmB,CACvB,MAAO,IAAKlB,EAAae,KAAKC,GAAKA,EAAEtR,YAAcoR,GAAgB,CAC/D,MAAMc,EAAetT,EAA+BkS,GACpDS,EAAgBxV,KAAKmW,GACrBT,EAAwBS,EACxBV,GAAmB,CACvB,CACJ,MAAO,GAAIK,IACFvB,EAAae,KAAKC,GAAKA,EAAEtR,YAAcoR,GAAgB,CACxD,MAAMc,EAAetT,EAA+BkS,GACpDS,EAAgBxV,KAAKmW,GACrBT,EAAwBS,EACxBV,GAAmB,EAEfzF,IACAG,GAAoBiG,GAAaA,EAAY,EAErD,CAGJ,OAAIX,GACApC,GAAkB2B,EAAeU,GAC1B,IAAKtB,EAAc,CAACY,GAAgBQ,IAGxCpB,IAEQL,EAAWxP,SAAW0G,EAAYjH,KAAO+P,EAAWpP,WAAaoP,EAAW3P,WAAiC,YAApB2P,EAAWrP,MACrGmP,GACdd,WAAW,IAAMpB,GAAe,UAAW,MAEhD,CAAC1G,EAAYjH,GAAIqP,GAAmBxH,EAAcmE,KAE/CqG,IAAW9E,EAAAA,EAAAA,SAAQ,IAAM,IACxBhG,EAASG,iBAAiB4K,OAAOC,GAAQA,EAAKxU,UAAsB,OAAXkJ,QAAW,IAAXA,OAAW,EAAXA,EAAajH,QACtEuH,EAASE,QACd+K,KAAK,CAACC,EAAGC,IAAM,IAAIxT,KAAKwT,EAAEjD,sBAAwB,IAAIvQ,KAAKuT,EAAEhD,uBAAwB,CAAClI,EAAUN,EAAYjH,KAExG2S,IAAoBtE,EAAAA,EAAAA,aAAasB,IACnC,MAAMiD,EAAe5C,KAAKC,MAAMN,EAAQO,MAExC,GAAI0C,EAAatR,WAAa2F,EAAYjH,GAAI,OAE9C,MAAM6S,EAAkC,SAAtBD,EAAalS,KAAkBkS,EAAatC,QAAUsC,EAAatR,SACrF,IAAKuR,EAAW,OAChB,MAAMC,EAAiBT,GAASU,KAAKC,GAAKA,EAAEjV,SAAW6U,EAAatR,UAC9D2R,GAA2B,OAAdH,QAAc,IAAdA,OAAc,EAAdA,EAAgBI,OAAQ,UAE3CzH,GAAe+C,IACX,MAAM2E,EAAiB,IAAK3E,GAmB5B,OAjBIjC,GAAiBxH,QAAQ8N,IACzBO,aAAa7G,GAAiBxH,QAAQ8N,IAGtCD,EAAaS,QACbF,EAAeN,GAAa,GAAGI,iBAC/B1G,GAAiBxH,QAAQ8N,GAAa9D,WAAW,KAC7CtD,GAAe6H,IACX,MAAMC,EAAU,IAAKD,GAErB,cADOC,EAAQV,GACRU,KAEZ,aAGIJ,EAAeN,GAEnBM,KAEZ,CAAClM,EAAYjH,GAAIqS,MAEpBxN,EAAAA,EAAAA,WAAU,KACNsI,GAAqBpI,QAAU2K,MAGnC7K,EAAAA,EAAAA,WAAU,MACDsD,GAAqBkE,GAAiBtH,SACvC4I,GAAe,SAEpB,CAACxF,EAAmBN,KAEvBhD,EAAAA,EAAAA,WAAU,KACN,GAAgB,OAAXoC,QAAW,IAAXA,IAAAA,EAAajH,KAAOkL,GAAiB,OAE1C,GAAIoB,GAAYvH,QACZ,OAGJ,MAAMyO,EAAY,+DAA+DvM,EAAYjH,KACvFyT,EAAS,IAAIC,EAAAA,EAAO,CACtBF,YACAG,eAAgB,IAChBC,UAAWA,KACPvI,IAAe,GACf,MAAMwI,EAAkBlE,IAChBxC,GAAqBpI,SACrBoI,GAAqBpI,QAAQ4K,IAmBrCtC,GAActI,QAAiB,QAAI0O,EAAOK,UAAU,sBAAuBD,GAC3ExG,GAActI,QAAQ,eAAiB0O,EAAOK,UAAU,0BAA2BD,GACnFxG,GAActI,QAAQ,aAAe0O,EAAOK,UAAU,wBAAyBD,GAC/ExG,GAActI,QAAkB,SAAI0O,EAAOK,UAAU,kBAlB5BnE,IACrB,MAAMoE,EAAe/D,KAAKC,MAAMN,EAAQO,MACpC6D,EAAa7E,SAAWjI,EAAYjH,IAExCwH,EAAYgH,IACR,MAAMwF,EAAkBxF,EAAK9G,iBAAiBuG,IAAIC,GAC1CA,EAAKnQ,SAAWgW,EAAa7E,OACtB,IAAKhB,EAAM+F,SAAUF,EAAaE,UAEtC/F,GAEX,MAAO,IAAKM,EAAM9G,iBAAkBsM,OAQ5C3G,GAActI,QAAgB,OAAI0O,EAAOK,UAAU,4BAA6BnB,KAEpFuB,iBAAmBha,GAAUqB,QAAQrB,MAAM,mBAAoBA,GAC/Dia,aAAeC,GAAU7Y,QAAQrB,MAAM,eAAgBka,EAAM9Y,QAAiB,QAAG8Y,EAAMlE,MACvFmE,iBAAkBA,KACdhJ,IAAe,MAOvB,OAHAoI,EAAOa,WACPhI,GAAYvH,QAAU0O,EAEf,KAAO,IAADc,EACc,QAAvBA,EAAIjI,GAAYvH,eAAO,IAAAwP,GAAnBA,EAAqBC,SACrBlI,GAAYvH,QAAQ0P,aACpBnI,GAAYvH,QAAU,QAG/B,CAAY,OAAXkC,QAAW,IAAXA,OAAW,EAAXA,EAAajH,GAAIkL,KAErB,MAAMwJ,IAAWnH,EAAAA,EAAAA,SAAQ,KACbhG,EAASE,QAAU,IAAIwG,IAAI0G,GAAKA,EAAE5W,QAAQyU,OAAOoC,KAAK,KAC/D,CAACrN,EAASE,UAEb5C,EAAAA,EAAAA,WAAU,KAAO,IAADgQ,EACZ,IAAKzJ,IAAmC,QAApByJ,EAACvI,GAAYvH,eAAO,IAAA8P,IAAnBA,EAAqBL,OAAQ,OAElD,MAAMX,EAAkBlE,IAChBxC,GAAqBpI,SACrBoI,GAAqBpI,QAAQ4K,IAI/BmF,EAAmB,IAAIC,KAAKxN,EAASE,QAAU,IAAIwG,IAAI0G,GAAKA,EAAE5W,OAAO8H,aACrEmP,EAAiBC,OAAOC,KAAK7H,GAActI,SAC3CoQ,EAAqB,IAAIJ,IAAIC,EAAe1C,OAAOxV,GAAOA,EAAI8C,WAAW,WAAWqO,IAAInR,GAAOA,EAAIsY,QAAQ,SAAU,MAE3HD,EAAmB5a,QAAQ+V,IACvB,IAAKwE,EAAiBO,IAAI/E,GAAU,CAChC,MAAMgF,EAAQ,SAAShF,IACnBjD,GAActI,QAAQuQ,KACtBjI,GAActI,QAAQuQ,GAAOC,qBACtBlI,GAActI,QAAQuQ,GAErC,IAGJR,EAAiBva,QAAQ+V,IACrB,IAAK6E,EAAmBE,IAAI/E,GAAU,CAClC,MAAMgF,EAAQ,SAAShF,IACvBjD,GAActI,QAAQuQ,GAAShJ,GAAYvH,QAAQ+O,UAAU,eAAexD,IAAWuD,GACvF,MAAM2B,EAAc,gBAAgBlF,IACpCjD,GAActI,QAAQyQ,GAAelJ,GAAYvH,QAAQ+O,UAAU,wBAAwBxD,IAAWqC,GAC1G,KAGL,CAACvH,GAAasJ,GAAUnN,EAASE,OAAQmD,GAAc3D,EAAYjH,KAEtE,MAAMyV,IAAWpH,EAAAA,EAAAA,aAAaqH,IAAgB,IAADC,EACzC,GAAgB,OAAX1O,QAAW,IAAXA,IAAAA,EAAajH,IAA0B,QAApB2V,EAACrJ,GAAYvH,eAAO,IAAA4Q,IAAnBA,EAAqBnB,OAC1C,OAEJ,MAAMoB,EAAc,sBAAsBF,EAAW3X,SAC/C4R,EAAU,CACZT,OAAQjI,EAAYjH,GACpBU,KAA0B,UAApBgV,EAAWhV,KAAmB,OAAS,WAEjD4L,GAAYvH,QAAQ8Q,QAAQ,CAAED,cAAa1F,KAAMF,KAAK8F,UAAUnG,KAEhE7H,EAAgB4N,GAChBpN,GAAc,GAEd,MAAMyN,EAAS,SAAS9O,EAAYjH,cAAc0V,EAAW3X,SAC7DT,OAAO0Y,QAAQC,UAAU,CAAEC,KAAMH,GAAU,GAAIA,IAEhD,CAAC9O,EAAYjH,KAEVmW,IAAY9H,EAAAA,EAAAA,aAAY,KAAO,IAAD+H,EAChC,IAAKvO,GAAoC,QAApBuO,EAAC9J,GAAYvH,eAAO,IAAAqR,IAAnBA,EAAqB5B,QAAsB,OAAXvN,QAAW,IAAXA,IAAAA,EAAajH,GAAI,OACvE,MAAM4V,EAAc,uBAAuB/N,EAAa9J,SACxDuO,GAAYvH,QAAQ8Q,QAAQ,CAAED,cAAa1F,KAAM,OAEjDpI,EAAgB,MAChBQ,GAAc,GAEd,MAAMyN,EAAS,SAAS9O,EAAYjH,KACpC1C,OAAO0Y,QAAQC,UAAU,CAAEC,KAAMH,GAAU,GAAIA,IAEhD,CAAClO,EAAcZ,EAAYjH,KAExBqW,IAAmBhI,EAAAA,EAAAA,aAAaH,KAC7BA,EAAKC,oBAAsB,GAAK,GACjC3G,EAAYgH,IAAI,IACTA,EACH/G,OAAQ+G,EAAK/G,OAAOwG,IAAI0G,GAAKA,EAAE5W,SAAWmQ,EAAKnQ,OAAS,IAAK4W,EAAGxG,mBAAoB,GAAMwG,GAC1FjN,iBAAkB8G,EAAK9G,iBAAiBuG,IAAIqF,GAAKA,EAAEvV,SAAWmQ,EAAKnQ,OAAS,IAAKuV,EAAGnF,mBAAoB,GAAMmF,MAIlHzL,IAAgBA,EAAa9J,OAAWmQ,EAAKnQ,QAEjD0X,GAASvH,IACV,CAACrG,EAAc4N,MAElB5Q,EAAAA,EAAAA,WAAU,KACN,MAAMyR,EAAqBA,KACvB,GAAIzO,GAAgByE,GAAYvH,SAAWuH,GAAYvH,QAAQyP,OAAQ,CACnE,MAAMoB,EAAc,uBAAuB/N,EAAa9J,SACxDuO,GAAYvH,QAAQ8Q,QAAQ,CAAED,cAAa1F,KAAM,MACrD,GAGJ,OADA5S,OAAOG,iBAAiB,eAAgB6Y,GACjC,IAAMhZ,OAAO+H,oBAAoB,eAAgBiR,IACzD,CAACzO,KAEJhD,EAAAA,EAAAA,WAAU,KACiBlJ,WACnB,GAAK6O,IAAyB3C,GAAsC,UAAtBA,EAAanH,OAI3DnF,QAAQC,IAAI,qCAAsCkP,GAAoB,yBAA0BE,GAAavQ,QAElF,YAAvBqQ,IAA4D,IAAxBE,GAAavQ,QACjD,IACI0Q,IAAsB,GACtBxP,QAAQC,IAAI,gCAAiCqM,EAAa9J,QAE1D,MAAMwY,OFhnBK5a,WAC7B,IACE,MAAMD,QAAiBkC,EAAQM,IAAI,uBAAuBsY,KAE1D,OADAjb,QAAQC,IAAI,YAAaE,GAClBA,EAASe,IAClB,CAAE,MAAOvC,GAEP,OADAqB,QAAQrB,MAAM,oCAAoCsc,KAAWtc,GACtD,IACT,GEwmBoDuc,CAAgB5O,EAAa9J,QAC/DxC,QAAQC,IAAI,qCAAsC+a,GAElD,MAAMG,EAAcC,MAAMC,QAAQL,IAAwBA,EAAoBlc,OAAS,EACjFkc,EAAoB,GACpB,KAEFG,GAAeA,EAAYG,WAC3Btb,QAAQC,IAAI,oCAAqCkb,EAAYG,WAC7DhM,GAAgB6L,EAAYG,aAE5Btb,QAAQC,IAAI,wEACZqP,GAAgB,IAExB,CAAE,MAAO3Q,GACLqB,QAAQrB,MAAM,iCAAkCA,GAChD2Q,GAAgB,GACpB,CAAC,QACGE,IAAsB,EAC1B,GAIR+L,IACD,CAACtM,GAAsBE,GAAoB7C,EAAc+C,GAAavQ,UAEzEwK,EAAAA,EAAAA,WAAU,KACN,MAAMkS,EAAsBrZ,IAAW,IAADsZ,EAAAC,EAAAC,GAC9B3O,IAAmBoE,GAAe5H,SAAY4H,GAAe5H,QAAQoS,SAASzZ,EAAM0Z,SAAkC,QAAvBJ,EAACpK,GAAe7H,eAAO,IAAAiS,GAAtBA,EAAwBG,SAASzZ,EAAM0Z,SAAS5O,GAAmB,IACnKG,IAAgBkE,GAAY9H,SAAY8H,GAAY9H,QAAQoS,SAASzZ,EAAM0Z,SAAqC,QAA1BH,EAACnK,GAAkB/H,eAAO,IAAAkS,GAAzBA,EAA2BE,SAASzZ,EAAM0Z,SAASxO,GAAgB,GAC1JG,EAAYE,SAAW8D,GAAehI,UAAYgI,GAAehI,QAAQoS,SAASzZ,EAAM0Z,SAASpO,EAAe,CAAEC,SAAS,EAAOC,EAAG,EAAGC,EAAG,EAAGpB,QAAS,KAAMqB,MAAO,QACpKgB,KAAkB6C,GAAclI,SAAYkI,GAAclI,QAAQoS,SAASzZ,EAAM0Z,SAAuC,QAA5BF,EAAChK,GAAoBnI,eAAO,IAAAmS,GAA3BA,EAA6BC,SAASzZ,EAAM0Z,SAAS/M,IAAkB,IAG5K,OADAgN,SAAS5Z,iBAAiB,YAAasZ,GAChC,IAAMM,SAAShS,oBAAoB,YAAa0R,IACxD,CAACxO,EAAiBI,EAAcI,EAAYE,QAASmB,KAExD,MAAMkN,GAAoBC,IAAc,IAADC,EACnC,GAAwB,QAApBA,EAAClL,GAAYvH,eAAO,IAAAyS,IAAnBA,EAAqBhD,SAAW3M,EAAc,OAEnD,MAAM8H,EAAU,CACZrO,SAAU2F,EAAYjH,GACtBqT,OAAQkE,EACR7W,KAA4B,UAAtBmH,EAAanH,KAAmB,OAAS,UAC/CoQ,WAAkC,YAAtBjJ,EAAanH,KAAqBmH,EAAa9J,OAAS,KACpEuS,QAA+B,UAAtBzI,EAAanH,KAAmBmH,EAAa9J,OAAS,MAGnEuO,GAAYvH,QAAQ8Q,QAAQ,CACxBD,YAAa,cACb1F,KAAMF,KAAK8F,UAAUnG,MAIvB8H,GAAoBA,KACtB,IAAK1P,EAAQ2P,SAAW7P,EAAc,OAEtCyP,IAAiB,GAEjB,MAAMtW,EAAW9B,KAAKyY,MAAM9R,WAAalE,KAAKiW,SAAS/R,SAAS,IAAIgS,UAAU,EAAG,GAC3EzW,EAAyB,OAAfoI,EAEVsO,EAAoB,CACtB9X,GAAIgB,EACJf,UAAWe,EACXT,OAAQ0G,EAAYjH,GACpBM,QAASyH,EACThJ,WAAW,IAAIG,MAAOE,cACtBtD,OAAQ,UACR4E,KAAM,OACNhB,SAAU,KACVoB,SAAU,KACVH,UAAU,EACVU,QAASmI,EACTvI,aAAa,GASjB,IAAI2U,EACAjG,EAPJN,GAAkBxH,EAAa9J,OAAQ+Z,GACvC5P,EAAYsG,IAAI,IACTA,EACH,CAAC3G,EAAa9J,QAAS,IAAKyQ,EAAK3G,EAAa9J,SAAW,GAAK+Z,MAM9D1W,GACAwU,EAAc,aACdjG,EAAU,CACNoI,iBAAkBvO,EAAWvJ,UAC7BM,OAAQ0G,EAAYjH,GACpBM,QAASyH,EACT/G,SAAUA,EACV4P,SAAgC,YAAtB/I,EAAanH,KAAqBmH,EAAa9J,OAAS,KAClEuS,QAA+B,UAAtBzI,EAAanH,KAAmBmH,EAAa9J,OAAS,KAC/D2C,KAA4B,UAAtBmH,EAAanH,KAAmB,OAAS,aAGnDkV,EAAc,YACdjG,EAAU,CACNpP,OAAQ0G,EAAYjH,GACpBM,QAASyH,EACTrH,KAA4B,UAAtBmH,EAAanH,KAAmB,OAAS,UAC/CkQ,SAAgC,YAAtB/I,EAAanH,KAAqBmH,EAAa9J,OAAS,KAClEuS,QAA+B,UAAtBzI,EAAanH,KAAmBmH,EAAa9J,OAAS,KAC/DiD,SAAUA,IAIlBsL,GAAYvH,QAAQ8Q,QAAQ,CAAED,cAAa1F,KAAMF,KAAK8F,UAAUnG,KAEhE3H,EAAW,IACXQ,GAAmB,GACnBiB,EAAc,MACdsF,WAAW,IAAMpB,GAAe,UAAW,MAuEzCqK,GAAiBrc,UACnB,IACI,MAAMsc,QAAeC,UAAUC,aAAaC,aAAa,CAAEtT,OAAO,IAClE4D,GAAe,GACfgE,GAAe3H,QAAU,GAEzB,MAAMsT,EAAW,IAAIC,cAAcL,EAAQ,CAAEM,SAAU,eAEvDF,EAASG,gBAAmB9a,IACpBA,EAAMjB,KAAKwB,KAAO,GAClByO,GAAe3H,QAAQ/I,KAAK0B,EAAMjB,OAG1C4b,EAASI,OAAS9c,UAGd,GAFAsc,EAAOS,YAAYne,QAAQoe,GAASA,EAAMC,SAErC/Q,GAAkD,IAAlC6E,GAAe3H,QAAQ1K,OACxC,OAGJ,MAAMwe,EAAY,IAAIC,KAAKpM,GAAe3H,QAAS,CAAErE,KAAM,eAC3DnF,QAAQC,IAAI,4BAA6Bqd,GACzC,MAAME,EAAWrT,IAAIC,gBAAgBkT,GACrCtd,QAAQC,IAAI,gDAAiDud,GAC7D,MAAMtG,EAAI4E,SAAS2B,cAAc,KACjCvG,EAAE3L,MAAMmS,QAAU,OAClBxG,EAAEjV,KAAOub,EACTtG,EAAEyG,SAAW,sBACb7B,SAASnH,KAAKiJ,YAAY1G,GAC1BA,EAAE2G,QACF/B,SAASnH,KAAKmJ,YAAY5G,GAC1B,MAAM6G,EAAY,IAAIC,KAAK,CAACV,GAAY,iBAAiB3Z,KAAKyY,aAAc,CAAEjX,KAAM,eAE9E8Y,OAz3BIX,IACtB,IAAIpd,QAASf,IACT,MAAM+e,EAAS,IAAIC,WAEnBD,EAAOE,OAAUjc,IACb,MAAMkc,EAAe,IAAKtc,OAAOuc,cAAgBvc,OAAOwc,oBACxDF,EAAaG,gBAAgBrc,EAAM0Z,OAAO4C,OACrCC,IACG,MAAMlZ,EAAWkZ,EAAOlZ,SAAWY,KAAKuY,MAAMD,EAAOlZ,UAAY,EACjE6Y,EAAaO,QACbzf,EAAQqG,IAEX7G,IACGqB,QAAQrB,MAAM,6BAA8BA,GAC5C0f,EAAaO,QACbzf,EAAQ,MAKpB+e,EAAOW,QAAWlgB,IACdqB,QAAQrB,MAAM,qCAAsCA,GACpDQ,EAAQ,IAGZ+e,EAAOY,kBAAkBxB,KAg2BWyB,CAAiBzB,GACvCY,EAAS,IAAIC,WACnBD,EAAOc,cAAc1B,GACrBY,EAAOe,UAAY7e,UACf,MAAM8e,EAAehB,EAAOO,OACtBhZ,EAAW9B,KAAKyY,MAAM9R,WAAalE,KAAKiW,SAAS/R,SAAS,IAAIgS,UAAU,EAAG,GAC3E6C,EAAkBhV,IAAIC,gBAAgBkT,GAEtCf,EAAoB,CACtB9X,GAAIgB,EAAUf,UAAWe,EAAUT,OAAQ0G,EAAYjH,GACvDM,QAASoa,EAAiB3b,WAAW,IAAIG,MAAOE,cAChDtD,OAAQ,UAAW4E,KAAM,QAAShB,SAAU4Z,EAAUpG,KACtDpS,SAAUwY,EAAUrb,KAAMwB,QAASib,EAAiB/Z,UAAU,EAC9DI,SAAUyY,GAGdnK,GAAkBxH,EAAa9J,OAAQ+Z,GACvC5P,EAAYsG,IAAI,IAAUA,EAAM,CAAC3G,EAAa9J,QAAS,IAAKyQ,EAAK3G,EAAa9J,SAAW,GAAK+Z,MAE9F,MAAM6C,EAAY,CACdpa,OAAQ0G,EAAYjH,GACpBgB,SAAUA,EACVrB,SAAU2Z,EAAU5Y,KACpBhB,SAAU4Z,EAAUpG,KACpB0H,SAAUH,EACV/Z,KAA4B,UAAtBmH,EAAanH,KAAmB,OAAS,UAC/C4P,QAA+B,UAAtBzI,EAAanH,KAAmBmH,EAAa9J,OAAS,KAC/D6S,SAAgC,YAAtB/I,EAAanH,KAAqBmH,EAAa9J,OAAS,KAClEgD,SAAUyY,GAGd,SFp3Bc7d,WAChC,IACE,MAAMD,QAAiBkC,EAAQtB,KAAK,qBAAsBqe,GAE1D,OADApf,QAAQC,IAAI,YAAaE,GAClBA,EAASe,IAClB,CAAE,MAAOvC,GAEP,MADAqB,QAAQrB,MAAM,+BAAgCA,GACxCA,CACR,GE62B4B2gB,CAAmBF,EAC7B,CAAE,MAAOzgB,GACLqB,QAAQrB,MAAM,+BAAgCA,GAC9CgO,EAAYsG,IACR,MACMsM,GADetM,EAAK3G,EAAa9J,SAAW,IACjBkQ,IAAIsD,GAAKA,EAAEvR,KAAOgB,EAAW,IAAKuQ,EAAGzV,OAAQ,UAAayV,GAC3F,MAAO,IAAK/C,EAAM,CAAC3G,EAAa9J,QAAS+c,IAEjD,IAIRrO,GAAiB1H,QAAUsT,EAC3B5L,GAAiB1H,QAAQgW,OAE7B,CAAE,MAAO7gB,GACLqB,QAAQrB,MAAM,aAAcA,GAC5BwO,GAAe,EACnB,GAGEsS,GAAgBA,KACdvO,GAAiB1H,SAA8C,cAAnC0H,GAAiB1H,QAAQkW,QACrDxO,GAAiB1H,QAAQ6T,OACzBlQ,GAAe,KAsBjBwS,GAAiBA,KAAO,IAADC,EACzB,MAAMC,EAAiBrT,EAAQ2P,OAE/B,GAAuB,KAAnB0D,GAA+C,OAAtB/R,EAAYD,OAAsC,QAApB+R,EAAC7O,GAAYvH,eAAO,IAAAoW,IAAnBA,EAAqB3G,OAE7E,YADA6G,KAIJ,MAAMtd,EAAS8J,EAAa9J,OACtBud,EAAkBrT,EAASlK,GAC3Bwd,EAAgBD,EAAgBjS,EAAYD,OAC5CnJ,EAAYsb,EAActb,UAEhC,GAAImb,IAAmB/R,EAAYE,iBAAwC,kBAAdtJ,EAEzD,YADAob,KAIJ,MAAMG,EAA2B,IAC1BD,EACHjb,QAAS8a,EACTza,UAAU,GAGR8a,EAAsBH,EAAgBrN,IAAI,CAAC/K,EAAKkG,IAClDA,IAAUC,EAAYD,MAAQoS,EAA2BtY,GAG7DgF,EAAYsG,IAAI,IACTA,EACH,CAACzQ,GAAS0d,KAGVpS,EAAYD,QAAUkS,EAAgBjhB,OAAS,GAC/CgV,GAAkBtR,EAAQyd,GAG9B,MAAM7L,EAAU,CACZ1P,UAAWA,EACXK,QAAS8a,EACT7a,OAAQ0G,EAAYjH,IAKxBsM,GAAYvH,QAAQ8Q,QAAQ,CACxBD,YAHgB,YAIhB1F,KAAMF,KAAK8F,UAAUnG,KAGzB0L,MAGEA,GAAaA,KAAQ/R,EAAe,CAAEF,MAAO,KAAMG,gBAAiB,KAAOvB,EAAW,KAItF0T,GAAe/f,UACjB,MAAMoC,EAAS8J,EAAa9J,OACtBud,EAAkB,IAAKrT,EAASlK,IAAW,IAC3C4d,EAAkBL,EAAgBvS,EAAYK,OAC9CnJ,EAA2B,OAAf0b,QAAe,IAAfA,OAAe,EAAfA,EAAiB1b,UAEnC,IAAKA,GAAkC,kBAAdA,GAAqD,YAA3B0b,EAAgB7f,QAAmD,WAA3B6f,EAAgB7f,OAGvG,OAFAP,QAAQrB,MAAM,oDAAqD+F,EAAW0b,EAAgB7f,aAC9FkN,EAAe,CAAEC,SAAS,EAAOC,EAAG,EAAGC,EAAG,EAAGpB,QAAS,KAAMqB,MAAO,OAIvE,IACI,GAAIwS,OF1jCwBjgB,OAAOsE,EAAWiP,KACxD,IACE,MAAMxT,QAAiBkC,EAAQtB,KAAK,SAAS2D,qBAA6BiP,KAE1E,OADA3T,QAAQC,IAAI,YAAaE,GAClBA,EAASe,IAClB,CAAE,MAAOvC,GAEP,MADAqB,QAAQrB,MAAM,4BAA4B+F,kBAA2B/F,GAC/DA,CACR,GEmjCoB2hB,CAAyB5b,EAAWgH,EAAYjH,QACnD,MFvkCerE,OAAOsE,EAAWiP,KAClD,IACE,MAAMxT,QAAiBkC,EAAQtB,KAAK,SAAS2D,eAAuBiP,KAEpE,OADA3T,QAAQC,IAAI,YAAaE,GAClBA,EAASe,IAClB,CAAE,MAAOvC,GAEP,MADAqB,QAAQrB,MAAM,4BAA4B+F,YAAqB/F,GACzDA,CACR,GEgkCoB4hB,CAAmB7b,EAAWgH,EAAYjH,IAChD,MAAM+b,EAAeT,EAAgBhJ,OAAO,CAAC0J,EAAGta,IAAMA,IAAMqH,EAAYK,OACxElB,EAAYsG,IAAI,IAAUA,EAAM,CAACzQ,GAASge,KAC1C,MAAM5K,EAAiB4K,EAAa1hB,OAAS,EAAI0hB,EAAaA,EAAa1hB,OAAS,GAAK,KACzFgV,GAAkBtR,EAAQoT,EAC9B,CACJ,CAAE,MAAOjX,GACLqB,QAAQrB,MAAM,4BAA4B+F,kBAA2B/F,EACzE,CAAC,QACG8O,EAAe,CAAEC,SAAS,EAAOC,EAAG,EAAGC,EAAG,EAAGpB,QAAS,KAAMqB,MAAO,MACvE,GAGE6S,GAAmBA,KAAQ,IAAKvS,EAAa,OAAQ,MAAM4R,EAAkB,IAAIrT,EAASJ,EAAa9J,SAAUud,EAAgB5R,EAAYN,OAASM,EAAY3B,QAASG,EAAYsG,IAAI,IAAUA,EAAM,CAAC3G,EAAa9J,QAASud,KAAqB3R,EAAe,OA4BtQuS,GAAoBA,KAEtB,GADA7R,IAAkB,GACdT,EAAe,CACf,MAAMuS,EAAe5L,GAAayB,UAAUT,GAAKA,EAAEtR,YAAc2J,EAAc3J,WAE/E,IAAsB,IAAlBkc,EAAqB,CACrB,MAAMC,EAAiB/E,SAASgF,cAAc,wBAAwBF,OAClEC,IACAA,EAAeE,eAAe,CAAE1O,SAAU,SAAU2O,MAAO,WAC3DH,EAAeI,UAAUC,IAAI,gBAAiB,eAC9C1N,WAAW,IAAMqN,EAAeI,UAAUE,OAAO,gBAAiB,eAAgB,MAE1F,CACJ,GA+CEC,GAAgBtK,GAASC,OAAOpE,IAAI,IAAA0O,EAAA,OAAa,QAAbA,EAAI1O,EAAKgF,YAAI,IAAA0J,OAAA,EAATA,EAAW9c,cAAcI,SAASyH,EAAW7H,kBAE3F+E,EAAAA,EAAAA,WAAU,KACN,GAAIyI,IAAiB+E,GAAShY,OAAS,GAAK+Q,KAAgBvD,EAAc,CACtE,MAAMgV,EAAexK,GAASU,KAAKC,GAAKA,EAAEjV,OAAO8H,aAAeyH,IAE5DuP,GACAthB,QAAQC,IAAI,wDAAyDqhB,GACrExG,GAAiBwG,IAEjBthB,QAAQ0V,KAAK,sBAAsB3D,iCAE3C,GACD,CAAC+E,GAAU/E,GAAezF,EAAcwO,GAAkBjL,KAE7D,MAQM0R,GAAmBC,IACrB,IAAKA,EAAW,MAAO,GACvB,MAAM1d,EAAO,IAAIH,KAAK6d,EAAU5d,SAAS,KAAO4d,EAAYA,EAAY,KACxE,OAAIC,MAAM3d,GAAc,GACjBA,EAAK4d,mBAAmB,QAAS,CACpCC,KAAM,UACNC,OAAQ,UACRC,QAAQ,KAIVC,GAAoBN,IACtB,IAAKA,EAAW,MAAO,GACvB,MAAM1d,EAAO,IAAIH,KAAKD,OAAO8d,GAAW5d,SAAS,KAAO4d,EAAYA,EAAY,KAChF,GAAIC,MAAM3d,GAAO,MAAO,eACxB,MAAMie,EAAQ,IAAIpe,KACZqe,EAAY,IAAIre,KAAKoe,GAE3B,OADAC,EAAUC,QAAQD,EAAUE,UAAY,GACpCpe,EAAKqe,iBAAmBJ,EAAMI,eAAuB,QACrDre,EAAKqe,iBAAmBH,EAAUG,eAAuB,YACtDre,EAAKse,mBAAmB,GAAI,CAAEC,KAAM,UAAWC,MAAO,OAAQC,IAAK,aAcxEC,GAAsBjiB,IACxB,OAAQA,GACJ,IAAK,UAAW,MAAO,kBACvB,IAAK,OAAQ,MAAO,gBACpB,IAAK,YAAa,MAAO,gBACzB,IAAK,OAAQ,MAAO,iBACpB,IAAK,SAAU,MAAO,eACtB,QAAS,MAAO,qBAIxB,IAAIkiB,GAAkB,KAEtB,MAAMC,GAAkBpW,EAAewK,GAASU,KAAKC,GAAKA,EAAEjV,SAAW8J,EAAa9J,QAAU,KACxFwS,GAAe0N,IAAkBhW,EAASgW,GAAgBlgB,SAAgB,GAE1EmgB,GAAiB5c,IACnB,IAAK2F,EAAa,MAAO,CAAEiM,KAAM,UAAWiL,QAAS,MACrD,GAAI7c,IAAa2F,EAAYjH,GAAI,MAAO,CAAEkT,KAAM,MAAOiL,QAASlX,EAAYkX,SAC5E,MACMC,EADW,IAAI7W,EAASG,qBAAqC,OAAfuW,SAAe,IAAfA,QAAe,EAAfA,GAAiBI,UAAW,IACxDtL,KAAKxB,GAAKA,EAAExT,SAAWuD,GAAYiQ,EAAEzT,aAAewD,GAC5E,OAAO8c,EACD,CAAElL,KAAMkL,EAAOlL,MAAQkL,EAAOE,aAAcH,QAASC,EAAOD,SAAW,MACvE,CAAEjL,KAAM,eAAgBiL,QAAS,OAGrCI,GAAcrb,IAChB,MAAMsb,EAAU5gB,EAAQuC,SAASvF,QAEjC,GAAIsI,EAAIzD,SAAWyD,EAAIzD,QAAQG,WAAW,SACtC,OAAOsD,EAAIzD,QAGf,GAAIyD,EAAIzD,SAAWyD,EAAIzD,QAAQG,WAAW,QAAS,CAE/C,MAAO,GADQ,IAAI8F,IAAI8Y,GAASC,SACbvb,EAAIzD,SAC3B,CAAO,GAAIyD,EAAIzD,QACX,OAAOyD,EAAIzD,QAGf,MAAMM,EAAkBmD,EAAIlD,IAAMkD,EAAIjD,UACtC,OAAIF,EACO,GAAGye,eAAqBze,IAE5BmD,EAAI5C,SAGf,OACI+C,EAAAA,EAAAA,MAAA,OAAKlB,UAAU,sCAAqCmB,SAAA,EAChDD,EAAAA,EAAAA,MAAA,OAAKlB,UAAU,yCAAwCmB,SAAA,EACnDD,EAAAA,EAAAA,MAAA,OAAKlB,UAAW,yFAAwFkG,EAAa,iBAAmB,QAAS/E,SAAA,EAC7If,EAAAA,EAAAA,KAAA,OAAKJ,UAAU,qBAAoBmB,UAACf,EAAAA,EAAAA,KAAA,SAAO7B,KAAK,OAAOge,YAAY,2BAA2Bvc,UAAU,0DAA0DpF,MAAO4K,EAAYgX,SAAUpf,GAAKqI,EAAcrI,EAAE6X,OAAOra,YAC3NsG,EAAAA,EAAAA,MAAA,OAAK2C,IAAKoG,GAAkBwS,SAvoChBC,KACxB,MAAMjP,EAAYxD,GAAiBrH,QACnC,GAAI6K,EAAW,CACX,MAAM,UAAEf,EAAS,aAAEd,EAAY,aAAE+B,GAAiBF,EAC9C7B,EAAec,EAAYiB,EAAe,MAC1CvU,QAAQC,IAAI,yCAAyC8L,eAA4BD,KAC7EA,IAAYC,GACZF,IAGZ,GA6nCuEjF,UAAU,4DAA2DmB,SAAA,CAC3HqZ,GAAc1O,IAAIC,IACf7K,EAAAA,EAAAA,MAAA,OAAuBE,QAASA,IAAM8S,GAAiBnI,GAAO/L,UAAW,2DAAqE,OAAZ0F,QAAY,IAAZA,OAAY,EAAZA,EAAc9J,UAAWmQ,EAAKnQ,OAAS,cAAgB,oBAAqBuF,SAAA,EAC1MD,EAAAA,EAAAA,MAAA,OAAKlB,UAAU,yBAAwBmB,SAAA,CACpB,UAAd4K,EAAKxN,MACF6B,EAAAA,EAAAA,KAAA,OAAKJ,UAAU,sEAAqEmB,UAChFf,EAAAA,EAAAA,KAACuc,EAAAA,IAAO,CAAC3c,UAAU,gBAAgBlE,KAAM,OAE7CiQ,EAAKiQ,SACL5b,EAAAA,EAAAA,KAAA,OAAKuB,IAAKoK,EAAKiQ,QAASY,IAAK7Q,EAAKgF,KAAM/Q,UAAU,yCAElDI,EAAAA,EAAAA,KAAA,OAAKJ,UAAU,sEAAqEmB,UAChFf,EAAAA,EAAAA,KAACyc,EAAAA,IAAM,CAAC7c,UAAU,gBAAgBlE,KAAM,OAG/CiQ,EAAK+F,WAAa1R,EAAAA,EAAAA,KAAA,QAAMJ,UAAU,4FAEvCkB,EAAAA,EAAAA,MAAA,OAAKlB,UAAU,sBAAqBmB,SAAA,EAACf,EAAAA,EAAAA,KAAA,KAAGJ,UAAU,uCAAsCmB,SAAE4K,EAAKgF,QAAS3Q,EAAAA,EAAAA,KAAA,KAAGJ,UAAU,iCAAgCmB,SAAE4K,EAAK5P,aAAe,wBACzK4P,EAAKC,oBAAsB,GAAK,IAAM5L,EAAAA,EAAAA,KAAA,OAAKJ,UAAU,gBAAemB,UAACf,EAAAA,EAAAA,KAAA,QAAMJ,UAAU,kEAAiEmB,SAAE4K,EAAKC,yBAhBzJD,EAAKnQ,SAmBlBuJ,IACG/E,EAAAA,EAAAA,KAAA,OAAKJ,UAAU,uCAAsCmB,UACjDf,EAAAA,EAAAA,KAAA,OAAKJ,UAAU,0EAM/BI,EAAAA,EAAAA,KAAA,OAAKJ,UAAW,qFAAoFkG,EAAa,OAAS,kBAAmB/E,SACvI2a,IASE5a,EAAAA,EAAAA,MAAA4b,EAAAA,SAAA,CAAA3b,SAAA,EACID,EAAAA,EAAAA,MAAA,OAAKlB,UAAU,+EAA8EmB,SAAA,EACzFD,EAAAA,EAAAA,MAAA,OAAKlB,UAAU,gDAA+CmB,SAAA,EAC1Df,EAAAA,EAAAA,KAAA,UAAQgB,QAAS4S,GAAWhU,UAAU,+CAA8CmB,UAACf,EAAAA,EAAAA,KAAC2c,EAAAA,IAAW,OACjG3c,EAAAA,EAAAA,KAAA,UAAQgB,QAASA,IAA+B,UAAzB0a,GAAgBvd,MAAoBud,GAAgBE,SAAW5T,IAAsB,GAAOpI,UAAU,gBAAemB,SAC9G,UAAzB2a,GAAgBvd,MACb6B,EAAAA,EAAAA,KAAA,OAAKJ,UAAU,sEAAqEmB,UAChFf,EAAAA,EAAAA,KAACuc,EAAAA,IAAO,CAAC3c,UAAU,gBAAgBlE,KAAM,OAE7CggB,GAAgBE,SAChB5b,EAAAA,EAAAA,KAAA,OAAKuB,IAAKma,GAAgBE,QAASY,IAAKd,GAAgB/K,KAAM/Q,UAAU,yCAExEI,EAAAA,EAAAA,KAAA,OAAKJ,UAAU,sEAAqEmB,UAChFf,EAAAA,EAAAA,KAACyc,EAAAA,IAAM,CAAC7c,UAAU,gBAAgBlE,KAAM,UAIpDoF,EAAAA,EAAAA,MAAA,OAAKlB,UAAU,WAAUmB,SAAA,EACrBf,EAAAA,EAAAA,KAAA,UAAQgB,QAvJjB4b,KACI,WAAX,OAAZtX,QAAY,IAAZA,OAAY,EAAZA,EAAcnH,QACdiK,GAAsB,YACtBE,GAAgB,IAChBJ,IAAwB,KAmJyC2U,SAAmC,UAAzBnB,GAAgBvd,KAAkByB,UAAU,YAAWmB,UAClGf,EAAAA,EAAAA,KAAA,KAAGJ,UAAU,6BAA4BmB,SAAE2a,GAAgB/K,SAErC,YAAzB+K,GAAgBvd,MACb6B,EAAAA,EAAAA,KAAA,KAAGJ,UAAU,wBAAuBmB,SAAE2a,GAAgBhK,SAAW,SA5HjF8I,KACpB,IAAKA,EAAW,MAAO,UACvB,MAAM1d,EAAO,IAAIH,KAAKD,OAAO8d,GAAW5d,SAAS,KAAO4d,EAAYA,EAAY,KAChF,GAAIC,MAAM3d,GAAO,MAAO,UACxB,MAAMie,EAAQ,IAAIpe,KAClB,OAAIG,EAAKqe,iBAAmBJ,EAAMI,eACvB,sBAAsBZ,GAAgBC,KAE1C,gBAAgB1d,EAAKse,wBAoHoF0B,CAAepB,GAAgBxO,yBAE3GpM,EAAAA,EAAAA,MAAA,KAAGlB,UAAU,wBAAuBmB,SAAA,CAAE2a,GAAgBqB,aAAe,EAAE,qBAInFjc,EAAAA,EAAAA,MAAA,OAAKlB,UAAU,8BAA6BmB,SAAA,EAACf,EAAAA,EAAAA,KAAA,UAAQJ,UAAU,mDAAkDmB,UAACf,EAAAA,EAAAA,KAACgd,EAAAA,IAAO,CAACthB,KAAM,QAAesE,EAAAA,EAAAA,KAAA,UAAQJ,UAAU,mDAAkDmB,UAACf,EAAAA,EAAAA,KAACid,EAAAA,IAAO,CAACvhB,KAAM,QAAeoF,EAAAA,EAAAA,MAAA,OAAKlB,UAAU,WAAUmB,SAAA,EAACf,EAAAA,EAAAA,KAAA,UAAQyD,IAAK8G,GAAmBvJ,QAASA,IAAMqF,GAAiBD,GAAexG,UAAU,qCAAoCmB,UAACf,EAAAA,EAAAA,KAACkd,EAAAA,IAAmB,CAACxhB,KAAM,OAAgB0K,IAAiBpG,EAAAA,EAAAA,KAAA,OAAKyD,IAAK6G,GAAa1K,UAAU,gEAA+DmB,UAACf,EAAAA,EAAAA,KAAA,UAAQgB,QAASA,KAAQgI,IAAoB,GAAO3C,GAAgB,IAAWzG,UAAU,2EAA0EmB,SAAC,0BAG/sBsG,IACGvG,EAAAA,EAAAA,MAAA,OAAKlB,UAAU,0FAAyFmB,SAAA,EACpGD,EAAAA,EAAAA,MAAA,OAAKlB,UAAU,mFAAmFoB,QAAS2Y,GAAkB5Y,SAAA,EACzHf,EAAAA,EAAAA,KAACmd,EAAAA,IAAW,CAACvd,UAAU,iCACvBI,EAAAA,EAAAA,KAACP,EAAQ,CAACtC,SAAUkK,EAAclK,UAAY,GAAIgB,KAAMkJ,EAAcpK,YAAa2C,UAAU,2BAC7FkB,EAAAA,EAAAA,MAAA,OAAKlB,UAAU,WAAUmB,SAAA,EACrBf,EAAAA,EAAAA,KAAA,KAAGJ,UAAU,0BAAyBmB,SAAC,oBACvCf,EAAAA,EAAAA,KAAA,KAAGJ,UAAU,yBAAwBmB,SACF,SAA9BsG,EAAcpK,YAAyBoK,EAActJ,QAAUsJ,EAAclK,UAAY,wBAItG2D,EAAAA,EAAAA,MAAA,OAAKlB,UAAU,yBAAwBmB,SAAA,EACnCf,EAAAA,EAAAA,KAAA,UAAQyD,IAAKkH,GAAqB3J,QAASA,IAAM8G,IAAmBD,IAAiBjI,UAAU,qCAAoCmB,UAC/Hf,EAAAA,EAAAA,KAACod,EAAAA,IAAa,MAEjBvV,KACG7H,EAAAA,EAAAA,KAAA,OAAKyD,IAAKiH,GAAe9K,UAAU,wEAAuEmB,UACtGD,EAAAA,EAAAA,MAAA,MAAIlB,UAAU,OAAMmB,SAAA,EAChBD,EAAAA,EAAAA,MAAA,MAAIE,QAAS2Y,GAAmB/Z,UAAU,qEAAoEmB,SAAA,EAC1Gf,EAAAA,EAAAA,KAACqd,EAAAA,IAAkB,IAAG,qBAE1Bvc,EAAAA,EAAAA,MAAA,MAAIE,QAlRhC5H,UAChB,GAAkB,OAAbiO,QAAa,IAAbA,GAAAA,EAAe3J,UAEpB,SF5iCoBtE,OAAOsE,EAAWiP,KAC1C,IACI,MAAMxT,QAAiBkC,EAAQtB,KAAK,eAAe2D,YAAoBiP,KAEvE,OADA3T,QAAQC,IAAI,YAAaE,GAClBA,EAASe,IACpB,CAAE,MAAOvC,GAEL,MADAqB,QAAQrB,MAAM,2BAA2B+F,KAAc/F,GACjDA,CACV,GEqiCc2lB,CAAajW,EAAc3J,UAAWgH,EAAYjH,IACxD6J,EAAiB,KACrB,CAAE,MAAO3P,GACLqB,QAAQrB,MAAM,2BAA4BA,EAC9C,CAAC,QACGmQ,IAAkB,EACtB,GAwQsElI,UAAU,kFAAiFmB,SAAA,EACjHf,EAAAA,EAAAA,KAACud,EAAAA,IAAO,IAAG,wBASvCzc,EAAAA,EAAAA,MAAA,OAAK2C,IAAKqG,GAAkBuS,SAhuC3BmB,KACrB,MAAMnQ,EAAYvD,GAAiBtH,QACnC,IAAK6K,EAAW,OAEhB,MAAM,UAAEf,EAAS,aAAEd,EAAY,aAAE+B,GAAiBF,EAElD,GAAkB,IAAdf,IAAoB1G,IAAsB2D,GAAwB,CAClE,MAAM/N,EAAS8J,EAAa9J,OAC5B,IAAgC,IAA5B6N,GAAgB7N,GAAmB,CACnC,MAAMiiB,GAAYtU,GAAa3N,IAAW,GAAK,EAC/C4N,GAAgB6C,IAAI,IAAUA,EAAM,CAACzQ,GAASiiB,KAC9C5R,GAAiBrQ,EAAQiiB,EAC7B,CACJ,CAEA,MAAMC,EAAelS,EAAec,EAAYiB,EAAe,IAC3DmQ,IAAiBjU,KACjBC,GAAsBgU,GACjBA,GACD9T,GAAoB,KA6sCgDhK,UAAU,2CAA0CmB,SAAA,CACvGwI,KACGvJ,EAAAA,EAAAA,KAAA,OAAKJ,UAAU,wCAAuCmB,UAClDf,EAAAA,EAAAA,KAAA,OAAKJ,UAAU,mEAGtBgG,GACG5F,EAAAA,EAAAA,KAACwE,EAAe,KAEhB1D,EAAAA,EAAAA,MAAA,OAAKlB,UAAU,YAAWmB,SAAA,CACrBiN,GAAatC,IAAI,CAAC/K,EAAKkG,KACpB,MAAMjG,EAAcD,EAAI3C,UAAsB,OAAX0G,QAAW,IAAXA,OAAW,EAAXA,EAAajH,IAC1CkgB,EAAU,IAAIhhB,KAAKgE,EAAInE,WAAW2e,eAClCyC,EAAiBnC,KAAoBkC,EACvCC,IACAnC,GAAkBkC,GAEtB,MAAME,EAAcjd,EAA0C,KAA5B+a,GAAchb,EAAI3C,QAE9Cd,EAAU8e,GAAWrb,GAE3B,OACIG,EAAAA,EAAAA,MAACgd,EAAAA,SAAc,CAAA/c,SAAA,CACV6c,IACG5d,EAAAA,EAAAA,KAAA,OAAKJ,UAAU,mBAAkBmB,UAC7Bf,EAAAA,EAAAA,KAAA,QAAMJ,UAAU,yEAAwEmB,SAAE+Z,GAAiBna,EAAInE,gBAGvHsE,EAAAA,EAAAA,MAAA,OAAK,qBAAoB+F,EAAOjH,UAAW,yBAAwBgB,EAAc,cAAgB,iBAAkBG,SAAA,EAC7GH,GAAe,MACb,MAAMmd,EAAsC,UAAzBrC,GAAgBvd,KAA6B,OAAV0f,QAAU,IAAVA,OAAU,EAAVA,EAAYjC,QAAUF,GAAgBE,QACtFoC,EAAuC,UAAzBtC,GAAgBvd,KAA6B,OAAV0f,QAAU,IAAVA,OAAU,EAAVA,EAAYlN,KAAO+K,GAAgB/K,KAC1F,OAAOoN,GACH/d,EAAAA,EAAAA,KAAA,OAAKuB,IAAKwc,EAAYvB,IAAKwB,EAAape,UAAU,gEAElDI,EAAAA,EAAAA,KAAA,OAAKJ,UAAU,6FAA4FmB,UACvGf,EAAAA,EAAAA,KAACyc,EAAAA,IAAM,CAAC7c,UAAU,gBAAgBlE,KAAM,MAGnD,EAVgB,IAWjBoF,EAAAA,EAAAA,MAAA,OAAKlB,UAAW,kBAAiBgB,EAAc,YAAc,eAAgBG,SAAA,CAC/C,UAAzB2a,GAAgBvd,OAAqByC,IAClCZ,EAAAA,EAAAA,KAAA,KAAGJ,UAAU,gDAA+CmB,SAAY,OAAV8c,QAAU,IAAVA,OAAU,EAAVA,EAAYlN,QAE9E3Q,EAAAA,EAAAA,KAAA,OAAKie,cAAgBjhB,GAjbnDkhB,EAAC/iB,EAAOqK,EAASqB,KAAY1L,EAAM8F,iBAAkB9F,EAAM+F,kBAAkE,IAAIyF,EAAIxL,EAAMgjB,MAAWvX,EAAIzL,EAAMijB,MAAWzX,EAA3E,IAA2F5L,OAAOsjB,aAAY1X,GAA9G,KAAkIC,EAA1G,IAA2H7L,OAAOujB,cAAa1X,GAA/I,KAAgKH,EAAe,CAAEC,SAAS,EAAMC,IAAGC,IAAGpB,UAASqB,WAib9QqX,CAAkBlhB,EAAG2D,EAAKkG,GAAQjH,UAAW,mHACpD,UAAbe,EAAIxC,MAAiC,YAAbwC,EAAIxC,KAAsB,qBAAuB,uEAC5D,SAAbwC,EAAIxC,KAAoByC,EAAc,6BAA+B,gCAAmC,uEAC3F,UAAbD,EAAIxC,MAAiC,SAAbwC,EAAIxC,KAAoByC,EAAc,cAAgB,cAAiB,uEAChGG,SACY,YAAbJ,EAAIxC,MACD2C,EAAAA,EAAAA,MAAA,OAAKlB,UAAU,wDAAuDmB,SAAA,EAClEf,EAAAA,EAAAA,KAAA,QAAAe,SAAM,8BACM,OAAXoG,QAAW,IAAXA,OAAW,EAAXA,EAAaN,SAAUA,IAAS7G,EAAAA,EAAAA,KAAA,UAAQgB,QAAS0Y,GAAkB9Z,UAAU,gCAA+BmB,SAAC,aAGlHD,EAAAA,EAAAA,MAAA4b,EAAAA,SAAA,CAAA3b,SAAA,CACKJ,EAAIjC,cAAeoC,EAAAA,EAAAA,MAAA,OAAKlB,UAAU,kEAAiEmB,SAAA,EAACf,EAAAA,EAAAA,KAACue,EAAAA,IAAO,IAAG,gBAE/G5d,EAAI7B,UACDgC,EAAAA,EAAAA,MAAA,OAAKlB,UAAW,6BAA4BgB,EAAc,cAAgB,eAAgBG,SAAA,EACtFf,EAAAA,EAAAA,KAAA,KAAGJ,UAAU,gBAAemB,SAAEJ,EAAI7B,QAAQd,UAAsB,OAAX0G,QAAW,IAAXA,OAAW,EAAXA,EAAajH,IAAK,MAAQke,GAAchb,EAAI7B,QAAQd,QAAQ2S,QACjH3Q,EAAAA,EAAAA,KAAA,KAAGJ,UAAU,sBAAqBmB,UAC7B,CAAC,QAAS,QAAS,QAAQpD,SAASgD,EAAI7B,QAAQX,MAAQwC,EAAI7B,QAAQf,cAKnE,UAAb4C,EAAIxC,MACD2C,EAAAA,EAAAA,MAAA,OAAKlB,UAAU,WAAUmB,SAAA,EACrBf,EAAAA,EAAAA,KAAA,UAAQgB,QAASA,IAAM0H,GAAexL,GAAS6D,UAC3Cf,EAAAA,EAAAA,KAAA,OAAKuB,IAAKrE,EAASsf,IAAK7b,EAAIxD,UAAY,QAASyC,UAAU,wBAAwB2E,MAAO,CAAEia,UAAW,cAEzG5d,IACEZ,EAAAA,EAAAA,KAAA,KAAG/E,KAAMiC,EAASyZ,SAAUhW,EAAIxD,SAAU6D,QAAUhE,GAAMA,EAAEkE,kBAAmBtB,UAAU,oIAAmImB,UACxNf,EAAAA,EAAAA,KAACoB,EAAAA,IAAU,SAIV,UAAbT,EAAIxC,MACJ6B,EAAAA,EAAAA,KAAA,OAAKJ,WAAcgB,EAAc,cAAgB,eAAjC,cAA4DG,UACxEf,EAAAA,EAAAA,KAACqB,EAAW,CAACE,IAAKrE,EAASA,QAASA,EAASsE,SAAUZ,EAAaa,gBAAiBd,EAAInC,SAAUD,SAAUoC,EAAIpC,aAExG,SAAboC,EAAIxC,MACJ6B,EAAAA,EAAAA,KAACS,EAAW,CAACE,IAAKA,EAAKC,YAAaA,KAEpCZ,EAAAA,EAAAA,KAAA,KAAGJ,UAAU,sBAAqBmB,SAAEJ,EAAI5C,gBAKxD+C,EAAAA,EAAAA,MAAA,QAAMlB,UAAU,kCAAiCmB,SAAA,CAAiB,YAAfJ,EAAIpH,OAAuB,aAA8B,WAAfoH,EAAIpH,OAAsB,SAAWghB,GAAgB5Z,EAAInE,WAAW,IAAEmE,EAAIvC,SAAW,WAAa,SAElMwC,IACGZ,EAAAA,EAAAA,KAAA,OAAKJ,UAAW,4CAA4CmB,UACxDf,EAAAA,EAAAA,KAAA,OAAKuB,KAAgB,OAAXmD,QAAW,IAAXA,OAAW,EAAXA,EAAakX,UAAW,qDAAsDY,IAAI,eAAe5c,UAAW,kDAAkD4b,GAAmB7a,EAAIpH,mBAxE1LoH,EAAIjD,WAAaiD,EAAIlD,MAgFjDwL,GAAY3D,EAAa9J,UACtBsF,EAAAA,EAAAA,MAAA,OAAKlB,UAAU,qCAAoCmB,SAAA,EAC/Cf,EAAAA,EAAAA,KAAA,OAAKJ,UAAU,6FAA4FmB,UACvGf,EAAAA,EAAAA,KAACyc,EAAAA,IAAM,CAAC7c,UAAU,gBAAgBlE,KAAM,QAE5CsE,EAAAA,EAAAA,KAAA,OAAKJ,UAAU,4BAA2BmB,UACtCf,EAAAA,EAAAA,KAAA,OAAKJ,UAAU,2CAA0CmB,UACrDD,EAAAA,EAAAA,MAAA,OAAKlB,UAAU,2CAA0CmB,SAAA,EACrDf,EAAAA,EAAAA,KAAA,QAAMJ,UAAU,6EAChBI,EAAAA,EAAAA,KAAA,QAAMJ,UAAU,8EAChBI,EAAAA,EAAAA,KAAA,QAAMJ,UAAU,qEAUhDkB,EAAAA,EAAAA,MAAA,OAAKlB,UAAU,2DAA0DmB,SAAA,CACpEkG,IACGnG,EAAAA,EAAAA,MAAA,OAAKlB,UAAU,iEAAgEmB,SAAA,EAC3ED,EAAAA,EAAAA,MAAA,OAAKlB,UAAU,0BAAyBmB,SAAA,EACpCD,EAAAA,EAAAA,MAAA,KAAGlB,UAAU,8BAA6BmB,SAAA,CAAC,eAAakG,EAAWjJ,UAAsB,OAAX0G,QAAW,IAAXA,OAAW,EAAXA,EAAajH,IAAK,WAAake,GAAc1U,EAAWjJ,QAAQ2S,SAC9I3Q,EAAAA,EAAAA,KAAA,KAAGJ,UAAU,yBAAwBmB,SAChC,CAAC,QAAS,QAAS,QAAQpD,SAASsJ,EAAW9I,MAAQ8I,EAAW9J,SAAW8J,EAAWlJ,cAGjGiC,EAAAA,EAAAA,KAAA,UAAQgB,QAASA,IAAMkG,EAAc,MAAMnG,UAACf,EAAAA,EAAAA,KAACud,EAAAA,IAAO,SAIrC,OAAtBzW,EAAYD,QAAmB/F,EAAAA,EAAAA,MAAA,OAAKlB,UAAU,iEAAgEmB,SAAA,EAACD,EAAAA,EAAAA,MAAA,OAAKlB,UAAU,0BAAyBmB,SAAA,EAACf,EAAAA,EAAAA,KAAA,KAAGJ,UAAU,8BAA6BmB,SAAC,qBAAmBf,EAAAA,EAAAA,KAAA,KAAGJ,UAAU,yBAAwBmB,SAAE+F,EAAYE,sBAA0BhH,EAAAA,EAAAA,KAAA,UAAQgB,QAAS8X,GAAW/X,UAACf,EAAAA,EAAAA,KAACud,EAAAA,IAAO,SACxU7B,KACG5a,EAAAA,EAAAA,MAAA,OAAKlB,UAAW,gDAAgDqH,GAAoC,OAAtBH,EAAYD,MAAkB,OAAS,IAAK9F,SAAA,CACrHiF,IACGhG,EAAAA,EAAAA,KAAA,OAAKyD,IAAK2G,GAAgBxK,UAAU,0DAAyDmB,UACzFf,EAAAA,EAAAA,KAACye,EAAAA,GAAW,CAACC,aA/rBnCC,GAAgBlZ,EAAWwG,GAAQA,EAAO0S,EAAYC,OA+rBSta,MAAM,OAAOua,OAAQ,SAGtE/d,EAAAA,EAAAA,MAAA,OAAKlB,UAAU,qBAAoBmB,SAAA,EAC/Bf,EAAAA,EAAAA,KAAA,SAAOyD,IAAKgH,GAAiBtM,KAAK,OAAOge,YAAajW,EAAc,eAAiB,oBAAqBtG,UAAU,uGAAuGpF,MAAOgL,EAAS4W,SAAWpf,IAAQyI,EAAWzI,EAAE6X,OAAOra,OAAQua,IAAiB,IAAU+J,UApsBtU3jB,IAA8B,UAAdA,EAAMZ,KAAoBY,EAAM4jB,WAAY5jB,EAAM8F,iBAA4C,OAAtB6F,EAAYD,MAAgB8R,KAAuBzD,OAosBqN2H,SAAU3W,KACzVpF,EAAAA,EAAAA,MAAA,OAAKlB,UAAU,8DAA6DmB,SAAA,EACxEf,EAAAA,EAAAA,KAAA,UAAQyD,IAAK4G,GAAgBrJ,QAASA,IAAMiF,GAAoBD,GAAkBpG,UAAU,uEAAsEmB,UAACf,EAAAA,EAAAA,KAACgf,EAAAA,IAAO,CAACtjB,KAAM,QAClLsE,EAAAA,EAAAA,KAAA,UAAQgB,QArsBtBie,IAAMhV,GAAazH,QAAQqU,QAqsB2BjX,UAAU,uEAAsEmB,UAACf,EAAAA,EAAAA,KAACkf,EAAAA,IAAW,CAACxjB,KAAM,aAGnJ8J,EAAQ2P,QAAgC,OAAtBrO,EAAYD,OAC3B7G,EAAAA,EAAAA,KAAA,UAAQgB,QAA+B,OAAtB8F,EAAYD,MAAiB8R,GAAiBzD,GAAmBtV,UAAW,gCAAqD,OAAtBkH,EAAYD,MAAiB,kCAAoC,iCAAkC9F,SACpM,OAAtB+F,EAAYD,OAAiB7G,EAAAA,EAAAA,KAACmf,EAAAA,IAAO,CAACzjB,KAAM,MAASsE,EAAAA,EAAAA,KAACof,EAAAA,IAAY,CAAC1jB,KAAM,QAG9EsE,EAAAA,EAAAA,KAAA,UAAQgB,QA5oBnBqe,KAAYnZ,EAAauS,KAAsBhD,MA4oBG7V,UAAW,uCAAsCsG,EAAc,6BAA+B,qCAAsCnF,SACtKmF,GAAclG,EAAAA,EAAAA,KAACsf,EAAAA,IAAM,CAAC5jB,KAAM,MAASsE,EAAAA,EAAAA,KAACuf,EAAAA,IAAY,CAAC7jB,KAAM,QAGlEsE,EAAAA,EAAAA,KAAA,SAAO7B,KAAK,OAAOsF,IAAKwG,GAAcmS,SA/sBjDhjB,UACrB,MAAMomB,EAAOrkB,EAAM0Z,OAAO4K,MAAM,GAChC,IAAKD,IAASla,EAAc,OAE5B,IAAIrI,EAAc,OACduiB,EAAKrhB,KAAKd,WAAW,UACrBJ,EAAc,QACPuiB,EAAKrhB,KAAKd,WAAW,YAC5BJ,EAAc,SAGlB,MAAMwB,EAAW9B,KAAKyY,MAAM9R,WAAalE,KAAKiW,SAAS/R,SAAS,IAAIgS,UAAU,EAAG,GAE3EoK,EAAsBvc,IAAIC,gBAAgBoc,GAE1CjK,EAAoB,CACtB9X,GAAIgB,EACJf,UAAWe,EACXT,OAAQ0G,EAAYjH,GACpBM,QAAS2hB,EACTljB,WAAW,IAAIG,MAAOE,cACtBtD,OAAQ,UACR4E,KAAMlB,EACNE,SAAUqiB,EAAK7O,KACfpS,SAAUihB,EAAK9jB,KACfwB,QAASwiB,EACTthB,UAAU,GAGd0O,GAAkBxH,EAAa9J,OAAQ+Z,GAEvC5P,EAAYsG,IAAI,IACTA,EACH,CAAC3G,EAAa9J,QAAS,IAAKyQ,EAAK3G,EAAa9J,SAAW,GAAK+Z,MAGlE,MAAMlb,EAAW,IAAID,SACrBC,EAASK,OAAO,OAAQ8kB,GACxBnlB,EAASK,OAAO,SAAUgK,EAAYjH,IACtCpD,EAASK,OAAO,YAAa+D,GAC7BpE,EAASK,OAAO,WAAY8kB,EAAKrhB,MACjC9D,EAASK,OAAO,OAA8B,UAAtB4K,EAAanH,KAAmB,OAAS,WAEvC,UAAtBmH,EAAanH,KACb9D,EAASK,OAAO,UAAW4K,EAAa9J,QAExCnB,EAASK,OAAO,WAAY4K,EAAa9J,QAG7C,SF32BkBpC,WACtB,IACI,MAAMD,QAAiBkC,EAAQtB,KAAK,eAAgBM,EAAU,CAC1DtB,QAAS,CACL,eAAgB,yBAIxB,OADAC,QAAQC,IAAI,YAAaE,GAClBA,EAASe,IACpB,CAAE,MAAOvC,GAEL,MADAqB,QAAQrB,MAAM,sBAAuBA,GAC/BA,CACV,GEg2BcgoB,CAAWtlB,EACrB,CAAE,MAAO1C,GACLqB,QAAQrB,MAAM,mCAAoCA,GAClDgO,EAAYsG,IACR,MACMsM,GADetM,EAAK3G,EAAa9J,SAAW,IACjBkQ,IAAIsD,GAAKA,EAAEvR,KAAOgB,EAAW,IAAKuQ,EAAGzV,OAAQ,UAAayV,GAC3F,MAAO,IAAK/C,EAAM,CAAC3G,EAAa9J,QAAS+c,IAEjD,CAAC,QACGpd,EAAM0Z,OAAOra,MAAQ,IACzB,GAmpBkGoF,UAAU,qBAtO5FI,EAAAA,EAAAA,KAAA,OAAKJ,UAAU,0CAAyCmB,UACpDD,EAAAA,EAAAA,MAAA,OAAKlB,UAAU,cAAamB,SAAA,EACxBf,EAAAA,EAAAA,KAACuc,EAAAA,IAAO,CAAC3c,UAAU,oCACnBI,EAAAA,EAAAA,KAAA,KAAGJ,UAAU,yCAAwCmB,SAAC,4BACtDf,EAAAA,EAAAA,KAAA,KAAGJ,UAAU,gBAAemB,SAAC,8DAyO5C0I,KACG3I,EAAAA,EAAAA,MAAA,UACIE,QAASA,IAAMoK,KACfxL,UAAU,2PACV,aAAW,mBAAkBmB,SAAA,CAE5B4I,GAAmB,IAChB3J,EAAAA,EAAAA,KAAA,QAAMJ,UAAU,yHAAwHmB,SACnI4I,GAAmB,EAAI,KAAOA,MAGvC3J,EAAAA,EAAAA,KAACod,EAAAA,IAAa,CAAC1hB,KAAM,WAKhC8K,EAAYE,UACT1G,EAAAA,EAAAA,KAAA,OAAKyD,IAAK+G,GAAgBjG,MAAO,CAAEgH,IAAK/E,EAAYI,EAAGvC,KAAMmC,EAAYG,GAAK/G,UAAU,sDAAqDmB,UACzIf,EAAAA,EAAAA,KAAA,MAAIJ,UAAU,OAAMmB,SACc,YAA7ByF,EAAYhB,QAAQrH,MACjB2C,EAAAA,EAAAA,MAAA,MAAIE,QAASA,IAAMmY,IAAa,GAAQvZ,UAAU,kFAAiFmB,SAAA,EAACf,EAAAA,EAAAA,KAAC4f,EAAAA,IAAO,IAAG,qBAE/I9e,EAAAA,EAAAA,MAAA4b,EAAAA,SAAA,CAAA3b,SAAA,EACID,EAAAA,EAAAA,MAAA,MAAIE,QAjkBZ6e,KAAQ3Y,EAAcV,EAAYhB,SAAUiB,EAAe,CAAEC,SAAS,EAAOC,EAAG,EAAGC,EAAG,EAAGpB,QAAS,KAAMqB,MAAO,OAAS4D,GAAgBjI,QAAQsd,SAikB9GlgB,UAAU,qEAAoEmB,SAAA,EAACf,EAAAA,EAAAA,KAAC+f,EAAAA,IAAO,IAAG,aACpHjf,EAAAA,EAAAA,MAAA,MAAIE,QAxed5H,UAAa,IAAD4mB,EAC1B,GAAwB,QAApBA,EAACxZ,EAAYhB,eAAO,IAAAwa,GAAnBA,EAAqBtiB,UAE1B,IACI,MAAMuiB,EAAiBzZ,EAAYhB,QAAQ9H,UACrCvE,OF3iCQC,OAAOsE,EAAWiP,KACxC,IACI,MAAMxT,QAAiBkC,EAAQtB,KAAK,aAAa2D,YAAoBiP,KAErE,OADA3T,QAAQC,IAAI,YAAaE,GAClBA,EAASe,IACpB,CAAE,MAAOvC,GAEL,MADAqB,QAAQrB,MAAM,yBAAyB+F,KAAc/F,GAC/CA,CACV,GEmiC+BuoB,CAAWD,EAAgBvb,EAAYjH,IAC9D6J,EAAiBnO,EACrB,CAAE,MAAOxB,GACLqB,QAAQrB,MAAM,yBAA0BA,EAC5C,CAAC,QACG8O,EAAe,CAAEC,SAAS,EAAOC,EAAG,EAAGC,EAAG,EAAGpB,QAAS,KAAMqB,MAAO,MACvE,GA6dgDjH,UAAU,qEAAoEmB,SAAA,EAACf,EAAAA,EAAAA,KAACmd,EAAAA,IAAW,IAAG,WACtHrc,EAAAA,EAAAA,MAAA,MAAIE,QA9bVmf,KAClB3Y,EAAkB,CAAEd,SAAS,EAAMlB,QAASgB,EAAYhB,UACxDiB,EAAe,CAAEC,SAAS,EAAOC,EAAG,EAAGC,EAAG,EAAGpB,QAAS,KAAMqB,MAAO,QA4bfjH,UAAU,qEAAoEmB,SAAA,EAACf,EAAAA,EAAAA,KAACue,EAAAA,IAAO,IAAG,cAEtF,YAA/B/X,EAAYhB,QAAQjM,QAAuD,WAA/BiN,EAAYhB,QAAQjM,SAC7DuH,EAAAA,EAAAA,MAAA4b,EAAAA,SAAA,CAAA3b,SAAA,CACKyF,EAAYhB,QAAQxH,UAAsB,OAAX0G,QAAW,IAAXA,OAAW,EAAXA,EAAajH,KAAmC,SAA7B+I,EAAYhB,QAAQrH,OAAoBqI,EAAYhB,QAAQ9G,aAAgB,IAAI/B,KAAS,IAAIA,KAAK6J,EAAYhB,QAAQhJ,WAAa,MAClLsE,EAAAA,EAAAA,MAAA,MAAIE,QAvkBzBof,KAAQrZ,EAAe,CAAEF,MAAOL,EAAYK,MAAOG,gBAAiBR,EAAYhB,QAAQzH,UAAY0H,EAAWe,EAAYhB,QAAQzH,SAAU0I,EAAe,CAAEC,SAAS,EAAOC,EAAG,EAAGC,EAAG,EAAGpB,QAAS,KAAMqB,MAAO,OAAS4D,GAAgBjI,QAAQsd,SAukBnMlgB,UAAU,qEAAoEmB,SAAA,EAACf,EAAAA,EAAAA,KAACqgB,EAAAA,IAAM,IAAG,YAEtHrgB,EAAAA,EAAAA,KAAA,MAAIJ,UAAU,UACdkB,EAAAA,EAAAA,MAAA,MAAIE,QAASA,IAAMmY,IAAa,GAAQvZ,UAAU,kFAAiFmB,SAAA,EAACf,EAAAA,EAAAA,KAAC4f,EAAAA,IAAO,IAAG,oBAC9IpZ,EAAYhB,QAAQxH,UAAsB,OAAX0G,QAAW,IAAXA,OAAW,EAAXA,EAAajH,MACzCqD,EAAAA,EAAAA,MAAA,MAAIE,QAASA,IAAMmY,IAAa,GAAOvZ,UAAU,kFAAiFmB,SAAA,EAACf,EAAAA,EAAAA,KAAC4f,EAAAA,IAAO,IAAG,oCAU7KrY,EAAeb,UAAY1G,EAAAA,EAAAA,KAAA,OAAKJ,UAAU,wEAAuEmB,UAACD,EAAAA,EAAAA,MAAA,OAAKlB,UAAU,iDAAgDmB,SAAA,EAACD,EAAAA,EAAAA,MAAA,OAAKlB,UAAU,iDAAgDmB,SAAA,EAACf,EAAAA,EAAAA,KAAA,MAAIJ,UAAU,oBAAmBmB,SAAC,2BAA0Bf,EAAAA,EAAAA,KAAA,UAAQgB,QAASA,IAAMwG,EAAkB,CAAEd,SAAS,EAAOlB,QAAS,OAAQzE,UAACf,EAAAA,EAAAA,KAACud,EAAAA,IAAO,UAAkBvd,EAAAA,EAAAA,KAAA,OAAKJ,UAAU,MAAKmB,UAACf,EAAAA,EAAAA,KAAA,SAAO7B,KAAK,OAAOge,YAAY,6BAA6Bvc,UAAU,+BAA+BpF,MAAOmN,GAAmByU,SAAWpf,GAAM4K,GAAqB5K,EAAE6X,OAAOra,YAAgBwF,EAAAA,EAAAA,KAAA,OAAKJ,UAAU,2BAA0BmB,SAAE+O,GAASC,OAAOU,IAAC,IAAA6P,EAAA,OAAU,QAAVA,EAAI7P,EAAEE,YAAI,IAAA2P,OAAA,EAANA,EAAQ/iB,cAAcI,SAASgK,GAAkBpK,iBAAgBmO,IAAIC,IAAS7K,EAAAA,EAAAA,MAAA,OAAuBlB,UAAU,qDAAoDmB,SAAA,EAACf,EAAAA,EAAAA,KAAA,SAAO7B,KAAK,WAAWV,GAAI,OAAOkO,EAAKnQ,SAAUoE,UAAU,+BAA+B2gB,QAAS9Y,GAAkB9J,SAASgO,EAAKnQ,QAAS4gB,SAAWpf,IAAYA,EAAE6X,OAAO0L,QAAS7Y,GAAqB,IAAID,GAAmBkE,EAAKnQ,SAAekM,GAAqBD,GAAkBsI,OAAOtS,GAAMA,IAAOkO,EAAKnQ,aAC9nCsF,EAAAA,EAAAA,MAAA,SAAO0f,QAAS,OAAO7U,EAAKnQ,SAAUoE,UAAU,mDAAkDmB,SAAA,CAC/E,UAAd4K,EAAKxN,MACF6B,EAAAA,EAAAA,KAAA,OAAKJ,UAAU,sEAAqEmB,UAACf,EAAAA,EAAAA,KAACuc,EAAAA,IAAO,CAAC3c,UAAU,qBAExGI,EAAAA,EAAAA,KAAA,OAAKuB,IAAKoK,EAAKiQ,QAASY,IAAK7Q,EAAKgF,KAAM/Q,UAAU,sCAAsC6gB,QAAUzjB,IAAQA,EAAE6X,OAAOtT,IAAM,wDAE7HvB,EAAAA,EAAAA,KAAA,QAAAe,SAAO4K,EAAKgF,YAP6uBhF,EAAKnQ,YASvvBwE,EAAAA,EAAAA,KAAA,OAAKJ,UAAU,0BAAyBmB,UAACf,EAAAA,EAAAA,KAAA,UAAQgB,QAtd3C5H,UACzB,MAAMsnB,EAAcnZ,EAAe/B,QACnC,IAAKkb,GAA4C,IAA7BjZ,GAAkB3P,OAClC,OAGJ,MAAM6oB,EAAc,CAChB3iB,OAAQ0G,EAAYjH,GACpBmjB,iBAAkBF,EAAYhjB,UAC9BmjB,UAAWpZ,GAAkBiE,IAAIlQ,IAC7B,MAAMmQ,EAAOmE,GAASU,KAAKC,GAAKA,EAAEjV,SAAWA,GAC7C,MAAkB,YAAdmQ,EAAKxN,KACE,CAAEkQ,SAAU1C,EAAKnQ,QAEjB,CAAEuS,QAASpC,EAAKnQ,WAKnC,SFpnCsBpC,WAC1B,IACI,MAAMD,QAAiBkC,EAAQtB,KAAK,gBAAiB4mB,GAErD,OADA3nB,QAAQC,IAAI,YAAaE,GAClBA,EAASe,IACpB,CAAE,MAAOvC,GAEL,MADAqB,QAAQrB,MAAM,6BAA6BgpB,EAAYC,oBAAqBjpB,GACtEA,CACV,GE6mCcmpB,CAAeH,GACrB,MAAMI,EAAuB,IACtBxZ,EAAe/B,QAClBxH,OAAQ0G,EAAYjH,GACpBjB,WAAW,IAAIG,MAAOE,eAE1B4K,GAAkBzP,QAAQwD,IACtBsR,GAAkBtR,EAAQulB,IAGlC,CAAE,MAAOppB,GACLqB,QAAQrB,MAAM,6BAA8BA,EAChD,CAAC,QACG6P,EAAkB,CAAEd,SAAS,EAAOlB,QAAS,OAC7CkC,GAAqB,IACrBE,GAAqB,GACzB,GAkbmGiV,SAAuC,IAA7BpV,GAAkB3P,OAAc8H,UAAU,8GAA6GmB,SAAC,mBAEhQgH,IAAsB2T,IAA4C,UAAzBA,GAAgBvd,OACtD6B,EAAAA,EAAAA,KAAA,OAAKJ,UAAU,gFAAgFoB,QAASA,IAAMgH,IAAsB,GAAOjH,UACvIf,EAAAA,EAAAA,KAAA,OAAKuB,IAAKma,GAAgBE,QAASY,IAAKd,GAAgB/K,KAAM/Q,UAAU,2CAA2CoB,QAAUhE,GAAMA,EAAEkE,sBAI5I+G,IAAkD,WAAX,OAAfyT,SAAe,IAAfA,QAAe,EAAfA,GAAiBvd,QACtC6B,EAAAA,EAAAA,KAAA,OAAKJ,UAAU,wEAAwEoB,QAASA,IAAMkH,IAAwB,GAAOnH,UACjID,EAAAA,EAAAA,MAAA,OAAKlB,UAAU,wEAAwEoB,QAAUhE,GAAMA,EAAEkE,kBAAkBH,SAAA,EACvHD,EAAAA,EAAAA,MAAA,OAAKlB,UAAU,+DAA8DmB,SAAA,EACzEf,EAAAA,EAAAA,KAAA,MAAIJ,UAAU,oBAAmBmB,SAAC,gBAClCf,EAAAA,EAAAA,KAAA,UAAQgB,QAASA,IAAMkH,IAAwB,GAAQtI,UAAU,qCAAoCmB,UAACf,EAAAA,EAAAA,KAACud,EAAAA,IAAO,UAElHvd,EAAAA,EAAAA,KAAA,OAAKJ,UAAU,8BAA6BmB,SACvC,CAAC,WAAY,UAAW,QAAS,QAAS,SAAS2K,IAAIsV,IACpDhhB,EAAAA,EAAAA,KAAA,UAAkBgB,QAASA,IAAMoH,GAAsB4Y,GAAMphB,UAAW,qCAAoCuI,KAAuB6Y,EAAM,2CAA6C,mCAAoCjgB,SACrNigB,GADQA,OAKrBlgB,EAAAA,EAAAA,MAAA,OAAKlB,UAAU,gCAA+BmB,SAAA,CAClB,aAAvBoH,KACGrH,EAAAA,EAAAA,MAAA,OAAKlB,UAAU,mDAAkDmB,SAAA,EAC7Df,EAAAA,EAAAA,KAAA,OAAKJ,UAAU,sEAAqEmB,UAChFf,EAAAA,EAAAA,KAACuc,EAAAA,IAAO,CAAC3c,UAAU,gBAAgBlE,KAAM,QAE7CsE,EAAAA,EAAAA,KAAA,MAAIJ,UAAU,qBAAoBmB,SAAE2a,GAAgB/K,QACpD7P,EAAAA,EAAAA,MAAA,KAAGlB,UAAU,gBAAemB,SAAA,CAAE2a,GAAgBqB,aAAe,EAAE,iBAG/C,YAAvB5U,KACGnI,EAAAA,EAAAA,KAAA,OAAKJ,UAAU,YAAWmB,SACrBwH,IACGvI,EAAAA,EAAAA,KAAA,KAAGJ,UAAU,4BAA2BmB,SAAC,uBAEzCsH,GAAaqD,IAAI,CAACmQ,EAAQ1c,KACtB2B,EAAAA,EAAAA,MAAA,OAAkClB,UAAU,0DAAyDmB,SAAA,CAChG8a,EAAOoF,eACJjhB,EAAAA,EAAAA,KAAA,OAAKuB,IAAKsa,EAAOoF,cAAezE,IAAKX,EAAOqF,YAAathB,UAAU,yCAEnEI,EAAAA,EAAAA,KAAA,OAAKJ,UAAU,sEAAqEmB,UAChFf,EAAAA,EAAAA,KAACyc,EAAAA,IAAM,CAAC7c,UAAU,gBAAgBlE,KAAM,QAGhDoF,EAAAA,EAAAA,MAAA,OAAAC,SAAA,EACIf,EAAAA,EAAAA,KAAA,QAAMJ,UAAU,gBAAemB,SAAE8a,EAAOqF,cACvCrF,EAAOsF,kBAAmBnhB,EAAAA,EAAAA,KAAA,KAAGJ,UAAU,wBAAuBmB,SAAE8a,EAAOsF,uBAVtEtF,EAAOtgB,YAAc4D,MAiBvB,UAAvBgJ,KACGnI,EAAAA,EAAAA,KAAA,OAAKJ,UAAU,wCAAuCmB,SACjDiN,GAAa+B,OAAOpP,GAAO,CAAC,QAAS,SAAShD,SAASgD,EAAIxC,OAAOuN,IAAI,CAAC/K,EAAKxB,KACzEa,EAAAA,EAAAA,KAAA,UAAgBgB,QAASA,IAAM0H,GAAesT,GAAWrb,IAAMI,UAC3Df,EAAAA,EAAAA,KAAA,OAAKuB,IAAKya,GAAWrb,GAAM6b,IAAK7b,EAAIxD,SAAUyC,UAAU,yEAD/CT,MAOD,UAAvBgJ,KACGnI,EAAAA,EAAAA,KAAA,OAAKJ,UAAU,YAAWmB,SACrB,MACG,MAAM0e,EAAQzR,GAAa+B,OAAOpP,GAAoB,SAAbA,EAAIxC,MAC7C,OAAOshB,EAAM3nB,OAAS,EAClB2nB,EAAM/T,IAAI0V,IACNphB,EAAAA,EAAAA,KAACS,EAAW,CAAkBE,IAAKygB,EAASxgB,aAAa,GAAvCwgB,EAAQ3jB,MAG9BuC,EAAAA,EAAAA,KAAA,KAAGJ,UAAU,gCAA+BmB,SAAC,gCAEpD,EATA,KAae,UAAvBoH,KACGnI,EAAAA,EAAAA,KAAA,OAAKJ,UAAU,YAAWmB,SACrB,MACG,MACMsgB,EADerT,GAAa+B,OAAOpP,GAAoB,SAAbA,EAAIxC,OAAoBwC,EAAI5C,QAAQJ,SAAS,YAAcgD,EAAI5C,QAAQJ,SAAS,cAClG2jB,QAAQC,IAClC,MACMC,EAAQD,EAAQxjB,QAAQ1B,MADZ,wBAElB,OAAOmlB,EAAQA,EAAM9V,IAAI+V,IAAI,CACzBhkB,GAAI8jB,EAAQ9jB,GACZikB,IAAKD,EACLzjB,OAAQ2d,GAAc4F,EAAQvjB,QAAQ2S,KACtCnU,UAAW+kB,EAAQ/kB,aACjB,KAGV,OAAO6kB,EAASvpB,OAAS,EACrBupB,EAAS3V,IAAI,CAAC+V,EAAM5a,KAChB/F,EAAAA,EAAAA,MAAA,OAAiClB,UAAU,6BAA4BmB,SAAA,EACnEf,EAAAA,EAAAA,KAAA,KAAG/E,KAAMwmB,EAAKC,IAAK7M,OAAO,SAAS8M,IAAI,sBAAsB/hB,UAAU,0CAAyCmB,SAAE0gB,EAAKC,OACvH5gB,EAAAA,EAAAA,MAAA,KAAGlB,UAAU,6BAA4BmB,SAAA,CAAC,aAAW0gB,EAAKzjB,OAAO,OAAK,IAAIrB,KAAK8kB,EAAKjlB,WAAW4e,0BAFzF,GAAGqG,EAAKhkB,MAAMoJ,OAM5B7G,EAAAA,EAAAA,KAAA,KAAGJ,UAAU,gCAA+BmB,SAAC,gCAEpD,EAvBA,aA+BxB0H,KACGzI,EAAAA,EAAAA,KAAA,OAAKJ,UAAU,gFAAgFoB,QAASA,IAAM0H,GAAe,MAAM3H,UAC/Hf,EAAAA,EAAAA,KAAA,OAAKuB,IAAKkH,GAAa+T,IAAI,YAAY5c,UAAU,2CAA2CoB,QAAUhE,GAAMA,EAAEkE,sBAIrH6H,KACG/I,EAAAA,EAAAA,KAAA,OAAKJ,UAAU,wEAAuEmB,UAClFD,EAAAA,EAAAA,MAAA,OAAKlB,UAAU,oDAAmDmB,SAAA,EAC9Df,EAAAA,EAAAA,KAAA,MAAIJ,UAAU,yBAAwBmB,SAAC,iBACvCf,EAAAA,EAAAA,KAAA,KAAGJ,UAAU,qBAAoBmB,SAAC,6FAClCD,EAAAA,EAAAA,MAAA,OAAKlB,UAAU,yBAAwBmB,SAAA,EACnCf,EAAAA,EAAAA,KAAA,UAAQgB,QAASA,IAAMgI,IAAoB,GAAQpJ,UAAU,mEAAkEmB,SAAC,YAGhIf,EAAAA,EAAAA,KAAA,UAAQgB,QA/uBD5H,UAC3B,GAAKkM,EACL,SF95BwBlM,OAAOuT,EAAQnR,KAC7C,IACE,MAAMrC,QAAiBkC,EAAQtB,KAAK,sBAAsB4S,YAAiBnR,KAE3E,OADAxC,QAAQC,IAAI,YAAaE,GAClBA,EAASe,IAClB,CAAE,MAAOvC,GAEP,MADAqB,QAAQrB,MAAM,4BAA4B6D,KAAW7D,GAC/CA,CACR,GEu5BgBiqB,CAAiBld,EAAYjH,GAAI6H,EAAa9J,QACpDmK,EAAYsG,IAAI,IAAUA,EAAM,CAAC3G,EAAa9J,QAAS,MACvDsR,GAAkBxH,EAAa9J,OAAQ,KAC3C,CAAE,MAAO7D,GACLqB,QAAQrB,MAAM,wBAAyBA,EAC3C,CAAC,QACGqR,IAAoB,EACxB,GAquB6DpJ,UAAU,8DAA6DmB,SAAC,yBAS7I,ECt3DM8gB,EAAuBA,KACzB/gB,EAAAA,EAAAA,MAAA,OAAKlB,UAAU,kCAAiCmB,SAAA,EAC5Cf,EAAAA,EAAAA,KAAA,OAAKJ,UAAU,sDACfkB,EAAAA,EAAAA,MAAA,OAAKlB,UAAU,mBAAkBmB,SAAA,EAC7Bf,EAAAA,EAAAA,KAAA,OAAKJ,UAAU,iDACfI,EAAAA,EAAAA,KAAA,OAAKJ,UAAU,sDAKrBkiB,EAAkBA,KACpBhhB,EAAAA,EAAAA,MAAA,OAAKlB,UAAU,yCAAwCmB,SAAA,EAEnDD,EAAAA,EAAAA,MAAA,OAAKlB,UAAU,wFAAuFmB,SAAA,EAClGf,EAAAA,EAAAA,KAAA,OAAKJ,UAAU,oDACfkB,EAAAA,EAAAA,MAAA,OAAKlB,UAAU,2CAA0CmB,SAAA,EACrDf,EAAAA,EAAAA,KAAC6hB,EAAoB,KACrB7hB,EAAAA,EAAAA,KAAC6hB,EAAoB,KACrB7hB,EAAAA,EAAAA,KAAC6hB,EAAoB,KACrB7hB,EAAAA,EAAAA,KAAC6hB,EAAoB,KACrB7hB,EAAAA,EAAAA,KAAC6hB,EAAoB,KACrB7hB,EAAAA,EAAAA,KAAC6hB,EAAoB,KACrB7hB,EAAAA,EAAAA,KAAC6hB,EAAoB,WAK7B7hB,EAAAA,EAAAA,KAAA,OAAKJ,UAAU,0EAAyEmB,UACpFf,EAAAA,EAAAA,KAAA,OAAKJ,UAAU,0CAAyCmB,UACpDf,EAAAA,EAAAA,KAAA,OAAKJ,UAAU,cAAamB,UACxBf,EAAAA,EAAAA,KAAA,KAAGJ,UAAU,wBAAuBmB,SAAC,8BAmHzD,QA3GA,WACI,MAAM,OAAE4L,IAAWoV,EAAAA,EAAAA,MACZC,EAAUC,IAAengB,EAAAA,EAAAA,UAAS,CAAEoD,OAAQ,GAAIC,iBAAkB,MAClE+c,EAAWC,IAAgBrgB,EAAAA,EAAAA,WAAS,IACpCiD,EAAgBqd,IAAqBtgB,EAAAA,EAAAA,WAAS,IAC9CrG,EAAM4mB,IAAWvgB,EAAAA,EAAAA,UAAS,IAC1BgD,EAASwd,IAAcxgB,EAAAA,EAAAA,WAAS,GAEjCygB,GAAe5gB,EAAAA,EAAAA,SAAO,GAEtB+C,EAAc,CAChBiM,KAAM,MACNlT,GAAIkP,EACJiP,QAAS,sDAGP4G,EAAYppB,UAGd,GAFAJ,QAAQC,IAAI,2CAA2C8S,IAAW,mCAE7DjH,IAAWyd,EAAa/f,QAA7B,CAKA+f,EAAa/f,SAAU,EAEP,IAAZuJ,EACAoW,GAAa,GAEbC,GAAkB,GAGtB,IACIppB,QAAQC,IAAI,oCAAoC8S,IAAW,iBAC3D,MAAM0W,QHoCarpB,eAAOmC,GAAqC,IAAzBE,EAAI5D,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAG,EAAG6D,EAAI7D,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAG,GACjE,IACE,MAAMsB,QAAiBkC,EAAQM,IAAI,kBAAkBJ,UAAmBE,UAAaC,KAErF,OADA1C,QAAQC,IAAI,qBAAqBwC,KAAStC,GACnCA,EAASe,IAClB,CAAE,MAAOvC,GAEP,OADAqB,QAAQrB,MAAM,iCAAkCA,GACzC,EACT,CACF,CG7C0C+qB,CAAgB/V,EAAQZ,EAAS,IAE/D,GAA+B,IAA3B0W,EAAgB3qB,OAEhB,YADAwqB,GAAW,GAIf,MAAMK,EFtDyBC,EAACC,EAAc/mB,KACtD,IAAK+mB,IAAiBzO,MAAMC,QAAQwO,GAChC,MAAO,CAAE3d,OAAQ,GAAIC,iBAAkB,IAG3C,MAAM6c,EAAW,CACb9c,OAAQ,GACRC,iBAAkB,IAuBtB,OApBA0d,EAAa7qB,QAAQ6D,IACjB,MAAMinB,EAAW,CACbtnB,OAAQK,EAAKL,OACbmV,KAAM9U,EAAKknB,WAAalnB,EAAKkgB,aAC7BhgB,YAAaH,EAAwBC,EAAMC,GAC3CoR,qBAAsBrR,EAAKmnB,SAC3BpX,mBAAoB/P,EAAK+P,mBACzBgQ,QAAS/f,EAAK+f,SAAW,KACzBlK,SAAU7V,EAAK6V,SACfqL,YAAalhB,EAAKkhB,aAAe,EACjC5e,KAAwB,UAAlBtC,EAAK6Q,SAAuB,QAAU,WAG1B,UAAlBoW,EAAS3kB,KACT6jB,EAAS9c,OAAOzL,KAAKqpB,GAErBd,EAAS7c,iBAAiB1L,KAAKqpB,KAIhCd,GEwB2BY,CAA4BH,EAAiB9V,GAEvEsV,EAAYgB,IACR,GAAgB,IAAZlX,EACA,OAAO4W,EAEX,MAAMO,EAAmB,IAAI1Q,IAAIyQ,EAAa/d,OAAOwG,IAAI0G,GAAKA,EAAE5W,SAC1D2nB,EAAqB,IAAI3Q,IAAIyQ,EAAa9d,iBAAiBuG,IAAIqF,GAAKA,EAAEvV,SACtE4nB,EAAkBT,EAAkBzd,OAAO6K,OAAOqC,IAAM8Q,EAAiBpQ,IAAIV,EAAE5W,SAC/E6nB,EAAmBV,EAAkBxd,iBAAiB4K,OAAOgB,IAAMoS,EAAmBrQ,IAAI/B,EAAEvV,SAClG,MAAO,CACH0J,OAAQ,IAAI+d,EAAa/d,UAAWke,GACpCje,iBAAkB,IAAI8d,EAAa9d,oBAAqBke,MAI5DZ,EAAgB3qB,OAAS,IACzBwqB,GAAW,EAEnB,CAAE,MAAO3qB,GACLqB,QAAQrB,MAAM,uBAAwBA,EAC1C,CAAC,QACmB,IAAZoU,GACAoW,GAAa,GAEjBC,GAAkB,GAElBG,EAAa/f,SAAU,EACvBxJ,QAAQC,IAAI,8BAA8B8S,oBAA2B,iBACzE,CAhDA,MAFI/S,QAAQC,IAAI,uBAAuB8S,sBAA4BjH,2BAAiCyd,EAAa/f,UAAW,gBAsEhI,OANAF,EAAAA,EAAAA,WAAU,KACFqK,GACA6V,EAAU,IAEf,CAAC7V,KAGA3M,EAAAA,EAAAA,KAAA,OAAKuE,MAAO,CAAEsa,OAAQ,QAAUjf,UAAU,4BAA2BmB,SAChEmhB,GACGliB,EAAAA,EAAAA,KAAC8hB,EAAe,KAEhB9hB,EAAAA,EAAAA,KAACsjB,EAAe,CACZ5e,YAAaA,EACbC,MAAOqd,EACPnd,cAzBO0e,KAEnB,GADAvqB,QAAQC,IAAI,6BACRspB,EAAa/f,UAAYsC,EAEzB,YADA9L,QAAQC,IAAI,uDAGhB,MAAMwkB,EAAWhiB,EAAO,EACxB4mB,EAAQ5E,GACR+E,EAAU/E,IAkBE3Y,QAASA,EACTC,eAAgBA,KAKpC,C,qFCzIA,IAAIvN,GAAe,EACfC,EAAc,GAElB,MAAMC,EAAe,SAACC,GAAyB,IAAlBC,EAAKC,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAG,KACjCJ,EAAYO,QAAQC,IACZN,EACAM,EAAKC,OAAOP,GAEZM,EAAKE,QAAQP,KAGrBH,EAAc,EAClB,EAEMW,EAAuBC,IACzB,MAAMC,EAAWC,EAAAA,EAAMC,OAAO,CAC1BH,QAASA,IA4Eb,OAxEAC,EAASG,aAAaC,QAAQC,IACzBC,IACG,MAAMhB,EAAQiB,aAAaC,QAAQ,eAInC,OAHIlB,IACAgB,EAAOG,QAAuB,cAAI,UAAUnB,KAEzCgB,GAEVjB,GAAUuB,QAAQhB,OAAOP,IAG9BW,EAASG,aAAaU,SAASR,IAC1BQ,GAAaA,EACdC,UAAkB,IAADC,EACb,MAAMC,EAAkB3B,EAAMiB,OAE9B,GAA+B,OAAb,QAAdS,EAAA1B,EAAMwB,gBAAQ,IAAAE,OAAA,EAAdA,EAAgBE,UAAmBD,EAAgBE,OAAQ,CAC3D,GAAIhC,EACA,OAAO,IAAI0B,QAAQ,CAACf,EAASD,KACzBT,EAAYgC,KAAK,CAAEtB,UAASD,aAE/BwB,KAAK9B,IACF0B,EAAgBP,QAAuB,cAAI,UAAUnB,IAC9CU,EAASgB,KAEnBK,MAAMC,GAAOV,QAAQhB,OAAO0B,IAGjCN,EAAgBE,QAAS,EACzBhC,GAAe,EAEf,MAAMqC,EAAWhB,aAAaC,QAAQ,eACtCE,QAAQC,IAAI,kCAAwBZ,gBAAuBwB,GAE3D,IACI,MAAMC,QAAwBvB,EAAAA,EAAMwB,KAjEnC,mEAmEG,CAAC,EACD,CAAEC,iBAAiB,KAGjB,YAAEC,GAAgBH,EAAgBI,KACxCrB,aAAasB,QAAQ,cAAeF,GACpCjB,QAAQC,IAAI,8BAAoBZ,KAAY4B,GAExCX,EAAgBY,gBAAgBE,WAChCd,EAAgBY,KA1ExC,SAAuBG,GACnB,MAAMC,EAAc,IAAIF,SACxB,IAAK,IAAKG,EAAKC,KAAUH,EAASI,UAC9BH,EAAYI,OAAOH,EAAKC,GAE5B,OAAOF,CACX,CAoE+CK,CAAcrB,EAAgBY,OAGzDxC,EAAa,KAAMuC,GAEnB,MAAMW,EAAcxC,EAAoBC,GAGxC,OAFAiB,EAAgBP,QAAuB,cAAI,UAAUkB,IAE9CW,EAAYtB,EAEvB,CAAE,MAAOuB,GAKL,OAJA7B,QAAQrB,MAAM,qCAAsCkD,GACpDhC,aAAaiC,QACbC,OAAOC,SAASC,KAAO,SACvBvD,EAAamD,GACN3B,QAAQhB,OAAO2C,EAE1B,CAAC,QACGrD,GAAe,CACnB,CACJ,CAEA,OAAO0B,QAAQhB,OAAOP,KAIvBW,GAGXyC,OAAOG,iBAAiB,UAAYC,IACd,gBAAdA,EAAMZ,KACNvB,QAAQC,IAAI,6CAAoCkC,EAAMC,YAIvD,MAAMooB,EAAWprB,EAAoB,iDAC/BqrB,EAAgBrrB,EAAoB,iDACpCiD,EAAUjD,EAAoB,iDAC9BsrB,EAAmBtrB,EAAoB,8DACvCurB,EAAavrB,EAAoB,mC","sources":["services/apiService.js","services/dataTransformer.js","TechLife/HRMS/Components/Chats/ChatApplication.jsx","TechLife/HRMS/Components/Chats/ChatApp.jsx","axiosInstance.js"],"sourcesContent":["import axios from 'axios';\r\n\r\nconst AUTH_API_URL = 'http://hrms.anasolconsultancyservices.com/api/auth/refresh-token';\r\n\r\nfunction cloneFormData(formData) {\r\n    const newFormData = new FormData();\r\n    for (let [key, value] of formData.entries()) {\r\n        newFormData.append(key, value);\r\n    }\r\n    return newFormData;\r\n}\r\n\r\nlet isRefreshing = false;\r\nlet failedQueue = [];\r\n\r\nconst processQueue = (error, token = null) => {\r\n    failedQueue.forEach(prom => {\r\n        if (error) {\r\n            prom.reject(error);\r\n        } else {\r\n            prom.resolve(token);\r\n        }\r\n    });\r\n    failedQueue = [];\r\n};\r\n\r\nconst createAxiosInstance = (baseURL) => {\r\n    const instance = axios.create({\r\n        baseURL: baseURL,\r\n    });\r\n\r\n    instance.interceptors.request.use(\r\n        (config) => {\r\n            const token = localStorage.getItem('accessToken');\r\n            if (token) {\r\n                config.headers['Authorization'] = `Bearer ${token}`;\r\n            }\r\n            console.log('Request Headers (from Interceptor):', config.headers);\r\n            return config;\r\n        },\r\n        (error) => Promise.reject(error)\r\n    );\r\n\r\n    instance.interceptors.response.use(\r\n        (response) => response,\r\n        async (error) => {\r\n            const originalRequest = error.config;\r\n\r\n            if (error.response?.status === 401 && !originalRequest._retry) {\r\n                if (isRefreshing) {\r\n                    return new Promise((resolve, reject) => {\r\n                        failedQueue.push({ resolve, reject });\r\n                    })\r\n                    .then(token => {\r\n                        originalRequest.headers['Authorization'] = `Bearer ${token}`;\r\n                        return instance(originalRequest);\r\n                    })\r\n                    .catch(err => Promise.reject(err));\r\n                }\r\n\r\n                originalRequest._retry = true;\r\n                isRefreshing = true;\r\n\r\n                const oldToken = localStorage.getItem('accessToken');\r\n                console.log(` Token expired for ${baseURL}. Old Token:`, oldToken);\r\n\r\n                try {\r\n                    const refreshResponse = await axios.post(\r\n                        AUTH_API_URL,\r\n                        {},\r\n                        { withCredentials: true }\r\n                    );\r\n\r\n                    const { accessToken } = refreshResponse.data;\r\n                    localStorage.setItem('accessToken', accessToken);\r\n                    console.log(` New Token for ${baseURL}:`, accessToken);\r\n\r\n                    if (originalRequest.data instanceof FormData) {\r\n                        originalRequest.data = cloneFormData(originalRequest.data);\r\n                    }\r\n\r\n                    processQueue(null, accessToken);\r\n\r\n                    const newInstance = createAxiosInstance(baseURL);\r\n                    originalRequest.headers['Authorization'] = `Bearer ${accessToken}`;\r\n\r\n                    return newInstance(originalRequest);\r\n\r\n                } catch (refreshError) {\r\n                    console.error(\"Refresh token failed. Logging out.\", refreshError);\r\n                    localStorage.clear();\r\n                    window.location.href = '/login';\r\n                    processQueue(refreshError);\r\n                    return Promise.reject(refreshError);\r\n\r\n                } finally {\r\n                    isRefreshing = false;\r\n                }\r\n            }\r\n\r\n            return Promise.reject(error);\r\n        }\r\n    );\r\n\r\n    return instance;\r\n};\r\n\r\nwindow.addEventListener('storage', (event) => {\r\n    if (event.key === 'accessToken') {\r\n        console.log(\" Token updated in another tab:\", event.newValue);\r\n    }\r\n});\r\nexport const chatApi = createAxiosInstance('http://hrms.anasolconsultancyservices.com/api');\r\n\r\nexport const getChatOverview = async (employeeId, page = 0, size = 10) => {\r\n  try {\r\n    const response = await chatApi.get(`/chat/overview/${employeeId}?page=${page}&size=${size}`);\r\n    console.log(`Response for page ${page}:`, response);\r\n    return response.data;\r\n  } catch (error) {\r\n    console.error(\"Failed to fetch chat overview:\", error);\r\n    return [];\r\n  }\r\n};\r\n\r\nexport const getMessages = async (employeeId, chatId, page = 0, size = 15) => {\r\n  try {\r\n    const response = await chatApi.get(`/chat/${employeeId}/${chatId}?page=${page}&size=${size}`);\r\n    console.log(`Response for messages page ${page}:`, response);\r\n    return response.data;\r\n  } catch (error) {\r\n    console.error(`Failed to fetch messages for chat ${chatId}:`, error);\r\n    return [];\r\n  }\r\n};\r\n\r\nexport const updateMessage = async (messageId, newContent, senderId) => {\r\n  try {\r\n    const requestBody = {\r\n      content: newContent,\r\n      sender: senderId,\r\n    };\r\n    const response = await chatApi.put(`/chat/update/${messageId}`, requestBody);\r\n    console.log('Response:', response);\r\n    return response.data;\r\n  } catch (error) {\r\n    console.error(`Failed to update message ${messageId}:`, error);\r\n    throw error;\r\n  }\r\n};\r\n\r\nexport const deleteMessageForMe = async (messageId, userId) => {\r\n  try {\r\n    const response = await chatApi.post(`/chat/${messageId}/me?userId=${userId}`);\r\n    console.log('Response:', response);\r\n    return response.data;\r\n  } catch (error) {\r\n    console.error(`Failed to delete message ${messageId} for me:`, error);\r\n    throw error;\r\n  }\r\n};\r\n\r\nexport const deleteMessageForEveryone = async (messageId, userId) => {\r\n  try {\r\n    const response = await chatApi.post(`/chat/${messageId}/everyone?userId=${userId}`);\r\n    console.log('Response:', response);\r\n    return response.data;\r\n  } catch (error) {\r\n    console.error(`Failed to delete message ${messageId} for everyone:`, error);\r\n    throw error;\r\n  }\r\n};\r\n\r\nexport const uploadFile = async (formData) => {\r\n    try {\r\n        const response = await chatApi.post('/chat/upload', formData, {\r\n            headers: {\r\n                'Content-Type': 'multipart/form-data',\r\n            },\r\n        });\r\n        console.log('Response:', response);\r\n        return response.data;\r\n    } catch (error) {\r\n        console.error(\"File upload failed:\", error);\r\n        throw error;\r\n    }\r\n};\r\n\r\nexport const forwardMessage = async (forwardData) => {\r\n    try {\r\n        const response = await chatApi.post('/chat/forward', forwardData);\r\n        console.log('Response:', response);\r\n        return response.data;\r\n    } catch (error) {\r\n        console.error(`Failed to forward message ${forwardData.forwardMessageId}:`, error);\r\n        throw error;\r\n    }\r\n};\r\n\r\nexport const pinMessage = async (messageId, userId) => {\r\n    try {\r\n        const response = await chatApi.post(`/chat/pin/${messageId}?userId=${userId}`);\r\n        console.log('Response:', response);\r\n        return response.data;\r\n    } catch (error) {\r\n        console.error(`Failed to pin message ${messageId}:`, error);\r\n        throw error;\r\n    }\r\n};\r\n\r\nexport const unpinMessage = async (messageId, userId) => {\r\n    try {\r\n        const response = await chatApi.post(`/chat/unpin/${messageId}?userId=${userId}`);\r\n        console.log('Response:', response);\r\n        return response.data;\r\n    } catch (error) {\r\n        console.error(`Failed to unpin message ${messageId}:`, error);\r\n        throw error;\r\n    }\r\n};\r\n\r\nexport const getPinnedMessage = async (chatId, chatType, userId) => {\r\n  try {\r\n    const response = await chatApi.get(`/chat/${chatId}/pinned?chatType=${chatType}&userId=${userId}`);\r\n    console.log('Response:', response);\r\n    return response.data;\r\n  } catch (error) {\r\n    console.error(`Failed to fetch pinned message for chat ${chatId}:`, error);\r\n    return null;\r\n  }\r\n};\r\n\r\nexport const clearChatHistory = async (userId, chatId) => {\r\n  try {\r\n    const response = await chatApi.post(`/chat/clear?userId=${userId}&chatId=${chatId}`);\r\n    console.log('Response:', response);\r\n    return response.data;\r\n  } catch (error) {\r\n    console.error(`Failed to clear chat for ${chatId}:`, error);\r\n    throw error;\r\n  }\r\n};\r\n\r\nexport const uploadVoiceMessage = async (voiceData) => {\r\n  try {\r\n    const response = await chatApi.post('/chat/voice/upload', voiceData);\r\n    console.log('Response:', response);\r\n    return response.data;\r\n  } catch (error) {\r\n    console.error(\"Voice message upload failed:\", error);\r\n    throw error;\r\n  }\r\n};\r\n\r\nexport const getGroupMembers = async (teamId) => {\r\n  try {\r\n    const response = await chatApi.get(`/chat/team/employee/${teamId}`);\r\n    console.log('Response:', response);\r\n    return response.data;\r\n  } catch (error) {\r\n    console.error(`Failed to fetch members for team ${teamId}:`, error);\r\n    return null;\r\n  }\r\n};\r\n","import { chatApi } from \"../axiosInstance\";\r\n\r\nexport const generateChatListPreview = (item, currentUserId) => {\r\n    if (!item.lastMessage || item.lastMessage === 'Chat cleared') {\r\n      return '';\r\n    }\r\n\r\n    const lastMessageContent = item.lastMessage;\r\n    const prefix = item.lastMessageSenderId === currentUserId ? 'You: ' : '';\r\n\r\n    if (item.lastMessageType) {\r\n        switch (item.lastMessageType.toUpperCase()) {\r\n            case 'IMAGE': return prefix + ' Image';\r\n            case 'AUDIO': return prefix + ' Voice Message';\r\n            case 'FILE': return prefix + ` ${lastMessageContent}`;\r\n            case 'DELETED': return 'This message was deleted';\r\n        }\r\n    }\r\n    if (lastMessageContent.match(/\\.(jpeg|jpg|gif|png|webp)$/i)) {\r\n        return prefix + ' Image';\r\n    }\r\n    if (lastMessageContent.match(/\\.(mp3|wav|ogg|m4a|webm)$/i)) {\r\n        return prefix + ' Voice Message';\r\n    }\r\n    if (lastMessageContent.match(/\\.(pdf|doc|docx|ppt|pptx|xls|xlsx|zip|rar)$/i)) {\r\n        return prefix + ` ${lastMessageContent}`;\r\n    }\r\n\r\n    return prefix + lastMessageContent;\r\n};\r\n\r\nexport const transformOverviewToChatList = (overviewData, currentUserId) => { \r\n    if (!overviewData || !Array.isArray(overviewData)) {\r\n        return { groups: [], privateChatsWith: [] };\r\n    }\r\n\r\n    const chatList = {\r\n        groups: [],\r\n        privateChatsWith: [],\r\n    };\r\n\r\n    overviewData.forEach(item => {\r\n        const chatItem = {\r\n            chatId: item.chatId,\r\n            name: item.groupName || item.employeeName,\r\n            lastMessage: generateChatListPreview(item, currentUserId), \r\n            lastMessageTimestamp: item.lastSeen,\r\n            unreadMessageCount: item.unreadMessageCount,\r\n            profile: item.profile || null,\r\n            isOnline: item.isOnline,\r\n            memberCount: item.memberCount || 0,\r\n            type: item.chatType === 'GROUP' ? 'group' : 'private',\r\n        };\r\n\r\n        if (chatItem.type === 'group') {\r\n            chatList.groups.push(chatItem);\r\n        } else {\r\n            chatList.privateChatsWith.push(chatItem);\r\n        }\r\n    });\r\n\r\n    return chatList;\r\n};\r\n\r\nexport const transformMessageDTOToUIMessage = (msgDto) => {\r\n    let timestamp;\r\n    try {\r\n        if (msgDto.timestamp) {\r\n            const tsString = String(msgDto.timestamp);\r\n            timestamp = new Date(tsString.endsWith('Z') ? tsString : tsString + 'Z').toISOString();\r\n        } else if (msgDto.date && msgDto.time) {\r\n            timestamp = new Date(`${msgDto.date} ${msgDto.time} UTC`).toISOString();\r\n        } else {\r\n            timestamp = new Date().toISOString();\r\n        }\r\n    } catch (e) {\r\n        timestamp = new Date().toISOString();\r\n    }\r\n    \r\n    let messageType = 'text';\r\n    let fileUrl = msgDto.fileUrl || null;\r\n\r\n    if (msgDto.fileName) {\r\n        if (msgDto.fileType) {\r\n            if (msgDto.fileType.startsWith('image/')) messageType = 'image';\r\n            else if (msgDto.fileType.startsWith('audio/')) messageType = 'audio';\r\n            else if (msgDto.fileType.startsWith('video/')) messageType = 'video';\r\n            else messageType = 'file';\r\n        } else {\r\n            if (msgDto.fileName.match(/\\.(jpeg|jpg|gif|png|webp)$/i)) messageType = 'image';\r\n            else if (msgDto.fileName.match(/\\.(mp3|wav|ogg|m4a)$/i)) messageType = 'audio';\r\n            else if (msgDto.fileName.match(/\\.(mp4|webm|mov)$/i)) messageType = 'video';\r\n            else messageType = 'file';\r\n        }\r\n    } else if (msgDto.kind && msgDto.kind !== 'text') {\r\n        messageType = msgDto.kind.toLowerCase();\r\n    }\r\n    \r\n    const messageIdForUrl = msgDto.id || msgDto.messageId;\r\n\r\n    if (!fileUrl && ['image', 'video', 'audio', 'file'].includes(messageType) && messageIdForUrl) {\r\n        const baseUrl = chatApi.defaults.baseURL;\r\n        fileUrl = `${baseUrl}/chat/file/${messageIdForUrl}`;\r\n    }\r\n    \r\n    if (msgDto.isDeleted) {\r\n        messageType = 'deleted';\r\n    }\r\n\r\n    const finalId = msgDto.id || msgDto.messageId;\r\n    \r\n    return {\r\n        id: finalId, \r\n        messageId: finalId, \r\n        content: msgDto.content,\r\n        sender: msgDto.sender,\r\n        timestamp: timestamp,\r\n        status: (msgDto.seen === true || String(msgDto.isSeen) === 'true') ? 'seen' : 'sent',\r\n        type: messageType,\r\n        isEdited: msgDto.isEdited || false,\r\n        isPinned: msgDto.pinned || false,\r\n        fileName: msgDto.fileName || null,\r\n        fileUrl: fileUrl,\r\n        fileSize: msgDto.fileSize || null,\r\n        duration: msgDto.duration || 0,\r\n        clientId: msgDto.clientId || null,\r\n        isForwarded: msgDto.forwarded || false,\r\n        forwardedFrom: msgDto.forwardedFrom || null,\r\n        isReply: !!msgDto.replyTo,\r\n        replyTo: msgDto.replyTo ? {\r\n            sender: msgDto.replyTo.senderId,\r\n            content: msgDto.replyTo.content,\r\n            originalMessageId: msgDto.replyTo.originalMessageId,\r\n            type: msgDto.replyTo.type\r\n        } : null,\r\n    };\r\n};\r\n","import React, { useEffect, useState, useRef, useMemo, useCallback } from 'react';\r\nimport { Client } from '@stomp/stompjs';\r\nimport {\r\n    FaMicrophone, FaPaperclip, FaSmile, FaPaperPlane, FaArrowLeft, FaStop,\r\n    FaFileAlt, FaDownload, FaPlay, FaPause,\r\n    FaVideo, FaPhone, FaReply, FaEdit, FaThumbtack, FaShare, FaTrash, FaTimes, FaCheck,\r\n    FaChevronDown, FaImage, FaFileAudio, FaEye, FaAngleDoubleRight, FaCamera, FaPen, FaUsers, FaUser,\r\n    FaFilePdf, FaFileWord, FaFilePowerpoint, FaFileExcel, FaFileArchive\r\n} from 'react-icons/fa';\r\nimport { BsThreeDotsVertical } from 'react-icons/bs';\r\nimport EmojiPicker from 'emoji-picker-react';\r\nimport {\r\n    chatApi,\r\n    getMessages,\r\n    deleteMessageForMe,\r\n    deleteMessageForEveryone,\r\n    uploadFile,\r\n    forwardMessage,\r\n    getPinnedMessage,\r\n    pinMessage,\r\n    unpinMessage,\r\n    clearChatHistory,\r\n    uploadVoiceMessage,\r\n    getGroupMembers\r\n} from '../../../../services/apiService';\r\nimport { transformMessageDTOToUIMessage, generateChatListPreview } from '../../../../services/dataTransformer';\r\n\r\nconst formatFileSize = (bytes) => {\r\n    if (!bytes || bytes === 0) return '0 Bytes';\r\n    const k = 1024;\r\n    const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];\r\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\r\n    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\r\n};\r\n\r\nconst FileIcon = ({ fileName, className = \"text-3xl\" }) => {\r\n    const extension = fileName?.split('.').pop()?.toLowerCase();\r\n    if (['pdf'].includes(extension)) return <FaFilePdf className={`text-red-500 ${className}`} />;\r\n    if (['doc', 'docx'].includes(extension)) return <FaFileWord className={`text-blue-700 ${className}`} />;\r\n    if (['ppt', 'pptx'].includes(extension)) return <FaFilePowerpoint className={`text-orange-500 ${className}`} />;\r\n    if (['xls', 'xlsx'].includes(extension)) return <FaFileExcel className={`text-green-600 ${className}`} />;\r\n    if (['zip', 'rar', '7z'].includes(extension)) return <FaFileArchive className={`text-yellow-500 ${className}`} />;\r\n    if (['png', 'jpg', 'jpeg', 'gif', 'webp'].includes(extension)) return <FaImage className={`text-purple-500 ${className}`} />;\r\n    if (['mp3', 'wav', 'ogg'].includes(extension)) return <FaFileAudio className={`text-pink-500 ${className}`} />;\r\n    return <FaFileAlt className={`text-gray-500 ${className}`} />;\r\n};\r\n\r\nconst FileMessage = ({ msg, isMyMessage }) => {\r\n    const downloadUrl = `${chatApi.defaults.baseURL}/chat/file/${msg.messageId}`;\r\n\r\n    const content = (\r\n        <div className={`flex items-center gap-3 p-2 rounded-lg max-w-xs md:max-w-sm ${isMyMessage ? 'bg-blue-600' : 'bg-gray-200'}`}>\r\n            <div className=\"flex-shrink-0 p-2 bg-white/20 rounded-lg\">\r\n                <FileIcon fileName={msg.fileName} className=\"text-4xl\" />\r\n            </div>\r\n            <div className=\"flex-grow overflow-hidden mr-2\">\r\n                <p className={`font-semibold truncate ${isMyMessage ? 'text-white' : 'text-gray-800'}`}>{msg.fileName}</p>\r\n                <p className={`text-sm ${isMyMessage ? 'text-blue-200' : 'text-gray-600'}`}>{formatFileSize(msg.fileSize)}</p>\r\n            </div>\r\n            <div\r\n                onClick={(e) => {\r\n                    e.preventDefault();\r\n                    e.stopPropagation();\r\n                    window.open(downloadUrl, '_blank');\r\n                }}\r\n                className=\"flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center bg-black/20 hover:bg-black/30 text-white transition-colors cursor-pointer\"\r\n            >\r\n                <FaDownload size={18} />\r\n            </div>\r\n        </div>\r\n    );\r\n    return !isMyMessage ? <div onClick={() => window.open(downloadUrl, '_blank')} className=\"cursor-pointer\">{content}</div> : content;\r\n};\r\n\r\nconst AudioPlayer = ({ src, fileUrl, isSender, initialDuration = 0, fileSize = 0 }) => {\r\n    const audioRef = useRef(null);\r\n    const [isPlaying, setIsPlaying] = useState(false);\r\n    const [progress, setProgress] = useState(0);\r\n    const [duration, setDuration] = useState(initialDuration);\r\n    const [localSrc, setLocalSrc] = useState(src || null);\r\n    const [isDownloading, setIsDownloading] = useState(false);\r\n\r\n    useEffect(() => {\r\n        const audio = audioRef.current;\r\n        if (!audio) return;\r\n\r\n        const setAudioData = () => {\r\n            if (audio.duration !== Infinity && audio.duration > 0) {\r\n                setDuration(audio.duration);\r\n            }\r\n        };\r\n        const setAudioTime = () => setProgress(audio.currentTime);\r\n        const handleEnded = () => setIsPlaying(false);\r\n\r\n        audio.addEventListener('loadedmetadata', setAudioData);\r\n        audio.addEventListener('timeupdate', setAudioTime);\r\n        audio.addEventListener('ended', handleEnded);\r\n\r\n        return () => {\r\n            audio.removeEventListener('loadedmetadata', setAudioData);\r\n            audio.removeEventListener('timeupdate', setAudioTime);\r\n            audio.removeEventListener('ended', handleEnded);\r\n        };\r\n    }, [localSrc]);\r\n\r\n    const handleDownload = async () => {\r\n        if (isDownloading) return;\r\n        setIsDownloading(true);\r\n        try {\r\n            const response = await fetch(fileUrl);\r\n            const blob = await response.blob();\r\n            const localUrl = URL.createObjectURL(blob);\r\n            setLocalSrc(localUrl);\r\n        } catch (error) {\r\n            console.error(\"Failed to download audio:\", error);\r\n        } finally {\r\n            setIsDownloading(false);\r\n        }\r\n    };\r\n\r\n    const togglePlayPause = () => {\r\n        if (!audioRef.current) return;\r\n        if (isPlaying) {\r\n            audioRef.current.pause();\r\n        } else {\r\n            audioRef.current.play().catch(e => console.error(\"Audio play failed:\", e));\r\n        }\r\n        setIsPlaying(!isPlaying);\r\n    };\r\n\r\n    const formatTime = (time) => {\r\n        if (!time || time === Infinity) return '0:00';\r\n        const minutes = Math.floor(time / 60);\r\n        const seconds = Math.floor(time % 60);\r\n        return `${minutes}:${seconds.toString().padStart(2, '0')}`;\r\n    };\r\n\r\n    const progressPercentage = duration ? (progress / duration) * 100 : 0;\r\n\r\n    if (!localSrc) {\r\n        return (\r\n            <div className=\"flex items-center gap-3 p-2 w-64\">\r\n                {isDownloading ? (\r\n                    <div className=\"flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center bg-gray-400 bg-opacity-30\">\r\n                        <div className=\"animate-spin rounded-full h-5 w-5 border-b-2 border-white\"></div>\r\n                    </div>\r\n                ) : (\r\n                    <button onClick={handleDownload} className=\"flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center bg-gray-400 bg-opacity-30 text-white hover:bg-opacity-40 transition-colors\">\r\n                        <FaDownload size={16} />\r\n                    </button>\r\n                )}\r\n                <div className=\"flex-grow flex flex-col justify-center\">\r\n                    <p className=\"text-sm text-gray-700\">Voice Message</p>\r\n                    <div className=\"flex justify-between items-center mt-1\">\r\n                        <span className=\"text-xs text-gray-500\">{formatFileSize(fileSize)}</span>\r\n                        <span className=\"text-xs text-gray-500\">{formatTime(duration)}</span>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n    return (\r\n        <div className=\"flex items-center gap-3 p-2 w-64\">\r\n            <audio ref={audioRef} src={localSrc} preload=\"metadata\" />\r\n            <button onClick={togglePlayPause} className={`flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center ${isSender ? 'bg-white text-blue-600' : 'bg-gray-400 bg-opacity-30 text-white'}`}>\r\n                {isPlaying ? <FaPause size={16} /> : <FaPlay size={16} className=\"ml-1\" />}\r\n            </button>\r\n            <div className=\"flex-grow flex flex-col justify-center\">\r\n                <div className=\"w-full h-1.5 bg-black/20 rounded-full cursor-pointer\" onClick={(e) => {\r\n                    if (!duration) return;\r\n                    const rect = e.currentTarget.getBoundingClientRect();\r\n                    const clickX = e.clientX - rect.left;\r\n                    const newTime = (clickX / rect.width) * duration;\r\n                    if (audioRef.current) audioRef.current.currentTime = newTime;\r\n                }}>\r\n                    <div style={{ width: `${progressPercentage}%` }} className={`h-full rounded-full ${isSender ? 'bg-white' : 'bg-gray-300'}`}></div>\r\n                </div>\r\n                <span className={`text-xs self-end mt-1 ${isSender ? 'text-blue-200' : 'text-gray-500'}`}>{formatTime(duration)}</span>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\nconst MessageSkeleton = () => (\r\n    <div className=\"space-y-4 p-4\">\r\n        <div className=\"flex items-end gap-2 justify-start\">\r\n            <div className=\"w-8 h-8 rounded-full bg-gray-200 animate-pulse flex-shrink-0\"></div>\r\n            <div className=\"h-10 rounded-lg bg-gray-200 animate-pulse w-48\"></div>\r\n        </div>\r\n        <div className=\"flex items-end gap-2 justify-end\">\r\n            <div className=\"h-12 rounded-lg bg-blue-200 animate-pulse w-32\"></div>\r\n            <div className=\"w-8 h-8 rounded-full bg-gray-200 animate-pulse flex-shrink-0\"></div>\r\n        </div>\r\n        <div className=\"flex items-end gap-2 justify-start\">\r\n            <div className=\"w-8 h-8 rounded-full bg-gray-200 animate-pulse flex-shrink-0\"></div>\r\n            <div className=\"h-16 rounded-lg bg-gray-200 animate-pulse w-64\"></div>\r\n        </div>\r\n        <div className=\"flex items-end gap-2 justify-end\">\r\n            <div className=\"h-10 rounded-lg bg-blue-200 animate-pulse w-40\"></div>\r\n            <div className=\"w-8 h-8 rounded-full bg-gray-200 animate-pulse flex-shrink-0\"></div>\r\n        </div>\r\n        <div className=\"flex items-end gap-2 justify-start\">\r\n            <div className=\"w-8 h-8 rounded-full bg-gray-200 animate-pulse flex-shrink-0\"></div>\r\n            <div className=\"h-10 rounded-lg bg-gray-200 animate-pulse w-32\"></div>\r\n        </div>\r\n    </div>\r\n);\r\n\r\nconst getAudioDuration = (audioBlob) =>\r\n    new Promise((resolve) => {\r\n        const reader = new FileReader();\r\n\r\n        reader.onload = (event) => {\r\n            const audioContext = new (window.AudioContext || window.webkitAudioContext)();\r\n            audioContext.decodeAudioData(event.target.result,\r\n                (buffer) => {\r\n                    const duration = buffer.duration ? Math.round(buffer.duration) : 0;\r\n                    audioContext.close();\r\n                    resolve(duration);\r\n                },\r\n                (error) => {\r\n                    console.error(\"Error decoding audio data:\", error);\r\n                    audioContext.close();\r\n                    resolve(0);\r\n                }\r\n            );\r\n        };\r\n\r\n        reader.onerror = (error) => {\r\n            console.error(\"Error reading blob as ArrayBuffer:\", error);\r\n            resolve(0);\r\n        };\r\n\r\n        reader.readAsArrayBuffer(audioBlob);\r\n    });\r\nfunction ChatApplication({ currentUser, chats: initialChats, loadMoreChats, hasMore, isFetchingMore }) {\r\n    const [chatData, setChatData] = useState({ groups: [], privateChatsWith: [] });\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n    const [selectedChat, setSelectedChat] = useState(null);\r\n    const [message, setMessage] = useState('');\r\n    const [messages, setMessages] = useState({});\r\n    const [isMessagesLoading, setIsMessagesLoading] = useState(false);\r\n    const [isChatOpen, setIsChatOpen] = useState(false);\r\n    const [showEmojiPicker, setShowEmojiPicker] = useState(false);\r\n    const [isRecording, setIsRecording] = useState(false);\r\n    const [showChatMenu, setShowChatMenu] = useState(false);\r\n    const [downloadedMedia, setDownloadedMedia] = useState({});\r\n    const [contextMenu, setContextMenu] = useState({ visible: false, x: 0, y: 0, message: null, index: null });\r\n    const [editingInfo, setEditingInfo] = useState({ index: null, originalContent: '' });\r\n    const [replyingTo, setReplyingTo] = useState(null);\r\n    const [lastDeleted, setLastDeleted] = useState(null);\r\n    const [pinnedMessage, setPinnedMessage] = useState(null);\r\n    const [forwardingInfo, setForwardingInfo] = useState({ visible: false, message: null });\r\n    const [forwardRecipients, setForwardRecipients] = useState([]);\r\n    const [forwardSearchTerm, setForwardSearchTerm] = useState('');\r\n    const [showPinnedMenu, setShowPinnedMenu] = useState(false);\r\n    const [isProfileModalOpen, setIsProfileModalOpen] = useState(false);\r\n    const [isGroupInfoModalOpen, setIsGroupInfoModalOpen] = useState(false);\r\n    const [activeGroupInfoTab, setActiveGroupInfoTab] = useState('Overview');\r\n    const [groupMembers, setGroupMembers] = useState([]);\r\n    const [isGroupDataLoading, setIsGroupDataLoading] = useState(false);\r\n    const [imageInView, setImageInView] = useState(null);\r\n    const [isChatDataReady, setIsChatDataReady] = useState(false);\r\n    const [isConnected, setIsConnected] = useState(false);\r\n    const [showClearConfirm, setShowClearConfirm] = useState(false);\r\n    const [typingUsers, setTypingUsers] = useState({});\r\n    const [messagePages, setMessagePages] = useState({});\r\n    const [hasMoreMessages, setHasMoreMessages] = useState({});\r\n    const [isFetchingMoreMessages, setIsFetchingMoreMessages] = useState(false);\r\n    const [showScrollToBottom, setShowScrollToBottom] = useState(false);\r\n    const [newMessagesCount, setNewMessagesCount] = useState(0);\r\n\r\n    const sidebarScrollRef = useRef(null);\r\n    const chatContainerRef = useRef(null);\r\n    const stompClient = useRef(null);\r\n    const typingTimeoutRef = useRef({});\r\n    const fileInputRef = useRef(null);\r\n    const mediaRecorderRef = useRef(null);\r\n    const audioChunksRef = useRef([]);\r\n    const emojiPickerRef = useRef(null);\r\n    const emojiButtonRef = useRef(null);\r\n    const chatMenuRef = useRef(null);\r\n    const chatMenuButtonRef = useRef(null);\r\n    const contextMenuRef = useRef(null);\r\n    const messageInputRef = useRef(null);\r\n    const pinnedMenuRef = useRef(null);\r\n    const pinnedMenuButtonRef = useRef(null);\r\n    const onMessageReceivedRef = useRef(null);\r\n    const isFetchingOldMessages = useRef(false);\r\n    const subscriptions = useRef({});\r\n\r\n    const chatIdFromUrl = useMemo(() => {\r\n        if (typeof window !== 'undefined' && window.location.pathname.includes('/with')) {\r\n            const params = new URLSearchParams(window.location.search);\r\n            return params.get('id');\r\n        }\r\n        return null;\r\n    }, []);\r\n\r\n    const handleSidebarScroll = () => {\r\n        const container = sidebarScrollRef.current;\r\n        if (container) {\r\n            const { scrollTop, scrollHeight, clientHeight } = container;\r\n            if (scrollHeight - scrollTop - clientHeight < 100) {\r\n                console.log(`Scroll condition met. isFetchingMore: ${isFetchingMore}, hasMore: ${hasMore}`);\r\n                if (hasMore && !isFetchingMore) {\r\n                    loadMoreChats();\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    const handleChatScroll = () => {\r\n        const container = chatContainerRef.current;\r\n        if (!container) return;\r\n\r\n        const { scrollTop, scrollHeight, clientHeight } = container;\r\n\r\n        if (scrollTop === 0 && !isMessagesLoading && !isFetchingMoreMessages) {\r\n            const chatId = selectedChat.chatId;\r\n            if (hasMoreMessages[chatId] !== false) {\r\n                const nextPage = (messagePages[chatId] || 0) + 1;\r\n                setMessagePages(prev => ({ ...prev, [chatId]: nextPage }));\r\n                loadMoreMessages(chatId, nextPage);\r\n            }\r\n        }\r\n\r\n        const isScrolledUp = scrollHeight - scrollTop - clientHeight > 400;\r\n        if (isScrolledUp !== showScrollToBottom) {\r\n            setShowScrollToBottom(isScrolledUp);\r\n            if (!isScrolledUp) {\r\n                setNewMessagesCount(0);\r\n            }\r\n        }\r\n    };\r\n\r\n    const scrollToBottom = (behavior = 'smooth') => {\r\n        if (chatContainerRef.current) {\r\n            chatContainerRef.current.scrollTo({\r\n                top: chatContainerRef.current.scrollHeight,\r\n                behavior: behavior\r\n            });\r\n        }\r\n        setNewMessagesCount(0);\r\n    };\r\n\r\n    useEffect(() => {\r\n        if (initialChats) {\r\n            const correctedChats = {\r\n                groups: initialChats.groups.map(chat =>\r\n                    chat.chatId.toString() === chatIdFromUrl\r\n                        ? { ...chat, unreadMessageCount: 0 }\r\n                        : chat\r\n                ),\r\n                privateChatsWith: initialChats.privateChatsWith.map(chat =>\r\n                    chat.chatId.toString() === chatIdFromUrl\r\n                        ? { ...chat, unreadMessageCount: 0 }\r\n                        : chat\r\n                ),\r\n            };\r\n            setChatData(correctedChats);\r\n            setIsChatDataReady(true);\r\n        }\r\n    }, [initialChats, chatIdFromUrl]);\r\n\r\n    const loadMoreMessages = useCallback(async (chatId, pageNum) => {\r\n        if ((pageNum > 0 && isFetchingMoreMessages) || (pageNum === 0 && isMessagesLoading)) {\r\n            return;\r\n        }\r\n\r\n        if (pageNum > 0) {\r\n            setIsFetchingMoreMessages(true);\r\n            isFetchingOldMessages.current = true;\r\n        } else {\r\n            setIsMessagesLoading(true);\r\n        }\r\n\r\n        try {\r\n            const rawMessages = await getMessages(currentUser.id, chatId, pageNum, 15);\r\n            console.log(\"%c REFRESH (API) RAW DATA:\", \"color: red; font-weight: bold;\", rawMessages);\r\n\r\n            if (rawMessages.length === 0) {\r\n                setHasMoreMessages(prev => ({ ...prev, [chatId]: false }));\r\n                return;\r\n            }\r\n\r\n            const transformedMessages = rawMessages.map(transformMessageDTOToUIMessage);\r\n\r\n            const chatContainer = chatContainerRef.current;\r\n            const previousScrollHeight = chatContainer ? chatContainer.scrollHeight : 0;\r\n            const previousScrollTop = chatContainer ? chatContainer.scrollTop : 0;\r\n\r\n            setMessages(prev => ({\r\n                ...prev,\r\n                [chatId]: pageNum === 0\r\n                    ? transformedMessages\r\n                    : [...transformedMessages, ...(prev[chatId] || [])]\r\n            }));\r\n\r\n            if (pageNum > 0) {\r\n                requestAnimationFrame(() => {\r\n                    if (chatContainer) {\r\n                        chatContainer.scrollTop = (chatContainer.scrollHeight - previousScrollHeight) + previousScrollTop;\r\n                    }\r\n                });\r\n            }\r\n\r\n            if (rawMessages.length === 0) {\r\n                setHasMoreMessages(prev => ({ ...prev, [chatId]: false }));\r\n            }\r\n\r\n        } catch (error) {\r\n            console.error(`Failed to load messages for chat ${chatId}:`, error);\r\n        } finally {\r\n            if (pageNum > 0) {\r\n                setIsFetchingMoreMessages(false);\r\n                setTimeout(() => { isFetchingOldMessages.current = false; }, 100);\r\n            } else {\r\n                setIsMessagesLoading(false);\r\n            }\r\n        }\r\n    }, [currentUser.id, isFetchingMoreMessages, isMessagesLoading, getMessages]);\r\n    useEffect(() => {\r\n        if (!selectedChat) return;\r\n\r\n        const chatId = selectedChat.chatId;\r\n\r\n        setMessagePages(prev => ({ ...prev, [chatId]: 0 }));\r\n        setHasMoreMessages(prev => ({ ...prev, [chatId]: true }));\r\n        setMessages(prev => ({ ...prev, [chatId]: [] }));\r\n\r\n        loadMoreMessages(chatId, 0);\r\n\r\n        const fetchPinnedMessage = async () => {\r\n            try {\r\n                const pinnedMsgData = await getPinnedMessage(chatId, selectedChat.type, currentUser.id);\r\n                setPinnedMessage(pinnedMsgData);\r\n            } catch (error) {\r\n                console.error(\"Failed to fetch pinned message:\", error);\r\n                setPinnedMessage(null);\r\n            }\r\n        };\r\n        fetchPinnedMessage();\r\n\r\n    }, [selectedChat, currentUser.id]);\r\n\r\n    const updateLastMessage = useCallback((chatId, message) => {\r\n        setChatData(prev => {\r\n            const updateChat = (chat) => {\r\n                if (chat.chatId === chatId) {\r\n                    const isNewUnread = message && message.type !== 'deleted' && !message.isDeleted && message.sender !== currentUser.id && selectedChat?.chatId !== chatId;\r\n\r\n                    const overviewItem = {\r\n                        lastMessage: message ? (message.fileName || message.content) : '',\r\n                        lastMessageType: message ? message.type.toUpperCase() : null,\r\n                        lastMessageSenderId: message ? message.sender : null\r\n                    };\r\n\r\n                    return {\r\n                        ...chat,\r\n                        lastMessage: message ? generateChatListPreview(overviewItem, currentUser.id) : 'Chat cleared',\r\n                        lastMessageTimestamp: message?.timestamp || new Date(0).toISOString(),\r\n                        unreadMessageCount: (chat.unreadMessageCount || 0) + (isNewUnread ? 1 : 0)\r\n                    };\r\n                }\r\n                return chat;\r\n            };\r\n\r\n            const newGroups = prev.groups.map(updateChat);\r\n            const newPrivate = prev.privateChatsWith.map(updateChat);\r\n\r\n            return { groups: newGroups, privateChatsWith: newPrivate };\r\n        });\r\n    }, [currentUser.id, selectedChat]);\r\n\r\n    const onMessageReceived = useCallback((payload) => {\r\n        const container = chatContainerRef.current;\r\n        const shouldScrollOnReceive = container\r\n            ? (container.scrollHeight - container.scrollTop - container.clientHeight) < 300\r\n            : true;\r\n\r\n        const parsedData = JSON.parse(payload.body);\r\n        console.log(\"%c LIVE MSG (WebSocket) RAW DATA:\", \"color: green; font-weight: bold;\", parsedData);\r\n        console.log(\"Received WebSocket Message:\", parsedData);\r\n\r\n        if (parsedData.type === 'STATUS_UPDATE') {\r\n            const { status, chatId, messageIds } = parsedData;\r\n\r\n            setMessages(prevMessages => {\r\n                const chatKey = selectedChat?.type === 'group' ? parsedData.groupId : chatId;\r\n                const chatMessages = prevMessages[chatKey] || [];\r\n                const newStatus = status.toLowerCase();\r\n\r\n                const updatedMessages = chatMessages.map(msg => {\r\n                    if (messageIds.includes(msg.messageId)) {\r\n                        if (newStatus === 'seen') {\r\n                            return { ...msg, status: 'seen' };\r\n                        }\r\n                        if (newStatus === 'delivered' && msg.status === 'sent') {\r\n                            return { ...msg, status: 'delivered' };\r\n                        }\r\n                    }\r\n                    return msg;\r\n                });\r\n                return { ...prevMessages, [chatKey]: updatedMessages };\r\n            });\r\n            return;\r\n        }\r\n\r\n\r\n        if (parsedData.type === 'PIN_UPDATE') {\r\n            const pinnedDto = parsedData.payload;\r\n            const eventChatId = pinnedDto.groupId || (pinnedDto.sender === currentUser.id ? pinnedDto.receiver : pinnedDto.sender);\r\n\r\n            if (selectedChat?.chatId === eventChatId) {\r\n                setPinnedMessage(pinnedDto);\r\n            }\r\n            return;\r\n\r\n        } else if (parsedData.type === 'UNPIN_UPDATE') {\r\n            const unpinPayload = parsedData.payload;\r\n\r\n            let eventChatId;\r\n            if (selectedChat.type === 'group') {\r\n                eventChatId = unpinPayload.groupId;\r\n            } else {\r\n                eventChatId = unpinPayload.senderId === currentUser.id\r\n                    ? unpinPayload.receiverId\r\n                    : unpinPayload.senderId;\r\n            }\r\n            if (selectedChat?.chatId === eventChatId) {\r\n                setPinnedMessage(null);\r\n            }\r\n            return;\r\n        }\r\n\r\n        const receivedMessage = parsedData;\r\n        const messageChatId = receivedMessage.groupId || (receivedMessage.sender === currentUser.id ? receivedMessage.receiver : receivedMessage.sender);\r\n\r\n        if (!messageChatId) {\r\n            console.warn(\"Received message without a clear chat ID\", receivedMessage);\r\n            return;\r\n        }\r\n\r\n        if (receivedMessage.isDeleted || receivedMessage.type === 'deleted') {\r\n            setMessages(prevMessages => {\r\n                const chatMessages = prevMessages[messageChatId] || [];\r\n                let wasLastMessage = false;\r\n\r\n                if (chatMessages.length > 0) {\r\n                    const lastMessage = chatMessages[chatMessages.length - 1];\r\n                    wasLastMessage = lastMessage.messageId === receivedMessage.messageId || lastMessage.id === receivedMessage.messageId;\r\n                }\r\n\r\n                const updatedMessages = chatMessages.map(msg => {\r\n                    if (msg.messageId === receivedMessage.messageId || msg.id === receivedMessage.messageId) {\r\n                        return { ...msg, type: 'deleted', content: 'This message was deleted', fileName: null, fileSize: null, isDeleted: true };\r\n                    }\r\n                    return msg;\r\n                });\r\n\r\n                if (wasLastMessage) {\r\n                    const newLastMessage = updatedMessages.length > 0 ? updatedMessages[updatedMessages.length - 1] : null;\r\n                    updateLastMessage(messageChatId, newLastMessage);\r\n                }\r\n\r\n                return { ...prevMessages, [messageChatId]: updatedMessages };\r\n            });\r\n            return;\r\n        }\r\n\r\n        if (receivedMessage.isEdited) {\r\n            setMessages(prevMessages => {\r\n                const chatMessages = prevMessages[messageChatId] || [];\r\n\r\n                const updatedMessages = chatMessages.map(msg => {\r\n                    if (msg.messageId === receivedMessage.id || msg.messageId === receivedMessage.messageId) {\r\n                        const updatedMsg = {\r\n                            ...msg,\r\n                            content: receivedMessage.content,\r\n                            isEdited: true\r\n                        };\r\n\r\n                        if (chatMessages.length > 0 && chatMessages[chatMessages.length - 1].messageId === msg.messageId) {\r\n                            updateLastMessage(messageChatId, updatedMsg);\r\n                        }\r\n\r\n                        return updatedMsg;\r\n                    }\r\n\r\n                    return msg;\r\n                });\r\n\r\n                return { ...prevMessages, [messageChatId]: updatedMessages };\r\n            });\r\n            return;\r\n        }\r\n\r\n        const transformedForEditCheck = transformMessageDTOToUIMessage(receivedMessage);\r\n\r\n        setMessages(prevMessages => {\r\n            const chatMessages = prevMessages[messageChatId] || [];\r\n            const finalServerId = receivedMessage.messageId || receivedMessage.id;\r\n\r\n            const messageAlreadyExists = chatMessages.some(m => m.messageId === finalServerId && m.status === 'sent');\r\n            if (messageAlreadyExists) {\r\n                return prevMessages;\r\n            }\r\n\r\n            let newChatMessages = [...chatMessages];\r\n            let messageProcessed = false;\r\n            let finalMessageForUpdate = null;\r\n\r\n            const isProperAck = receivedMessage.sender === currentUser.id && receivedMessage.client_id;\r\n            const isBroadcastOfOwnMessage = receivedMessage.sender === currentUser.id && !receivedMessage.client_id;\r\n            const isIncoming = receivedMessage.sender !== currentUser.id;\r\n\r\n            if (isProperAck) {\r\n                const optimisticIndex = newChatMessages.findIndex(m => m.id === receivedMessage.client_id);\r\n                if (optimisticIndex > -1) {\r\n                    const transformedServerMessage = transformMessageDTOToUIMessage(receivedMessage);\r\n                    newChatMessages[optimisticIndex] = { ...newChatMessages[optimisticIndex], ...transformedServerMessage, status: 'sent' };\r\n                    finalMessageForUpdate = newChatMessages[optimisticIndex];\r\n                    messageProcessed = true;\r\n                }\r\n            } else if (isBroadcastOfOwnMessage) {\r\n                const optimisticIndex = newChatMessages.findLastIndex(m => m.status === 'sending' && m.sender === currentUser.id);\r\n                if (optimisticIndex > -1) {\r\n                    const transformedServerMessage = transformMessageDTOToUIMessage(receivedMessage);\r\n                    newChatMessages[optimisticIndex] = { ...newChatMessages[optimisticIndex], ...transformedServerMessage, status: 'sent' };\r\n                    finalMessageForUpdate = newChatMessages[optimisticIndex];\r\n                    messageProcessed = true;\r\n                } else if (!chatMessages.some(m => m.messageId === finalServerId)) {\r\n                    const finalMessage = transformMessageDTOToUIMessage(receivedMessage);\r\n                    newChatMessages.push(finalMessage);\r\n                    finalMessageForUpdate = finalMessage;\r\n                    messageProcessed = true;\r\n                }\r\n            } else if (isIncoming) {\r\n                if (!chatMessages.some(m => m.messageId === finalServerId)) {\r\n                    const finalMessage = transformMessageDTOToUIMessage(receivedMessage);\r\n                    newChatMessages.push(finalMessage);\r\n                    finalMessageForUpdate = finalMessage;\r\n                    messageProcessed = true;\r\n\r\n                    if (showScrollToBottom) {\r\n                        setNewMessagesCount(prevCount => prevCount + 1);\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (messageProcessed) {\r\n                updateLastMessage(messageChatId, finalMessageForUpdate);\r\n                return { ...prevMessages, [messageChatId]: newChatMessages };\r\n            }\r\n\r\n            return prevMessages;\r\n        });\r\n        const isIncoming = parsedData.sender !== currentUser.id && !parsedData.isEdited && !parsedData.isDeleted && parsedData.type !== 'deleted';\r\n        if (isIncoming && shouldScrollOnReceive) {\r\n            setTimeout(() => scrollToBottom('smooth'), 100);\r\n        }\r\n    }, [currentUser.id, updateLastMessage, selectedChat, showScrollToBottom]);\r\n\r\n    const allChats = useMemo(() => [\r\n        ...chatData.privateChatsWith.filter(user => user.chatId !== currentUser?.id),\r\n        ...chatData.groups,\r\n    ].sort((a, b) => new Date(b.lastMessageTimestamp) - new Date(a.lastMessageTimestamp)), [chatData, currentUser.id]);\r\n\r\n    const handleTypingEvent = useCallback((payload) => {\r\n        const typingUpdate = JSON.parse(payload.body);\r\n\r\n        if (typingUpdate.senderId === currentUser.id) return;\r\n\r\n        const chatIdKey = typingUpdate.type === 'TEAM' ? typingUpdate.groupId : typingUpdate.senderId;\r\n        if (!chatIdKey) return;\r\n        const senderChatInfo = allChats.find(c => c.chatId === typingUpdate.senderId);\r\n        const senderName = senderChatInfo?.name || 'Someone';\r\n\r\n        setTypingUsers(prev => {\r\n            const newTypingUsers = { ...prev };\r\n\r\n            if (typingTimeoutRef.current[chatIdKey]) {\r\n                clearTimeout(typingTimeoutRef.current[chatIdKey]);\r\n            }\r\n\r\n            if (typingUpdate.typing) {\r\n                newTypingUsers[chatIdKey] = `${senderName} is typing...`;\r\n                typingTimeoutRef.current[chatIdKey] = setTimeout(() => {\r\n                    setTypingUsers(p => {\r\n                        const updated = { ...p };\r\n                        delete updated[chatIdKey];\r\n                        return updated;\r\n                    });\r\n                }, 3000);\r\n\r\n            } else {\r\n                delete newTypingUsers[chatIdKey];\r\n            }\r\n            return newTypingUsers;\r\n        });\r\n    }, [currentUser.id, allChats]);\r\n\r\n    useEffect(() => {\r\n        onMessageReceivedRef.current = onMessageReceived;\r\n    });\r\n\r\n    useEffect(() => {\r\n        if (!isMessagesLoading && chatContainerRef.current) {\r\n            scrollToBottom('auto');\r\n        }\r\n    }, [isMessagesLoading, selectedChat]);\r\n\r\n    useEffect(() => {\r\n        if (!currentUser?.id || !isChatDataReady) return;\r\n\r\n        if (stompClient.current) {\r\n            return;\r\n        }\r\n\r\n        const brokerURL = `ws://hrms.anasolconsultancyservices.com/api/chat?employeeId=${currentUser.id}`;\r\n        const client = new Client({\r\n            brokerURL,\r\n            reconnectDelay: 5000,\r\n            onConnect: () => {\r\n                setIsConnected(true);\r\n                const messageHandler = (payload) => {\r\n                    if (onMessageReceivedRef.current) {\r\n                        onMessageReceivedRef.current(payload);\r\n                    }\r\n                };\r\n\r\n                const presenceHandler = (payload) => {\r\n                    const statusUpdate = JSON.parse(payload.body);\r\n                    if (statusUpdate.userId === currentUser.id) return;\r\n\r\n                    setChatData(prev => {\r\n                        const newPrivateChats = prev.privateChatsWith.map(chat => {\r\n                            if (chat.chatId === statusUpdate.userId) {\r\n                                return { ...chat, isOnline: statusUpdate.isOnline };\r\n                            }\r\n                            return chat;\r\n                        });\r\n                        return { ...prev, privateChatsWith: newPrivateChats };\r\n                    });\r\n                };\r\n\r\n                subscriptions.current['private'] = client.subscribe(`/user/queue/private`, messageHandler);\r\n                subscriptions.current['private-ack'] = client.subscribe(`/user/queue/private-ack`, messageHandler);\r\n                subscriptions.current['group-ack'] = client.subscribe(`/user/queue/group-ack`, messageHandler);\r\n                subscriptions.current['presence'] = client.subscribe('/topic/presence', presenceHandler);\r\n                subscriptions.current['typing'] = client.subscribe('/user/queue/typing-status', handleTypingEvent);\r\n            },\r\n            onWebSocketError: (error) => console.error('WebSocket Error:', error),\r\n            onStompError: (frame) => console.error('STOMP Error:', frame.headers['message'], frame.body),\r\n            onWebSocketClose: () => {\r\n                setIsConnected(false);\r\n            }\r\n        });\r\n\r\n        client.activate();\r\n        stompClient.current = client;\r\n\r\n        return () => {\r\n            if (stompClient.current?.active) {\r\n                stompClient.current.deactivate();\r\n                stompClient.current = null;\r\n            }\r\n        };\r\n    }, [currentUser?.id, isChatDataReady]);\r\n\r\n    const groupIds = useMemo(() => {\r\n        return (chatData.groups || []).map(g => g.chatId).sort().join(',');\r\n    }, [chatData.groups]);\r\n\r\n    useEffect(() => {\r\n        if (!isConnected || !stompClient.current?.active) return;\r\n\r\n        const messageHandler = (payload) => {\r\n            if (onMessageReceivedRef.current) {\r\n                onMessageReceivedRef.current(payload);\r\n            }\r\n        };\r\n\r\n        const requiredGroupIds = new Set((chatData.groups || []).map(g => g.chatId.toString()));\r\n        const currentSubKeys = Object.keys(subscriptions.current);\r\n        const subscribedGroupIds = new Set(currentSubKeys.filter(key => key.startsWith('group-')).map(key => key.replace('group-', '')));\r\n\r\n        subscribedGroupIds.forEach(groupId => {\r\n            if (!requiredGroupIds.has(groupId)) {\r\n                const subId = `group-${groupId}`;\r\n                if (subscriptions.current[subId]) {\r\n                    subscriptions.current[subId].unsubscribe();\r\n                    delete subscriptions.current[subId];\r\n                }\r\n            }\r\n        });\r\n\r\n        requiredGroupIds.forEach(groupId => {\r\n            if (!subscribedGroupIds.has(groupId)) {\r\n                const subId = `group-${groupId}`;\r\n                subscriptions.current[subId] = stompClient.current.subscribe(`/topic/team-${groupId}`, messageHandler);\r\n                const typingSubId = `group-typing-${groupId}`;\r\n                subscriptions.current[typingSubId] = stompClient.current.subscribe(`/topic/typing-status/${groupId}`, handleTypingEvent);\r\n            }\r\n        });\r\n\r\n    }, [isConnected, groupIds, chatData.groups, groupMembers, currentUser.id]);\r\n\r\n    const openChat = useCallback((targetChat) => {\r\n        if (!currentUser?.id || !stompClient.current?.active) {\r\n            return;\r\n        }\r\n        const destination = `/app/presence/open/${targetChat.chatId}`;\r\n        const payload = {\r\n            userId: currentUser.id,\r\n            type: targetChat.type === 'group' ? 'TEAM' : 'PRIVATE'\r\n        };\r\n        stompClient.current.publish({ destination, body: JSON.stringify(payload) });\r\n\r\n        setSelectedChat(targetChat);\r\n        setIsChatOpen(true);\r\n\r\n        const newUrl = `/chat/${currentUser.id}/with?id=${targetChat.chatId}`;\r\n        window.history.pushState({ path: newUrl }, '', newUrl);\r\n\r\n    }, [currentUser.id]);\r\n\r\n    const closeChat = useCallback(() => {\r\n        if (!selectedChat || !stompClient.current?.active || !currentUser?.id) return;\r\n        const destination = `/app/presence/close/${selectedChat.chatId}`;\r\n        stompClient.current.publish({ destination, body: \"{}\" });\r\n\r\n        setSelectedChat(null);\r\n        setIsChatOpen(false);\r\n\r\n        const newUrl = `/chat/${currentUser.id}`;\r\n        window.history.pushState({ path: newUrl }, '', newUrl);\r\n\r\n    }, [selectedChat, currentUser.id]);\r\n\r\n    const handleChatSelect = useCallback((chat) => {\r\n        if ((chat.unreadMessageCount || 0) > 0) {\r\n            setChatData(prev => ({\r\n                ...prev,\r\n                groups: prev.groups.map(g => g.chatId === chat.chatId ? { ...g, unreadMessageCount: 0 } : g),\r\n                privateChatsWith: prev.privateChatsWith.map(p => p.chatId === chat.chatId ? { ...p, unreadMessageCount: 0 } : p),\r\n            }));\r\n        }\r\n\r\n        if (selectedChat && selectedChat.chatId !== chat.chatId) {\r\n        }\r\n        openChat(chat);\r\n    }, [selectedChat, openChat]);\r\n\r\n    useEffect(() => {\r\n        const handleBeforeUnload = () => {\r\n            if (selectedChat && stompClient.current && stompClient.current.active) {\r\n                const destination = `/app/presence/close/${selectedChat.chatId}`;\r\n                stompClient.current.publish({ destination, body: \"{}\" });\r\n            }\r\n        };\r\n        window.addEventListener('beforeunload', handleBeforeUnload);\r\n        return () => window.removeEventListener('beforeunload', handleBeforeUnload);\r\n    }, [selectedChat]);\r\n\r\n    useEffect(() => {\r\n        const fetchGroupData = async () => {\r\n            if (!isGroupInfoModalOpen || !selectedChat || selectedChat.type !== 'group') {\r\n                return;\r\n            }\r\n\r\n            console.log(\"Group Info useEffect running. Tab:\", activeGroupInfoTab, \"Current members count:\", groupMembers.length);\r\n\r\n            if (activeGroupInfoTab === 'Members' && groupMembers.length === 0) {\r\n                try {\r\n                    setIsGroupDataLoading(true);\r\n                    console.log(\"Fetching members for team ID:\", selectedChat.chatId);\r\n\r\n                    const teamDetailsResponse = await getGroupMembers(selectedChat.chatId);\r\n                    console.log(\"API response from getGroupMembers:\", teamDetailsResponse);\r\n\r\n                    const teamDetails = Array.isArray(teamDetailsResponse) && teamDetailsResponse.length > 0\r\n                        ? teamDetailsResponse[0]\r\n                        : null;\r\n\r\n                    if (teamDetails && teamDetails.employees) {\r\n                        console.log(\"Setting group members state with:\", teamDetails.employees);\r\n                        setGroupMembers(teamDetails.employees);\r\n                    } else {\r\n                        console.log(\"No 'employees' array found in the final object. Setting empty array.\");\r\n                        setGroupMembers([]);\r\n                    }\r\n                } catch (error) {\r\n                    console.error(\"Failed to fetch group members:\", error);\r\n                    setGroupMembers([]);\r\n                } finally {\r\n                    setIsGroupDataLoading(false);\r\n                }\r\n            }\r\n        };\r\n\r\n        fetchGroupData();\r\n    }, [isGroupInfoModalOpen, activeGroupInfoTab, selectedChat, groupMembers.length]);\r\n\r\n    useEffect(() => {\r\n        const handleClickOutside = (event) => {\r\n            if (showEmojiPicker && emojiPickerRef.current && !emojiPickerRef.current.contains(event.target) && !emojiButtonRef.current?.contains(event.target)) setShowEmojiPicker(false);\r\n            if (showChatMenu && chatMenuRef.current && !chatMenuRef.current.contains(event.target) && !chatMenuButtonRef.current?.contains(event.target)) setShowChatMenu(false);\r\n            if (contextMenu.visible && contextMenuRef.current && !contextMenuRef.current.contains(event.target)) setContextMenu({ visible: false, x: 0, y: 0, message: null, index: null });\r\n            if (showPinnedMenu && pinnedMenuRef.current && !pinnedMenuRef.current.contains(event.target) && !pinnedMenuButtonRef.current?.contains(event.target)) setShowPinnedMenu(false);\r\n        };\r\n        document.addEventListener('mousedown', handleClickOutside);\r\n        return () => document.removeEventListener('mousedown', handleClickOutside);\r\n    }, [showEmojiPicker, showChatMenu, contextMenu.visible, showPinnedMenu]);\r\n\r\n    const sendTypingStatus = (isTyping) => {\r\n        if (!stompClient.current?.active || !selectedChat) return;\r\n\r\n        const payload = {\r\n            senderId: currentUser.id,\r\n            typing: isTyping,\r\n            type: selectedChat.type === 'group' ? 'TEAM' : 'PRIVATE',\r\n            receiverId: selectedChat.type === 'private' ? selectedChat.chatId : null,\r\n            groupId: selectedChat.type === 'group' ? selectedChat.chatId : null,\r\n        };\r\n\r\n        stompClient.current.publish({\r\n            destination: '/app/typing',\r\n            body: JSON.stringify(payload),\r\n        });\r\n    };\r\n\r\n    const handleSendMessage = () => {\r\n        if (!message.trim() || !selectedChat) return;\r\n\r\n        sendTypingStatus(false);\r\n\r\n        const clientId = Date.now().toString() + Math.random().toString(36).substring(2, 9);\r\n        const isReply = replyingTo !== null;\r\n\r\n        const optimisticMessage = {\r\n            id: clientId,\r\n            messageId: clientId,\r\n            sender: currentUser.id,\r\n            content: message,\r\n            timestamp: new Date().toISOString(),\r\n            status: 'sending',\r\n            type: 'text',\r\n            fileName: null,\r\n            fileSize: null,\r\n            isEdited: false,\r\n            replyTo: replyingTo,\r\n            isForwarded: false,\r\n        };\r\n\r\n        updateLastMessage(selectedChat.chatId, optimisticMessage);\r\n        setMessages(prev => ({\r\n            ...prev,\r\n            [selectedChat.chatId]: [...(prev[selectedChat.chatId] || []), optimisticMessage]\r\n        }));\r\n\r\n        let destination;\r\n        let payload;\r\n\r\n        if (isReply) {\r\n            destination = '/app/reply';\r\n            payload = {\r\n                replyToMessageId: replyingTo.messageId,\r\n                sender: currentUser.id,\r\n                content: message,\r\n                clientId: clientId,\r\n                receiver: selectedChat.type === 'private' ? selectedChat.chatId : null,\r\n                groupId: selectedChat.type === 'group' ? selectedChat.chatId : null,\r\n                type: selectedChat.type === 'group' ? 'TEAM' : 'PRIVATE',\r\n            };\r\n        } else {\r\n            destination = '/app/send';\r\n            payload = {\r\n                sender: currentUser.id,\r\n                content: message,\r\n                type: selectedChat.type === 'group' ? 'TEAM' : 'PRIVATE',\r\n                receiver: selectedChat.type === 'private' ? selectedChat.chatId : null,\r\n                groupId: selectedChat.type === 'group' ? selectedChat.chatId : null,\r\n                clientId: clientId,\r\n            };\r\n        }\r\n\r\n        stompClient.current.publish({ destination, body: JSON.stringify(payload) });\r\n\r\n        setMessage('');\r\n        setShowEmojiPicker(false);\r\n        setReplyingTo(null);\r\n        setTimeout(() => scrollToBottom('smooth'), 100);\r\n    };\r\n\r\n    const handleKeyDown = (event) => { if (event.key === 'Enter' && !event.shiftKey) { event.preventDefault(); if (editingInfo.index !== null) handleSaveEdit(); else handleSendMessage(); } };\r\n    const onEmojiClick = (emojiObject) => setMessage(prev => prev + emojiObject.emoji);\r\n    const handleFileButtonClick = () => fileInputRef.current.click();\r\n\r\n    const handleFileChange = async (event) => {\r\n        const file = event.target.files[0];\r\n        if (!file || !selectedChat) return;\r\n\r\n        let messageType = 'file';\r\n        if (file.type.startsWith('image/')) {\r\n            messageType = 'image';\r\n        } else if (file.type.startsWith('audio/')) {\r\n            messageType = 'audio';\r\n        }\r\n\r\n        const clientId = Date.now().toString() + Math.random().toString(36).substring(2, 9);\r\n\r\n        const localPreviewContent = URL.createObjectURL(file);\r\n\r\n        const optimisticMessage = {\r\n            id: clientId,\r\n            messageId: clientId,\r\n            sender: currentUser.id,\r\n            content: localPreviewContent,\r\n            timestamp: new Date().toISOString(),\r\n            status: 'sending',\r\n            type: messageType,\r\n            fileName: file.name,\r\n            fileSize: file.size,\r\n            fileUrl: localPreviewContent,\r\n            isEdited: false,\r\n        };\r\n\r\n        updateLastMessage(selectedChat.chatId, optimisticMessage);\r\n\r\n        setMessages(prev => ({\r\n            ...prev,\r\n            [selectedChat.chatId]: [...(prev[selectedChat.chatId] || []), optimisticMessage]\r\n        }));\r\n\r\n        const formData = new FormData();\r\n        formData.append('file', file);\r\n        formData.append('sender', currentUser.id);\r\n        formData.append('client_id', clientId);\r\n        formData.append('fileType', file.type);\r\n        formData.append('type', selectedChat.type === 'group' ? 'TEAM' : 'PRIVATE');\r\n\r\n        if (selectedChat.type === 'group') {\r\n            formData.append('groupId', selectedChat.chatId);\r\n        } else {\r\n            formData.append('receiver', selectedChat.chatId);\r\n        }\r\n\r\n        try {\r\n            await uploadFile(formData);\r\n        } catch (error) {\r\n            console.error(\"File upload failed in component:\", error);\r\n            setMessages(prev => {\r\n                const chatMessages = prev[selectedChat.chatId] || [];\r\n                const newMessages = chatMessages.map(m => m.id === clientId ? { ...m, status: 'failed' } : m);\r\n                return { ...prev, [selectedChat.chatId]: newMessages };\r\n            });\r\n        } finally {\r\n            event.target.value = null;\r\n        }\r\n    };\r\n\r\n    const handleMicButtonClick = () => { if (isRecording) stopRecording(); else startRecording(); };\r\n    const startRecording = async () => {\r\n        try {\r\n            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\r\n            setIsRecording(true);\r\n            audioChunksRef.current = [];\r\n\r\n            const recorder = new MediaRecorder(stream, { mimeType: 'audio/webm' });\r\n\r\n            recorder.ondataavailable = (event) => {\r\n                if (event.data.size > 0) {\r\n                    audioChunksRef.current.push(event.data);\r\n                }\r\n            };\r\n            recorder.onstop = async () => {\r\n                stream.getTracks().forEach(track => track.stop());\r\n\r\n                if (!selectedChat || audioChunksRef.current.length === 0) {\r\n                    return;\r\n                }\r\n\r\n                const audioBlob = new Blob(audioChunksRef.current, { type: 'audio/webm' });\r\n                console.log(\"Local Audio Blob created:\", audioBlob);\r\n                const debugUrl = URL.createObjectURL(audioBlob);\r\n                console.log(\"You can manually open this local URL to test:\", debugUrl);\r\n                const a = document.createElement('a');\r\n                a.style.display = 'none';\r\n                a.href = debugUrl;\r\n                a.download = 'test-recording.webm';\r\n                document.body.appendChild(a);\r\n                a.click();\r\n                document.body.removeChild(a);\r\n                const audioFile = new File([audioBlob], `voice-message-${Date.now()}.webm`, { type: 'audio/webm' });\r\n\r\n                const audioDuration = await getAudioDuration(audioBlob);\r\n                const reader = new FileReader();\r\n                reader.readAsDataURL(audioBlob);\r\n                reader.onloadend = async () => {\r\n                    const base64String = reader.result;\r\n                    const clientId = Date.now().toString() + Math.random().toString(36).substring(2, 9);\r\n                    const localPreviewUrl = URL.createObjectURL(audioBlob);\r\n\r\n                    const optimisticMessage = {\r\n                        id: clientId, messageId: clientId, sender: currentUser.id,\r\n                        content: localPreviewUrl, timestamp: new Date().toISOString(),\r\n                        status: 'sending', type: 'audio', fileName: audioFile.name,\r\n                        fileSize: audioFile.size, fileUrl: localPreviewUrl, isEdited: false,\r\n                        duration: audioDuration,\r\n                    };\r\n\r\n                    updateLastMessage(selectedChat.chatId, optimisticMessage);\r\n                    setMessages(prev => ({ ...prev, [selectedChat.chatId]: [...(prev[selectedChat.chatId] || []), optimisticMessage] }));\r\n\r\n                    const voiceData = {\r\n                        sender: currentUser.id,\r\n                        clientId: clientId,\r\n                        fileType: audioFile.type,\r\n                        fileName: audioFile.name,\r\n                        fileData: base64String,\r\n                        type: selectedChat.type === 'group' ? 'TEAM' : 'PRIVATE',\r\n                        groupId: selectedChat.type === 'group' ? selectedChat.chatId : null,\r\n                        receiver: selectedChat.type === 'private' ? selectedChat.chatId : null,\r\n                        duration: audioDuration,\r\n                    };\r\n\r\n                    try {\r\n                        await uploadVoiceMessage(voiceData);\r\n                    } catch (error) {\r\n                        console.error(\"Voice message upload failed:\", error);\r\n                        setMessages(prev => {\r\n                            const chatMessages = prev[selectedChat.chatId] || [];\r\n                            const newMessages = chatMessages.map(m => m.id === clientId ? { ...m, status: 'failed' } : m);\r\n                            return { ...prev, [selectedChat.chatId]: newMessages };\r\n                        });\r\n                    }\r\n                };\r\n            };\r\n\r\n            mediaRecorderRef.current = recorder;\r\n            mediaRecorderRef.current.start();\r\n\r\n        } catch (error) {\r\n            console.error(\"Mic error:\", error);\r\n            setIsRecording(false);\r\n        }\r\n    };\r\n\r\n    const stopRecording = () => {\r\n        if (mediaRecorderRef.current && mediaRecorderRef.current.state === \"recording\") {\r\n            mediaRecorderRef.current.stop();\r\n            setIsRecording(false);\r\n        }\r\n    };\r\n\r\n    const handleConfirmClearChat = async () => {\r\n        if (!selectedChat) return;\r\n        try {\r\n            await clearChatHistory(currentUser.id, selectedChat.chatId);\r\n            setMessages(prev => ({ ...prev, [selectedChat.chatId]: [] }));\r\n            updateLastMessage(selectedChat.chatId, null);\r\n        } catch (error) {\r\n            console.error(\"Failed to clear chat:\", error);\r\n        } finally {\r\n            setShowClearConfirm(false);\r\n        }\r\n    };\r\n\r\n    const handleMediaDownload = (src, fileName) => { const link = document.createElement('a'); link.href = src; link.setAttribute('download', fileName || 'download'); document.body.appendChild(link); link.click(); document.body.removeChild(link); };\r\n    const handleContextMenu = (event, message, index) => { event.preventDefault(); event.stopPropagation(); const menuWidth = 180; const menuHeight = 250; let x = event.pageX; let y = event.pageY; if (x + menuWidth > window.innerWidth) x -= menuWidth; if (y + menuHeight > window.innerHeight) y -= menuHeight; setContextMenu({ visible: true, x, y, message, index }); };\r\n    const handleReply = () => { setReplyingTo(contextMenu.message); setContextMenu({ visible: false, x: 0, y: 0, message: null, index: null }); messageInputRef.current.focus(); };\r\n    const handleEdit = () => { setEditingInfo({ index: contextMenu.index, originalContent: contextMenu.message.content }); setMessage(contextMenu.message.content); setContextMenu({ visible: false, x: 0, y: 0, message: null, index: null }); messageInputRef.current.focus(); };\r\n\r\n    const handleSaveEdit = () => {\r\n        const updatedContent = message.trim();\r\n\r\n        if (updatedContent === '' || editingInfo.index === null || !stompClient.current?.active) {\r\n            cancelEdit();\r\n            return;\r\n        }\r\n\r\n        const chatId = selectedChat.chatId;\r\n        const currentMessages = messages[chatId];\r\n        const messageToEdit = currentMessages[editingInfo.index];\r\n        const messageId = messageToEdit.messageId;\r\n\r\n        if (updatedContent === editingInfo.originalContent || typeof messageId !== 'number') {\r\n            cancelEdit();\r\n            return;\r\n        }\r\n\r\n        const optimisticUpdatedMessage = {\r\n            ...messageToEdit,\r\n            content: updatedContent,\r\n            isEdited: true,\r\n        };\r\n\r\n        const updatedMessagesList = currentMessages.map((msg, index) =>\r\n            index === editingInfo.index ? optimisticUpdatedMessage : msg\r\n        );\r\n\r\n        setMessages(prev => ({\r\n            ...prev,\r\n            [chatId]: updatedMessagesList,\r\n        }));\r\n\r\n        if (editingInfo.index === currentMessages.length - 1) {\r\n            updateLastMessage(chatId, optimisticUpdatedMessage);\r\n        }\r\n\r\n        const payload = {\r\n            messageId: messageId,\r\n            content: updatedContent,\r\n            sender: currentUser.id,\r\n        };\r\n\r\n        const destination = '/app/edit';\r\n\r\n        stompClient.current.publish({\r\n            destination,\r\n            body: JSON.stringify(payload)\r\n        });\r\n\r\n        cancelEdit();\r\n    };\r\n\r\n    const cancelEdit = () => { setEditingInfo({ index: null, originalContent: '' }); setMessage(''); };\r\n\r\n\r\n\r\n    const handleDelete = async (forEveryone) => {\r\n        const chatId = selectedChat.chatId;\r\n        const currentMessages = [...(messages[chatId] || [])];\r\n        const messageToDelete = currentMessages[contextMenu.index];\r\n        const messageId = messageToDelete?.messageId;\r\n\r\n        if (!messageId || typeof messageId !== 'number' || messageToDelete.status === 'sending' || messageToDelete.status === 'failed') {\r\n            console.error(\"Invalid messageId or message status for deletion:\", messageId, messageToDelete.status);\r\n            setContextMenu({ visible: false, x: 0, y: 0, message: null, index: null });\r\n            return;\r\n        }\r\n\r\n        try {\r\n            if (forEveryone) {\r\n                await deleteMessageForEveryone(messageId, currentUser.id);\r\n            } else {\r\n                await deleteMessageForMe(messageId, currentUser.id);\r\n                const nextMessages = currentMessages.filter((_, i) => i !== contextMenu.index);\r\n                setMessages(prev => ({ ...prev, [chatId]: nextMessages }));\r\n                const newLastMessage = nextMessages.length > 0 ? nextMessages[nextMessages.length - 1] : null;\r\n                updateLastMessage(chatId, newLastMessage);\r\n            }\r\n        } catch (error) {\r\n            console.error(`Failed to delete message ${messageId} in component:`, error);\r\n        } finally {\r\n            setContextMenu({ visible: false, x: 0, y: 0, message: null, index: null });\r\n        }\r\n    };\r\n\r\n    const handleUndoDelete = () => { if (!lastDeleted) return; const currentMessages = [...messages[selectedChat.chatId]]; currentMessages[lastDeleted.index] = lastDeleted.message; setMessages(prev => ({ ...prev, [selectedChat.chatId]: currentMessages })); setLastDeleted(null); };\r\n    const handlePin = async () => {\r\n        if (!contextMenu.message?.messageId) return;\r\n\r\n        try {\r\n            const messageIdToPin = contextMenu.message.messageId;\r\n            const response = await pinMessage(messageIdToPin, currentUser.id);\r\n            setPinnedMessage(response);\r\n        } catch (error) {\r\n            console.error(\"Failed to pin message:\", error);\r\n        } finally {\r\n            setContextMenu({ visible: false, x: 0, y: 0, message: null, index: null });\r\n        }\r\n    };\r\n\r\n    const handleUnpin = async () => {\r\n        if (!pinnedMessage?.messageId) return;\r\n\r\n        try {\r\n            await unpinMessage(pinnedMessage.messageId, currentUser.id);\r\n            setPinnedMessage(null);\r\n        } catch (error) {\r\n            console.error(\"Failed to unpin message:\", error);\r\n        } finally {\r\n            setShowPinnedMenu(false);\r\n        }\r\n    };\r\n\r\n    const handleGoToMessage = () => {\r\n        setShowPinnedMenu(false);\r\n        if (pinnedMessage) {\r\n            const messageIndex = chatMessages.findIndex(m => m.messageId === pinnedMessage.messageId);\r\n\r\n            if (messageIndex !== -1) {\r\n                const messageElement = document.querySelector(`[data-message-index='${messageIndex}']`);\r\n                if (messageElement) {\r\n                    messageElement.scrollIntoView({ behavior: 'smooth', block: 'center' });\r\n                    messageElement.classList.add('animate-pulse', 'bg-blue-200');\r\n                    setTimeout(() => messageElement.classList.remove('animate-pulse', 'bg-blue-200'), 2500);\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    const handleForward = () => {\r\n        setForwardingInfo({ visible: true, message: contextMenu.message });\r\n        setContextMenu({ visible: false, x: 0, y: 0, message: null, index: null });\r\n    };\r\n\r\n    const handleConfirmForward = async () => {\r\n        const originalMsg = forwardingInfo.message;\r\n        if (!originalMsg || forwardRecipients.length === 0) {\r\n            return;\r\n        }\r\n\r\n        const forwardData = {\r\n            sender: currentUser.id,\r\n            forwardMessageId: originalMsg.messageId,\r\n            forwardTo: forwardRecipients.map(chatId => {\r\n                const chat = allChats.find(c => c.chatId === chatId);\r\n                if (chat.type === 'private') {\r\n                    return { receiver: chat.chatId };\r\n                } else {\r\n                    return { groupId: chat.chatId };\r\n                }\r\n            })\r\n        };\r\n\r\n        try {\r\n            await forwardMessage(forwardData);\r\n            const newLastMessageObject = {\r\n                ...forwardingInfo.message,\r\n                sender: currentUser.id,\r\n                timestamp: new Date().toISOString(),\r\n            };\r\n            forwardRecipients.forEach(chatId => {\r\n                updateLastMessage(chatId, newLastMessageObject);\r\n            });\r\n\r\n        } catch (error) {\r\n            console.error(\"Failed to forward message:\", error);\r\n        } finally {\r\n            setForwardingInfo({ visible: false, message: null });\r\n            setForwardRecipients([]);\r\n            setForwardSearchTerm('');\r\n        }\r\n    };\r\n\r\n    const filteredChats = allChats.filter(chat => chat.name?.toLowerCase().includes(searchTerm.toLowerCase()));\r\n\r\n    useEffect(() => {\r\n        if (chatIdFromUrl && allChats.length > 0 && isConnected && !selectedChat) {\r\n            const chatToSelect = allChats.find(c => c.chatId.toString() === chatIdFromUrl);\r\n\r\n            if (chatToSelect) {\r\n                console.log(\"SUCCESS: All conditions met. Selecting chat from URL:\", chatToSelect);\r\n                handleChatSelect(chatToSelect);\r\n            } else {\r\n                console.warn(`WARN: Chat with ID ${chatIdFromUrl} not found in the chat list.`);\r\n            }\r\n        }\r\n    }, [allChats, chatIdFromUrl, selectedChat, handleChatSelect, isConnected]);\r\n\r\n    const openGroupInfoModal = () => {\r\n        if (selectedChat?.type === 'group') {\r\n            setActiveGroupInfoTab('Overview');\r\n            setGroupMembers([]);\r\n            setIsGroupInfoModalOpen(true);\r\n        }\r\n    };\r\n\r\n    const formatTimestamp = (isoString) => {\r\n        if (!isoString) return '';\r\n        const date = new Date(isoString.endsWith('Z') ? isoString : isoString + 'Z');\r\n        if (isNaN(date)) return '';\r\n        return date.toLocaleTimeString('en-US', {\r\n            hour: '2-digit',\r\n            minute: '2-digit',\r\n            hour12: true\r\n        });\r\n    };\r\n\r\n    const formatDateHeader = (isoString) => {\r\n        if (!isoString) return '';\r\n        const date = new Date(String(isoString).endsWith('Z') ? isoString : isoString + 'Z');\r\n        if (isNaN(date)) return 'Invalid Date';\r\n        const today = new Date();\r\n        const yesterday = new Date(today);\r\n        yesterday.setDate(yesterday.getDate() - 1);\r\n        if (date.toDateString() === today.toDateString()) return 'Today';\r\n        if (date.toDateString() === yesterday.toDateString()) return 'Yesterday';\r\n        return date.toLocaleDateString([], { year: 'numeric', month: 'long', day: 'numeric' });\r\n    };\r\n\r\n    const formatLastSeen = (isoString) => {\r\n        if (!isoString) return 'Offline';\r\n        const date = new Date(String(isoString).endsWith('Z') ? isoString : isoString + 'Z');\r\n        if (isNaN(date)) return 'Offline';\r\n        const today = new Date();\r\n        if (date.toDateString() === today.toDateString()) {\r\n            return `last seen today at ${formatTimestamp(isoString)}`;\r\n        }\r\n        return `last seen on ${date.toLocaleDateString()}`;\r\n    };\r\n\r\n    const getStatusRingColor = (status) => {\r\n        switch (status) {\r\n            case 'sending': return 'ring-yellow-400';\r\n            case 'sent': return 'ring-gray-400';\r\n            case 'delivered': return 'ring-blue-500';\r\n            case 'seen': return 'ring-green-500';\r\n            case 'failed': return 'ring-red-500';\r\n            default: return 'ring-transparent';\r\n        }\r\n    };\r\n\r\n    let lastMessageDate = null;\r\n\r\n    const currentChatInfo = selectedChat ? allChats.find(c => c.chatId === selectedChat.chatId) : null;\r\n    const chatMessages = currentChatInfo ? messages[currentChatInfo.chatId] || [] : [];\r\n\r\n    const getSenderInfo = (senderId) => {\r\n        if (!currentUser) return { name: 'Unknown', profile: null };\r\n        if (senderId === currentUser.id) return { name: 'You', profile: currentUser.profile };\r\n        const allUsers = [...chatData.privateChatsWith, ...(currentChatInfo?.members || [])];\r\n        const member = allUsers.find(m => m.chatId === senderId || m.employeeId === senderId);\r\n        return member\r\n            ? { name: member.name || member.employeeName, profile: member.profile || null }\r\n            : { name: 'Unknown User', profile: null };\r\n    };\r\n\r\n    const getFileUrl = (msg) => {\r\n        const baseUrl = chatApi.defaults.baseURL;\r\n\r\n        if (msg.fileUrl && msg.fileUrl.startsWith('blob:')) {\r\n            return msg.fileUrl;\r\n        }\r\n\r\n        if (msg.fileUrl && msg.fileUrl.startsWith('/api')) {\r\n            const origin = new URL(baseUrl).origin;\r\n            return `${origin}${msg.fileUrl}`;\r\n        } else if (msg.fileUrl) {\r\n            return msg.fileUrl;\r\n        }\r\n\r\n        const messageIdForUrl = msg.id || msg.messageId;\r\n        if (messageIdForUrl) {\r\n            return `${baseUrl}/chat/file/${messageIdForUrl}`;\r\n        }\r\n        return msg.content;\r\n    };\r\n\r\n    return (\r\n        <div className=\"w-full h-full bg-gray-100 font-sans\">\r\n            <div className=\"flex w-full h-full p-0 md:p-4 md:gap-4\">\r\n                <div className={`relative w-full md:w-[30%] h-full p-4 bg-white flex flex-col shadow-xl md:rounded-lg ${isChatOpen ? 'hidden md:flex' : 'flex'}`}>\r\n                    <div className=\"mb-4 flex-shrink-0\"><input type=\"text\" placeholder=\"Search chats or users...\" className=\"w-full p-3 rounded-lg border border-gray-300 bg-gray-50\" value={searchTerm} onChange={e => setSearchTerm(e.target.value)} /></div>\r\n                    <div ref={sidebarScrollRef} onScroll={handleSidebarScroll} className=\"flex-grow space-y-2 pr-2 overflow-y-auto custom-scrollbar\">\r\n                        {filteredChats.map(chat => (\r\n                            <div key={chat.chatId} onClick={() => handleChatSelect(chat)} className={`p-3 flex items-center rounded-lg cursor-pointer group ${selectedChat?.chatId === chat.chatId ? 'bg-blue-100' : 'hover:bg-blue-50'}`}>\r\n                                <div className=\"relative flex-shrink-0\">\r\n                                    {chat.type === 'group' ? (\r\n                                        <div className=\"w-11 h-11 rounded-full bg-gray-200 flex items-center justify-center\">\r\n                                            <FaUsers className=\"text-gray-500\" size={24} />\r\n                                        </div>\r\n                                    ) : chat.profile ? (\r\n                                        <img src={chat.profile} alt={chat.name} className=\"w-11 h-11 rounded-full object-cover\" />\r\n                                    ) : (\r\n                                        <div className=\"w-11 h-11 rounded-full bg-gray-200 flex items-center justify-center\">\r\n                                            <FaUser className=\"text-gray-500\" size={24} />\r\n                                        </div>\r\n                                    )}\r\n                                    {chat.isOnline && (<span className=\"absolute bottom-0 right-0 block h-3 w-3 rounded-full ring-2 ring-white bg-green-500\"></span>)}\r\n                                </div>\r\n                                <div className=\"flex-1 min-w-0 mx-3\"><p className=\"font-semibold text-gray-800 truncate\">{chat.name}</p><p className=\"text-sm text-gray-500 truncate\">{chat.lastMessage || 'No messages yet'}</p></div>\r\n                                {(chat.unreadMessageCount || 0) > 0 && (<div className=\"flex-shrink-0\"><span className=\"bg-blue-600 text-white text-xs font-bold px-2 py-1 rounded-full\">{chat.unreadMessageCount}</span></div>)}\r\n                            </div>\r\n                        ))}\r\n                        {isFetchingMore && (\r\n                            <div className=\"flex justify-center items-center p-4\">\r\n                                <div className=\"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600\"></div>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n\r\n                <div className={`w-full md:w-[70%] h-full flex flex-col bg-white md:rounded-lg shadow-xl relative ${isChatOpen ? 'flex' : 'hidden md:flex'}`}>\r\n                    {!currentChatInfo ? (\r\n                        <div className=\"flex items-center justify-center h-full\">\r\n                            <div className=\"text-center\">\r\n                                <FaUsers className=\"mx-auto text-6xl text-gray-300\" />\r\n                                <p className=\"mt-4 text-xl text-center text-gray-600\">Select a chat to begin</p>\r\n                                <p className=\"text-gray-400\">Start a conversation with your team or colleagues.</p>\r\n                            </div>\r\n                        </div>\r\n                    ) : (\r\n                        <>\r\n                            <div className=\"flex-shrink-0 flex items-center justify-between p-4 border-b border-gray-200\">\r\n                                <div className=\"flex items-center space-x-3 flex-grow min-w-0\">\r\n                                    <button onClick={closeChat} className=\"md:hidden p-2 rounded-full hover:bg-gray-100\"><FaArrowLeft /></button>\r\n                                    <button onClick={() => currentChatInfo.type !== 'group' && currentChatInfo.profile && setIsProfileModalOpen(true)} className=\"flex-shrink-0\">\r\n                                        {currentChatInfo.type === 'group' ? (\r\n                                            <div className=\"w-12 h-12 rounded-full bg-gray-200 flex items-center justify-center\">\r\n                                                <FaUsers className=\"text-gray-500\" size={28} />\r\n                                            </div>\r\n                                        ) : currentChatInfo.profile ? (\r\n                                            <img src={currentChatInfo.profile} alt={currentChatInfo.name} className=\"w-12 h-12 rounded-full object-cover\" />\r\n                                        ) : (\r\n                                            <div className=\"w-12 h-12 rounded-full bg-gray-200 flex items-center justify-center\">\r\n                                                <FaUser className=\"text-gray-500\" size={28} />\r\n                                            </div>\r\n                                        )}\r\n                                    </button>\r\n                                    <div className=\"truncate\">\r\n                                        <button onClick={openGroupInfoModal} disabled={currentChatInfo.type !== 'group'} className=\"text-left\">\r\n                                            <p className=\"font-bold text-lg truncate\">{currentChatInfo.name}</p>\r\n                                        </button>\r\n                                        {currentChatInfo.type === 'private' ? (\r\n                                            <p className=\"text-sm text-gray-500\">{currentChatInfo.isOnline ? 'Online' : formatLastSeen(currentChatInfo.lastMessageTimestamp)}</p>\r\n                                        ) : (\r\n                                            <p className=\"text-sm text-gray-500\">{currentChatInfo.memberCount || 0} members</p>\r\n                                        )}\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"flex items-center space-x-2\"><button className=\"p-2 rounded-full hover:bg-gray-100 text-gray-600\"><FaVideo size={20} /></button><button className=\"p-2 rounded-full hover:bg-gray-100 text-gray-600\"><FaPhone size={20} /></button><div className=\"relative\"><button ref={chatMenuButtonRef} onClick={() => setShowChatMenu(!showChatMenu)} className=\"p-2 rounded-full hover:bg-gray-100\"><BsThreeDotsVertical size={20} /></button>{showChatMenu && (<div ref={chatMenuRef} className=\"absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg z-20\"><button onClick={() => { setShowClearConfirm(true); setShowChatMenu(false); }} className=\"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100\">Clear chat</button></div>)}</div></div>\r\n                            </div>\r\n\r\n                            {pinnedMessage && (\r\n                                <div className=\"flex-shrink-0 flex items-center justify-between p-2 border-b border-gray-200 bg-gray-50\">\r\n                                    <div className=\"flex items-center gap-2 text-sm overflow-hidden cursor-pointer flex-grow min-w-0\" onClick={handleGoToMessage}>\r\n                                        <FaThumbtack className=\"text-gray-500 flex-shrink-0\" />\r\n                                        <FileIcon fileName={pinnedMessage.fileName || ''} type={pinnedMessage.messageType} className=\"text-lg flex-shrink-0\" />\r\n                                        <div className=\"truncate\">\r\n                                            <p className=\"font-bold text-blue-600\">Pinned Message</p>\r\n                                            <p className=\"text-gray-600 truncate\">\r\n                                                {pinnedMessage.messageType === 'text' ? pinnedMessage.content : pinnedMessage.fileName || 'Pinned Media'}\r\n                                            </p>\r\n                                        </div>\r\n                                    </div>\r\n                                    <div className=\"relative flex-shrink-0\">\r\n                                        <button ref={pinnedMenuButtonRef} onClick={() => setShowPinnedMenu(!showPinnedMenu)} className=\"p-2 rounded-full hover:bg-gray-200\">\r\n                                            <FaChevronDown />\r\n                                        </button>\r\n                                        {showPinnedMenu && (\r\n                                            <div ref={pinnedMenuRef} className=\"absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg z-20 text-sm\">\r\n                                                <ul className=\"py-1\">\r\n                                                    <li onClick={handleGoToMessage} className=\"px-4 py-2 hover:bg-gray-100 cursor-pointer flex items-center gap-3\">\r\n                                                        <FaAngleDoubleRight /> Go to message\r\n                                                    </li>\r\n                                                    <li onClick={handleUnpin} className=\"px-4 py-2 hover:bg-gray-100 cursor-pointer flex items-center gap-3 text-red-600\">\r\n                                                        <FaTimes /> Unpin\r\n                                                    </li>\r\n                                                </ul>\r\n                                            </div>\r\n                                        )}\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n\r\n                            <div ref={chatContainerRef} onScroll={handleChatScroll} className=\"flex-grow p-4 overflow-y-auto bg-gray-50\">\r\n                                {isFetchingMoreMessages && (\r\n                                    <div className=\"flex justify-center items-center py-4\">\r\n                                        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"></div>\r\n                                    </div>\r\n                                )}\r\n                                {isMessagesLoading ? (\r\n                                    <MessageSkeleton />\r\n                                ) : (\r\n                                    <div className=\"space-y-2\">\r\n                                        {chatMessages.map((msg, index) => {\r\n                                            const isMyMessage = msg.sender === currentUser?.id;\r\n                                            const msgDate = new Date(msg.timestamp).toDateString();\r\n                                            const showDateHeader = lastMessageDate !== msgDate;\r\n                                            if (showDateHeader) {\r\n                                                lastMessageDate = msgDate;\r\n                                            }\r\n                                            const senderInfo = !isMyMessage ? getSenderInfo(msg.sender) : null;\r\n\r\n                                            const fileUrl = getFileUrl(msg);\r\n\r\n                                            return (\r\n                                                <React.Fragment key={msg.messageId || msg.id}>\r\n                                                    {showDateHeader && (\r\n                                                        <div className=\"text-center my-4\">\r\n                                                            <span className=\"bg-gray-200 text-gray-600 text-xs font-semibold px-3 py-1 rounded-full\">{formatDateHeader(msg.timestamp)}</span>\r\n                                                        </div>\r\n                                                    )}\r\n                                                    <div data-message-index={index} className={`flex items-end gap-2 ${isMyMessage ? 'justify-end' : 'justify-start'}`}>\r\n                                                        {!isMyMessage && (() => {\r\n                                                            const profileSrc = currentChatInfo.type === 'group' ? senderInfo?.profile : currentChatInfo.profile;\r\n                                                            const profileName = currentChatInfo.type === 'group' ? senderInfo?.name : currentChatInfo.name;\r\n                                                            return profileSrc ? (\r\n                                                                <img src={profileSrc} alt={profileName} className=\"w-8 h-8 rounded-full object-cover self-start flex-shrink-0\" />\r\n                                                            ) : (\r\n                                                                <div className=\"w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center self-start flex-shrink-0\">\r\n                                                                    <FaUser className=\"text-gray-500\" size={18} />\r\n                                                                </div>\r\n                                                            );\r\n                                                        })()}\r\n                                                        <div className={`flex flex-col ${isMyMessage ? 'items-end' : 'items-start'}`}>\r\n                                                            {currentChatInfo.type === 'group' && !isMyMessage && (\r\n                                                                <p className=\"text-xs text-gray-500 mb-1 ml-2 font-semibold\">{senderInfo?.name}</p>\r\n                                                            )}\r\n                                                            <div onContextMenu={(e) => handleContextMenu(e, msg, index)} className={`rounded-lg max-w-xs md:max-w-md group relative\r\n                                                                ${(msg.type === 'image' || msg.type === 'deleted') ? 'p-0 bg-transparent' : ''}\r\n                                                                ${(msg.type === 'text') ? (isMyMessage ? 'bg-blue-600 text-white p-3' : 'bg-gray-200 text-gray-800 p-3') : ''}\r\n                                                                ${(msg.type === 'audio' || msg.type === 'file') ? (isMyMessage ? 'bg-blue-600' : 'bg-gray-200') : ''}\r\n                                                                `}>\r\n                                                                {msg.type === 'deleted' ? (\r\n                                                                    <div className=\"flex items-center gap-2 italic text-sm opacity-70 p-3\">\r\n                                                                        <span>This message was deleted</span>\r\n                                                                        {lastDeleted?.index === index && <button onClick={handleUndoDelete} className=\"font-semibold hover:underline\">Undo</button>}\r\n                                                                    </div>\r\n                                                                ) : (\r\n                                                                    <>\r\n                                                                        {msg.isForwarded && <div className=\"flex items-center gap-1.5 text-xs opacity-70 mb-1 font-semibold\"><FaShare /> Forwarded</div>}\r\n\r\n                                                                        {msg.replyTo && (\r\n                                                                            <div className={`p-2 rounded mb-2 text-sm ${isMyMessage ? 'bg-blue-500' : 'bg-gray-300'}`}>\r\n                                                                                <p className=\"font-semibold\">{msg.replyTo.sender === currentUser?.id ? 'You' : getSenderInfo(msg.replyTo.sender).name}</p>\r\n                                                                                <p className=\"opacity-80 truncate\">\r\n                                                                                    {['image', 'audio', 'file'].includes(msg.replyTo.type) ? msg.replyTo.content : msg.replyTo.content}\r\n                                                                                </p>\r\n                                                                            </div>\r\n                                                                        )}\r\n\r\n                                                                        {msg.type === 'image' ? (\r\n                                                                            <div className=\"relative\">\r\n                                                                                <button onClick={() => setImageInView(fileUrl)}>\r\n                                                                                    <img src={fileUrl} alt={msg.fileName || 'image'} className=\"rounded-md max-w-full\" style={{ maxHeight: '300px' }} />\r\n                                                                                </button>\r\n                                                                                {!isMyMessage && (\r\n                                                                                    <a href={fileUrl} download={msg.fileName} onClick={(e) => e.stopPropagation()} className=\"absolute bottom-2 right-2 bg-black bg-opacity-50 text-white p-2 rounded-full opacity-0 group-hover:opacity-100 transition-opacity\">\r\n                                                                                        <FaDownload />\r\n                                                                                    </a>\r\n                                                                                )}\r\n                                                                            </div>\r\n                                                                        ) : msg.type === 'audio' ? (\r\n                                                                            <div className={`${isMyMessage ? 'bg-blue-600' : 'bg-gray-200'} rounded-lg`}>\r\n                                                                                <AudioPlayer src={fileUrl} fileUrl={fileUrl} isSender={isMyMessage} initialDuration={msg.duration} fileSize={msg.fileSize} />\r\n                                                                            </div>\r\n                                                                        ) : msg.type === 'file' ? (\r\n                                                                            <FileMessage msg={msg} isMyMessage={isMyMessage} />\r\n                                                                        ) : (\r\n                                                                            <p className=\"text-sm break-words\">{msg.content}</p>\r\n                                                                        )}\r\n                                                                    </>\r\n                                                                )}\r\n                                                            </div>\r\n                                                            <span className=\"text-xs text-gray-400 mt-1 px-1\">{msg.status === 'sending' ? 'Sending...' : msg.status === 'failed' ? 'Failed' : formatTimestamp(msg.timestamp)} {msg.isEdited ? '(edited)' : ''}</span>\r\n                                                        </div>\r\n                                                        {isMyMessage && (\r\n                                                            <div className={`relative w-8 h-8 self-start flex-shrink-0`}>\r\n                                                                <img src={currentUser?.profile || 'https://placehold.co/100x100/E2E8F0/4A5568?text=Me'} alt=\"current user\" className={`w-full h-full rounded-full object-cover ring-2 ${getStatusRingColor(msg.status)}`} />\r\n                                                            </div>\r\n                                                        )}\r\n                                                    </div>\r\n                                                </React.Fragment>\r\n                                            );\r\n                                        })}\r\n\r\n                                        {typingUsers[selectedChat.chatId] && (\r\n                                            <div className=\"flex items-end gap-2 justify-start\">\r\n                                                <div className=\"w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center self-start flex-shrink-0\">\r\n                                                    <FaUser className=\"text-gray-500\" size={18} />\r\n                                                </div>\r\n                                                <div className=\"flex flex-col items-start\">\r\n                                                    <div className=\"p-3 rounded-lg bg-gray-200 text-gray-800\">\r\n                                                        <div className=\"flex items-center justify-center gap-1.5\">\r\n                                                            <span className=\"h-2 w-2 bg-gray-500 rounded-full animate-bounce [animation-delay:-0.3s]\"></span>\r\n                                                            <span className=\"h-2 w-2 bg-gray-500 rounded-full animate-bounce [animation-delay:-0.15s]\"></span>\r\n                                                            <span className=\"h-2 w-2 bg-gray-500 rounded-full animate-bounce\"></span>\r\n                                                        </div>\r\n                                                    </div>\r\n                                                </div>\r\n                                            </div>\r\n                                        )}\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n\r\n                            <div className=\"flex-shrink-0 flex flex-col p-4 border-t border-gray-200\">\r\n                                {replyingTo && (\r\n                                    <div className=\"bg-gray-100 p-2 rounded-t-lg flex justify-between items-center\">\r\n                                        <div className=\"text-sm overflow-hidden\">\r\n                                            <p className=\"font-semibold text-blue-600\">Replying to {replyingTo.sender === currentUser?.id ? 'yourself' : getSenderInfo(replyingTo.sender).name}</p>\r\n                                            <p className=\"text-gray-600 truncate\">\r\n                                                {['image', 'audio', 'file'].includes(replyingTo.type) ? replyingTo.fileName : replyingTo.content}\r\n                                            </p>\r\n                                        </div>\r\n                                        <button onClick={() => setReplyingTo(null)}><FaTimes /></button>\r\n                                    </div>\r\n                                )}\r\n\r\n                                {editingInfo.index !== null && (<div className=\"bg-gray-100 p-2 rounded-t-lg flex justify-between items-center\"><div className=\"text-sm overflow-hidden\"><p className=\"font-semibold text-blue-600\">Editing message</p><p className=\"text-gray-600 truncate\">{editingInfo.originalContent}</p></div><button onClick={cancelEdit}><FaTimes /></button></div>)}\r\n                                {currentChatInfo && (\r\n                                    <div className={`relative flex items-center w-full space-x-2 ${(replyingTo || editingInfo.index !== null) ? 'pt-2' : ''}`}>\r\n                                        {showEmojiPicker && (\r\n                                            <div ref={emojiPickerRef} className=\"absolute bottom-full mb-2 left-0 z-40 w-[95vw] max-w-sm\">\r\n                                                <EmojiPicker onEmojiClick={onEmojiClick} width=\"100%\" height={350} />\r\n                                            </div>\r\n                                        )}\r\n                                        <div className=\"relative flex-grow\">\r\n                                            <input ref={messageInputRef} type=\"text\" placeholder={isRecording ? \"Recording...\" : \"Type a message...\"} className=\"w-full p-3 pr-24 rounded-full border bg-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500\" value={message} onChange={(e) => { setMessage(e.target.value); sendTypingStatus(true); }} onKeyDown={handleKeyDown} disabled={isRecording} />\r\n                                            <div className=\"absolute right-2 top-1/2 -translate-y-1/2 flex items-center\">\r\n                                                <button ref={emojiButtonRef} onClick={() => setShowEmojiPicker(!showEmojiPicker)} className=\"p-2 text-gray-500 hover:text-blue-600 rounded-full hover:bg-gray-100\"><FaSmile size={20} /></button>\r\n                                                <button onClick={handleFileButtonClick} className=\"p-2 text-gray-500 hover:text-blue-600 rounded-full hover:bg-gray-100\"><FaPaperclip size={20} /></button>\r\n                                            </div>\r\n                                        </div>\r\n                                        {message.trim() || editingInfo.index !== null ? (\r\n                                            <button onClick={editingInfo.index !== null ? handleSaveEdit : handleSendMessage} className={`p-3 rounded-full text-white ${editingInfo.index !== null ? 'bg-green-600 hover:bg-green-700' : 'bg-blue-600 hover:bg-blue-700'}`}>\r\n                                                {editingInfo.index !== null ? <FaCheck size={20} /> : <FaPaperPlane size={20} />}\r\n                                            </button>\r\n                                        ) : (\r\n                                            <button onClick={handleMicButtonClick} className={`p-3 rounded-full hover:bg-gray-100 ${isRecording ? 'text-red-500 animate-pulse' : 'text-gray-500 hover:text-blue-600'}`}>\r\n                                                {isRecording ? <FaStop size={20} /> : <FaMicrophone size={20} />}\r\n                                            </button>\r\n                                        )}\r\n                                        <input type=\"file\" ref={fileInputRef} onChange={handleFileChange} className=\"hidden\" />\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        </>\r\n                    )}\r\n                </div>\r\n                {showScrollToBottom && (\r\n                    <button\r\n                        onClick={() => scrollToBottom()}\r\n                        className=\"absolute bottom-24 right-8 z-10 bg-blue-600/80 backdrop-blur-sm text-white rounded-full p-3 shadow-xl hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all transform hover:scale-110 animate-fade-in\"\r\n                        aria-label=\"Scroll to bottom\"\r\n                    >\r\n                        {newMessagesCount > 0 && (\r\n                            <span className=\"absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center\">\r\n                                {newMessagesCount > 9 ? '9+' : newMessagesCount}\r\n                            </span>\r\n                        )}\r\n                        <FaChevronDown size={20} />\r\n                    </button>\r\n                )}\r\n            </div>\r\n\r\n            {contextMenu.visible && (\r\n                <div ref={contextMenuRef} style={{ top: contextMenu.y, left: contextMenu.x }} className=\"absolute bg-white rounded-md shadow-lg z-50 text-sm\">\r\n                    <ul className=\"py-1\">\r\n                        {contextMenu.message.type === 'deleted' ? (\r\n                            <li onClick={() => handleDelete(false)} className=\"px-4 py-2 hover:bg-gray-100 cursor-pointer flex items-center gap-3 text-red-600\"><FaTrash /> Delete for me</li>\r\n                        ) : (\r\n                            <>\r\n                                <li onClick={handleReply} className=\"px-4 py-2 hover:bg-gray-100 cursor-pointer flex items-center gap-3\"><FaReply /> Reply</li>\r\n                                <li onClick={handlePin} className=\"px-4 py-2 hover:bg-gray-100 cursor-pointer flex items-center gap-3\"><FaThumbtack /> Pin</li>\r\n                                <li onClick={handleForward} className=\"px-4 py-2 hover:bg-gray-100 cursor-pointer flex items-center gap-3\"><FaShare /> Forward</li>\r\n\r\n                                {contextMenu.message.status !== 'sending' && contextMenu.message.status !== 'failed' && (\r\n                                    <>\r\n                                        {contextMenu.message.sender === currentUser?.id && contextMenu.message.type === 'text' && !contextMenu.message.isForwarded && (new Date() - new Date(contextMenu.message.timestamp) < 15 * 60 * 1000) && (\r\n                                            <li onClick={handleEdit} className=\"px-4 py-2 hover:bg-gray-100 cursor-pointer flex items-center gap-3\"><FaEdit /> Edit</li>\r\n                                        )}\r\n                                        <hr className=\"my-1\" />\r\n                                        <li onClick={() => handleDelete(false)} className=\"px-4 py-2 hover:bg-gray-100 cursor-pointer flex items-center gap-3 text-red-600\"><FaTrash /> Delete for me</li>\r\n                                        {contextMenu.message.sender === currentUser?.id && (\r\n                                            <li onClick={() => handleDelete(true)} className=\"px-4 py-2 hover:bg-gray-100 cursor-pointer flex items-center gap-3 text-red-600\"><FaTrash /> Delete for everyone</li>\r\n                                        )}\r\n                                    </>\r\n                                )}\r\n                            </>\r\n                        )}\r\n                    </ul>\r\n                </div>\r\n            )}\r\n\r\n            {forwardingInfo.visible && (<div className=\"fixed inset-0 bg-opacity-100 flex items-center justify-center z-[100]\"><div className=\"bg-white rounded-lg shadow-2xl w-full max-w-md\"><div className=\"p-4 border-b flex justify-between items-center\"><h3 className=\"font-bold text-lg\">Forward message to...</h3><button onClick={() => setForwardingInfo({ visible: false, message: null })}><FaTimes /></button></div><div className=\"p-4\"><input type=\"text\" placeholder=\"Search for users or groups\" className=\"w-full p-2 border rounded-lg\" value={forwardSearchTerm} onChange={(e) => setForwardSearchTerm(e.target.value)} /></div><div className=\"h-64 overflow-y-auto p-4\">{allChats.filter(c => c.name?.toLowerCase().includes(forwardSearchTerm.toLowerCase())).map(chat => (<div key={chat.chatId} className=\"flex items-center p-2 rounded-lg hover:bg-gray-100\"><input type=\"checkbox\" id={`fwd-${chat.chatId}`} className=\"mr-3 h-4 w-4 accent-blue-600\" checked={forwardRecipients.includes(chat.chatId)} onChange={(e) => { if (e.target.checked) setForwardRecipients([...forwardRecipients, chat.chatId]); else setForwardRecipients(forwardRecipients.filter(id => id !== chat.chatId)); }} />\r\n                <label htmlFor={`fwd-${chat.chatId}`} className=\"flex-grow flex items-center gap-3 cursor-pointer\">\r\n                    {chat.type === 'group' ? (\r\n                        <div className=\"w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center\"><FaUsers className=\"text-gray-500\" /></div>\r\n                    ) : (\r\n                        <img src={chat.profile} alt={chat.name} className=\"w-10 h-10 rounded-full object-cover\" onError={(e) => { e.target.src = 'https://placehold.co/100x100/E2E8F0/4A5568?text=U' }} />\r\n                    )}\r\n                    <span>{chat.name}</span>\r\n                </label>\r\n            </div>))}</div><div className=\"p-4 border-t text-right\"><button onClick={handleConfirmForward} disabled={forwardRecipients.length === 0} className=\"bg-blue-600 text-white px-4 py-2 rounded-lg disabled:bg-gray-400 disabled:cursor-not-allowed cursor-pointer\">Forward</button></div></div></div>)}\r\n\r\n            {isProfileModalOpen && currentChatInfo && currentChatInfo.type !== 'group' && (\r\n                <div className=\"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[100]\" onClick={() => setIsProfileModalOpen(false)}>\r\n                    <img src={currentChatInfo.profile} alt={currentChatInfo.name} className=\"max-w-[80vw] max-h-[90vh] object-contain\" onClick={(e) => e.stopPropagation()} />\r\n                </div>\r\n            )}\r\n\r\n            {isGroupInfoModalOpen && currentChatInfo?.type === 'group' && (\r\n                <div className=\"fixed inset-0 bg-opacity-100 flex items-center justify-center z-[100]\" onClick={() => setIsGroupInfoModalOpen(false)}>\r\n                    <div className=\"bg-white rounded-lg shadow-2xl w-full max-w-lg h-[80vh] flex flex-col\" onClick={(e) => e.stopPropagation()}>\r\n                        <div className=\"p-4 border-b flex justify-between items-center flex-shrink-0\">\r\n                            <h3 className=\"font-bold text-xl\">Group Info</h3>\r\n                            <button onClick={() => setIsGroupInfoModalOpen(false)} className=\"p-2 rounded-full hover:bg-gray-200\"><FaTimes /></button>\r\n                        </div>\r\n                        <div className=\"flex border-b flex-shrink-0\">\r\n                            {['Overview', 'Members', 'Media', 'Files', 'Links'].map(tab => (\r\n                                <button key={tab} onClick={() => setActiveGroupInfoTab(tab)} className={`flex-1 p-3 text-sm font-semibold ${activeGroupInfoTab === tab ? 'text-blue-600 border-b-2 border-blue-600' : 'text-gray-500 hover:bg-gray-100'}`}>\r\n                                    {tab}\r\n                                </button>\r\n                            ))}\r\n                        </div>\r\n                        <div className=\"p-4 overflow-y-auto flex-grow\">\r\n                            {activeGroupInfoTab === 'Overview' && (\r\n                                <div className=\"flex flex-col items-center text-center space-y-4\">\r\n                                    <div className=\"w-40 h-40 rounded-full bg-gray-200 flex items-center justify-center\">\r\n                                        <FaUsers className=\"text-gray-500\" size={80} />\r\n                                    </div>\r\n                                    <h2 className=\"text-2xl font-bold\">{currentChatInfo.name}</h2>\r\n                                    <p className=\"text-gray-600\">{currentChatInfo.memberCount || 0} members</p>\r\n                                </div>\r\n                            )}\r\n                            {activeGroupInfoTab === 'Members' && (\r\n                                <div className=\"space-y-3\">\r\n                                    {isGroupDataLoading ? (\r\n                                        <p className=\"text-center text-gray-500\">Loading members...</p>\r\n                                    ) : (\r\n                                        groupMembers.map((member, i) => (\r\n                                            <div key={member.employeeId || i} className=\"flex items-center gap-4 p-2 rounded-lg hover:bg-gray-50\">\r\n                                                {member.employeeImage ? (\r\n                                                    <img src={member.employeeImage} alt={member.displayName} className=\"w-10 h-10 rounded-full object-cover\" />\r\n                                                ) : (\r\n                                                    <div className=\"w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center\">\r\n                                                        <FaUser className=\"text-gray-500\" size={20} />\r\n                                                    </div>\r\n                                                )}\r\n                                                <div>\r\n                                                    <span className=\"font-semibold\">{member.displayName}</span>\r\n                                                    {member.jobTitlePrimary && <p className=\"text-sm text-gray-500\">{member.jobTitlePrimary}</p>}\r\n                                                </div>\r\n                                            </div>\r\n                                        ))\r\n                                    )}\r\n                                </div>\r\n                            )}\r\n                            {activeGroupInfoTab === 'Media' && (\r\n                                <div className=\"grid grid-cols-3 md:grid-cols-4 gap-2\">\r\n                                    {chatMessages.filter(msg => ['image', 'video'].includes(msg.type)).map((msg, i) => (\r\n                                        <button key={i} onClick={() => setImageInView(getFileUrl(msg))}>\r\n                                            <img src={getFileUrl(msg)} alt={msg.fileName} className=\"w-full h-24 object-cover rounded-md cursor-pointer hover:opacity-80\" />\r\n                                        </button>\r\n                                    ))}\r\n                                </div>\r\n                            )}\r\n\r\n                            {activeGroupInfoTab === 'Files' && (\r\n                                <div className=\"space-y-3\">\r\n                                    {(() => {\r\n                                        const files = chatMessages.filter(msg => msg.type === 'file');\r\n                                        return files.length > 0 ? (\r\n                                            files.map(fileMsg => (\r\n                                                <FileMessage key={fileMsg.id} msg={fileMsg} isMyMessage={false} />\r\n                                            ))\r\n                                        ) : (\r\n                                            <p className=\"text-center text-gray-500 p-4\">No files found in this chat.</p>\r\n                                        );\r\n                                    })()}\r\n                                </div>\r\n                            )}\r\n\r\n                            {activeGroupInfoTab === 'Links' && (\r\n                                <div className=\"space-y-3\">\r\n                                    {(() => {\r\n                                        const linkMessages = chatMessages.filter(msg => msg.type === 'text' && (msg.content.includes('http://') || msg.content.includes('https://')));\r\n                                        const allLinks = linkMessages.flatMap(linkMsg => {\r\n                                            const linkRegex = /(https?:\\/\\/[^\\s]+)/g;\r\n                                            const links = linkMsg.content.match(linkRegex);\r\n                                            return links ? links.map(link => ({\r\n                                                id: linkMsg.id,\r\n                                                url: link,\r\n                                                sender: getSenderInfo(linkMsg.sender).name,\r\n                                                timestamp: linkMsg.timestamp\r\n                                            })) : [];\r\n                                        });\r\n\r\n                                        return allLinks.length > 0 ? (\r\n                                            allLinks.map((link, index) => (\r\n                                                <div key={`${link.id}-${index}`} className=\"p-3 bg-gray-100 rounded-lg\">\r\n                                                    <a href={link.url} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-blue-600 hover:underline break-all\">{link.url}</a>\r\n                                                    <p className=\"text-xs text-gray-500 mt-1\">Shared by {link.sender} on {new Date(link.timestamp).toLocaleDateString()}</p>\r\n                                                </div>\r\n                                            ))\r\n                                        ) : (\r\n                                            <p className=\"text-center text-gray-500 p-4\">No links found in this chat.</p>\r\n                                        );\r\n                                    })()}\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {imageInView && (\r\n                <div className=\"fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-[120]\" onClick={() => setImageInView(null)}>\r\n                    <img src={imageInView} alt=\"Full view\" className=\"max-w-[90vw] max-h-[90vh] object-contain\" onClick={(e) => e.stopPropagation()} />\r\n                </div>\r\n            )}\r\n\r\n            {showClearConfirm && (\r\n                <div className=\"fixed inset-0 bg-opacity-100 flex items-center justify-center z-[110]\">\r\n                    <div className=\"bg-white rounded-lg shadow-xl p-6 w-full max-w-sm\">\r\n                        <h3 className=\"text-lg font-bold mb-4\">Clear Chat?</h3>\r\n                        <p className=\"text-gray-600 mb-6\">Are you sure you want to clear all messages in this chat? This action cannot be undone.</p>\r\n                        <div className=\"flex justify-end gap-4\">\r\n                            <button onClick={() => setShowClearConfirm(false)} className=\"px-4 py-2 rounded-lg text-gray-700 bg-gray-200 hover:bg-gray-300\">\r\n                                Cancel\r\n                            </button>\r\n                            <button onClick={handleConfirmClearChat} className=\"px-4 py-2 rounded-lg text-white bg-red-600 hover:bg-red-700\">\r\n                                Clear Chat\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default ChatApplication;","import { useEffect, useState, useRef } from 'react';\r\nimport { useParams } from 'react-router-dom';\r\nimport { getChatOverview } from '../../../../services/apiService';\r\nimport { transformOverviewToChatList } from '../../../../services/dataTransformer';\r\nimport ChatApplication from './ChatApplication';\r\n\r\nconst ChatListItemSkeleton = () => (\r\n    <div className=\"flex items-center space-x-4 p-3\">\r\n        <div className=\"w-11 h-11 bg-gray-200 rounded-full animate-pulse\"></div>\r\n        <div className=\"flex-1 space-y-2\">\r\n            <div className=\"h-4 bg-gray-200 rounded w-3/4 animate-pulse\"></div>\r\n            <div className=\"h-3 bg-gray-200 rounded w-1/2 animate-pulse\"></div>\r\n        </div>\r\n    </div>\r\n);\r\n\r\nconst ChatAppSkeleton = () => (\r\n    <div className=\"flex w-full h-full p-0 md:p-4 md:gap-4\">\r\n        {/* Sidebar Skeleton */}\r\n        <div className=\"w-full md:w-[30%] h-full p-4 bg-white flex flex-col shadow-xl md:rounded-lg space-y-4\">\r\n            <div className=\"h-12 bg-gray-200 rounded-lg animate-pulse mb-4\"></div>\r\n            <div className=\"flex-grow space-y-2 pr-2 overflow-hidden\">\r\n                <ChatListItemSkeleton />\r\n                <ChatListItemSkeleton />\r\n                <ChatListItemSkeleton />\r\n                <ChatListItemSkeleton />\r\n                <ChatListItemSkeleton />\r\n                <ChatListItemSkeleton />\r\n                <ChatListItemSkeleton />\r\n            </div>\r\n        </div>\r\n\r\n        {/* This part is hidden on mobile to match the final layout's behavior */}\r\n        <div className=\"hidden md:flex flex-col w-[70%] h-full bg-white md:rounded-lg shadow-xl\">\r\n            <div className=\"flex items-center justify-center h-full\">\r\n                <div className=\"text-center\">\r\n                    <p className=\"text-xl text-gray-400\">Loading Chats...</p>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n);\r\n\r\n\r\nfunction ChatApp() {\r\n    const { userId } = useParams();\r\n    const [chatList, setChatList] = useState({ groups: [], privateChatsWith: [] });\r\n    const [isLoading, setIsLoading] = useState(true);\r\n    const [isFetchingMore, setIsFetchingMore] = useState(false);\r\n    const [page, setPage] = useState(0);\r\n    const [hasMore, setHasMore] = useState(true);\r\n\r\n    const fetchingMore = useRef(false);\r\n\r\n    const currentUser = {\r\n        name: 'You',\r\n        id: userId,\r\n        profile: 'https://placehold.co/100x100/E2E8F0/4A5568?text=Me'\r\n    };\r\n\r\n    const loadChats = async (pageNum) => {\r\n        console.log(`%c loadChats function started for page: ${pageNum}`, 'color: blue; font-weight: bold;');\r\n\r\n        if (!hasMore || fetchingMore.current) {\r\n            console.log(`%c Request for page ${pageNum} blocked. hasMore=${hasMore}, fetchingMore.current=${fetchingMore.current}`, 'color: red;');\r\n            return;\r\n        }\r\n\r\n        fetchingMore.current = true;\r\n\r\n        if (pageNum === 0) {\r\n            setIsLoading(true);\r\n        } else {\r\n            setIsFetchingMore(true);\r\n        }\r\n\r\n        try {\r\n            console.log(`%c Sending API request for page: ${pageNum}`, 'color: green;');\r\n            const rawChatListData = await getChatOverview(userId, pageNum, 10);\r\n\r\n            if (rawChatListData.length === 0) {\r\n                setHasMore(false);\r\n                return;\r\n            }\r\n\r\n            const formattedChatList = transformOverviewToChatList(rawChatListData, userId);\r\n\r\n            setChatList(prevChatList => {\r\n                if (pageNum === 0) {\r\n                    return formattedChatList;\r\n                }\r\n                const existingGroupIds = new Set(prevChatList.groups.map(g => g.chatId));\r\n                const existingPrivateIds = new Set(prevChatList.privateChatsWith.map(p => p.chatId));\r\n                const newUniqueGroups = formattedChatList.groups.filter(g => !existingGroupIds.has(g.chatId));\r\n                const newUniquePrivate = formattedChatList.privateChatsWith.filter(p => !existingPrivateIds.has(p.chatId));\r\n                return {\r\n                    groups: [...prevChatList.groups, ...newUniqueGroups],\r\n                    privateChatsWith: [...prevChatList.privateChatsWith, ...newUniquePrivate]\r\n                };\r\n            });\r\n\r\n            if (rawChatListData.length < 10) {\r\n                setHasMore(false);\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Error loading chats:\", error);\r\n        } finally {\r\n            if (pageNum === 0) {\r\n                setIsLoading(false);\r\n            }\r\n            setIsFetchingMore(false);\r\n\r\n            fetchingMore.current = false;\r\n            console.log(`%c Finished fetch for page ${pageNum}. Lock released.`, 'color: orange;');\r\n        }\r\n    };\r\n\r\n    const handleLoadMore = () => {\r\n        console.log(\"handleLoadMore triggered!\");\r\n        if (fetchingMore.current || !hasMore) {\r\n            console.log(\"handleLoadMore blocked by ref lock or no more data.\");\r\n            return;\r\n        }\r\n        const nextPage = page + 1;\r\n        setPage(nextPage);\r\n        loadChats(nextPage);\r\n    };\r\n\r\n    useEffect(() => {\r\n        if (userId) {\r\n            loadChats(0);\r\n        }\r\n    }, [userId]);\r\n\r\n    return (\r\n        <div style={{ height: '90vh' }} className=\"flex h-screen bg-gray-100\">\r\n            {isLoading ? (\r\n                <ChatAppSkeleton />\r\n            ) : (\r\n                <ChatApplication\r\n                    currentUser={currentUser}\r\n                    chats={chatList}\r\n                    loadMoreChats={handleLoadMore}\r\n                    hasMore={hasMore}\r\n                    isFetchingMore={isFetchingMore}\r\n                />\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default ChatApp;\r\n","import axios from 'axios';\r\n \r\nconst AUTH_API_URL = 'http://hrms.anasolconsultancyservices.com/api/auth/refresh-token';\r\n \r\nfunction cloneFormData(formData) {\r\n    const newFormData = new FormData();\r\n    for (let [key, value] of formData.entries()) {\r\n        newFormData.append(key, value);\r\n    }\r\n    return newFormData;\r\n}\r\n \r\nlet isRefreshing = false;\r\nlet failedQueue = [];\r\n \r\nconst processQueue = (error, token = null) => {\r\n    failedQueue.forEach(prom => {\r\n        if (error) {\r\n            prom.reject(error);\r\n        } else {\r\n            prom.resolve(token);\r\n        }\r\n    });\r\n    failedQueue = [];\r\n};\r\n \r\nconst createAxiosInstance = (baseURL) => {\r\n    const instance = axios.create({\r\n        baseURL: baseURL,\r\n    });\r\n \r\n   \r\n    instance.interceptors.request.use(\r\n        (config) => {\r\n            const token = localStorage.getItem('accessToken');\r\n            if (token) {\r\n                config.headers['Authorization'] = `Bearer ${token}`;\r\n            }\r\n            return config;\r\n        },\r\n        (error) => Promise.reject(error)\r\n    );\r\n \r\n    instance.interceptors.response.use(\r\n        (response) => response,\r\n        async (error) => {\r\n            const originalRequest = error.config;\r\n \r\n            if (error.response?.status === 401 && !originalRequest._retry) {\r\n                if (isRefreshing) {\r\n                    return new Promise((resolve, reject) => {\r\n                        failedQueue.push({ resolve, reject });\r\n                    })\r\n                    .then(token => {\r\n                        originalRequest.headers['Authorization'] = `Bearer ${token}`;\r\n                        return instance(originalRequest);\r\n                    })\r\n                    .catch(err => Promise.reject(err));\r\n                }\r\n \r\n                originalRequest._retry = true;\r\n                isRefreshing = true;\r\n \r\n                const oldToken = localStorage.getItem('accessToken');\r\n                console.log(` Token expired for ${baseURL}. Old Token:`, oldToken);\r\n \r\n                try {\r\n                    const refreshResponse = await axios.post(\r\n                        AUTH_API_URL,\r\n                        {},\r\n                        { withCredentials: true }\r\n                    );\r\n \r\n                    const { accessToken } = refreshResponse.data;\r\n                    localStorage.setItem('accessToken', accessToken);\r\n                    console.log(` New Token for ${baseURL}:`, accessToken);\r\n \r\n                    if (originalRequest.data instanceof FormData) {\r\n                        originalRequest.data = cloneFormData(originalRequest.data);\r\n                    }\r\n \r\n                    processQueue(null, accessToken);\r\n \r\n                    const newInstance = createAxiosInstance(baseURL);\r\n                    originalRequest.headers['Authorization'] = `Bearer ${accessToken}`;\r\n \r\n                    return newInstance(originalRequest);\r\n \r\n                } catch (refreshError) {\r\n                    console.error(\"Refresh token failed. Logging out.\", refreshError);\r\n                    localStorage.clear();\r\n                    window.location.href = '/login';\r\n                    processQueue(refreshError);\r\n                    return Promise.reject(refreshError);\r\n \r\n                } finally {\r\n                    isRefreshing = false;\r\n                }\r\n            }\r\n \r\n            return Promise.reject(error);\r\n        }\r\n    );\r\n \r\n    return instance;\r\n};\r\n \r\nwindow.addEventListener('storage', (event) => {\r\n    if (event.key === 'accessToken') {\r\n        console.log(\" Token updated in another tab:\", event.newValue);\r\n    }\r\n});\r\n \r\nexport const tasksApi = createAxiosInstance('http://hrms.anasolconsultancyservices.com/api');\r\nexport const publicinfoApi = createAxiosInstance('http://hrms.anasolconsultancyservices.com/api');\r\nexport const chatApi = createAxiosInstance('http://hrms.anasolconsultancyservices.com/api');\r\nexport const notificationsApi = createAxiosInstance('http://hrms.anasolconsultancyservices.com/api/notification');\r\nexport const ticketsApi = createAxiosInstance('http://localhost:8088/api/ticket')"],"names":["isRefreshing","failedQueue","processQueue","error","token","arguments","length","undefined","forEach","prom","reject","resolve","createAxiosInstance","baseURL","instance","axios","create","interceptors","request","use","config","localStorage","getItem","headers","console","log","Promise","response","async","_error$response","originalRequest","status","_retry","push","then","catch","err","oldToken","refreshResponse","post","withCredentials","accessToken","data","setItem","FormData","formData","newFormData","key","value","entries","append","cloneFormData","newInstance","refreshError","clear","window","location","href","addEventListener","event","newValue","chatApi","getMessages","employeeId","chatId","page","size","get","generateChatListPreview","item","currentUserId","lastMessage","lastMessageContent","prefix","lastMessageSenderId","lastMessageType","toUpperCase","match","transformMessageDTOToUIMessage","msgDto","timestamp","tsString","String","Date","endsWith","toISOString","date","time","e","messageType","fileUrl","fileName","fileType","startsWith","kind","toLowerCase","messageIdForUrl","id","messageId","includes","defaults","isDeleted","finalId","content","sender","seen","isSeen","type","isEdited","isPinned","pinned","fileSize","duration","clientId","isForwarded","forwarded","forwardedFrom","isReply","replyTo","senderId","originalMessageId","formatFileSize","bytes","i","Math","floor","parseFloat","pow","toFixed","FileIcon","_ref","_fileName$split$pop","className","extension","split","pop","_jsx","FaFilePdf","FaFileWord","FaFilePowerpoint","FaFileExcel","FaFileArchive","FaImage","FaFileAudio","FaFileAlt","FileMessage","_ref2","msg","isMyMessage","downloadUrl","_jsxs","children","onClick","preventDefault","stopPropagation","open","FaDownload","AudioPlayer","_ref3","src","isSender","initialDuration","audioRef","useRef","isPlaying","setIsPlaying","useState","progress","setProgress","setDuration","localSrc","setLocalSrc","isDownloading","setIsDownloading","useEffect","audio","current","setAudioData","Infinity","setAudioTime","currentTime","handleEnded","removeEventListener","handleDownload","fetch","blob","localUrl","URL","createObjectURL","formatTime","toString","padStart","progressPercentage","ref","preload","togglePlayPause","pause","play","FaPause","FaPlay","rect","currentTarget","getBoundingClientRect","newTime","clientX","left","width","style","MessageSkeleton","_ref4","currentUser","chats","initialChats","loadMoreChats","hasMore","isFetchingMore","chatData","setChatData","groups","privateChatsWith","searchTerm","setSearchTerm","selectedChat","setSelectedChat","message","setMessage","messages","setMessages","isMessagesLoading","setIsMessagesLoading","isChatOpen","setIsChatOpen","showEmojiPicker","setShowEmojiPicker","isRecording","setIsRecording","showChatMenu","setShowChatMenu","downloadedMedia","setDownloadedMedia","contextMenu","setContextMenu","visible","x","y","index","editingInfo","setEditingInfo","originalContent","replyingTo","setReplyingTo","lastDeleted","setLastDeleted","pinnedMessage","setPinnedMessage","forwardingInfo","setForwardingInfo","forwardRecipients","setForwardRecipients","forwardSearchTerm","setForwardSearchTerm","showPinnedMenu","setShowPinnedMenu","isProfileModalOpen","setIsProfileModalOpen","isGroupInfoModalOpen","setIsGroupInfoModalOpen","activeGroupInfoTab","setActiveGroupInfoTab","groupMembers","setGroupMembers","isGroupDataLoading","setIsGroupDataLoading","imageInView","setImageInView","isChatDataReady","setIsChatDataReady","isConnected","setIsConnected","showClearConfirm","setShowClearConfirm","typingUsers","setTypingUsers","messagePages","setMessagePages","hasMoreMessages","setHasMoreMessages","isFetchingMoreMessages","setIsFetchingMoreMessages","showScrollToBottom","setShowScrollToBottom","newMessagesCount","setNewMessagesCount","sidebarScrollRef","chatContainerRef","stompClient","typingTimeoutRef","fileInputRef","mediaRecorderRef","audioChunksRef","emojiPickerRef","emojiButtonRef","chatMenuRef","chatMenuButtonRef","contextMenuRef","messageInputRef","pinnedMenuRef","pinnedMenuButtonRef","onMessageReceivedRef","isFetchingOldMessages","subscriptions","chatIdFromUrl","useMemo","pathname","URLSearchParams","search","scrollToBottom","behavior","scrollTo","top","scrollHeight","correctedChats","map","chat","unreadMessageCount","loadMoreMessages","useCallback","pageNum","rawMessages","prev","transformedMessages","chatContainer","previousScrollHeight","previousScrollTop","scrollTop","requestAnimationFrame","setTimeout","pinnedMsgData","chatType","userId","getPinnedMessage","fetchPinnedMessage","updateLastMessage","updateChat","isNewUnread","overviewItem","lastMessageTimestamp","onMessageReceived","payload","container","shouldScrollOnReceive","clientHeight","parsedData","JSON","parse","body","messageIds","prevMessages","chatKey","groupId","chatMessages","newStatus","updatedMessages","pinnedDto","eventChatId","receiver","unpinPayload","receiverId","receivedMessage","messageChatId","warn","wasLastMessage","newLastMessage","updatedMsg","finalServerId","some","m","newChatMessages","messageProcessed","finalMessageForUpdate","isProperAck","client_id","isBroadcastOfOwnMessage","isIncoming","optimisticIndex","findIndex","transformedServerMessage","findLastIndex","finalMessage","prevCount","allChats","filter","user","sort","a","b","handleTypingEvent","typingUpdate","chatIdKey","senderChatInfo","find","c","senderName","name","newTypingUsers","clearTimeout","typing","p","updated","brokerURL","client","Client","reconnectDelay","onConnect","messageHandler","subscribe","statusUpdate","newPrivateChats","isOnline","onWebSocketError","onStompError","frame","onWebSocketClose","activate","_stompClient$current","active","deactivate","groupIds","g","join","_stompClient$current2","requiredGroupIds","Set","currentSubKeys","Object","keys","subscribedGroupIds","replace","has","subId","unsubscribe","typingSubId","openChat","targetChat","_stompClient$current3","destination","publish","stringify","newUrl","history","pushState","path","closeChat","_stompClient$current4","handleChatSelect","handleBeforeUnload","teamDetailsResponse","teamId","getGroupMembers","teamDetails","Array","isArray","employees","fetchGroupData","handleClickOutside","_emojiButtonRef$curre","_chatMenuButtonRef$cu","_pinnedMenuButtonRef$","contains","target","document","sendTypingStatus","isTyping","_stompClient$current5","handleSendMessage","trim","now","random","substring","optimisticMessage","replyToMessageId","startRecording","stream","navigator","mediaDevices","getUserMedia","recorder","MediaRecorder","mimeType","ondataavailable","onstop","getTracks","track","stop","audioBlob","Blob","debugUrl","createElement","display","download","appendChild","click","removeChild","audioFile","File","audioDuration","reader","FileReader","onload","audioContext","AudioContext","webkitAudioContext","decodeAudioData","result","buffer","round","close","onerror","readAsArrayBuffer","getAudioDuration","readAsDataURL","onloadend","base64String","localPreviewUrl","voiceData","fileData","uploadVoiceMessage","newMessages","start","stopRecording","state","handleSaveEdit","_stompClient$current6","updatedContent","cancelEdit","currentMessages","messageToEdit","optimisticUpdatedMessage","updatedMessagesList","handleDelete","messageToDelete","forEveryone","deleteMessageForEveryone","deleteMessageForMe","nextMessages","_","handleUndoDelete","handleGoToMessage","messageIndex","messageElement","querySelector","scrollIntoView","block","classList","add","remove","filteredChats","_chat$name","chatToSelect","formatTimestamp","isoString","isNaN","toLocaleTimeString","hour","minute","hour12","formatDateHeader","today","yesterday","setDate","getDate","toDateString","toLocaleDateString","year","month","day","getStatusRingColor","lastMessageDate","currentChatInfo","getSenderInfo","profile","member","members","employeeName","getFileUrl","baseUrl","origin","placeholder","onChange","onScroll","handleSidebarScroll","FaUsers","alt","FaUser","_Fragment","FaArrowLeft","openGroupInfoModal","disabled","formatLastSeen","memberCount","FaVideo","FaPhone","BsThreeDotsVertical","FaThumbtack","FaChevronDown","FaAngleDoubleRight","unpinMessage","FaTimes","handleChatScroll","nextPage","isScrolledUp","msgDate","showDateHeader","senderInfo","React","profileSrc","profileName","onContextMenu","handleContextMenu","pageX","pageY","innerWidth","innerHeight","FaShare","maxHeight","EmojiPicker","onEmojiClick","emojiObject","emoji","height","onKeyDown","shiftKey","FaSmile","handleFileButtonClick","FaPaperclip","FaCheck","FaPaperPlane","handleMicButtonClick","FaStop","FaMicrophone","file","files","localPreviewContent","uploadFile","FaTrash","handleReply","focus","FaReply","_contextMenu$message","messageIdToPin","pinMessage","handleForward","handleEdit","FaEdit","_c$name","checked","htmlFor","onError","originalMsg","forwardData","forwardMessageId","forwardTo","forwardMessage","newLastMessageObject","tab","employeeImage","displayName","jobTitlePrimary","fileMsg","allLinks","flatMap","linkMsg","links","link","url","rel","clearChatHistory","ChatListItemSkeleton","ChatAppSkeleton","useParams","chatList","setChatList","isLoading","setIsLoading","setIsFetchingMore","setPage","setHasMore","fetchingMore","loadChats","rawChatListData","getChatOverview","formattedChatList","transformOverviewToChatList","overviewData","chatItem","groupName","lastSeen","prevChatList","existingGroupIds","existingPrivateIds","newUniqueGroups","newUniquePrivate","ChatApplication","handleLoadMore","tasksApi","publicinfoApi","notificationsApi","ticketsApi"],"sourceRoot":""}