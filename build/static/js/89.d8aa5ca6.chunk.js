"use strict";(self.webpackChunktechlife=self.webpackChunktechlife||[]).push([[89],{6089:(e,s,t)=>{t.r(s),t.d(s,{default:()=>d});var r=t(9379),a=t(5043),l=t(9944),o=t(9910),n=t(2397),i=t(579);const d=()=>{var e,s;const{theme:t,permissionsdata:d,userData:c,setPermissionsData:u}=(0,a.useContext)(o.ob),[m,p]=(0,a.useState)({}),[b,g]=(0,a.useState)(!0),[x,h]=(0,a.useState)(!1),[y,f]=(0,a.useState)(null),[v,w]=(0,a.useState)(!1),j=null===c||void 0===c||null===(e=c.roles[0])||void 0===e?void 0:e.toUpperCase(),N=j||null;console.log("Searching for role:",N);const E=d.find(e=>e.roleName.trim()===N.trim());(0,a.useEffect)(()=>{E&&f(E)},[E]),console.log("Found object:",y);const[k,C]=(0,a.useState)(""),[A,S]=(0,a.useState)([]),[R,_]=(0,a.useState)(!1),[L,T]=(0,a.useState)(""),[U,P]=(0,a.useState)(!1),[O,D]=(0,a.useState)(!1),[M,I]=(0,a.useState)(null),Q=e=>e?e.replace("ROLE_","").toLowerCase():null,Z=()=>{if(!d||!Array.isArray(d))return{};const e={};return d.forEach(s=>{const t=Q(s.roleName);t&&(e[t]={id:s.id,permissions:s.permissions?[...new Set(s.permissions)]:[]})}),e};(0,a.useEffect)(()=>{if(d&&Array.isArray(d)){const e=(()=>{if(!d||!Array.isArray(d))return[];const e=d.flatMap(e=>e.permissions||[]);return[...new Set(e)].map(e=>{let s=e.replace(/_/g," ").toLowerCase().replace(/\b\w/g,e=>e.toUpperCase());return"CREAT_USER"===e&&(s="Create User"),"DELETE_USER"===e&&(s="Delete User"),"CREATE_TASK"===e&&(s="Create Task"),"VIEW_TASKS"===e&&(s="View Tasks"),"VIEW_REPORTS"===e&&(s="View Reports"),"PERMISSIONS_BUTTENS"===e&&(s="Permissions Buttons"),"CREATE_HR"===e&&(s="Create HR"),{value:e,label:s}}).sort((e,s)=>e.label.localeCompare(s.label))})();S(e);const s=Z();p(s),g(!1),w(!0)}else g(!1)},[d]);const F={};if(b)return(0,i.jsx)("div",{children:"Loading..."});const V=Object.keys(m).sort();return(0,i.jsxs)(i.Fragment,{children:[R&&(0,i.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,i.jsxs)("div",{className:"p-6 rounded-lg shadow-xl ".concat("dark"===t?"bg-gray-800":"bg-white"),children:[(0,i.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Add a New Role"}),(0,i.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),!L.trim()||!L.toUpperCase().startsWith("ROLE_"))return void alert("Please enter a valid role name starting with 'ROLE_'.");const s=Q(L);if(m[s])return void alert("This role already exists.");P(!0);const t={roleName:L.trim().toUpperCase(),permissions:[]};try{await n.ZQ.post("/role-access",t);const e=await n.ZQ.get("/role-access/all");u(e.data),_(!1),T(""),alert("Role '".concat(t.roleName,"' created successfully and UI has been updated!"))}catch(l){var r,a;console.error("Failed to create new role or refresh data:",l);const e=(null===(r=l.response)||void 0===r||null===(a=r.data)||void 0===a?void 0:a.message)||"An error occurred.";alert("Error: ".concat(e))}finally{P(!1)}},children:[(0,i.jsx)("input",{type:"text",value:L,onChange:e=>T(e.target.value),placeholder:"ROLE_ROLENAME",className:"w-full p-3 border rounded-lg focus:outline-none focus:ring-2 mb-4 ".concat("dark"===t?"bg-gray-700 border-gray-600":"bg-white border-gray-300")}),(0,i.jsxs)("div",{className:"flex justify-end gap-4",children:[(0,i.jsx)("button",{type:"button",onClick:()=>_(!1),className:"px-4 py-2 rounded ".concat("dark"===t?"bg-gray-600":"bg-gray-200"),disabled:U,children:"Cancel"}),(0,i.jsx)("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 disabled:bg-blue-400",disabled:U,children:U?"Adding...":"Add Role"})]})]})]})}),(0,i.jsx)("div",{className:"min-h-screen px-0 sm:px-4 md:px-6 lg:px-8 py-4 sm:py-6 ".concat("dark"===t?"bg-gray-900 text-white":"bg-gray-50 text-gray-800"),children:(0,i.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,i.jsxs)("div",{className:"mb-6 sm:mb-8 px-4 sm:px-0 flex justify-between items-center",children:[(0,i.jsxs)("div",{children:[(null===y||void 0===y||null===(s=y.permissions)||void 0===s?void 0:s.includes("DELETE_USER"))&&(0,i.jsx)("h1",{className:"text-2xl sm:text-3xl font-bold mb-2",children:"Permissions Management"}),(0,i.jsx)("p",{className:"text-sm ".concat("dark"===t?"text-gray-400":"text-gray-600"),children:"Configure role-based permissions"})]}),(0,i.jsx)("div",{children:(0,i.jsx)("button",{onClick:()=>{D(!O),I(null)},className:"p-3 rounded-full transition-colors duration-200 ".concat(O?"bg-blue-600 text-white":"dark"===t?"bg-gray-700 hover:bg-gray-600":"bg-gray-200 hover:bg-gray-300"),title:O?"Cancel Edit":"Edit Roles",children:(0,i.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.5L14.732 3.732z"})})})})]}),(0,i.jsx)("div",{className:"p-4 sm:p-6 rounded-lg shadow-md mb-8 ".concat("dark"===t?"bg-gray-800":"bg-white"),children:(0,i.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start gap-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Add a New Permission"}),(0,i.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,i.jsx)("input",{type:"text",value:k,onChange:e=>C(e.target.value),placeholder:"Enter new permission label",className:"flex-grow p-3 border rounded-lg ".concat("dark"===t?"bg-gray-700 border-gray-600":"bg-white border-gray-300")}),(0,i.jsx)("button",{type:"button",onClick:()=>{if(!k.trim())return void alert("Please enter a label for the new permission.");const e=k.trim().toUpperCase().replace(/\s+/g,"_");if(A.some(s=>s.value===e))return void alert("A permission with this value already exists.");const s={value:e,label:k.trim()};S(e=>[...e,s].sort((e,s)=>e.label.localeCompare(s.label))),C("")},className:"px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700",children:"Add Permission"})]})]}),(0,i.jsxs)("div",{className:"flex-shrink-0 mt-4 sm:mt-0",children:[(0,i.jsx)("h3",{className:"text-lg font-semibold mb-2 text-transparent select-none hidden sm:block",children:"."}),(0,i.jsx)("button",{onClick:()=>_(!0),className:"w-full px-6 py-3 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700",children:"Add New Role"})]})]})}),(0,i.jsxs)("div",{className:"space-y-4 sm:space-y-6 md:space-y-8",children:[V.map(e=>{const s=A.filter(s=>{var t,r;return null===(t=m[e])||void 0===t||null===(r=t.permissions)||void 0===r?void 0:r.includes(s.value)});return(0,i.jsx)("div",{className:"mx-4 sm:mx-0 rounded-lg shadow-md border transition-all duration-300 ".concat(M===e?"border-red-500 ring-2 ring-red-500/50":"dark"===t?"border-gray-700":"border-gray-200"),children:(0,i.jsxs)("div",{className:"p-4 sm:p-6 md:p-8 flex items-start gap-4",children:[O&&(0,i.jsx)("input",{type:"checkbox",className:"mt-2 h-6 w-6 rounded border-gray-300 text-blue-600 focus:ring-blue-500 disabled:opacity-50 cursor-pointer",checked:M===e,onChange:()=>{return s=e,void I(e=>e===s?null:s);var s},disabled:null!==M&&M!==e}),(0,i.jsxs)("div",{className:"flex-grow",children:[(0,i.jsx)("h2",{className:"text-lg sm:text-xl font-semibold capitalize mb-4 pb-2 border-b ".concat("dark"===t?"border-gray-700":"border-gray-200"),children:e.replace(/_/g," ")}),(0,i.jsx)(l.Ay,{isMulti:!0,options:A,value:s,onChange:s=>((e,s)=>{const t=e?e.map(e=>e.value):[];p(e=>(0,r.A)((0,r.A)({},e),{},{[s]:(0,r.A)((0,r.A)({},e[s]),{},{permissions:t})}))})(s,e),styles:F,placeholder:"Select permissions...",closeMenuOnSelect:!1,isDisabled:O}),(0,i.jsxs)("p",{className:"text-xs mt-3 ".concat("dark"===t?"text-gray-400":"text-gray-500"),children:[s.length," permission(s) selected"]})]})]})},e)}),(0,i.jsx)("div",{className:"pt-4 sm:pt-6 px-4 sm:px-0",children:(0,i.jsx)("div",{className:"flex flex-col sm:flex-row justify-end gap-3 sm:gap-4",children:O?(0,i.jsx)("button",{type:"button",onClick:async()=>{if(!M)return void alert("Please select a role to delete.");const e="ROLE_".concat(M.toUpperCase());if(window.confirm("Are you sure you want to delete the role: ".concat(e,"? This action cannot be undone.")))try{const s="ADMIN";await n.ZQ.delete("role-access/delete/".concat(s,"/").concat(e));const t=await n.ZQ.get("/role-access/all");u(t.data),alert("Role '".concat(e,"' has been deleted successfully.")),I(null),D(!1)}catch(r){var s,t;console.error("Failed to delete role:",r);const e=(null===(s=r.response)||void 0===s||null===(t=s.data)||void 0===t?void 0:t.message)||"An error occurred while deleting the role.";alert("Error: ".concat(e))}},disabled:!M,className:"w-full sm:w-auto px-8 py-3 bg-red-600 text-white font-bold rounded-lg shadow-lg disabled:bg-red-400 disabled:cursor-not-allowed",children:"Delete Selected Role"}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("button",{type:"button",onClick:()=>{if(d&&Array.isArray(d)){const e=Z();p(e),alert("Permissions have been reset to their original state.")}},className:"w-full sm:w-auto px-6 py-3 border-2 rounded-lg font-semibold ".concat("dark"===t?"border-gray-600":"border-gray-300"),children:"Reset"}),(0,i.jsx)("button",{type:"button",onClick:async e=>{e.preventDefault(),h(!0);const s=Object.keys(m).map(e=>{const s={roleName:"ROLE_".concat(e.toUpperCase()),permissions:m[e].permissions||[]};return null!==m[e].id&&(s.id=m[e].id),s});try{await n.ZQ.post("role-access/updateAll",s);const e=await n.ZQ.get("/role-access/all");u(e.data),alert("Permissions have been saved successfully!")}catch(a){var t,r;console.error("Error saving permissions:",a);const e=(null===(t=a.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||"An error occurred while saving permissions.";alert("Error: ".concat(e))}finally{h(!1)}},disabled:x,className:"w-full sm:w-auto flex items-center justify-center gap-2 px-8 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-bold rounded-lg ".concat(x?"cursor-not-allowed":""),children:x?"Saving...":"Save Permissions"})]})})})]})]})})]})}}}]);
//# sourceMappingURL=89.d8aa5ca6.chunk.js.map