{"version":3,"file":"static/js/358.28d10fdd.chunk.js","mappings":"2PAiCA,MAAMA,EAAkBC,IACpB,IAAKA,GAAmB,IAAVA,EAAa,MAAO,UAClC,MAEMC,EAAIC,KAAKC,MAAMD,KAAKE,IAAIJ,GAASE,KAAKE,IAFlC,OAGV,OAAOC,YAAYL,EAAQE,KAAKI,IAHtB,KAG6BL,IAAIM,QAAQ,IAAM,IAF3C,CAAC,QAAS,KAAM,KAAM,KAAM,MAE2BN,IAInEO,EAAWC,IAA2C,IAADC,EAAA,IAAzC,SAAEC,EAAQ,UAAEC,EAAY,YAAYH,EAClD,MAAMI,EAAoB,OAARF,QAAQ,IAARA,GAA0B,QAAlBD,EAARC,EAAUG,MAAM,KAAKC,aAAK,IAAAL,OAAlB,EAARA,EAA4BM,cAC9C,MAAI,CAAC,OAAOC,SAASJ,IAAmBK,EAAAA,EAAAA,KAACC,EAAAA,IAAS,CAACP,UAAS,gBAAAQ,OAAkBR,KAC1E,CAAC,MAAO,QAAQK,SAASJ,IAAmBK,EAAAA,EAAAA,KAACG,EAAAA,IAAU,CAACT,UAAS,iBAAAQ,OAAmBR,KACpF,CAAC,MAAO,QAAQK,SAASJ,IAAmBK,EAAAA,EAAAA,KAACI,EAAAA,IAAgB,CAACV,UAAS,mBAAAQ,OAAqBR,KAC5F,CAAC,MAAO,QAAQK,SAASJ,IAAmBK,EAAAA,EAAAA,KAACK,EAAAA,GAAW,CAACX,UAAS,kBAAAQ,OAAoBR,KACtF,CAAC,MAAO,MAAO,MAAMK,SAASJ,IAAmBK,EAAAA,EAAAA,KAACM,EAAAA,IAAa,CAACZ,UAAS,mBAAAQ,OAAqBR,KAC9F,CAAC,MAAO,MAAO,OAAQ,MAAO,QAAQK,SAASJ,IAAmBK,EAAAA,EAAAA,KAACO,EAAAA,IAAO,CAACb,UAAS,mBAAAQ,OAAqBR,KACzG,CAAC,MAAO,MAAO,OAAOK,SAASJ,IAAmBK,EAAAA,EAAAA,KAACQ,EAAAA,IAAW,CAACd,UAAS,iBAAAQ,OAAmBR,MACxFM,EAAAA,EAAAA,KAACS,EAAAA,IAAS,CAACf,UAAS,iBAAAQ,OAAmBR,MAI5CgB,EAAcC,IAAkC,IAAjC,IAAEC,EAAG,YAAEC,EAAW,MAAEC,GAAOH,EAC5C,MAAMI,EAAW,GAAAb,OAAMc,EAAAA,GAAQC,SAASC,QAAO,eAAAhB,OAAcU,EAAIO,WA0B3DC,GACFC,EAAAA,EAAAA,MAAA,OAAK3B,UAAS,+DAAAQ,OAAiEW,EAAc,cAA2B,SAAVC,EAAmB,cAAgB,eAAiBQ,SAAA,EAC9JtB,EAAAA,EAAAA,KAAA,OAAKN,UAAU,2CAA0C4B,UACrDtB,EAAAA,EAAAA,KAACV,EAAQ,CAACG,SAAUmB,EAAInB,SAAUC,UAAU,gBAEhD2B,EAAAA,EAAAA,MAAA,OAAK3B,UAAU,iCAAgC4B,SAAA,EAC3CtB,EAAAA,EAAAA,KAAA,KAAGN,UAAS,0BAAAQ,OAA4BW,GAAwC,SAAVC,EAAhB,aAAkD,iBAAmBQ,SAAEV,EAAInB,YACjIO,EAAAA,EAAAA,KAAA,KAAGN,UAAS,WAAAQ,OAAaW,EAAc,gBAA6B,SAAVC,EAAmB,gBAAkB,iBAAmBQ,SAAEzC,EAAe+B,EAAIW,gBAE3IvB,EAAAA,EAAAA,KAAA,OACIwB,QAlCgBC,UACxBC,EAAEC,iBACFD,EAAEE,kBAEF,IACI,MAAMC,QAAiBC,MAAMf,GAC7B,IAAKc,EAASE,GACV,MAAM,IAAIC,MAAM,+BAEpB,MAAMC,QAAaJ,EAASI,OACtBC,EAAUC,OAAOC,IAAIC,gBAAgBJ,GACrCK,EAAOC,SAASC,cAAc,KACpCF,EAAKG,KAAOP,EACZI,EAAKI,aAAa,WAAY9B,EAAInB,UAAY,YAC9C8C,SAASI,KAAKC,YAAYN,GAC1BA,EAAKO,QACLP,EAAKQ,SACLX,OAAOC,IAAIW,gBAAgBb,EAC/B,CAAE,MAAOc,GACLC,QAAQD,MAAM,mBAAoBA,GAClCb,OAAOe,KAAKnC,EAAa,SAC7B,GAcQrB,UAAU,kJAAiJ4B,UAE3JtB,EAAAA,EAAAA,KAACmD,EAAAA,IAAU,CAACC,KAAM,UAI9B,OAAQvC,EAAmHO,GAArGpB,EAAAA,EAAAA,KAAA,OAAKwB,QAASA,IAAMW,OAAOe,KAAKnC,EAAa,UAAWrB,UAAU,iBAAgB4B,SAAEF,KAIxGiC,EAAcC,IAA2E,IAA1E,IAAEC,EAAG,QAAEC,EAAO,SAAEC,EAAQ,gBAAEC,EAAkB,EAAC,SAAEnC,EAAW,EAAC,MAAET,GAAOwC,EACrF,MAAMK,GAAWC,EAAAA,EAAAA,QAAO,OACjBC,EAAWC,IAAgBC,EAAAA,EAAAA,WAAS,IACpCC,EAAUC,IAAeF,EAAAA,EAAAA,UAAS,IAClCG,EAAUC,IAAeJ,EAAAA,EAAAA,UAASL,IAClCU,EAAUC,IAAeN,EAAAA,EAAAA,UAASR,GAAO,OACzCe,EAAeC,IAAoBR,EAAAA,EAAAA,WAAS,IAEnDS,EAAAA,EAAAA,WAAU,KACN,MAAMC,EAAQd,EAASe,QACvB,IAAKD,EAAO,OAEZ,MAAME,EAAeA,KACbF,EAAMP,WAAaU,KAAYH,EAAMP,SAAW,GAChDC,EAAYM,EAAMP,WAGpBW,EAAeA,IAAMZ,EAAYQ,EAAMK,aACvCC,EAAcA,IAAMjB,GAAa,GAMvC,OAJAW,EAAMO,iBAAiB,iBAAkBL,GACzCF,EAAMO,iBAAiB,aAAcH,GACrCJ,EAAMO,iBAAiB,QAASD,GAEzB,KACHN,EAAMQ,oBAAoB,iBAAkBN,GAC5CF,EAAMQ,oBAAoB,aAAcJ,GACxCJ,EAAMQ,oBAAoB,QAASF,KAExC,CAACX,IAEJ,MAAMc,EAAiBzD,UACnB,IAAI6C,EAAJ,CACAC,GAAiB,GACjB,IACI,MAAM1C,QAAiBC,MAAM0B,GACvBvB,QAAaJ,EAASI,OACtBkD,EAAW/C,IAAIC,gBAAgBJ,GACrCoC,EAAYc,EAChB,CAAE,MAAOnC,GACLC,QAAQD,MAAM,4BAA6BA,EAC/C,CAAC,QACGuB,GAAiB,EACrB,CAXyB,GAwBvBa,EAAcC,IAChB,IAAKA,GAAQA,IAAST,IAAU,MAAO,OACvC,MAAMU,EAAUtG,KAAKC,MAAMoG,EAAO,IAC5BE,EAAUvG,KAAKC,MAAMoG,EAAO,IAClC,MAAM,GAANnF,OAAUoF,EAAO,KAAApF,OAAIqF,EAAQC,WAAWC,SAAS,EAAG,OAGlDC,EAAqBxB,EAAYF,EAAWE,EAAY,IAAM,EAEpE,OAAKE,GAuBD/C,EAAAA,EAAAA,MAAA,OAAK3B,UAAU,mCAAkC4B,SAAA,EAC7CtB,EAAAA,EAAAA,KAAA,SAAO2F,IAAKhC,EAAUJ,IAAKa,EAAUwB,QAAQ,cAC7C5F,EAAAA,EAAAA,KAAA,UAAQwB,QA5CQqE,KACflC,EAASe,UACVb,EACAF,EAASe,QAAQoB,QAEjBnC,EAASe,QAAQqB,OAAOC,MAAMtE,GAAKuB,QAAQD,MAAM,qBAAsBtB,IAE3EoC,GAAcD,KAqCwBnE,UAAS,yEAAAQ,OAA2EuD,EAAW,yBAA+C,wCAAmFnC,SAC9PuC,GAAY7D,EAAAA,EAAAA,KAACiG,EAAAA,IAAO,CAAC7C,KAAM,MAASpD,EAAAA,EAAAA,KAACkG,EAAAA,IAAM,CAAC9C,KAAM,GAAI1D,UAAU,YAErE2B,EAAAA,EAAAA,MAAA,OAAK3B,UAAU,yCAAwC4B,SAAA,EACnDtB,EAAAA,EAAAA,KAAA,OAAKN,UAAU,uDAAuD8B,QAAUE,IAC5E,IAAKwC,EAAU,OACf,MAAMiC,EAAOzE,EAAE0E,cAAcC,wBAEvBC,GADS5E,EAAE6E,QAAUJ,EAAKK,MACNL,EAAKM,MAASvC,EACpCP,EAASe,UAASf,EAASe,QAAQI,YAAcwB,IACvDhF,UACEtB,EAAAA,EAAAA,KAAA,OAAK0G,MAAO,CAAED,MAAM,GAADvG,OAAKwF,EAAkB,MAAOhG,UAAS,uBAAAQ,OAAyBuD,EAAW,WAAiC,oBAEnIzD,EAAAA,EAAAA,KAAA,QAAMN,UAAS,yBAAAQ,OAA2BuD,EAAW,gBAA6B,SAAV3C,EAAmB,gBAAkB,iBAAmBQ,SAAE8D,EAAWlB,YApCjJ7C,EAAAA,EAAAA,MAAA,OAAK3B,UAAU,mCAAkC4B,SAAA,CAC5CgD,GACGtE,EAAAA,EAAAA,KAAA,OAAKN,UAAU,kGAAiG4B,UAC5GtB,EAAAA,EAAAA,KAAA,OAAKN,UAAU,iEAGnBM,EAAAA,EAAAA,KAAA,UAAQwB,QAAS0D,EAAgBxF,UAAU,mJAAkJ4B,UACzLtB,EAAAA,EAAAA,KAACmD,EAAAA,IAAU,CAACC,KAAM,QAG1B/B,EAAAA,EAAAA,MAAA,OAAK3B,UAAU,yCAAwC4B,SAAA,EACnDtB,EAAAA,EAAAA,KAAA,KAAGN,UAAS,WAAAQ,OAAauD,GAAqC,SAAV3C,EAAhB,aAAkD,iBAAmBQ,SAAC,mBAC1GD,EAAAA,EAAAA,MAAA,OAAK3B,UAAU,yCAAwC4B,SAAA,EACnDtB,EAAAA,EAAAA,KAAA,QAAMN,UAAS,WAAAQ,OAAauD,EAAW,gBAA6B,SAAV3C,EAAmB,gBAAkB,iBAAmBQ,SAAEzC,EAAe0C,MACnIvB,EAAAA,EAAAA,KAAA,QAAMN,UAAS,WAAAQ,OAAauD,EAAW,gBAA6B,SAAV3C,EAAmB,gBAAkB,iBAAmBQ,SAAE8D,EAAWlB,eA4BjJyC,EAAkBC,IAAA,IAAC,MAAE9F,GAAO8F,EAAA,OAC9BvF,EAAAA,EAAAA,MAAA,OAAK3B,UAAU,gBAAe4B,SAAA,EAC1BD,EAAAA,EAAAA,MAAA,OAAK3B,UAAU,qCAAoC4B,SAAA,EAC/CtB,EAAAA,EAAAA,KAAA,OAAKN,UAAS,wBAAAQ,OAAoC,SAAVY,EAAmB,cAAgB,cAAa,mCACxFd,EAAAA,EAAAA,KAAA,OAAKN,UAAS,mBAAAQ,OAA+B,SAAVY,EAAmB,cAAgB,cAAa,6BAEvFO,EAAAA,EAAAA,MAAA,OAAK3B,UAAU,mCAAkC4B,SAAA,EAC7CtB,EAAAA,EAAAA,KAAA,OAAKN,UAAS,mBAAAQ,OAA+B,SAAVY,EAAmB,cAAgB,cAAa,0BACnFd,EAAAA,EAAAA,KAAA,OAAKN,UAAS,wBAAAQ,OAAoC,SAAVY,EAAmB,cAAgB,cAAa,sCAE5FO,EAAAA,EAAAA,MAAA,OAAK3B,UAAU,qCAAoC4B,SAAA,EAC/CtB,EAAAA,EAAAA,KAAA,OAAKN,UAAS,wBAAAQ,OAAoC,SAAVY,EAAmB,cAAgB,cAAa,mCACxFd,EAAAA,EAAAA,KAAA,OAAKN,UAAS,mBAAAQ,OAA+B,SAAVY,EAAmB,cAAgB,cAAa,6BAEvFO,EAAAA,EAAAA,MAAA,OAAK3B,UAAU,mCAAkC4B,SAAA,EAC7CtB,EAAAA,EAAAA,KAAA,OAAKN,UAAS,mBAAAQ,OAA+B,SAAVY,EAAmB,cAAgB,cAAa,0BACnFd,EAAAA,EAAAA,KAAA,OAAKN,UAAS,wBAAAQ,OAAoC,SAAVY,EAAmB,cAAgB,cAAa,sCAE5FO,EAAAA,EAAAA,MAAA,OAAK3B,UAAU,qCAAoC4B,SAAA,EAC/CtB,EAAAA,EAAAA,KAAA,OAAKN,UAAS,wBAAAQ,OAAoC,SAAVY,EAAmB,cAAgB,cAAa,mCACxFd,EAAAA,EAAAA,KAAA,OAAKN,UAAS,mBAAAQ,OAA+B,SAAVY,EAAmB,cAAgB,cAAa,6BAEvFO,EAAAA,EAAAA,MAAA,OAAK3B,UAAU,qCAAoC4B,SAAA,EAC/CtB,EAAAA,EAAAA,KAAA,OAAKN,UAAS,wBAAAQ,OAAoC,SAAVY,EAAmB,cAAgB,cAAa,mCACxFd,EAAAA,EAAAA,KAAA,OAAKN,UAAS,mBAAAQ,OAA+B,SAAVY,EAAmB,cAAgB,cAAa,6BAEvFO,EAAAA,EAAAA,MAAA,OAAK3B,UAAU,mCAAkC4B,SAAA,EAC7CtB,EAAAA,EAAAA,KAAA,OAAKN,UAAS,mBAAAQ,OAA+B,SAAVY,EAAmB,cAAgB,cAAa,0BACnFd,EAAAA,EAAAA,KAAA,OAAKN,UAAS,wBAAAQ,OAAoC,SAAVY,EAAmB,cAAgB,cAAa,sCAE5FO,EAAAA,EAAAA,MAAA,OAAK3B,UAAU,qCAAoC4B,SAAA,EAC/CtB,EAAAA,EAAAA,KAAA,OAAKN,UAAS,wBAAAQ,OAAoC,SAAVY,EAAmB,cAAgB,cAAa,mCACxFd,EAAAA,EAAAA,KAAA,OAAKN,UAAS,mBAAAQ,OAA+B,SAAVY,EAAmB,cAAgB,cAAa,6BAEvFO,EAAAA,EAAAA,MAAA,OAAK3B,UAAU,mCAAkC4B,SAAA,EAC7CtB,EAAAA,EAAAA,KAAA,OAAKN,UAAS,mBAAAQ,OAA+B,SAAVY,EAAmB,cAAgB,cAAa,0BACnFd,EAAAA,EAAAA,KAAA,OAAKN,UAAS,wBAAAQ,OAAoC,SAAVY,EAAmB,cAAgB,cAAa,sCAE5FO,EAAAA,EAAAA,MAAA,OAAK3B,UAAU,qCAAoC4B,SAAA,EAC/CtB,EAAAA,EAAAA,KAAA,OAAKN,UAAS,wBAAAQ,OAAoC,SAAVY,EAAmB,cAAgB,cAAa,mCACxFd,EAAAA,EAAAA,KAAA,OAAKN,UAAS,mBAAAQ,OAA+B,SAAVY,EAAmB,cAAgB,cAAa,6BAEvFO,EAAAA,EAAAA,MAAA,OAAK3B,UAAU,qCAAoC4B,SAAA,EAC/CtB,EAAAA,EAAAA,KAAA,OAAKN,UAAS,wBAAAQ,OAAoC,SAAVY,EAAmB,cAAgB,cAAa,mCACxFd,EAAAA,EAAAA,KAAA,OAAKN,UAAS,mBAAAQ,OAA+B,SAAVY,EAAmB,cAAgB,cAAa,6BAEvFO,EAAAA,EAAAA,MAAA,OAAK3B,UAAU,mCAAkC4B,SAAA,EAC7CtB,EAAAA,EAAAA,KAAA,OAAKN,UAAS,mBAAAQ,OAA+B,SAAVY,EAAmB,cAAgB,cAAa,0BACnFd,EAAAA,EAAAA,KAAA,OAAKN,UAAS,wBAAAQ,OAAoC,SAAVY,EAAmB,cAAgB,cAAa,sCAE5FO,EAAAA,EAAAA,MAAA,OAAK3B,UAAU,qCAAoC4B,SAAA,EAC/CtB,EAAAA,EAAAA,KAAA,OAAKN,UAAS,wBAAAQ,OAAoC,SAAVY,EAAmB,cAAgB,cAAa,mCACxFd,EAAAA,EAAAA,KAAA,OAAKN,UAAS,mBAAAQ,OAA+B,SAAVY,EAAmB,cAAgB,cAAa,gCAmCzF+F,EAAsBC,IAA+B,IAA9B,KAAEC,EAAI,QAAEC,EAAO,MAAElG,GAAOgG,EACjD,MAAOG,EAAUC,IAAenD,EAAAA,EAAAA,WAAS,GAEzC,OAAIkD,GAA0B,YAAdF,EAAKI,MAEbnH,EAAAA,EAAAA,KAAA,OACIN,UAAU,gFACV8B,QAASA,IAAM0F,GAAY,GAAO5F,UAElCtB,EAAAA,EAAAA,KAAA,OACIuD,IAAS,OAAJwD,QAAI,IAAJA,OAAI,EAAJA,EAAMK,QACXC,IAAS,OAAJN,QAAI,IAAJA,OAAI,EAAJA,EAAMO,KACX5H,UAAU,gDAOtBM,EAAAA,EAAAA,KAAA,OACIN,UAAU,gGACV8B,QAASwF,EAAQ1F,UAEjBD,EAAAA,EAAAA,MAAA,OACI3B,UAAU,2CACV8B,QAAUE,IACNA,EAAEE,kBACgB,YAAdmF,EAAKI,MAAoBD,GAAY,IAC3C5F,SAAA,CAEa,UAAdyF,EAAKI,MACFnH,EAAAA,EAAAA,KAAA,OAAKN,UAAU,yFAAwF4B,UACnGtB,EAAAA,EAAAA,KAACuH,EAAAA,IAAO,CAAC7H,UAAU,gBAAgB0D,KAAM,SAG7CpD,EAAAA,EAAAA,KAAA,OACIuD,IAAS,OAAJwD,QAAI,IAAJA,OAAI,EAAJA,EAAMK,QACXC,IAAS,OAAJN,QAAI,IAAJA,OAAI,EAAJA,EAAMO,KACX5H,UAAU,4DAGlBM,EAAAA,EAAAA,KAAA,OAAKN,UAAU,kGAAiG4B,UAC5GtB,EAAAA,EAAAA,KAAA,MAAIN,UAAU,oDAAmD4B,SAAM,OAAJyF,QAAI,IAAJA,OAAI,EAAJA,EAAMO,eA+/D7F,QAx/DA,SAAwBE,GAAuF,IAAtF,YAAEC,EAAaC,MAAOC,EAAY,cAAEC,EAAa,QAAEC,EAAO,eAAEC,EAAc,MAAEhH,GAAO0G,EACxG,MAAMO,GAAWC,EAAAA,EAAAA,MACXC,GAAWC,EAAAA,EAAAA,OACVC,EAAUC,IAAerE,EAAAA,EAAAA,UAAS,CAAEsE,OAAQ,GAAIC,iBAAkB,MAClEC,EAAYC,IAAiBzE,EAAAA,EAAAA,UAAS,KACtC0E,EAAcC,IAAmB3E,EAAAA,EAAAA,UAAS,OAC1C4E,EAASC,IAAc7E,EAAAA,EAAAA,UAAS,KAChC8E,EAAUC,IAAe/E,EAAAA,EAAAA,UAAS,CAAC,IACnCgF,EAAmBC,IAAwBjF,EAAAA,EAAAA,WAAS,IACpDkF,EAAYC,IAAiBnF,EAAAA,EAAAA,WAAS,IACtCoF,EAAiBC,IAAsBrF,EAAAA,EAAAA,WAAS,IAChDsF,EAAaC,IAAkBvF,EAAAA,EAAAA,WAAS,IACxCwF,EAAcC,IAAmBzF,EAAAA,EAAAA,WAAS,IAC1C0F,EAAiBC,IAAsB3F,EAAAA,EAAAA,UAAS,CAAC,IACjD4F,EAAaC,IAAkB7F,EAAAA,EAAAA,UAAS,CAAE8F,SAAS,EAAOC,EAAG,EAAGC,EAAG,EAAGpB,QAAS,KAAMqB,MAAO,QAC5FC,EAAaC,IAAkBnG,EAAAA,EAAAA,UAAS,CAAEiG,MAAO,KAAMG,gBAAiB,MACxEC,EAAYC,IAAiBtG,EAAAA,EAAAA,UAAS,OACtCuG,GAAaC,KAAkBxG,EAAAA,EAAAA,UAAS,OACxCyG,GAAeC,KAAoB1G,EAAAA,EAAAA,UAAS,OAC5C2G,GAAgBC,KAAqB5G,EAAAA,EAAAA,UAAS,CAAE8F,SAAS,EAAOlB,QAAS,QACzEiC,GAAmBC,KAAwB9G,EAAAA,EAAAA,UAAS,KACpD+G,GAAmBC,KAAwBhH,EAAAA,EAAAA,UAAS,KACpDiH,GAAgBC,KAAqBlH,EAAAA,EAAAA,WAAS,IAC9CmH,GAAoBC,KAAyBpH,EAAAA,EAAAA,WAAS,IACtDqH,GAAsBC,KAA2BtH,EAAAA,EAAAA,WAAS,IAC1DuH,GAAoBC,KAAyBxH,EAAAA,EAAAA,UAAS,aACtDyH,GAAcC,KAAmB1H,EAAAA,EAAAA,UAAS,KAC1C2H,GAAoBC,KAAyB5H,EAAAA,EAAAA,WAAS,IACtD6H,GAAmBC,KAAwB9H,EAAAA,EAAAA,UAAS,CAAC,IACrD+H,GAAaC,KAAkBhI,EAAAA,EAAAA,UAAS,OACxCiI,GAAiBC,KAAsBlI,EAAAA,EAAAA,WAAS,IAChDmI,GAAaC,KAAkBpI,EAAAA,EAAAA,WAAS,IACxCqI,GAAkBC,KAAuBtI,EAAAA,EAAAA,WAAS,IAClDuI,GAAaC,KAAkBxI,EAAAA,EAAAA,UAAS,CAAC,IACzCyI,GAAcC,KAAmB1I,EAAAA,EAAAA,UAAS,CAAC,IAC3C2I,GAAiBC,KAAsB5I,EAAAA,EAAAA,UAAS,CAAC,IACjD6I,GAAwBC,KAA6B9I,EAAAA,EAAAA,WAAS,IAC9D+I,GAAoBC,KAAyBhJ,EAAAA,EAAAA,WAAS,IACtDiJ,GAAkBC,KAAuBlJ,EAAAA,EAAAA,UAAS,IAClDmJ,GAAgBC,KAAqBpJ,EAAAA,EAAAA,UAAS,OAC9CqJ,GAAmBC,KAAwBtJ,EAAAA,EAAAA,UAAS,OACpDuJ,GAAaC,KAAkBxJ,EAAAA,EAAAA,WAAS,IACxCyJ,GAAYC,KAAiB1J,EAAAA,EAAAA,UAAS,KACtC2J,GAAYC,KAAiB5J,EAAAA,EAAAA,UAAS,KACtC6J,GAAYC,KAAiB9J,EAAAA,EAAAA,UAAS,KACtC+J,GAAqBC,KAA0BhK,EAAAA,EAAAA,WAAS,IACxDiK,GAAiBC,KAAsBlK,EAAAA,EAAAA,WAAS,IAChDmK,GAAaC,KAAkBpK,EAAAA,EAAAA,UAAS,KACxCqK,GAAeC,KAAoBtK,EAAAA,EAAAA,UAAS,KAC5CuK,GAAoBC,KAAyBxK,EAAAA,EAAAA,WAAU,IACxD,uBAAEyK,GAAsB,mBAAEC,KAAuBC,EAAAA,EAAAA,YAAWC,EAAAA,KAElEnK,EAAAA,EAAAA,WAAU,KACFgK,IACAA,GAAuBvF,IAE5B,CAACA,EAAYuF,KAEhB,MAAMI,IAAmBhL,EAAAA,EAAAA,QAAO,MAC1BiL,IAAmBjL,EAAAA,EAAAA,QAAO,MAC1BkL,IAAclL,EAAAA,EAAAA,QAAO,MACrBmL,IAAmBnL,EAAAA,EAAAA,QAAO,CAAC,GAC3BoL,IAAepL,EAAAA,EAAAA,QAAO,MACtBqL,IAAmBrL,EAAAA,EAAAA,QAAO,MAC1BsL,IAAiBtL,EAAAA,EAAAA,QAAO,IACxBuL,IAAYvL,EAAAA,EAAAA,QAAO,MACnBwL,IAAiBxL,EAAAA,EAAAA,QAAO,MACxByL,IAAiBzL,EAAAA,EAAAA,QAAO,MACxB0L,IAAc1L,EAAAA,EAAAA,QAAO,MACrB2L,IAAoB3L,EAAAA,EAAAA,QAAO,MAC3B4L,IAAiB5L,EAAAA,EAAAA,QAAO,MACxB6L,IAAkB7L,EAAAA,EAAAA,QAAO,MACzB8L,IAAoB9L,EAAAA,EAAAA,SAAO,GAC3B+L,IAAgB/L,EAAAA,EAAAA,QAAO,MACvBgM,IAAsBhM,EAAAA,EAAAA,QAAO,MAC7BiM,IAAuBjM,EAAAA,EAAAA,QAAO,MAC9BkM,IAAwBlM,EAAAA,EAAAA,SAAO,GAC/BmM,IAAgBnM,EAAAA,EAAAA,QAAO,CAAC,GAExBoM,IAAgBC,EAAAA,EAAAA,SAAQ,KAC1B,GAAIlI,EAASmI,SAASnQ,SAAS,SAAU,CAErC,OADe,IAAIoQ,gBAAgBpI,EAASqI,QAC9BC,IAAI,KACtB,CACA,OAAO,MACR,CAACtI,EAASmI,SAAUnI,EAASqI,UAOhC5L,EAAAA,EAAAA,WAAU,KACN,GAA2B,KAAvB0J,GAAYoC,OAGZ,OAFAjC,GAAiB,SACjBE,IAAuB,GAI3B,MAAMgC,EAAUC,WAAW,KACnB/H,IACAgI,EAAAA,EAAAA,IAAehJ,EAAYiJ,GAAIjI,EAAakI,OAAQzC,IAAa0C,KAAKC,IAClExC,GAAiBwC,GACjBtC,GAAsBsC,EAAQC,OAAS,EAAI,GAAK,MAGzD,KAEH,MAAO,IAAMC,aAAaR,IAC3B,CAACrC,GAAazF,EAAchB,EAAYiJ,MAgB3ClM,EAAAA,EAAAA,WAAU,KACN,IAA4B,IAAxB8J,IAA6BF,GAAcE,IAAqB,CAChE,MAAMnN,EAAYiN,GAAcE,IAAoBnN,UAC9C6P,EAAiBzO,SAAS0O,eAAe,OAAD/Q,OAAQiB,IAClD6P,GACAA,EAAeE,eAAe,CAAEC,SAAU,SAAUC,MAAO,UAEnE,GACD,CAAC9C,GAAoBF,KAGxB,MAmEMiD,GAAiB,WAA0B,IAAzBF,EAAQG,UAAAR,OAAA,QAAAS,IAAAD,UAAA,GAAAA,UAAA,GAAG,SAC3BzC,GAAiBnK,SACjBmK,GAAiBnK,QAAQ8M,SAAS,CAC9BC,IAAK5C,GAAiBnK,QAAQgN,aAC9BP,SAAUA,IAGlBlE,GAAoB,EACxB,GAGAzI,EAAAA,EAAAA,WAAU,KACN,GAA0B,KAAtB+D,EAAW+H,OAGX,OAFAjD,GAAqB,WACrBE,IAAe,GAInBA,IAAe,GACf,MAAMoE,EAAgBnB,WAAW,MAC7BoB,EAAAA,EAAAA,IAAmBnK,EAAYiJ,GAAInI,GAC9BqI,KAAKiB,IACF,MAAMC,GAAmBC,EAAAA,EAAAA,IAA4BF,EAAYpK,EAAYiJ,IACvEsB,EAAkB,IAAIF,EAAiBxJ,oBAAqBwJ,EAAiBzJ,QAC9E4J,KAAK,CAACC,EAAGC,IAAM,IAAIC,KAAKD,EAAEE,sBAAwB,IAAID,KAAKF,EAAEG,uBAClEhF,GAAqB2E,KAExBM,QAAQ,IAAM/E,IAAe,KACnC,KAEH,MAAO,IAAMwD,aAAaY,IAC3B,CAACpJ,EAAYd,EAAYiJ,MAE5BlM,EAAAA,EAAAA,WAAU,KACN,GAAImD,EAAc,CACd,MAAM4K,EAAiB,CACnBlK,OAAQV,EAAaU,OAAOmK,IAAIzL,GAC5BA,EAAK4J,OAAOnL,aAAewK,IAAayC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAC7B1L,GAAI,IAAE2L,mBAAoB,IAC/B3L,GAEVuB,iBAAkBX,EAAaW,iBAAiBkK,IAAIzL,GAChDA,EAAK4J,OAAOnL,aAAewK,IAAayC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAC7B1L,GAAI,IAAE2L,mBAAoB,IAC/B3L,IAGdqB,EAAYmK,GACZtG,IAAmB,EACvB,GACD,CAACtE,EAAcqI,KAGlB,MAAM2C,IAAmBC,EAAAA,EAAAA,aAAYnR,MAAOkP,EAAQkC,KAChD,KAAKA,EAAU,GAAKjG,IAAwC,IAAZiG,GAAiB9J,GAAjE,CAII8J,EAAU,GACVhG,IAA0B,GAC1BiD,GAAsBpL,SAAU,GAEhCsE,GAAqB,GAGzB,IACI,MAAM8J,QAAoBC,EAAAA,EAAAA,IAAYtL,EAAYiJ,GAAIC,EAAQkC,EAAS,IAGvE,GAFA5P,QAAQ/D,IAAI,6BAA8B,iCAAkC4T,GAEjD,IAAvBA,EAAYhC,OAEZ,YADAnE,GAAmBqG,IAAIP,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAUO,GAAI,IAAE,CAACrC,IAAS,KAIrD,MAAMsC,EAAsBH,EAAYN,IAAIU,EAAAA,IAEtCC,EAAgBtE,GAAiBnK,QACjC0O,EAAuBD,EAAgBA,EAAczB,aAAe,EACpE2B,EAAoBF,EAAgBA,EAAcG,UAAY,EAEpExK,EAAYkK,IAAIP,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACTO,GAAI,IACP,CAACrC,GAAqB,IAAZkC,EACJI,EACA,IAAIA,KAAyBD,EAAKrC,IAAW,OAGnDkC,EAAU,GACVU,sBAAsB,KACdJ,IACAA,EAAcG,UAAaH,EAAczB,aAAe0B,EAAwBC,KAKjE,IAAvBP,EAAYhC,QACZnE,GAAmBqG,IAAIP,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAUO,GAAI,IAAE,CAACrC,IAAS,IAGzD,CAAE,MAAO3N,GACLC,QAAQD,MAAM,oCAAD9C,OAAqCyQ,EAAM,KAAK3N,EACjE,CAAC,QACO6P,EAAU,GACVhG,IAA0B,GAC1B2D,WAAW,KAAQV,GAAsBpL,SAAU,GAAU,MAE7DsE,GAAqB,EAE7B,CApDA,GAqDD,CAACvB,EAAYiJ,GAAI9D,GAAwB7D,EAAmBgK,EAAAA,MAE/DvO,EAAAA,EAAAA,WAAU,KACN,IAAKiE,EAAc,OAEnB,MAAMkI,EAASlI,EAAakI,OAE5BlE,GAAgBuG,IAAIP,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAUO,GAAI,IAAE,CAACrC,GAAS,KAC9ChE,GAAmBqG,IAAIP,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAUO,GAAI,IAAE,CAACrC,IAAS,KACjD7H,EAAYkK,IAAIP,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAUO,GAAI,IAAE,CAACrC,GAAS,MAE1CgC,GAAiBhC,EAAQ,GAEElP,WACvB,IACI,MAAM+R,QAAsBC,EAAAA,EAAAA,IAAiB9C,EAAQlI,EAAatB,KAAMM,EAAYiJ,IACpFjG,GAAiB+I,EACrB,CAAE,MAAOxQ,GACLC,QAAQD,MAAM,kCAAmCA,GACjDyH,GAAiB,KACrB,GAEJiJ,IAED,CAACjL,EAAchB,EAAYiJ,KAE9B,MAAMiD,IAAoBf,EAAAA,EAAAA,aAAY,CAACjC,EAAQhI,KAC3CP,EAAY4K,IACR,MAAMY,EAAc7M,IAChB,GAAIA,EAAK4J,SAAWA,EAAQ,CACxB,MAAMkD,EAAclL,GAA4B,YAAjBA,EAAQxB,OAAuBwB,EAAQmL,WAAanL,EAAQoL,SAAWtM,EAAYiJ,KAAkB,OAAZjI,QAAY,IAAZA,OAAY,EAAZA,EAAckI,UAAWA,EAE3IqD,EAAe,CACjBC,YAAatL,EAAWA,EAAQlJ,UAAYkJ,EAAQvH,QAAW,GAC/D8S,gBAAiBvL,EAAUA,EAAQxB,KAAKgN,cAAgB,KACxDC,oBAAqBzL,EAAUA,EAAQoL,OAAS,MAGpD,OAAAtB,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACO1L,GAAI,IACPkN,YAAatL,GAAU0L,EAAAA,EAAAA,IAAwBL,EAAcvM,EAAYiJ,IAAM,eAC/E2B,sBAA6B,OAAP1J,QAAO,IAAPA,OAAO,EAAPA,EAAS2L,YAAa,IAAIlC,KAAK,GAAGmC,cACxD7B,oBAAqB3L,EAAK2L,oBAAsB,IAAMmB,EAAc,EAAI,IAEhF,CACA,OAAO9M,GAMX,MAAO,CAAEsB,OAHS2K,EAAK3K,OAAOmK,IAAIoB,GAGNtL,iBAFT0K,EAAK1K,iBAAiBkK,IAAIoB,OAIlD,CAACnM,EAAYiJ,GAAIjI,IAGd+L,IAAoB5B,EAAAA,EAAAA,aAAa6B,IACnC,MAAMC,EAAY7F,GAAiBnK,QAC7BiQ,GAAwBD,GACvBA,EAAUhD,aAAegD,EAAUpB,UAAYoB,EAAUE,aAAgB,IAG1EC,EAAaC,KAAKC,MAAMN,EAAQ9R,MAItC,GAHAM,QAAQ/D,IAAI,oCAAqC,mCAAoC2V,GACrF5R,QAAQ/D,IAAI,8BAA+B2V,GAEnB,kBAApBA,EAAW1N,KAA0B,CACrC,MAAM,OAAE6N,EAAM,OAAErE,EAAM,WAAEsE,GAAeJ,EAoBvC,YAlBA/L,EAAYoM,IACR,MAAMC,EAAiC,WAAX,OAAZ1M,QAAY,IAAZA,OAAY,EAAZA,EAActB,MAAmB0N,EAAWO,QAAUzE,EAChE0E,EAAeH,EAAaC,IAAY,GACxCG,EAAYN,EAAOlV,cAEnByV,EAAkBF,EAAa7C,IAAI5R,IACrC,GAAIqU,EAAWlV,SAASa,EAAIO,WAAY,CACpC,GAAkB,SAAdmU,EACA,OAAA7C,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAY7R,GAAG,IAAEoU,OAAQ,SAE7B,GAAkB,cAAdM,GAA4C,SAAf1U,EAAIoU,OACjC,OAAAvC,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAY7R,GAAG,IAAEoU,OAAQ,aAEjC,CACA,OAAOpU,IAEX,OAAA6R,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAYyC,GAAY,IAAE,CAACC,GAAUI,KAG7C,CAGA,GAAwB,eAApBV,EAAW1N,KAAuB,CAClC,MAAMqO,EAAYX,EAAWJ,QACvBgB,EAAcD,EAAUJ,UAAYI,EAAUzB,SAAWtM,EAAYiJ,GAAK8E,EAAUE,SAAWF,EAAUzB,QAK/G,aAHgB,OAAZtL,QAAY,IAAZA,OAAY,EAAZA,EAAckI,UAAW8E,GACzBhL,GAAiB+K,GAIzB,CAAO,GAAwB,iBAApBX,EAAW1N,KAAyB,CAC3C,MAAMwO,EAAed,EAAWJ,QAEhC,IAAIgB,EAWJ,OATIA,EADsB,UAAtBhN,EAAatB,KACCwO,EAAaP,QAEbO,EAAaC,WAAanO,EAAYiJ,GAC9CiF,EAAaE,WACbF,EAAaC,eAEP,OAAZnN,QAAY,IAAZA,OAAY,EAAZA,EAAckI,UAAW8E,GACzBhL,GAAiB,MAGzB,CAEA,MAAMqL,EAAkBjB,EAClBkB,EAAgBD,EAAgBV,UAAYU,EAAgB/B,SAAWtM,EAAYiJ,GAAKoF,EAAgBJ,SAAWI,EAAgB/B,QAEzI,IAAKgC,EAED,YADA9S,QAAQ+S,KAAK,2CAA4CF,GAI7D,GAAIA,EAAgBhC,WAAsC,YAAzBgC,EAAgB3O,KAwB7C,YAvBA2B,EAAYoM,IACR,MAAMG,EAAeH,EAAaa,IAAkB,GACpD,IAAIE,GAAiB,EAErB,GAAIZ,EAAavE,OAAS,EAAG,CACzB,MAAMmD,EAAcoB,EAAaA,EAAavE,OAAS,GACvDmF,EAAiBhC,EAAY9S,YAAc2U,EAAgB3U,WAAa8S,EAAYvD,KAAOoF,EAAgB3U,SAC/G,CAEA,MAAMoU,EAAkBF,EAAa7C,IAAI5R,GACjCA,EAAIO,YAAc2U,EAAgB3U,WAAaP,EAAI8P,KAAOoF,EAAgB3U,WAC1EsR,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAY7R,GAAG,IAAEuG,KAAM,UAAW/F,QAAS,2BAA4B3B,SAAU,KAAM8B,SAAU,KAAMuS,WAAW,IAE/GlT,GAGX,GAAIqV,EAAgB,CAChB,MAAMC,EAAiBX,EAAgBzE,OAAS,EAAIyE,EAAgBA,EAAgBzE,OAAS,GAAK,KAClG6C,GAAkBoC,EAAeG,EACrC,CAEA,OAAAzD,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAYyC,GAAY,IAAE,CAACa,GAAgBR,MAKnD,GAAIO,EAAgBK,SAwBhB,YAvBArN,EAAYoM,IACR,MAAMG,EAAeH,EAAaa,IAAkB,GAE9CR,EAAkBF,EAAa7C,IAAI5R,IACrC,GAAIA,EAAIO,YAAc2U,EAAgBpF,IAAM9P,EAAIO,YAAc2U,EAAgB3U,UAAW,CACrF,MAAMiV,GAAU3D,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACT7R,GAAG,IACNQ,QAAS0U,EAAgB1U,QACzB+U,UAAU,IAOd,OAJId,EAAavE,OAAS,GAAKuE,EAAaA,EAAavE,OAAS,GAAG3P,YAAcP,EAAIO,WACnFwS,GAAkBoC,EAAeK,GAG9BA,CACX,CAEA,OAAOxV,IAGX,OAAA6R,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAYyC,GAAY,IAAE,CAACa,GAAgBR,OAKnBrC,EAAAA,EAAAA,IAA+B4C,GAE/DhN,EAAYoM,IACR,MAAMG,EAAeH,EAAaa,IAAkB,GAC9CM,EAAgBP,EAAgB3U,WAAa2U,EAAgBpF,GAGnE,GAD6B2E,EAAaiB,KAAKC,GAAKA,EAAEpV,YAAckV,GAA8B,SAAbE,EAAEvB,QAEnF,OAAOE,EAGX,IAAIsB,EAAkB,IAAInB,GACtBoB,GAAmB,EACnBC,EAAwB,KAE5B,MAAMC,EAAcb,EAAgB/B,SAAWtM,EAAYiJ,IAAMoF,EAAgBc,UAC3EC,EAA0Bf,EAAgB/B,SAAWtM,EAAYiJ,KAAOoF,EAAgBc,UACxFE,EAAahB,EAAgB/B,SAAWtM,EAAYiJ,GAE1D,GAAIiG,EAAa,CACb,MAAMI,EAAkBP,EAAgBQ,UAAUT,GAAKA,EAAE7F,KAAOoF,EAAgBc,WAChF,GAAIG,GAAmB,EAAG,CACtB,MAAME,GAA2B/D,EAAAA,EAAAA,IAA+B4C,GAChEU,EAAgBO,IAAgBtE,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAQ+D,EAAgBO,IAAqBE,GAAwB,IAAEjC,OAAQ,SAC/G0B,EAAwBF,EAAgBO,GACxCN,GAAmB,CACvB,CACJ,MAAO,GAAII,EAAyB,CAChC,MAAME,EAAkBP,EAAgBU,cAAcX,GAAkB,YAAbA,EAAEvB,QAAwBuB,EAAExC,SAAWtM,EAAYiJ,IAC9G,GAAIqG,GAAmB,EAAG,CACtB,MAAME,GAA2B/D,EAAAA,EAAAA,IAA+B4C,GAChEU,EAAgBO,IAAgBtE,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAQ+D,EAAgBO,IAAqBE,GAAwB,IAAEjC,OAAQ,SAC/G0B,EAAwBF,EAAgBO,GACxCN,GAAmB,CACvB,MAAO,IAAKpB,EAAaiB,KAAKC,GAAKA,EAAEpV,YAAckV,GAAgB,CAC/D,MAAMc,GAAejE,EAAAA,EAAAA,IAA+B4C,GACpDU,EAAgBY,KAAKD,GACrBT,EAAwBS,EACxBV,GAAmB,CACvB,CACJ,MAAO,GAAIK,IACFzB,EAAaiB,KAAKC,GAAKA,EAAEpV,YAAckV,GAAgB,CACxD,MAAMc,GAAejE,EAAAA,EAAAA,IAA+B4C,GACpDU,EAAgBY,KAAKD,GACrBT,EAAwBS,EACxBV,GAAmB,EAEf3J,IACAG,GAAoBoK,GAAaA,EAAY,EAErD,CAGJ,OAAIZ,GACA9C,GAAkBoC,EAAeW,IACjCjE,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAYyC,GAAY,IAAE,CAACa,GAAgBS,KAGxCtB,IAEQL,EAAWd,SAAWtM,EAAYiJ,KAAOmE,EAAWsB,WAAatB,EAAWf,WAAiC,YAApBe,EAAW1N,MACrGwN,GACdnE,WAAW,IAAMa,GAAe,UAAW,MAEhD,CAAC5J,EAAYiJ,GAAIiD,GAAmBlL,EAAcqE,KAE/CwK,IAAWrH,EAAAA,EAAAA,SAAQ,IAAM,IACxB9H,EAASG,iBAAiBiP,OAAOC,GAAQA,EAAK7G,UAAsB,OAAXlJ,QAAW,IAAXA,OAAW,EAAXA,EAAaiJ,QACtEvI,EAASE,QACd4J,KAAK,CAACC,EAAGC,IAAM,IAAIC,KAAKD,EAAEE,sBAAwB,IAAID,KAAKF,EAAEG,uBAAwB,CAAClK,EAAUV,EAAYiJ,MAE9GlM,EAAAA,EAAAA,WAAU,KACN,MAAMiT,EAAcH,GAASI,OAAO,CAACC,EAAK5Q,IAAS4Q,GAAO5Q,EAAK2L,oBAAsB,GAAI,GACzFjE,GAAmBgJ,IACpB,CAACH,GAAU7I,KAEd,MAAMmJ,IAAoBhF,EAAAA,EAAAA,aAAa6B,IACnC,MAAMoD,EAAe/C,KAAKC,MAAMN,EAAQ9R,MAExC,GAAIkV,EAAajC,WAAanO,EAAYiJ,GAAI,OAE9C,MAAMoH,EAAkC,SAAtBD,EAAa1Q,KAAkB0Q,EAAazC,QAAUyC,EAAajC,SACrF,IAAKkC,EAAW,OAChB,MAAMC,EAAiBT,GAASU,KAAKC,GAAKA,EAAEtH,SAAWkH,EAAajC,UAC9DsC,GAA2B,OAAdH,QAAc,IAAdA,OAAc,EAAdA,EAAgBzQ,OAAQ,UAE3CiF,GAAeyG,IACX,MAAMmF,GAAc1F,EAAAA,EAAAA,GAAA,GAAQO,GAmB5B,OAjBIjE,GAAiBrK,QAAQoT,IACzB/G,aAAahC,GAAiBrK,QAAQoT,IAGtCD,EAAaO,QACbD,EAAeL,GAAU,GAAA5X,OAAMgY,EAAU,iBACzCnJ,GAAiBrK,QAAQoT,GAAatH,WAAW,KAC7CjE,GAAe8L,IACX,MAAMC,GAAO7F,EAAAA,EAAAA,GAAA,GAAQ4F,GAErB,cADOC,EAAQR,GACRQ,KAEZ,aAGIH,EAAeL,GAEnBK,KAEZ,CAAC1Q,EAAYiJ,GAAI4G,KAEdiB,IAAkB3F,EAAAA,EAAAA,aAAa6B,IACjC,MAAM+D,EAAkB1D,KAAKC,MAAMN,EAAQ9R,OACnC2F,iBAAkBmQ,EAAgBpQ,OAAQqQ,IAAkB3G,EAAAA,EAAAA,IAA4ByG,EAAiB/Q,EAAYiJ,IAE7HtI,EAAY4K,IAAIP,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACTO,GAAI,IACP1K,iBAAkB0K,EAAK1K,iBAAiBkK,IAAImG,IACxC,MAAMC,EAASH,EAAeT,KAAKa,GAAOA,EAAIlI,SAAWgI,EAAGhI,QAC5D,OAAOiI,GAAMnG,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAQkG,GAAOC,GAAWD,IAE3CtQ,OAAQ2K,EAAK3K,OAAOmK,IAAIsG,IACpB,MAAMF,EAASF,EAAcV,KAAKe,GAAMA,EAAGpI,SAAWmI,EAAEnI,QACxD,OAAOiI,GAAMnG,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAQqG,GAAMF,GAAWE,QAG/C,CAACrR,EAAYiJ,MAEhBlM,EAAAA,EAAAA,WAAU,KACNqL,GAAqBnL,QAAU8P,MAGnChQ,EAAAA,EAAAA,WAAU,MACDuE,GAAqB8F,GAAiBnK,SACvC2M,GAAe,SAEpB,CAACtI,EAAmBN,KAGvBjE,EAAAA,EAAAA,WAAU,KACN,GAAgB,OAAXiD,QAAW,IAAXA,IAAAA,EAAaiJ,KAAO1E,GAAiB,OAE1C,GAAI8C,GAAYpK,QACZ,OAGJ,MAAMsU,EAAQC,aAAaC,QAAQ,eAC7BC,EAAS,gEAAAjZ,OAAmEuH,EAAYiJ,GAAE,WAAAxQ,OAAU8Y,GACpGI,EAAS,IAAIC,EAAAA,EAAO,CACtBF,YACAG,eAAgB,IAChBC,UAAWA,KACPpN,IAAe,GACf,MAAMqN,EAAkB/E,IAChB5E,GAAqBnL,SACrBmL,GAAqBnL,QAAQ+P,IAkBrC1E,GAAcrL,QAAiB,QAAI0U,EAAOK,UAAU,sBAAuBlB,IAC3ExI,GAAcrL,QAAiB,QAAI0U,EAAOK,UAAU,sBAAuBD,GAC3EzJ,GAAcrL,QAAQ,eAAiB0U,EAAOK,UAAU,0BAA2BD,GACnFzJ,GAAcrL,QAAQ,aAAe0U,EAAOK,UAAU,uBAAwBD,GAC9EzJ,GAAcrL,QAAkB,SAAI0U,EAAOK,UAAU,kBAlB5BhF,IACrB,MAAMiF,EAAe5E,KAAKC,MAAMN,EAAQ9R,MACpC+W,EAAaC,SAAWlS,EAAYiJ,IAExCtI,EAAY4K,IACR,MAAM4G,EAAkB5G,EAAK1K,iBAAiBkK,IAAIzL,GAC1CA,EAAK4J,SAAW+I,EAAaC,QAC7BlH,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAY1L,GAAI,IAAE8S,SAAUH,EAAaG,WAEtC9S,GAEX,OAAA0L,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAYO,GAAI,IAAE1K,iBAAkBsR,QAQ5C7J,GAAcrL,QAAgB,OAAI0U,EAAOK,UAAU,4BAA6B7B,KAEpFkC,iBAAmB9W,GAAUC,QAAQD,MAAM,mBAAoBA,GAC/D+W,aAAeC,GAAU/W,QAAQD,MAAM,eAAgBgX,EAAMC,QAAiB,QAAGD,EAAMrX,MACvFuX,iBAAkBA,KACd/N,IAAe,MAOvB,OAHAiN,EAAOe,WACPrL,GAAYpK,QAAU0U,EAEf,KAAO,IAADgB,EAAAC,EACT,GAAI5R,GAAmC,QAAvB2R,EAAItL,GAAYpK,eAAO,IAAA0V,GAAnBA,EAAqBE,OAAQ,CAC7C,MAAMC,EAAW,uBAAAra,OAA0BuI,EAAakI,QACxD7B,GAAYpK,QAAQ8V,QAAQ,CAAED,cAAa5X,KAAM,OACjDM,QAAQ/D,IAAI,2BAADgB,OAA4BuI,EAAakI,OAAM,0BAC9D,CAEuB,QAAvB0J,EAAIvL,GAAYpK,eAAO,IAAA2V,GAAnBA,EAAqBC,SACrBxL,GAAYpK,QAAQ+V,aACpB3L,GAAYpK,QAAU,KACtBzB,QAAQ/D,IAAI,qDAGrB,CAAY,OAAXuI,QAAW,IAAXA,OAAW,EAAXA,EAAaiJ,GAAI1E,GAAiBvD,IAEtC,MAAMiS,IAAWzK,EAAAA,EAAAA,SAAQ,KACb9H,EAASE,QAAU,IAAImK,IAAIsG,GAAKA,EAAEnI,QAAQsB,OAAO0I,KAAK,KAC/D,CAACxS,EAASE,UAGb7D,EAAAA,EAAAA,WAAU,KAAO,IAADoW,EACZ,IAAK1O,IAAmC,QAApB0O,EAAC9L,GAAYpK,eAAO,IAAAkW,IAAnBA,EAAqBN,OAAQ,OAElD,MAAMd,EAAkB/E,IAChB5E,GAAqBnL,SACrBmL,GAAqBnL,QAAQ+P,IAI/BoG,EAAmB,IAAIC,KAAK3S,EAASE,QAAU,IAAImK,IAAIsG,GAAKA,EAAEnI,OAAOnL,aACrEuV,EAAiBC,OAAOC,KAAKlL,GAAcrL,SAC3CwW,EAAqB,IAAIJ,IAAIC,EAAexD,OAAO4D,GAAOA,EAAIC,WAAW,WAAW5I,IAAI2I,GAAOA,EAAIE,QAAQ,SAAU,MAE3HH,EAAmBI,QAAQlG,IACvB,IAAKyF,EAAiBU,IAAInG,GAAU,CAChC,MAAMoG,EAAK,SAAAtb,OAAYkV,GACnBrF,GAAcrL,QAAQ8W,KACtBzL,GAAcrL,QAAQ8W,GAAOC,qBACtB1L,GAAcrL,QAAQ8W,GAErC,IAGJX,EAAiBS,QAAQlG,IACrB,IAAK8F,EAAmBK,IAAInG,GAAU,CAClC,MAAMoG,EAAK,SAAAtb,OAAYkV,GACvBrF,GAAcrL,QAAQ8W,GAAS1M,GAAYpK,QAAQ+U,UAAU,eAADvZ,OAAgBkV,GAAWoE,GACvF,MAAMkC,EAAW,gBAAAxb,OAAmBkV,GACpCrF,GAAcrL,QAAQgX,GAAe5M,GAAYpK,QAAQ+U,UAAU,wBAADvZ,OAAyBkV,GAAWwC,GAC1G,KAGL,CAAC1L,GAAawO,GAAUvS,EAASE,OAAQmD,GAAc/D,EAAYiJ,KAGtE,MAAMiL,IAAW/I,EAAAA,EAAAA,aAAYnR,UAAuB,IAADma,EAC/C,GAAgB,OAAXnU,QAAW,IAAXA,IAAAA,EAAaiJ,IAA0B,QAApBkL,EAAC9M,GAAYpK,eAAO,IAAAkX,IAAnBA,EAAqBtB,OAC1C,OAEJ,MAAMC,EAAW,sBAAAra,OAAyB2b,EAAWlL,QAC/C8D,EAAU,CACZkF,OAAQlS,EAAYiJ,GACpBvJ,KAA0B,UAApB0U,EAAW1U,KAAmB,OAAS,WAIjD,GAFA2H,GAAYpK,QAAQ8V,QAAQ,CAAED,cAAa5X,KAAMmS,KAAKgH,UAAUrH,KAExC,UAApBoH,EAAW1U,OAAqByE,GAAkBiQ,EAAWlL,QAC7D,IAAK,IAADoL,EACA,MAAMC,QAA4BC,EAAAA,EAAAA,IAAgBJ,EAAWlL,QACvDuL,GAA6B,OAAnBF,QAAmB,IAAnBA,GAAwB,QAALD,EAAnBC,EAAsB,UAAE,IAAAD,OAAL,EAAnBA,EAA0BI,YAAa,GACnDD,EAAQpL,OAAS,GACjBjF,GAAqBuQ,IAAS3J,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACvB2J,GAAS,IACZ,CAACP,EAAWlL,QAASuL,IAGjC,CAAE,MAAOlZ,GACLC,QAAQD,MAAM,iCAAkCA,EACpD,CAGJ0F,EAAgBmT,GAChB3S,GAAc,GAEd,MAAMmT,EAAM,SAAAnc,OAAYuH,EAAYiJ,GAAE,aAAAxQ,OAAY2b,EAAWlL,QAC7DxO,OAAOma,QAAQC,UAAU,CAAEC,KAAMH,GAAU,GAAIA,IAEhD,CAAC5U,EAAYiJ,GAAI9E,KAGd6Q,IAAY7J,EAAAA,EAAAA,aAAY,KAAO,IAAD8J,EAGhC,GAFAhN,GAAkBhL,SAAU,GAEvB+D,GAA4B,OAAXhB,QAAW,IAAXA,IAAAA,EAAaiJ,GAE/B,YADAhB,GAAkBhL,SAAU,GAIhC,GAAuB,QAAvBgY,EAAI5N,GAAYpK,eAAO,IAAAgY,GAAnBA,EAAqBpC,OAAQ,CAC7B,MAAMC,EAAW,uBAAAra,OAA0BuI,EAAakI,QACxD7B,GAAYpK,QAAQ8V,QAAQ,CAAED,cAAa5X,KAAM,MACrD,CAEA+F,EAAgB,MAChBQ,GAAc,GACd6D,IAAsB,GACtBE,GAAoB,GAEpB,MAAMoP,EAAM,SAAAnc,OAAYuH,EAAYiJ,IACpCzI,EAASoU,IAEV,CAAC5T,EAAchB,EAAYiJ,GAAIzI,IAG5B0U,IAAmB/J,EAAAA,EAAAA,aAAa7L,IAAU,IAAD6V,EAC3C,GAAInU,GAAgBA,EAAakI,SAAW5J,EAAK4J,QAA6B,QAAvBiM,EAAI9N,GAAYpK,eAAO,IAAAkY,GAAnBA,EAAqBtC,OAAQ,CACpF,MAAMC,EAAW,uBAAAra,OAA0BuI,EAAakI,QACxD7B,GAAYpK,QAAQ8V,QAAQ,CAAED,cAAa5X,KAAM,OACjDM,QAAQ/D,IAAI,0CAADgB,OAA2CuI,EAAakI,QACvE,CAEI5J,EAAK2L,mBAAqB,GAC1BtK,EAAY4K,IACR,MAAM6J,EAAwB,UAAd9V,EAAKI,KAEf2V,GADOD,EAAU7J,EAAK3K,OAAS2K,EAAK1K,kBACjBkK,IAAIyF,GACzBA,EAAEtH,SAAW5J,EAAK4J,QAAM8B,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAQwF,GAAC,IAAEvF,mBAAoB,IAAMuF,GAEjE,OAAO4E,GAAOpK,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACHO,GAAI,IAAE3K,OAAQyU,KAAWrK,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACzBO,GAAI,IAAE1K,iBAAkBwU,MAI3CnB,GAAS5U,GACTyB,EAAc,KAEf,CAACmT,GAAUlT,KAIdjE,EAAAA,EAAAA,WAAU,KACN,MAAMuY,EAAqBA,KACvB,GAAItU,GAAgBqG,GAAYpK,SAAWoK,GAAYpK,QAAQ4V,OAAQ,CACnE,MAAMC,EAAW,uBAAAra,OAA0BuI,EAAakI,QACxD7B,GAAYpK,QAAQ8V,QAAQ,CAAED,cAAa5X,KAAM,MACrD,GAGJ,OADAR,OAAO6C,iBAAiB,eAAgB+X,GACjC,IAAM5a,OAAO8C,oBAAoB,eAAgB8X,IACzD,CAACtU,KAEJjE,EAAAA,EAAAA,WAAU,KACiB/C,WACnB,GAAK2J,IAAyB3C,GAAsC,UAAtBA,EAAatB,KAA3D,CAIAwE,IAAsB,GACtBoC,IAAuB,GAEvB,IACI,GAA2B,YAAvBzC,IAA4D,IAAxBE,GAAasF,OAAc,CAC/D,MAAMkL,QAA4BC,EAAAA,EAAAA,IAAgBxT,EAAakI,QACzDqM,EAAcC,MAAMC,QAAQlB,IAAwBA,EAAoBlL,OAAS,EAAIkL,EAAoB,GAAK,KACpHvQ,IAA2B,OAAXuR,QAAW,IAAXA,OAAW,EAAXA,EAAab,YAAa,GAC9C,MAAO,GAA2B,UAAvB7Q,IAAwD,IAAtBkC,GAAWsD,OAAc,CAClE,MAAMqM,QAAcC,EAAAA,EAAAA,IAAmB3U,EAAakI,OAAQ,SAC5DlD,GAAc0P,EAAM3K,IAAIU,EAAAA,IAC5B,MAAO,GAA2B,UAAvB5H,IAAwD,IAAtBoC,GAAWoD,OAAc,CAClE,MAAMuM,QAAcD,EAAAA,EAAAA,IAAmB3U,EAAakI,OAAQ,SAC5DhD,GAAc0P,EAAM7K,IAAIU,EAAAA,IAC5B,MAAO,GAA2B,UAAvB5H,IAAwD,IAAtBsC,GAAWkD,OAAc,CAClE,MAAMwM,QAAcF,EAAAA,EAAAA,IAAmB3U,EAAakI,OAAQ,SAC5D9C,GAAcyP,EAClB,CACJ,CAAE,MAAOta,GACLC,QAAQD,MAAM,sCAAuCsI,GAAoBtI,EAC7E,CAAC,QACG2I,IAAsB,GACtBoC,IAAuB,EAC3B,CAzBA,GA4BJwP,IACD,CAACnS,GAAsBE,GAAoB7C,KAE9CjE,EAAAA,EAAAA,WAAU,KACN,MAAMgZ,EAAsBC,IAAW,IAADC,EAAAC,EAAAC,GAC9BzU,IAAmBiG,GAAe1K,SAAY0K,GAAe1K,QAAQmZ,SAASJ,EAAMK,SAAkC,QAAvBJ,EAACrO,GAAe3K,eAAO,IAAAgZ,GAAtBA,EAAwBG,SAASJ,EAAMK,SAAS1U,GAAmB,IACnKG,IAAgB+F,GAAY5K,SAAY4K,GAAY5K,QAAQmZ,SAASJ,EAAMK,SAAqC,QAA1BH,EAACpO,GAAkB7K,eAAO,IAAAiZ,GAAzBA,EAA2BE,SAASJ,EAAMK,SAAStU,GAAgB,GAC1JG,EAAYE,SAAW2F,GAAe9K,UAAY8K,GAAe9K,QAAQmZ,SAASJ,EAAMK,SAASlU,EAAe,CAAEC,SAAS,EAAOC,EAAG,EAAGC,EAAG,EAAGpB,QAAS,KAAMqB,MAAO,QACpKgB,KAAkB2E,GAAcjL,SAAYiL,GAAcjL,QAAQmZ,SAASJ,EAAMK,SAAuC,QAA5BF,EAAChO,GAAoBlL,eAAO,IAAAkZ,GAA3BA,EAA6BC,SAASJ,EAAMK,SAAS7S,IAAkB,IAG5K,OADA1I,SAASyC,iBAAiB,YAAawY,GAChC,IAAMjb,SAAS0C,oBAAoB,YAAauY,IACxD,CAACrU,EAAiBI,EAAcI,EAAYE,QAASmB,KAGxD,MAAM+S,GAAoBC,IAAc,IAADC,EACnC,GAAwB,QAApBA,EAACnP,GAAYpK,eAAO,IAAAuZ,IAAnBA,EAAqB3D,SAAW7R,EAAc,OAEnD,MAAMgM,EAAU,CACZmB,SAAUnO,EAAYiJ,GACtB0H,OAAQ4F,EACR7W,KAA4B,UAAtBsB,EAAatB,KAAmB,OAAS,UAC/C0O,WAAkC,YAAtBpN,EAAatB,KAAqBsB,EAAakI,OAAS,KACpEyE,QAA+B,UAAtB3M,EAAatB,KAAmBsB,EAAakI,OAAS,MAGnE7B,GAAYpK,QAAQ8V,QAAQ,CACxBD,YAAa,cACb5X,KAAMmS,KAAKgH,UAAUrH,MAKvByJ,GAAoBA,KACtB,IAAKvV,EAAQ2H,SAAW7H,EAAc,OAEtCsV,IAAiB,GAEjB,MAAMI,EAAW/L,KAAKgM,MAAM5Y,WAAaxG,KAAKqf,SAAS7Y,SAAS,IAAI8Y,UAAU,EAAG,GAC3EC,EAAyB,OAAfnU,EAEVoU,EAAoB,CACtB9N,GAAIyN,EACJhd,UAAWgd,EACXpK,OAAQtM,EAAYiJ,GACpBtP,QAASuH,EACT2L,WAAW,IAAIlC,MAAOmC,cACtBS,OAAQ,UACR7N,KAAM,OACN1H,SAAU,KACV8B,SAAU,KACV4U,UAAU,EACVsI,QAASrU,EACTsU,aAAa,GASjB,IAAInE,EACA9F,EAPJd,GAAkBlL,EAAakI,OAAQ6N,GACvC1V,EAAYkK,IAAIP,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACTO,GAAI,IACP,CAACvK,EAAakI,QAAS,IAAKqC,EAAKvK,EAAakI,SAAW,GAAK6N,MAM9DD,GACAhE,EAAc,aACd9F,EAAU,CACNkK,iBAAkBvU,EAAWjJ,UAC7B4S,OAAQtM,EAAYiJ,GACpBtP,QAASuH,EACTwV,SAAUA,EACVzI,SAAgC,YAAtBjN,EAAatB,KAAqBsB,EAAakI,OAAS,KAClEyE,QAA+B,UAAtB3M,EAAatB,KAAmBsB,EAAakI,OAAS,KAC/DxJ,KAA4B,UAAtBsB,EAAatB,KAAmB,OAAS,aAGnDoT,EAAc,YACd9F,EAAU,CACNV,OAAQtM,EAAYiJ,GACpBtP,QAASuH,EACTxB,KAA4B,UAAtBsB,EAAatB,KAAmB,OAAS,UAC/CuO,SAAgC,YAAtBjN,EAAatB,KAAqBsB,EAAakI,OAAS,KAClEyE,QAA+B,UAAtB3M,EAAatB,KAAmBsB,EAAakI,OAAS,KAC/DwN,SAAUA,IAIlBrP,GAAYpK,QAAQ8V,QAAQ,CAAED,cAAa5X,KAAMmS,KAAKgH,UAAUrH,KAEhE7L,EAAW,IACXQ,GAAmB,GACnBiB,EAAc,MACdmG,WAAW,IAAMa,GAAe,UAAW,MA0EzCuN,GAAiBA,KACnBC,UAAUC,aAAaC,aAAa,CAAEta,OAAO,IACxCmM,KAAKoO,IACF/b,QAAQ/D,IAAI,iDACZoK,GAAe,GAEf6F,GAAUzK,QAAUsa,EAEpB9P,GAAexK,QAAU,GACzB,MAAMua,EAAgB,IAAIC,cAAcF,GACxC/P,GAAiBvK,QAAUua,EAE3BA,EAAcE,gBAAmB1B,IAC7BvO,GAAexK,QAAQ0S,KAAKqG,EAAM2B,OAGtCH,EAAcI,OAAS5d,UACnBwB,QAAQ/D,IAAI,mDACZ,MAAMogB,EAAY,IAAIC,KAAKrQ,GAAexK,QAAS,CAAEyC,KAAM,eAE3D,IAAKsB,EAAc,OAEnB,MAAM+W,EAAY,IAAIC,KAAK,CAACH,GAAW,iBAADpf,OAAmBkS,KAAKgM,MAAK,SAAS,CACxEjX,KAAM,aACNuY,aAActN,KAAKgM,QAGjBuB,EAAS,IAAIC,WACnBD,EAAOE,cAAcL,GACrBG,EAAOG,UAAYre,UACf,MAAMse,EAAeJ,EAAOK,OAAOpgB,MAAM,KAAK,GACxCue,EAAW/L,KAAKgM,MAAM5Y,WAAaxG,KAAKqf,SAAS7Y,SAAS,IAAI8Y,UAAU,EAAG,GAC3E2B,EAAkB7d,IAAIC,gBAAgBmd,GAEtChB,EAAoB,CACtB9N,GAAIyN,EAAUhd,UAAWgd,EAAUpK,OAAQtM,EAAYiJ,GACvDtP,QAAS6e,EAAiB3L,WAAW,IAAIlC,MAAOmC,cAChDS,OAAQ,UAAW7N,KAAM,QAAS1H,SAAU+f,EAAUlY,KACtD/F,SAAUie,EAAUpc,KAAMI,QAASyc,EAAiB9J,UAAU,EAC9DjS,SAAU,GAGdyP,GAAkBlL,EAAakI,OAAQ6N,GACvC1V,EAAYkK,IAAIP,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAUO,GAAI,IAAE,CAACvK,EAAakI,QAAS,IAAKqC,EAAKvK,EAAakI,SAAW,GAAK6N,MAE9F,MAAM0B,EAAY,CACdnM,OAAQtM,EAAYiJ,GAAIyN,SAAUA,EAClCgC,SAAUX,EAAUrY,KAAM1H,SAAU+f,EAAUlY,KAC9C8Y,SAAUL,EAAc5Y,KAA4B,UAAtBsB,EAAatB,KAAmB,OAAS,UACvEiO,QAA+B,UAAtB3M,EAAatB,KAAmBsB,EAAakI,OAAS,KAC/D+E,SAAgC,YAAtBjN,EAAatB,KAAqBsB,EAAakI,OAAS,KAClEzM,SAAU,GAGd,UACUmc,EAAAA,EAAAA,GAAmBH,EAC7B,CAAE,MAAOld,GACLC,QAAQD,MAAM,+BAAgCA,GAC9C8F,EAAYkK,IACR,MACMsN,GADetN,EAAKvK,EAAakI,SAAW,IACjB6B,IAAI+D,GAAKA,EAAE7F,KAAOyN,GAAQ1L,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAQ8D,GAAC,IAAEvB,OAAQ,WAAauB,GAC3F,OAAA9D,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAYO,GAAI,IAAE,CAACvK,EAAakI,QAAS2P,KAEjD,IAIRrB,EAAcsB,UAEjBva,MAAOtE,IACJuB,QAAQD,MAAM,gCAAiCtB,GAC/C4H,GAAe,GACfkX,MAAM,4DAIZC,GAAgBA,KAClBxd,QAAQ/D,IAAI,6BACR+P,GAAiBvK,SAA8C,cAAnCuK,GAAiBvK,QAAQgc,OACrDzR,GAAiBvK,QAAQic,OAEzBxR,GAAUzK,SACVyK,GAAUzK,QAAQkc,YAAYtF,QAAQuF,GAASA,EAAMF,QAEzDrX,GAAe,IAiBbwX,IAAsBlO,EAAAA,EAAAA,aAAYnR,MAAO8B,EAAK9D,EAAUge,KACtDA,IACAA,EAAM7b,kBACN6b,EAAM9b,kBAEV,IACI,MAAME,QAAiBC,MAAMyB,GAC7B,IAAK1B,EAASE,GACV,MAAM,IAAIC,MAAM,+BAEpB,MAAMC,QAAaJ,EAASI,OACtBC,EAAUC,OAAOC,IAAIC,gBAAgBJ,GACrCK,EAAOC,SAASC,cAAc,KACpCF,EAAKG,KAAOP,EACZI,EAAKI,aAAa,WAAYjD,GAAY,YAC1C8C,SAASI,KAAKC,YAAYN,GAC1BA,EAAKO,QACLP,EAAKQ,SACLX,OAAOC,IAAIW,gBAAgBb,EAC/B,CAAE,MAAOc,GACLC,QAAQD,MAAM,mBAAoBA,GAClCb,OAAOe,KAAKK,EAAK,SACrB,GACD,IAQGwd,GAAiBA,KAAO,IAADC,EACzB,MAAMC,EAAiBtY,EAAQ2H,OAE/B,GAAuB,KAAnB2Q,GAA+C,OAAtBhX,EAAYD,OAAsC,QAApBgX,EAAClS,GAAYpK,eAAO,IAAAsc,IAAnBA,EAAqB1G,OAE7E,YADA4G,KAIJ,MAAMvQ,EAASlI,EAAakI,OACtBwQ,EAAkBtY,EAAS8H,GAC3ByQ,EAAgBD,EAAgBlX,EAAYD,OAC5C7I,EAAYigB,EAAcjgB,UAEhC,GAAI8f,IAAmBhX,EAAYE,iBAAwC,kBAAdhJ,EAEzD,YADA+f,KAIJ,MAAMG,GAAwB5O,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACvB2O,GAAa,IAChBhgB,QAAS6f,EACT9K,UAAU,IAGRmL,EAAsBH,EAAgB3O,IAAI,CAAC5R,EAAKoJ,IAClDA,IAAUC,EAAYD,MAAQqX,EAA2BzgB,GAG7DkI,EAAYkK,IAAIP,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACTO,GAAI,IACP,CAACrC,GAAS2Q,KAGVrX,EAAYD,QAAUmX,EAAgBrQ,OAAS,GAC/C6C,GAAkBhD,EAAQ0Q,GAG9B,MAAM5M,EAAU,CACZtT,UAAWA,EACXC,QAAS6f,EACTlN,OAAQtM,EAAYiJ,IAKxB5B,GAAYpK,QAAQ8V,QAAQ,CACxBD,YAHgB,YAIhB5X,KAAMmS,KAAKgH,UAAUrH,KAGzByM,MAGEA,GAAaA,KAAQhX,EAAe,CAAEF,MAAO,KAAMG,gBAAiB,KAAOvB,EAAW,KAGtF2Y,GAAe9f,UACjB,MAAMkP,EAASlI,EAAakI,OACtBwQ,EAAkB,IAAKtY,EAAS8H,IAAW,IAC3C6Q,EAAkBL,EAAgBxX,EAAYK,OAC9C7I,EAA2B,OAAfqgB,QAAe,IAAfA,OAAe,EAAfA,EAAiBrgB,UAEnC,IAAKA,GAAkC,kBAAdA,GAAqD,YAA3BqgB,EAAgBxM,QAAmD,WAA3BwM,EAAgBxM,OAGvG,OAFA/R,QAAQD,MAAM,oDAAqD7B,EAAWqgB,EAAgBxM,aAC9FpL,EAAe,CAAEC,SAAS,EAAOC,EAAG,EAAGC,EAAG,EAAGpB,QAAS,KAAMqB,MAAO,OAIvE,IACI,GAAIyX,QACMC,EAAAA,EAAAA,IAAyBvgB,EAAWsG,EAAYiJ,QACnD,OACGiR,EAAAA,EAAAA,IAAmBxgB,EAAWsG,EAAYiJ,IAChD,MAAMkR,EAAeT,EAAgB5J,OAAO,CAACsK,EAAG9iB,IAAMA,IAAM4K,EAAYK,OACxElB,EAAYkK,IAAIP,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAUO,GAAI,IAAE,CAACrC,GAASiR,KAC1C,MAAM1L,EAAiB0L,EAAa9Q,OAAS,EAAI8Q,EAAaA,EAAa9Q,OAAS,GAAK,KACzF6C,GAAkBhD,EAAQuF,EAC9B,CACJ,CAAE,MAAOlT,GACLC,QAAQD,MAAM,4BAAD9C,OAA6BiB,EAAS,kBAAkB6B,EACzE,CAAC,QACG4G,EAAe,CAAEC,SAAS,EAAOC,EAAG,EAAGC,EAAG,EAAGpB,QAAS,KAAMqB,MAAO,MACvE,GAGE8X,GAAmBA,KAAQ,IAAKxX,GAAa,OAAQ,MAAM6W,EAAkB,IAAItY,EAASJ,EAAakI,SAAUwQ,EAAgB7W,GAAYN,OAASM,GAAY3B,QAASG,EAAYkK,IAAIP,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAUO,GAAI,IAAE,CAACvK,EAAakI,QAASwQ,KAAqB5W,GAAe,OA6BtQwX,GAAoBA,KAEtB,GADA9W,IAAkB,GACdT,GAAe,CACf,MAAMwX,EAAe3M,GAAa2B,UAAUT,GAAKA,EAAEpV,YAAcqJ,GAAcrJ,WAE/E,IAAsB,IAAlB6gB,EAAqB,CACrB,MAAMhR,EAAiBzO,SAAS0f,cAAc,wBAAD/hB,OAAyB8hB,EAAY,OAC9EhR,IACAA,EAAeE,eAAe,CAAEC,SAAU,SAAUC,MAAO,WAC3DJ,EAAekR,UAAUC,IAAI,gBAAiB,eAC9C3R,WAAW,IAAMQ,EAAekR,UAAUpf,OAAO,gBAAiB,eAAgB,MAE1F,CACJ,GAgDEsf,GAAuC,OAAtBhV,GAA6BA,GAAoBkK,IAGxE9S,EAAAA,EAAAA,WAAU,KACN,GAAIwL,IAAiBsH,GAASxG,OAAS,GAAK5E,KAAgBzD,EAAc,CACtE,GAAIiH,GAAkBhL,QAClB,OAGJ,MAAM2d,EAAe/K,GAASU,KAAKC,GAAKA,EAAEtH,OAAOnL,aAAewK,IAC5DqS,GACA1F,GAAiB0F,EAEzB,MAAYrS,KACRN,GAAkBhL,SAAU,IAEjC,CAAC4S,GAAUtH,GAAevH,EAAckU,GAAkBzQ,MAE7D1H,EAAAA,EAAAA,WAAU,KAAO,IAAD8d,EACZ,MAAMC,EAA8B,QAAjBD,EAAGva,EAAS2Y,aAAK,IAAA4B,OAAA,EAAdA,EAAgBC,cACtC,GAAIA,GAAiBvW,GAAiB,CACfsL,GAAShB,KAAKvP,GAAQA,EAAK4J,SAAW4R,EAAc5R,UAEnE1N,QAAQ/D,IAAI,0CAA2CqjB,GAEvDna,EAAYoa,IACR,MAAMC,EAAsB,CAACF,KAAkBC,EAASla,kBAExD,OAAAmK,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACO+P,GAAQ,IACXla,iBAAkBma,MAIlC,GACD,CAACzW,GAAiBsL,GAAUvP,EAAS2Y,QAExC,MAQMgC,GAAmBC,IACrB,IAAKA,EAAW,MAAO,GACvB,MAAMC,EAAO,IAAIxQ,KAAKuQ,EAAUE,SAAS,KAAOF,EAAYA,EAAY,KACxE,OAAIG,MAAMF,GAAc,GACjBA,EAAKG,mBAAmB,QAAS,CACpCC,KAAM,UACNC,OAAQ,UACRC,QAAQ,KAIVC,GAAoBR,IACtB,IAAKA,EAAW,MAAO,GACvB,MAAMC,EAAO,IAAIxQ,KAAKgR,OAAOT,GAAWE,SAAS,KAAOF,EAAYA,EAAY,KAChF,GAAIG,MAAMF,GAAO,MAAO,eACxB,MAAMS,EAAQ,IAAIjR,KACZkR,EAAY,IAAIlR,KAAKiR,GAE3B,OADAC,EAAUC,QAAQD,EAAUE,UAAY,GACpCZ,EAAKa,iBAAmBJ,EAAMI,eAAuB,QACrDb,EAAKa,iBAAmBH,EAAUG,eAAuB,YACtDb,EAAKc,mBAAmB,GAAI,CAAEC,KAAM,UAAWC,MAAO,OAAQC,IAAK,aAc9E,IAAIC,GAAkB,KAEtB,MAAMC,GAAkBtb,EAAe6O,GAASU,KAAKC,GAAKA,EAAEtH,SAAWlI,EAAakI,QAAU,KACxF0E,GAAe0O,IAAkBlb,EAASkb,GAAgBpT,SAAgB,GAE1EqT,GAAiBpO,IACnB,IAAKnO,EAAa,MAAO,CAAEH,KAAM,eAAgBF,QAAS,MAC1D,GAAIwO,IAAanO,EAAYiJ,GAAI,MAAO,CAAEpJ,KAAM,MAAOF,QAASK,EAAYL,SAE5E,IAAI6c,EAAS9b,EAASG,iBAAiB0P,KAAKzB,GAAKA,EAAE5F,SAAWiF,GAAYW,EAAE2N,aAAetO,GAC3F,OAAIqO,EACO,CAAE3c,KAAM2c,EAAO3c,MAAQ2c,EAAOE,YAAa/c,QAAS6c,EAAO7c,SAAW6c,EAAOG,eAAiB,OAE9E,WAAX,OAAZ3b,QAAY,IAAZA,OAAY,EAAZA,EAActB,OAAoByE,GAAkBnD,EAAakI,UACjEsT,EAASrY,GAAkBnD,EAAakI,QAAQqH,KAAKzB,GAAKA,EAAE2N,aAAetO,IAGxEqO,EACD,CAAE3c,KAAM2c,EAAO3c,MAAQ2c,EAAOE,YAAa/c,QAAS6c,EAAO7c,SAAW6c,EAAOG,eAAiB,MAC9F,CAAE9c,KAAM,eAAgBF,QAAS,QAGrCid,GAAczjB,IAChB,MAAM0jB,EAAUtjB,EAAAA,GAAQC,SAASC,QAEjC,GAAIN,EAAI4C,SAAW5C,EAAI4C,QAAQ4X,WAAW,SACtC,OAAOxa,EAAI4C,QAGf,GAAI5C,EAAI4C,SAAW5C,EAAI4C,QAAQ4X,WAAW,QAAS,CAC/C,MAAMmJ,EAAS,IAAIniB,IAAIkiB,GAASC,OAChC,MAAM,GAANrkB,OAAUqkB,GAAMrkB,OAAGU,EAAI4C,QAC3B,CAAO,GAAI5C,EAAI4C,QACX,OAAO5C,EAAI4C,QAGf,MAAMghB,EAAkB5jB,EAAI8P,IAAM9P,EAAIO,UACtC,OAAIqjB,EACM,GAANtkB,OAAUokB,EAAO,eAAApkB,OAAcskB,GAE5B5jB,EAAIQ,SAGf,OAEIC,EAAAA,EAAAA,MAAA,OAAK3B,UAAS,iBAAAQ,OAA6B,SAAVY,EAAmB,cAAgB,cAAa,cAAaQ,SAAA,EAE1FD,EAAAA,EAAAA,MAAA,OAAK3B,UAAU,yCAAwC4B,SAAA,EAEnDD,EAAAA,EAAAA,MAAA,OAAK3B,UAAS,+EAAAQ,OAAiF+I,EAAa,iBAAmB,OAAM,KAAA/I,OAAc,SAAVY,EAAmB,cAAgB,YAAaQ,SAAA,EAErLtB,EAAAA,EAAAA,KAAA,OAAKN,UAAU,qBAAoB4B,UAACtB,EAAAA,EAAAA,KAAA,SAAOmH,KAAK,OAAOsd,YAAY,wBAAwB/kB,UAAS,+FAAAQ,OAA2G,SAAVY,EAAmB,yCAA2C,8BAAgC4jB,MAAOnc,EAAYoc,SAAUjjB,GAAK8G,EAAc9G,EAAEoc,OAAO4G,YAE5VrjB,EAAAA,EAAAA,MAAA,OAAKsE,IAAKiJ,GAAkBgW,SA1xChBC,KACxB,MAAMnQ,EAAY9F,GAAiBlK,QACnC,GAAIgQ,EAAW,CACX,MAAM,UAAEpB,EAAS,aAAE5B,EAAY,aAAEkD,GAAiBF,EAC9ChD,EAAe4B,EAAYsB,EAAe,MAC1C3R,QAAQ/D,IAAI,yCAADgB,OAA0C4H,EAAc,eAAA5H,OAAc2H,IAC7EA,IAAYC,GACZF,IAGZ,GAgxCuElI,UAAU,4DAA2D4B,SAAA,CAC3HgM,IACGtN,EAAAA,EAAAA,KAAA,OAAKN,UAAU,gCAA+B4B,SAAC,iBAE/C8gB,GAAe5P,IAAIzL,IACf1F,EAAAA,EAAAA,MAAA,OAAuBG,QAASA,IAAMmb,GAAiB5V,GAAOrH,UAAS,yDAAAQ,QAAuE,OAAZuI,QAAY,IAAZA,OAAY,EAAZA,EAAckI,UAAW5J,EAAK4J,OAAS,kCAA+C,SAAV7P,EAAmB,oBAAsB,oBAAsBQ,SAAA,EACzQD,EAAAA,EAAAA,MAAA,OAAK3B,UAAU,yBAAwB4B,SAAA,CACpB,UAAdyF,EAAKI,MACFnH,EAAAA,EAAAA,KAAA,OACIwB,QAAUE,IACNA,EAAEE,kBACFuL,GAAkBpG,IAEtBrH,UAAS,4FAAAQ,OAAwG,SAAVY,EAAmB,cAAgB,eAAgBQ,UAE1JtB,EAAAA,EAAAA,KAACuH,EAAAA,IAAO,CAAC7H,UAAS,gBAAmB0D,KAAM,OAE/C2D,EAAKK,SACLpH,EAAAA,EAAAA,KAAA,OACIwB,QAAUE,IACNA,EAAEE,kBACFuL,GAAkBpG,IAEtBrH,UAAU,0DAAyD4B,UAEnEtB,EAAAA,EAAAA,KAAA,OAAKuD,IAAKwD,EAAKK,QAASC,IAAKN,EAAKO,KAAM5H,UAAU,+CAGtDM,EAAAA,EAAAA,KAAA,OAAKN,UAAS,2DAAAQ,OAAuE,SAAVY,EAAmB,cAAgB,eAAgBQ,UAC1HtB,EAAAA,EAAAA,KAAC8kB,EAAAA,IAAM,CAACplB,UAAS,gBAAmB0D,KAAM,OAGjD2D,EAAK8S,WAAa7Z,EAAAA,EAAAA,KAAA,QAAMN,UAAU,4FAEvC2B,EAAAA,EAAAA,MAAA,OAAK3B,UAAU,sBAAqB4B,SAAA,EAACtB,EAAAA,EAAAA,KAAA,KAAGN,UAAS,0BAAAQ,OAAsC,SAAVY,EAAmB,aAAe,iBAAkBQ,SAAEyF,EAAKO,QAAStH,EAAAA,EAAAA,KAAA,KAAGN,UAAS,oBAAAQ,OAAgC,SAAVY,EAAmB,gBAAkB,iBAAkBQ,SAAEyF,EAAKkN,aAAe,wBAC9PlN,EAAK2L,oBAAsB,GAAK,IAAM1S,EAAAA,EAAAA,KAAA,OAAKN,UAAU,gBAAe4B,UAACtB,EAAAA,EAAAA,KAAA,QAAMN,UAAU,kEAAiE4B,SAAEyF,EAAK2L,yBA9BzJ3L,EAAK4J,SAkCP,KAAfpI,GAAqBT,IAClB9H,EAAAA,EAAAA,KAAA,OAAKN,UAAU,uCAAsC4B,UACjDtB,EAAAA,EAAAA,KAAA,OAAKN,UAAU,0EAM/BM,EAAAA,EAAAA,KAAA,OAAKN,UAAS,mIAAAQ,OAAqI+I,EAAa,OAAS,iBAAgB,KAAA/I,OAAc,SAAVY,EAAmB,cAAgB,WAAU,KAAIQ,SACxOyiB,IASE1iB,EAAAA,EAAAA,MAAA0jB,EAAAA,SAAA,CAAAzjB,SAAA,EACID,EAAAA,EAAAA,MAAA,OAAK3B,UAAS,qEAAAQ,OAAiF,SAAVY,EAAmB,8BAAgC,4BAA6BQ,SAAA,EACjKD,EAAAA,EAAAA,MAAA,OAAK3B,UAAU,gDAA+C4B,SAAA,EAC1DtB,EAAAA,EAAAA,KAAA,UAAQwB,QAASib,GAAW/c,UAAS,8BAAAQ,OAA0C,SAAVY,EAAmB,+BAAiC,qBAAsBQ,UAACtB,EAAAA,EAAAA,KAACglB,EAAAA,IAAW,OAC5JhlB,EAAAA,EAAAA,KAAA,UAAQwB,QAASA,IAA+B,UAAzBuiB,GAAgB5c,MAAoB4c,GAAgB3c,SAAW+D,IAAsB,GAAOzL,UAAU,gBAAe4B,SAC9G,UAAzByiB,GAAgB5c,MACbnH,EAAAA,EAAAA,KAAA,OAAKN,UAAS,2DAAAQ,OAAuE,SAAVY,EAAmB,cAAgB,eAAgBQ,UAC1HtB,EAAAA,EAAAA,KAACuH,EAAAA,IAAO,CAAC7H,UAAS,gBAAmB0D,KAAM,OAE/C2gB,GAAgB3c,SAChBpH,EAAAA,EAAAA,KAAA,OAAKuD,IAAKwgB,GAAgB3c,QAASC,IAAK0c,GAAgBzc,KAAM5H,UAAU,yCAExEM,EAAAA,EAAAA,KAAA,OAAKN,UAAS,2DAAAQ,OAAuE,SAAVY,EAAmB,cAAgB,eAAgBQ,UAC1HtB,EAAAA,EAAAA,KAAC8kB,EAAAA,IAAM,CAACplB,UAAS,gBAAmB0D,KAAM,UAItD/B,EAAAA,EAAAA,MAAA,OAAK3B,UAAU,WAAU4B,SAAA,EACrBtB,EAAAA,EAAAA,KAAA,UACIwB,QAASA,KACwB,YAAzBuiB,GAAgB5c,KAChBc,EAAS,cAAD/H,OAAeuH,EAAYiJ,GAAE,YAAAxQ,OAAW6jB,GAAgBpT,SA5KjF,WAAX,OAAZlI,QAAY,IAAZA,OAAY,EAAZA,EAActB,QACdoE,GAAsB,YACtBE,GAAgB,IAChBJ,IAAwB,KA8KQ4Z,UAAWlB,GACXrkB,UAAU,YAAW4B,UAErBtB,EAAAA,EAAAA,KAAA,KAAGN,UAAS,8BAAAQ,OAA0C,SAAVY,EAAmB,aAAe,iBAAkBQ,SAAEyiB,GAAgBzc,SAE5F,YAAzByc,GAAgB5c,MACbnH,EAAAA,EAAAA,KAAA,KAAGN,UAAS,WAAAQ,OAAuB,SAAVY,EAAmB,gBAAkB,iBAAkBQ,SAC3EyiB,GAAgBlK,SACX,SACCkK,GAAgBmB,aA5J3CvC,KACpB,IAAKA,EAAW,MAAO,UACvB,MAAMC,EAAO,IAAIxQ,KAAKgR,OAAOT,GAAWE,SAAS,KAAOF,EAAYA,EAAY,KAChF,GAAIG,MAAMF,GAAO,MAAO,UACxB,MAAMS,EAAQ,IAAIjR,KAClB,OAAIwQ,EAAKa,iBAAmBJ,EAAMI,eACxB,sBAANvjB,OAA6BwiB,GAAgBC,IAE3C,gBAANziB,OAAuB0iB,EAAKc,uBAoJkDyB,CAAepB,GAAgBmB,cAAgB,aAEzF7jB,EAAAA,EAAAA,MAAA,KAAG3B,UAAS,WAAAQ,OAAuB,SAAVY,EAAmB,gBAAkB,iBAAkBQ,SAAA,CAAEyiB,GAAgBqB,aAAe,EAAE,qBAI/HplB,EAAAA,EAAAA,KAAA,OAAKN,UAAU,8BAA6B4B,UAACD,EAAAA,EAAAA,MAAA,OAAK3B,UAAU,WAAU4B,SAAA,EAACtB,EAAAA,EAAAA,KAAA,UAAQ2F,IAAK4J,GAAmB/N,QAASA,IAAMgI,GAAiBD,GAAe7J,UAAS,sCAAAQ,OAAkD,SAAVY,EAAmB,kCAAoC,iBAAkBQ,UAACtB,EAAAA,EAAAA,KAACqlB,EAAAA,IAAmB,CAACjiB,KAAM,OAAgBmG,IAAiBlI,EAAAA,EAAAA,MAAA,OAAKsE,IAAK2J,GAAa5P,UAAU,gEAA+D4B,SAAA,EAACtB,EAAAA,EAAAA,KAAA,UAAQwB,QAASA,KAAQyM,IAAmB,GAAOzE,GAAgB,IAC7e9J,UAAU,2EAA0E4B,SAAC,YAAetB,EAAAA,EAAAA,KAAA,UAAQwB,QAASA,KAAQ6K,IAAoB,GAAO7C,GAAgB,IAAW9J,UAAU,2EAA0E4B,SAAC,0BAG/Q0M,KACG3M,EAAAA,EAAAA,MAAA,OAAK3B,UAAS,kFAAAQ,OAA8F,SAAVY,EAAmB,8BAAgC,4BAA6BQ,SAAA,EAC9KtB,EAAAA,EAAAA,KAAA,SACImH,KAAK,OACLsd,YAAY,qBACZ/kB,UAAS,gCAAAQ,OAA4C,SAAVY,EAAmB,yBAA2B,IACzF4jB,MAAOxW,GACPyW,SAp9CRjjB,IACxByM,GAAezM,EAAEoc,OAAO4G,QAo9CQY,WAAS,IAEZlX,GAAc0C,OAAS,IACpBzP,EAAAA,EAAAA,MAAA,QAAM3B,UAAU,eAAc4B,SAAA,CAAEgN,GAAqB,EAAE,OAAKF,GAAc0C,WAE9EzP,EAAAA,EAAAA,MAAA,OAAK3B,UAAU,OAAM4B,SAAA,EACjBtB,EAAAA,EAAAA,KAAA,UAAQwB,QA57CnB+jB,KACjBjX,GAAqB,GACrBC,GAAsByE,GAAQA,EAAO,IA07C0BiS,SAAU3W,IAAsB,EAAG5O,UAAU,0BAAyB4B,UAACtB,EAAAA,EAAAA,KAACwlB,EAAAA,IAAW,OACtHxlB,EAAAA,EAAAA,KAAA,UAAQwB,QAn8CnBikB,KACjBnX,GAAqBF,GAAc0C,OAAS,GAC5CvC,GAAsByE,GAAQA,EAAO,IAi8C0BiS,SAAU3W,IAAsBF,GAAc0C,OAAS,EAAGpR,UAAU,0BAAyB4B,UAACtB,EAAAA,EAAAA,KAAC0lB,EAAAA,IAAa,OAC/I1lB,EAAAA,EAAAA,KAAA,UAAQwB,QAASA,KAAQyM,IAAmB,GAAQE,GAAe,IAAKE,GAAiB,KAAQ3O,UAAU,MAAK4B,UAACtB,EAAAA,EAAAA,KAAC2lB,EAAAA,IAAO,YAKpInb,KACGnJ,EAAAA,EAAAA,MAAA,OAAK3B,UAAS,2EAAAQ,OAAuF,SAAVY,EAAmB,8BAAgC,mBAAoBQ,SAAA,EAC9JD,EAAAA,EAAAA,MAAA,OAAK3B,UAAU,mFAAmF8B,QAASugB,GAAkBzgB,SAAA,EACzHtB,EAAAA,EAAAA,KAAC4lB,EAAAA,IAAW,CAAClmB,UAAS,iBAAAQ,OAA6B,SAAVY,EAAmB,gBAAkB,oBAC9Ed,EAAAA,EAAAA,KAACV,EAAQ,CAACG,SAAU+K,GAAc/K,UAAY,GAAI0H,KAAMqD,GAAcqb,YAAanmB,UAAU,2BAC7F2B,EAAAA,EAAAA,MAAA,OAAK3B,UAAU,WAAU4B,SAAA,EACrBtB,EAAAA,EAAAA,KAAA,KAAGN,UAAS,0BAA4B4B,SAAC,oBACzCtB,EAAAA,EAAAA,KAAA,KAAGN,UAAS,YAAAQ,OAAwB,SAAVY,EAAmB,gBAAkB,iBAAkBQ,SAC9C,SAA9BkJ,GAAcqb,YAAyBrb,GAAcpJ,QAAUoJ,GAAc/K,UAAY,wBAItG4B,EAAAA,EAAAA,MAAA,OAAK3B,UAAU,yBAAwB4B,SAAA,EACnCtB,EAAAA,EAAAA,KAAA,UAAQ2F,IAAKiK,GAAqBpO,QAASA,IAAMyJ,IAAmBD,IAAiBtL,UAAS,oBAAAQ,OAAgC,SAAVY,EAAmB,kCAAoC,qBAAsBQ,UAC7LtB,EAAAA,EAAAA,KAAC0lB,EAAAA,IAAa,MAEjB1a,KACGhL,EAAAA,EAAAA,KAAA,OAAK2F,IAAKgK,GAAejQ,UAAS,gEAAAQ,OAA4E,SAAVY,EAAmB,yBAA2B,YAAaQ,UAC3JD,EAAAA,EAAAA,MAAA,MAAI3B,UAAU,OAAM4B,SAAA,EAChBD,EAAAA,EAAAA,MAAA,MAAIG,QAASugB,GAAmBriB,UAAS,sEAAAQ,OAAkF,SAAVY,EAAmB,kCAAoC,iBAAkBQ,SAAA,EACtLtB,EAAAA,EAAAA,KAAC8lB,EAAAA,IAAkB,IAAG,qBAE1BzkB,EAAAA,EAAAA,MAAA,MAAIG,QA/VhCC,UAChB,GAAkB,OAAb+I,SAAa,IAAbA,IAAAA,GAAerJ,UAEpB,UACU4kB,EAAAA,EAAAA,IAAavb,GAAcrJ,UAAWsG,EAAYiJ,IACxDjG,GAAiB,KACrB,CAAE,MAAOzH,GACLC,QAAQD,MAAM,2BAA4BA,EAC9C,CAAC,QACGiI,IAAkB,EACtB,GAqVsEvL,UAAS,mFAAAQ,OAA+F,SAAVY,EAAmB,iCAAmC,IAAKQ,SAAA,EAC/KtB,EAAAA,EAAAA,KAAC2lB,EAAAA,IAAO,IAAG,wBASvC3lB,EAAAA,EAAAA,KAAA,OAAK2F,IAAKkJ,GAAkB+V,SAv6C3BoB,KACrB,MAAMtR,EAAY7F,GAAiBnK,QACnC,IAAKgQ,EAAW,OAEhB,MAAM,UAAEpB,EAAS,aAAE5B,EAAY,aAAEkD,GAAiBF,EAElD,GAAkB,IAAdpB,IAAoBvK,IAAsB6D,GAAwB,CAClE,MAAM+D,EAASlI,EAAakI,OAC5B,IAAgC,IAA5BjE,GAAgBiE,GAAmB,CACnC,MAAMsV,GAAYzZ,GAAamE,IAAW,GAAK,EAC/ClE,GAAgBuG,IAAIP,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAUO,GAAI,IAAE,CAACrC,GAASsV,KAC9CtT,GAAiBhC,EAAQsV,EAC7B,CACJ,CAEA,MAAMC,EAAexU,EAAe4B,EAAYsB,EAAe,IAC3DsR,IAAiBpZ,KACjBC,GAAsBmZ,GACjBA,GACDjZ,GAAoB,KAo5CgDvN,UAAS,yCAAAQ,OAAqD,SAAVY,EAAmB,cAAgB,cAAeQ,SACzJ0M,IACGhO,EAAAA,EAAAA,KAAA,OAAKN,UAAU,YAAW4B,SACrB8M,GAAc0C,OAAS,EACpB1C,GAAcoE,IAAI5R,IACdS,EAAAA,EAAAA,MAAA,OAEIG,QAASA,IAx9C7BC,WACxBwM,IAAmB,GACnBE,GAAe,IACfE,GAAiB,IAEjB,MAAM8X,QAA2BC,EAAAA,EAAAA,IAAkBzd,EAAQxH,UAAWsG,EAAYiJ,GAAIjI,EAAakI,QACnG,GAAIwV,GAAsBA,EAAmBrV,OAAS,EAAG,CACrD,MAAMuV,EAAqBF,EAAmB3T,IAAIU,EAAAA,IAElDpK,EAAYkK,IAAIP,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACTO,GAAI,IACP,CAACvK,EAAakI,QAAS0V,KAG3B7V,WAAW,KACP,MAAM8V,EAAU/jB,SAAS0O,eAAe,OAAD/Q,OAAQyI,EAAQxH,YACnDmlB,IACAA,EAAQpV,eAAe,CAAEC,SAAU,SAAUC,MAAO,WACpDkV,EAAQpE,UAAUC,IAAI,cAAe,iBAAkB,iBACvD3R,WAAW,KACP8V,EAAQpE,UAAUpf,OAAO,gBAC1B,OAER,IACP,GAg8C2DyjB,CAAoB3lB,GACnClB,UAAS,iCAAAQ,OAA6C,SAAVY,EAAmB,oBAAsB,qBAAsBQ,SAAA,EAE3GD,EAAAA,EAAAA,MAAA,OAAK3B,UAAU,oCAAmC4B,SAAA,EAC9CtB,EAAAA,EAAAA,KAAA,QAAMN,UAAU,YAAW4B,SAAE0iB,GAAcpjB,EAAImT,QAAQzM,QACvDtH,EAAAA,EAAAA,KAAA,QAAMN,UAAS,GAAAQ,OAAe,SAAVY,EAAmB,gBAAkB,iBAAkBQ,SACtE,IAAI8Q,KAAKxR,EAAI0T,WAAWoP,2BAGjC1jB,EAAAA,EAAAA,KAAA,KAAGN,UAAS,YAAAQ,OAAwB,SAAVY,EAAmB,gBAAkB,iBAAkBQ,SAC5EV,EAAInB,SAAQ,gBAAAS,OAASU,EAAInB,UAAamB,EAAIQ,YAX1CR,EAAIO,aAgBjBE,EAAAA,EAAAA,MAAA,OAAK3B,UAAU,kCAAiC4B,SAAA,CAAC,yBAAuB4M,GAAY,SAI5FnF,GACI/I,EAAAA,EAAAA,KAAC2G,EAAe,CAAC7F,MAAOA,KAExBO,EAAAA,EAAAA,MAAA,OAAK3B,UAAU,YAAW4B,SAAA,CACrB+T,GAAa7C,IAAI,CAAC5R,EAAKoJ,KAAW,IAADwc,EAC9B,MAAM3lB,EAAcD,EAAImT,UAAsB,OAAXtM,QAAW,IAAXA,OAAW,EAAXA,EAAaiJ,IAC1C+V,EAAU,IAAIrU,KAAKxR,EAAI0T,WAAWmP,eAClCiD,EAAiB5C,KAAoB2C,EACvCC,IACA5C,GAAkB2C,GAEtB,MAAME,EAAc9lB,EAA0C,KAA5BmjB,GAAcpjB,EAAImT,QAE9CvQ,EAAU6gB,GAAWzjB,GAE3B,OACIS,EAAAA,EAAAA,MAACulB,EAAAA,SAAc,CAAAtlB,SAAA,CACVolB,IACG1mB,EAAAA,EAAAA,KAAA,OAAKN,UAAU,mBAAkB4B,UAC7BtB,EAAAA,EAAAA,KAAA,QAAMN,UAAS,gDAAAQ,OAA4D,SAAVY,EAAmB,4BAA8B,6BAA8BQ,SAAE6hB,GAAiBviB,EAAI0T,gBAG/KjT,EAAAA,EAAAA,MAAA,OACIqP,GAAE,OAAAxQ,OAASU,EAAIO,WACf,qBAAoB6I,EACpBtK,UAAS,mHAAAQ,OACPW,EAAc,cAAgB,gBAAe,kEAAAX,QACZ,QAAjCsmB,EAAApY,GAAcE,WAAmB,IAAAkY,OAAA,EAAjCA,EAAmCrlB,aAAcP,EAAIO,UAAY,mBAAqB,GAAE,8DAC5FG,SAAA,EAEIT,GAAe,MACb,MAAMgmB,EAAsC,UAAzB9C,GAAgB5c,KAA6B,OAAVwf,QAAU,IAAVA,OAAU,EAAVA,EAAYvf,QAAU2c,GAAgB3c,QACtF0f,EAAuC,UAAzB/C,GAAgB5c,KAA6B,OAAVwf,QAAU,IAAVA,OAAU,EAAVA,EAAYrf,KAAOyc,GAAgBzc,KAC1F,OAAOuf,GACH7mB,EAAAA,EAAAA,KAAA,OAAKuD,IAAKsjB,EAAYxf,IAAKyf,EAAapnB,UAAU,gEAElDM,EAAAA,EAAAA,KAAA,OAAKN,UAAS,kFAAAQ,OAA8F,SAAVY,EAAmB,cAAgB,eAAgBQ,UACjJtB,EAAAA,EAAAA,KAAC8kB,EAAAA,IAAM,CAACplB,UAAU,gBAAgB0D,KAAM,MAGnD,EAVgB,IAWjB/B,EAAAA,EAAAA,MAAA,OAAK3B,UAAS,iBAAAQ,OAAmBW,EAAc,YAAc,eAAgBS,SAAA,CAC/C,UAAzByiB,GAAgB5c,OAAqBtG,IAClCb,EAAAA,EAAAA,KAAA,KAAGN,UAAS,iDAAAQ,OAA6D,SAAVY,EAAmB,gBAAkB,iBAAkBQ,SAAY,OAAVqlB,QAAU,IAAVA,OAAU,EAAVA,EAAYrf,QAExItH,EAAAA,EAAAA,KAAA,OAAK+mB,cAAgBrlB,GA1hBvDslB,EAACvJ,EAAO9U,EAASqB,KAAYyT,EAAM9b,iBAAkB8b,EAAM7b,kBAAkE,IAAIkI,EAAI2T,EAAMwJ,MAAWld,EAAI0T,EAAMyJ,MAAWpd,EAA3E,IAA2F3H,OAAOglB,aAAYrd,GAA9G,KAAkIC,EAA1G,IAA2H5H,OAAOilB,cAAard,GAA/I,KAAgKH,EAAe,CAAEC,SAAS,EAAMC,IAAGC,IAAGpB,UAASqB,WA0hB1Qgd,CAAkBtlB,EAAGd,EAAKoJ,GAAQtK,UAAS,mHAAAQ,OACtD,UAAbU,EAAIuG,MAAiC,YAAbvG,EAAIuG,KAAsB,qBAAuB,GAAE,sEAAAjH,OAC9D,SAAbU,EAAIuG,KAAoBtG,EAAc,6BAA0C,SAAVC,EAAmB,6BAA+B,gCAAoC,GAAE,sEAAAZ,OACjJ,UAAbU,EAAIuG,MAAiC,SAAbvG,EAAIuG,KAAoBtG,EAAc,cAA2B,SAAVC,EAAmB,cAAgB,cAAkB,GAAE,sEACvIQ,SACgB,YAAbV,EAAIuG,MACD9F,EAAAA,EAAAA,MAAA,OAAK3B,UAAU,wDAAuD4B,SAAA,EAClEtB,EAAAA,EAAAA,KAAA,QAAAsB,SAAM,8BACM,OAAXgJ,SAAW,IAAXA,QAAW,EAAXA,GAAaN,SAAUA,IAAShK,EAAAA,EAAAA,KAAA,UAAQwB,QAASsgB,GAAkBpiB,UAAU,gCAA+B4B,SAAC,aAGlHD,EAAAA,EAAAA,MAAA0jB,EAAAA,SAAA,CAAAzjB,SAAA,CACKV,EAAI8d,cAAerd,EAAAA,EAAAA,MAAA,OAAK3B,UAAU,kEAAiE4B,SAAA,EAACtB,EAAAA,EAAAA,KAACqnB,EAAAA,IAAO,IAAG,gBAE/GzmB,EAAI6d,UACDpd,EAAAA,EAAAA,MAAA,OAAK3B,UAAS,4BAAAQ,OAA8BW,EAAc,cAA2B,SAAVC,EAAmB,cAAgB,eAAiBQ,SAAA,EAC3HtB,EAAAA,EAAAA,KAAA,KAAGN,UAAU,gBAAe4B,SAAEV,EAAI6d,QAAQ1K,UAAsB,OAAXtM,QAAW,IAAXA,OAAW,EAAXA,EAAaiJ,IAAK,MAAQsT,GAAcpjB,EAAI6d,QAAQ1K,QAAQzM,QACjHtH,EAAAA,EAAAA,KAAA,KAAGN,UAAU,sBAAqB4B,UAC7B,CAAC,QAAS,QAAS,QAAQvB,SAASa,EAAI6d,QAAQtX,MAAQvG,EAAI6d,QAAQrd,cAKnE,UAAbR,EAAIuG,MACD9F,EAAAA,EAAAA,MAAA,OAAK3B,UAAU,WAAU4B,SAAA,EACrBtB,EAAAA,EAAAA,KAAA,UAAQwB,QAASA,IAAMuK,GAAevI,GAAU9D,UAAU,iBAAgB4B,UACtEtB,EAAAA,EAAAA,KAAA,OAAKuD,IAAKC,EAAS6D,IAAKzG,EAAInB,UAAY,QAASC,UAAU,wBAAwBgH,MAAO,CAAE4gB,UAAW,cAEzGzmB,IACEb,EAAAA,EAAAA,KAAA,KACIyC,KAAMe,EACN+jB,SAAU3mB,EAAInB,SACd+B,QAAUE,GAAMof,GAAoBtd,EAAS5C,EAAInB,SAAUiC,GAC3DhC,UAAU,oIAAmI4B,UAE7ItB,EAAAA,EAAAA,KAACmD,EAAAA,IAAU,SAIV,UAAbvC,EAAIuG,MACJnH,EAAAA,EAAAA,KAAA,OAAKN,UAAS,GAAAQ,OAAKW,EAAc,cAA2B,SAAVC,EAAmB,cAAgB,cAAc,eAAcQ,UAC7GtB,EAAAA,EAAAA,KAACqD,EAAW,CAACE,IAAKC,EAASA,QAASA,EAASC,SAAU5C,EAAa6C,gBAAiB9C,EAAIsD,SAAU3C,SAAUX,EAAIW,SAAUT,MAAOA,MAEzH,SAAbF,EAAIuG,MACJnH,EAAAA,EAAAA,KAACU,EAAW,CAACE,IAAKA,EAAKC,YAAaA,EAAaC,MAAOA,KAExDd,EAAAA,EAAAA,KAAA,KAAGN,UAAU,sBAAqB4B,SAAEV,EAAIQ,gBAKxDC,EAAAA,EAAAA,MAAA,QAAM3B,UAAS,yDAAAQ,OAAqE,SAAVY,EAAmB,gBAAkB,iBAAkBQ,SAAA,EAC7HtB,EAAAA,EAAAA,KAAA,QAAMN,UAAU,eAAc4B,SACV,YAAfV,EAAIoU,OAAuB,aAA8B,WAAfpU,EAAIoU,OAAsB,SAAW0N,GAAgB9hB,EAAI0T,aAGvG1T,EAAIuV,UAAWnW,EAAAA,EAAAA,KAAA,QAAMN,UAAU,eAAc4B,SAAC,aAAkB,GAEhET,GAA8B,YAAfD,EAAIoU,QAAuC,WAAfpU,EAAIoU,SAC5C3T,EAAAA,EAAAA,MAAA,QAAM3B,UAAU,gBAAe4B,SAAA,CACX,SAAfV,EAAIoU,SAAqBhV,EAAAA,EAAAA,KAACwnB,EAAAA,IAAO,CAACpkB,KAAM,GAAI1D,UAAS,GAAAQ,OAAe,SAAVY,EAAmB,gBAAkB,mBAChF,cAAfF,EAAIoU,SAA0BhV,EAAAA,EAAAA,KAACynB,EAAAA,IAAa,CAACrkB,KAAM,GAAI1D,UAAU,kBAClD,SAAfkB,EAAIoU,SAAqBhV,EAAAA,EAAAA,KAAC0nB,EAAAA,IAAK,CAACtkB,KAAM,GAAI1D,UAAU,2BAKpEmB,IACGb,EAAAA,EAAAA,KAAA,OAAKN,UAAS,4CAA8C4B,UACxDtB,EAAAA,EAAAA,KAAA,OAAKuD,KAAgB,OAAXkE,QAAW,IAAXA,OAAW,EAAXA,EAAaL,UAAW,qDAAsDC,IAAI,eAAe3H,UAAU,mDAlGhHkB,EAAIO,WAAaP,EAAI8P,MA0GjDpE,GAAY7D,EAAakI,UACtBtP,EAAAA,EAAAA,MAAA,OAAK3B,UAAU,qCAAoC4B,SAAA,EAC/CtB,EAAAA,EAAAA,KAAA,OAAKN,UAAS,kFAAAQ,OAA8F,SAAVY,EAAmB,cAAgB,eAAgBQ,UACjJtB,EAAAA,EAAAA,KAAC8kB,EAAAA,IAAM,CAACplB,UAAU,gBAAgB0D,KAAM,QAE5CpD,EAAAA,EAAAA,KAAA,OAAKN,UAAU,4BAA2B4B,UACtCtB,EAAAA,EAAAA,KAAA,OAAKN,UAAS,gCAAAQ,OAA4C,SAAVY,EAAmB,cAAgB,eAAgBQ,UAC/FD,EAAAA,EAAAA,MAAA,OAAK3B,UAAU,2CAA0C4B,SAAA,EACrDtB,EAAAA,EAAAA,KAAA,QAAMN,UAAU,6EAChBM,EAAAA,EAAAA,KAAA,QAAMN,UAAU,8EAChBM,EAAAA,EAAAA,KAAA,QAAMN,UAAU,oEAWpD2B,EAAAA,EAAAA,MAAA,OAAK3B,UAAS,4CAAAQ,OAAwD,SAAVY,EAAmB,8BAAgC,4BAA6BQ,SAAA,CACvI8I,IACG/I,EAAAA,EAAAA,MAAA,OAAK3B,UAAS,sDAAAQ,OAAkE,SAAVY,EAAmB,cAAgB,eAAgBQ,SAAA,EACrHD,EAAAA,EAAAA,MAAA,OAAK3B,UAAU,0BAAyB4B,SAAA,EACpCD,EAAAA,EAAAA,MAAA,KAAG3B,UAAU,8BAA6B4B,SAAA,CAAC,eAAa8I,EAAW2J,UAAsB,OAAXtM,QAAW,IAAXA,OAAW,EAAXA,EAAaiJ,IAAK,WAAasT,GAAc5Z,EAAW2J,QAAQzM,SAC9ItH,EAAAA,EAAAA,KAAA,KAAGN,UAAS,uBAAAQ,OAAmC,SAAVY,EAAmB,gBAAkB,iBAAkBQ,SACvF,CAAC,QAAS,QAAS,QAAQvB,SAASqK,EAAWjD,MAAQiD,EAAW3K,SAAW2K,EAAWhJ,cAGjGpB,EAAAA,EAAAA,KAAA,UAAQwB,QAASA,IAAM6I,EAAc,MAAM/I,UAACtB,EAAAA,EAAAA,KAAC2lB,EAAAA,IAAO,SAIrC,OAAtB1b,EAAYD,QAAmB3I,EAAAA,EAAAA,MAAA,OAAK3B,UAAS,sDAAAQ,OAAkE,SAAVY,EAAmB,cAAgB,eAAgBQ,SAAA,EAACD,EAAAA,EAAAA,MAAA,OAAK3B,UAAU,0BAAyB4B,SAAA,EAACtB,EAAAA,EAAAA,KAAA,KAAGN,UAAU,8BAA6B4B,SAAC,qBAAmBtB,EAAAA,EAAAA,KAAA,KAAGN,UAAS,uBAAAQ,OAAmC,SAAVY,EAAmB,gBAAkB,iBAAkBQ,SAAE2I,EAAYE,sBAA0BnK,EAAAA,EAAAA,KAAA,UAAQwB,QAAS0f,GAAW5f,UAACtB,EAAAA,EAAAA,KAAC2lB,EAAAA,IAAO,SACza5B,KACG1iB,EAAAA,EAAAA,MAAA,OAAK3B,UAAS,+CAAAQ,OAAkDkK,GAAoC,OAAtBH,EAAYD,MAAkB,OAAS,IAAK1I,SAAA,CACrH6H,IACGnJ,EAAAA,EAAAA,KAAA,OAAK2F,IAAKyJ,GAAgB1P,UAAU,0DAAyD4B,UACzFtB,EAAAA,EAAAA,KAAC2nB,EAAAA,GAAW,CAACC,aAn1BnCC,GAAgBjf,EAAWoK,GAAQA,EAAO6U,EAAYC,OAm1BSrhB,MAAM,OAAOshB,OAAQ,IAAKjnB,MAAOA,OAGlFO,EAAAA,EAAAA,MAAA,OAAK3B,UAAU,qBAAoB4B,SAAA,EAC/BtB,EAAAA,EAAAA,KAAA,SAAO2F,IAAK8J,GAAiBtI,KAAK,OAAOsd,YAAapb,EAAc,eAAiB,oBAAqB3J,UAAS,wGAAAQ,OAAoH,SAAVY,EAAmB,yCAA2C,+BAAiC4jB,MAAO/b,EAASgc,SAAWjjB,IAAQkH,EAAWlH,EAAEoc,OAAO4G,OAAQ3G,IAAiB,IAAUiK,UAx1BvavK,IAA8B,UAAdA,EAAMtC,KAAoBsC,EAAMwK,WAAYxK,EAAM9b,iBAA4C,OAAtBsI,EAAYD,MAAgB+W,KAAuB7C,OAw1BsT+G,SAAU5b,KAC1bhI,EAAAA,EAAAA,MAAA,OAAK3B,UAAU,8DAA6D4B,SAAA,EACxEtB,EAAAA,EAAAA,KAAA,UAAQ2F,IAAK0J,GAAgB7N,QAASA,IAAM4H,GAAoBD,GAAkBzJ,UAAS,sCAAAQ,OAAkD,SAAVY,EAAmB,kCAAoC,qCAAsCQ,UAACtB,EAAAA,EAAAA,KAACkoB,EAAAA,IAAO,CAAC9kB,KAAM,QAChPpD,EAAAA,EAAAA,KAAA,UAAQwB,QAz1BtB2mB,IAAMnZ,GAAatK,QAAQ7B,QAy1B2BnD,UAAS,sCAAAQ,OAAkD,SAAVY,EAAmB,kCAAoC,qCAAsCQ,UAACtB,EAAAA,EAAAA,KAACooB,EAAAA,IAAW,CAAChlB,KAAM,aAGjNuF,EAAQ2H,QAAgC,OAAtBrG,EAAYD,OAC3BhK,EAAAA,EAAAA,KAAA,UAAQwB,QAA+B,OAAtByI,EAAYD,MAAiB+W,GAAiB7C,GAAmBxe,UAAS,+BAAAQ,OAAuD,OAAtB+J,EAAYD,MAAiB,kCAAoC,iCAAkC1I,SACpM,OAAtB2I,EAAYD,OAAiBhK,EAAAA,EAAAA,KAACwnB,EAAAA,IAAO,CAACpkB,KAAM,MAASpD,EAAAA,EAAAA,KAACqoB,EAAAA,IAAY,CAACjlB,KAAM,QAG9EpD,EAAAA,EAAAA,KAAA,UAAQwB,QA9xBnB8mB,KAAYjf,EAAaoX,KAAsB7B,MA8xBGlf,UAAS,sCAAAQ,OAAwCmJ,EAAc,6BAA0C,SAAVvI,EAAmB,kCAAoC,qCAAuCQ,SAC/N+H,GAAcrJ,EAAAA,EAAAA,KAACuoB,EAAAA,IAAM,CAACnlB,KAAM,MAASpD,EAAAA,EAAAA,KAACwoB,EAAAA,IAAY,CAACplB,KAAM,QAGlEpD,EAAAA,EAAAA,KAAA,SAAOmH,KAAK,OAAOxB,IAAKqJ,GAAc2V,SAl2BjDljB,UACrB,MAAMgnB,EAAOhL,EAAMK,OAAOT,MAAM,GAChC,IAAKoL,IAAShgB,EAAc,OAE5B,IAAIod,EAAc,OACd4C,EAAKthB,KAAKiU,WAAW,UACrByK,EAAc,QACP4C,EAAKthB,KAAKiU,WAAW,YAC5ByK,EAAc,SAGlB,MAAM1H,EAAW/L,KAAKgM,MAAM5Y,WAAaxG,KAAKqf,SAAS7Y,SAAS,IAAI8Y,UAAU,EAAG,GAE3EoK,EAAsBtmB,IAAIC,gBAAgBomB,GAE1CjK,EAAoB,CACtB9N,GAAIyN,EACJhd,UAAWgd,EACXpK,OAAQtM,EAAYiJ,GACpBtP,QAASsnB,EACTpU,WAAW,IAAIlC,MAAOmC,cACtBS,OAAQ,UACR7N,KAAM0e,EACNpmB,SAAUgpB,EAAKnhB,KACf/F,SAAUknB,EAAKrlB,KACfI,QAASklB,EACTvS,UAAU,GAGdxC,GAAkBlL,EAAakI,OAAQ6N,GAEvC1V,EAAYkK,IAAIP,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACTO,GAAI,IACP,CAACvK,EAAakI,QAAS,IAAKqC,EAAKvK,EAAakI,SAAW,GAAK6N,MAGlE,MAAMmK,EAAW,IAAIC,SACrBD,EAASE,OAAO,OAAQJ,GACxBE,EAASE,OAAO,SAAUphB,EAAYiJ,IACtCiY,EAASE,OAAO,YAAa1K,GAC7BwK,EAASE,OAAO,WAAYJ,EAAKthB,MACjCwhB,EAASE,OAAO,OAA8B,UAAtBpgB,EAAatB,KAAmB,OAAS,WAEvC,UAAtBsB,EAAatB,KACbwhB,EAASE,OAAO,UAAWpgB,EAAakI,QAExCgY,EAASE,OAAO,WAAYpgB,EAAakI,QAG7C,UACUmY,EAAAA,EAAAA,IAAWH,EACrB,CAAE,MAAO3lB,GACLC,QAAQD,MAAM,mCAAoCA,GAClD8F,EAAYkK,IACR,MACMsN,GADetN,EAAKvK,EAAakI,SAAW,IACjB6B,IAAI+D,GAAKA,EAAE7F,KAAOyN,GAAQ1L,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAQ8D,GAAC,IAAEvB,OAAQ,WAAauB,GAC3F,OAAA9D,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAYO,GAAI,IAAE,CAACvK,EAAakI,QAAS2P,KAEjD,CAAC,QACG7C,EAAMK,OAAO4G,MAAQ,IACzB,GAsyBkGhlB,UAAU,qBAxT5FM,EAAAA,EAAAA,KAAA,OAAKN,UAAU,0CAAyC4B,UACpDD,EAAAA,EAAAA,MAAA,OAAK3B,UAAU,cAAa4B,SAAA,EACxBtB,EAAAA,EAAAA,KAACuH,EAAAA,IAAO,CAAC7H,UAAS,oBAAAQ,OAAgC,SAAVY,EAAmB,gBAAkB,oBAC7Ed,EAAAA,EAAAA,KAAA,KAAGN,UAAS,4BAAAQ,OAAwC,SAAVY,EAAmB,gBAAkB,iBAAkBQ,SAAC,4BAClGtB,EAAAA,EAAAA,KAAA,KAAGN,UAAS,WAAAQ,OAAuB,SAAVY,EAAmB,gBAAkB,iBAAkBQ,SAAC,8DA2ThGwL,KACGzL,EAAAA,EAAAA,MAAA,UACIG,QAASA,IAAM6P,KACf3R,UAAU,8PACV,aAAW,mBAAkB4B,SAAA,CAE5B0L,GAAmB,IAChBhN,EAAAA,EAAAA,KAAA,QAAMN,UAAU,yHAAwH4B,SACnI0L,GAAmB,EAAI,KAAOA,MAGvChN,EAAAA,EAAAA,KAAC0lB,EAAAA,IAAa,CAACtiB,KAAM,WAKhC8J,KACGlN,EAAAA,EAAAA,KAAC6G,EAAmB,CAChBE,KAAMmG,GACNlG,QAASA,IAAMmG,GAAkB,MACjCrM,MAAOA,IAId6I,EAAYE,UACT7J,EAAAA,EAAAA,KAAA,OAAK2F,IAAK6J,GAAgB9I,MAAO,CAAE+K,IAAK9H,EAAYI,EAAGvD,KAAMmD,EAAYG,GAAKpK,UAAS,iDAAAQ,OAA6D,SAAVY,EAAmB,cAAgB,YAAaQ,UACtLtB,EAAAA,EAAAA,KAAA,MAAIN,UAAU,OAAM4B,SACc,YAA7BqI,EAAYhB,QAAQxB,MACjB9F,EAAAA,EAAAA,MAAA,MAAIG,QAASA,IAAM+f,IAAa,GAAQ7hB,UAAS,mFAAAQ,OAA+F,SAAVY,EAAmB,iCAAmC,IAAKQ,SAAA,EAACtB,EAAAA,EAAAA,KAAC+oB,EAAAA,IAAO,IAAG,qBAE7M1nB,EAAAA,EAAAA,MAAA0jB,EAAAA,SAAA,CAAAzjB,SAAA,EACID,EAAAA,EAAAA,MAAA,MAAIG,QAtsBZwnB,KAAQ3e,EAAcV,EAAYhB,SAAUiB,EAAe,CAAEC,SAAS,EAAOC,EAAG,EAAGC,EAAG,EAAGpB,QAAS,KAAMqB,MAAO,OAASyF,GAAgB/K,QAAQukB,SAssB9GvpB,UAAS,sEAAAQ,OAAkF,SAAVY,EAAmB,kCAAoC,iBAAkBQ,SAAA,EAACtB,EAAAA,EAAAA,KAACkpB,EAAAA,IAAO,IAAG,aAChM7nB,EAAAA,EAAAA,MAAA,MAAIG,QA5mBdC,UAAa,IAAD0nB,EAC1B,GAAwB,QAApBA,EAACxf,EAAYhB,eAAO,IAAAwgB,GAAnBA,EAAqBhoB,UAE1B,IACI,MAAMioB,EAAiBzf,EAAYhB,QAAQxH,UACrCU,QAAiBwnB,EAAAA,EAAAA,IAAWD,EAAgB3hB,EAAYiJ,IAC9DjG,GAAiB5I,EACrB,CAAE,MAAOmB,GACLC,QAAQD,MAAM,yBAA0BA,EAC5C,CAAC,QACG4G,EAAe,CAAEC,SAAS,EAAOC,EAAG,EAAGC,EAAG,EAAGpB,QAAS,KAAMqB,MAAO,MACvE,GAimBgDtK,UAAS,sEAAAQ,OAAkF,SAAVY,EAAmB,kCAAoC,iBAAkBQ,SAAA,EAACtB,EAAAA,EAAAA,KAAC4lB,EAAAA,IAAW,IAAG,WAClMvkB,EAAAA,EAAAA,MAAA,MAAIG,QAlkBV8nB,KAClB3e,GAAkB,CAAEd,SAAS,EAAMlB,QAASgB,EAAYhB,UACxDiB,EAAe,CAAEC,SAAS,EAAOC,EAAG,EAAGC,EAAG,EAAGpB,QAAS,KAAMqB,MAAO,QAgkBftK,UAAS,sEAAAQ,OAAkF,SAAVY,EAAmB,kCAAoC,iBAAkBQ,SAAA,EAACtB,EAAAA,EAAAA,KAACqnB,EAAAA,IAAO,IAAG,cAElK,YAA/B1d,EAAYhB,QAAQqM,QAAuD,WAA/BrL,EAAYhB,QAAQqM,SAC7D3T,EAAAA,EAAAA,MAAA0jB,EAAAA,SAAA,CAAAzjB,SAAA,CACKqI,EAAYhB,QAAQoL,UAAsB,OAAXtM,QAAW,IAAXA,OAAW,EAAXA,EAAaiJ,KAAmC,SAA7B/G,EAAYhB,QAAQxB,OAAoBwC,EAAYhB,QAAQ+V,aAAgB,IAAItM,KAAS,IAAIA,KAAKzI,EAAYhB,QAAQ2L,WAAa,MAClLjT,EAAAA,EAAAA,MAAA,MAAIG,QA5sBzB+nB,KAAQrf,EAAe,CAAEF,MAAOL,EAAYK,MAAOG,gBAAiBR,EAAYhB,QAAQvH,UAAYwH,EAAWe,EAAYhB,QAAQvH,SAAUwI,EAAe,CAAEC,SAAS,EAAOC,EAAG,EAAGC,EAAG,EAAGpB,QAAS,KAAMqB,MAAO,OAASyF,GAAgB/K,QAAQukB,SA4sBnMvpB,UAAS,sEAAAQ,OAAkF,SAAVY,EAAmB,kCAAoC,iBAAkBQ,SAAA,EAACtB,EAAAA,EAAAA,KAACwpB,EAAAA,IAAM,IAAG,YAElMxpB,EAAAA,EAAAA,KAAA,MAAIN,UAAS,QAAAQ,OAAoB,SAAVY,EAAmB,kBAAoB,OAC9DO,EAAAA,EAAAA,MAAA,MAAIG,QAASA,IAAM+f,IAAa,GAAQ7hB,UAAS,mFAAAQ,OAA+F,SAAVY,EAAmB,iCAAmC,IAAKQ,SAAA,EAACtB,EAAAA,EAAAA,KAAC+oB,EAAAA,IAAO,IAAG,oBAC5Mpf,EAAYhB,QAAQoL,UAAsB,OAAXtM,QAAW,IAAXA,OAAW,EAAXA,EAAaiJ,MACzCrP,EAAAA,EAAAA,MAAA,MAAIG,QAASA,IAAM+f,IAAa,GAAO7hB,UAAS,mFAAAQ,OAA+F,SAAVY,EAAmB,iCAAmC,IAAKQ,SAAA,EAACtB,EAAAA,EAAAA,KAAC+oB,EAAAA,IAAO,IAAG,oCAU3Ore,GAAeb,UAAY7J,EAAAA,EAAAA,KAAA,OAAKN,UAAU,wEAAuE4B,UAACD,EAAAA,EAAAA,MAAA,OAAK3B,UAAS,yCAAAQ,OAAqD,SAAVY,EAAmB,yBAA2B,YAAaQ,SAAA,EAACD,EAAAA,EAAAA,MAAA,OAAK3B,UAAS,kDAAAQ,OAA8D,SAAVY,EAAmB,kBAAoB,mBAAoBQ,SAAA,EAACtB,EAAAA,EAAAA,KAAA,MAAIN,UAAU,oBAAmB4B,SAAC,2BAA0BtB,EAAAA,EAAAA,KAAA,UAAQwB,QAASA,IAAMmJ,GAAkB,CAAEd,SAAS,EAAOlB,QAAS,OAAQrH,UAACtB,EAAAA,EAAAA,KAAC2lB,EAAAA,IAAO,UAAkB3lB,EAAAA,EAAAA,KAAA,OAAKN,UAAU,MAAK4B,UAACtB,EAAAA,EAAAA,KAAA,SAAOmH,KAAK,OAAOsd,YAAY,6BAA6B/kB,UAAS,gCAAAQ,OAA4C,SAAVY,EAAmB,yCAA2C,+BAAiC4jB,MAAO5Z,GAAmB6Z,SAAWjjB,GAAMqJ,GAAqBrJ,EAAEoc,OAAO4G,YAAgB1kB,EAAAA,EAAAA,KAAA,OAAKN,UAAU,2BAA0B4B,SAAEgW,GAASC,OAAOU,IAAC,IAAAwR,EAAA,OAAU,QAAVA,EAAIxR,EAAE3Q,YAAI,IAAAmiB,OAAA,EAANA,EAAQ3pB,cAAcC,SAAS+K,GAAkBhL,iBAAgB0S,IAAIzL,IAAS1F,EAAAA,EAAAA,MAAA,OAAuB3B,UAAS,sDAAAQ,OAAkE,SAAVY,EAAmB,oBAAsB,IAAKQ,SAAA,EAACtB,EAAAA,EAAAA,KAAA,SAAOmH,KAAK,WAAWuJ,GAAE,OAAAxQ,OAAS6G,EAAK4J,QAAUjR,UAAU,+BAA+BgqB,QAAS9e,GAAkB7K,SAASgH,EAAK4J,QAASgU,SAAWjjB,IAAYA,EAAEoc,OAAO4L,QAAS7e,GAAqB,IAAID,GAAmB7D,EAAK4J,SAAe9F,GAAqBD,GAAkB2M,OAAO7G,GAAMA,IAAO3J,EAAK4J,aACn4CtP,EAAAA,EAAAA,MAAA,SAAOsoB,QAAO,OAAAzpB,OAAS6G,EAAK4J,QAAUjR,UAAU,mDAAkD4B,SAAA,CAC/E,UAAdyF,EAAKI,MACFnH,EAAAA,EAAAA,KAAA,OAAKN,UAAS,2DAAAQ,OAAuE,SAAVY,EAAmB,cAAgB,eAAgBQ,UAACtB,EAAAA,EAAAA,KAACuH,EAAAA,IAAO,CAAC7H,UAAS,qBAEjJM,EAAAA,EAAAA,KAAA,OAAKuD,IAAKwD,EAAKK,QAASC,IAAKN,EAAKO,KAAM5H,UAAU,sCAAsCkqB,QAAUloB,IAAQA,EAAEoc,OAAOva,IAAM,wDAE7HvD,EAAAA,EAAAA,KAAA,QAAMN,UAAS,GAAAQ,OAAe,SAAVY,EAAmB,gBAAkB,iBAAkBQ,SAAEyF,EAAKO,YAP23BP,EAAK4J,YAS38B3Q,EAAAA,EAAAA,KAAA,OAAKN,UAAS,2BAAAQ,OAAuC,SAAVY,EAAmB,kBAAoB,mBAAoBQ,UAACtB,EAAAA,EAAAA,KAAA,UAAQwB,QAzlBzGC,UACzB,MAAMooB,EAAcnf,GAAe/B,QACnC,IAAKkhB,GAA4C,IAA7Bjf,GAAkBkG,OAClC,OAGJ,MAAMgZ,EAAc,CAChB/V,OAAQtM,EAAYiJ,GACpBqZ,iBAAkBF,EAAY1oB,UAC9B6oB,UAAWpf,GAAkB4H,IAAI7B,IAC7B,MAAM5J,EAAOuQ,GAASU,KAAKC,GAAKA,EAAEtH,SAAWA,GAC7C,MAAkB,YAAd5J,EAAKI,KACE,CAAEuO,SAAU3O,EAAK4J,QAEjB,CAAEyE,QAASrO,EAAK4J,WAKnC,UACUsZ,EAAAA,EAAAA,IAAeH,GACrB,MAAMI,GAAoBzX,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GACnB/H,GAAe/B,SAAO,IACzBoL,OAAQtM,EAAYiJ,GACpB4D,WAAW,IAAIlC,MAAOmC,gBAE1B3J,GAAkB0Q,QAAQ3K,IACtBgD,GAAkBhD,EAAQuZ,IAGlC,CAAE,MAAOlnB,GACLC,QAAQD,MAAM,6BAA8BA,EAChD,CAAC,QACG2H,GAAkB,CAAEd,SAAS,EAAOlB,QAAS,OAC7CkC,GAAqB,IACrBE,GAAqB,GACzB,GAqjBiKka,SAAuC,IAA7Bra,GAAkBkG,OAAcpR,UAAU,8GAA6G4B,SAAC,mBAE9T4J,IAAsB6Y,IAA4C,UAAzBA,GAAgB5c,OACtDnH,EAAAA,EAAAA,KAAA,OAAKN,UAAU,gFAAgF8B,QAASA,IAAM2J,IAAsB,GAAO7J,UACvItB,EAAAA,EAAAA,KAAA,OAAKuD,IAAKwgB,GAAgB3c,QAASC,IAAK0c,GAAgBzc,KAAM5H,UAAU,2CAA2C8B,QAAUE,GAAMA,EAAEE,sBAI5IwJ,IAAkD,WAAX,OAAf2Y,SAAe,IAAfA,QAAe,EAAfA,GAAiB5c,QACtCnH,EAAAA,EAAAA,KAAA,OAAKN,UAAU,wEAAwE8B,QAASA,IAAM6J,IAAwB,GAAO/J,UACjID,EAAAA,EAAAA,MAAA,OAAK3B,UAAS,gEAAAQ,OAA4E,SAAVY,EAAmB,yBAA2B,YAAcU,QAAUE,GAAMA,EAAEE,kBAAkBN,SAAA,EAC5KD,EAAAA,EAAAA,MAAA,OAAK3B,UAAS,gEAAAQ,OAA4E,SAAVY,EAAmB,kBAAoB,mBAAoBQ,SAAA,EACvItB,EAAAA,EAAAA,KAAA,MAAIN,UAAU,oBAAmB4B,SAAC,gBAClCtB,EAAAA,EAAAA,KAAA,UAAQwB,QAASA,IAAM6J,IAAwB,GAAQ3L,UAAS,oBAAAQ,OAAgC,SAAVY,EAAmB,kCAAoC,qBAAsBQ,UAACtB,EAAAA,EAAAA,KAAC2lB,EAAAA,IAAO,UAEhL3lB,EAAAA,EAAAA,KAAA,OAAKN,UAAS,+BAAAQ,OAA2C,SAAVY,EAAmB,kBAAoB,mBAAoBQ,SACrG,CAAC,WAAY,UAAW,QAAS,QAAS,SAASkR,IAAI2X,IACpDnqB,EAAAA,EAAAA,KAAA,UAAkBwB,QAASA,IAAM+J,GAAsB4e,GAAMzqB,UAAS,oCAAAQ,OAAsCoL,KAAuB6e,EAAM,2CAAwD,SAAVrpB,EAAmB,kCAAoC,mCAAqCQ,SAC9Q6oB,GADQA,OAKrB9oB,EAAAA,EAAAA,MAAA,OAAK3B,UAAU,gCAA+B4B,SAAA,CAClB,aAAvBgK,KACGjK,EAAAA,EAAAA,MAAA,OAAK3B,UAAU,mDAAkD4B,SAAA,EAC7DtB,EAAAA,EAAAA,KAAA,OAAKN,UAAS,2DAAAQ,OAAuE,SAAVY,EAAmB,cAAgB,eAAgBQ,UAC1HtB,EAAAA,EAAAA,KAACuH,EAAAA,IAAO,CAAC7H,UAAU,gBAAgB0D,KAAM,QAE7CpD,EAAAA,EAAAA,KAAA,MAAIN,UAAU,qBAAoB4B,SAAEyiB,GAAgBzc,QACpDjG,EAAAA,EAAAA,MAAA,KAAG3B,UAAS,iBAAAQ,OAA6B,SAAVY,EAAmB,gBAAkB,IAAKQ,SAAA,CAAEyiB,GAAgBqB,aAAe,EAAE,iBAG5F,YAAvB9Z,KACGtL,EAAAA,EAAAA,KAAA,OAAKN,UAAU,YAAW4B,SACrBoK,IACG1L,EAAAA,EAAAA,KAAA,KAAGN,UAAU,4BAA2B4B,SAAC,uBAEzCkK,GAAagH,IAAI,CAACyR,EAAQllB,KACtBsC,EAAAA,EAAAA,MAAA,OAEI3B,UAAS,yDAAAQ,OAAqE,SAAVY,EAAmB,oBAAsB,oBAC7GU,QAASA,KACL6J,IAAwB,GACxBpD,EAAS,cAAD/H,OAAeuH,EAAYiJ,GAAE,YAAAxQ,OAAW+jB,EAAOC,cACzD5iB,SAAA,CACL,mDAAiD2iB,EAAOG,eACrDpkB,EAAAA,EAAAA,KAAA,OAAKuD,IAAK0gB,EAAOG,cAAe/c,IAAK4c,EAAOE,YAAazkB,UAAU,yCAEnEM,EAAAA,EAAAA,KAAA,OAAKN,UAAS,2DAAAQ,OAAuE,SAAVY,EAAmB,cAAgB,eAAgBQ,UAC1HtB,EAAAA,EAAAA,KAAC8kB,EAAAA,IAAM,CAACplB,UAAS,gBAAmB0D,KAAM,QAG9C/B,EAAAA,EAAAA,MAAA,OAAAC,SAAA,EACItB,EAAAA,EAAAA,KAAA,QAAMN,UAAS,iBAAAQ,OAA6B,SAAVY,EAAmB,aAAe,iBAAkBQ,SAAE2iB,EAAOE,cAC9FF,EAAOmG,kBAAmBpqB,EAAAA,EAAAA,KAAA,KAAGN,UAAS,WAAAQ,OAAuB,SAAVY,EAAmB,gBAAkB,iBAAkBQ,SAAE2iB,EAAOmG,uBAfnHnG,EAAOC,YAAcnlB,MAsBtB,UAAvBuM,KACGwC,IAAsB9N,EAAAA,EAAAA,KAAA,KAAGN,UAAU,gCAA+B4B,SAAC,sBAC/DtB,EAAAA,EAAAA,KAAA,OAAKN,UAAU,wCAAuC4B,SACjDkM,GAAWsD,OAAS,EAAItD,GAAWgF,IAAI,CAAC5R,EAAK7B,KAC1CiB,EAAAA,EAAAA,KAAA,UAAgBwB,QAASA,IAAMuK,GAAesY,GAAWzjB,IAAMU,UAC3DtB,EAAAA,EAAAA,KAAA,OAAKuD,IAAK8gB,GAAWzjB,GAAMyG,IAAKzG,EAAInB,SAAUC,UAAU,yEAD/CX,KAGZiB,EAAAA,EAAAA,KAAA,KAAGN,UAAU,8CAA6C4B,SAAC,uBAIpD,UAAvBgK,KACGwC,IAAsB9N,EAAAA,EAAAA,KAAA,KAAGN,UAAU,gCAA+B4B,SAAC,sBAC/DtB,EAAAA,EAAAA,KAAA,OAAKN,UAAU,YAAW4B,SACrBoM,GAAWoD,OAAS,EAAIpD,GAAW8E,IAAI6X,IACpCrqB,EAAAA,EAAAA,KAACU,EAAW,CAAkBE,IAAKypB,EAASxpB,aAAa,EAAOC,MAAOA,GAArDupB,EAAQ3Z,MACzB1Q,EAAAA,EAAAA,KAAA,KAAGN,UAAU,gCAA+B4B,SAAC,oCAItC,UAAvBgK,KACGwC,IAAsB9N,EAAAA,EAAAA,KAAA,KAAGN,UAAU,gCAA+B4B,SAAC,sBAC/DtB,EAAAA,EAAAA,KAAA,OAAKN,UAAU,YAAW4B,SACrB,MACG,MAAMgpB,EAAW1c,GAAW2c,QAAQC,IAChC,MACMlN,EAAQkN,EAAQppB,QAAQqpB,MADZ,wBAElB,OAAOnN,EAAQA,EAAM9K,IAAIlQ,IAAI,CACzBoO,GAAI8Z,EAAQ9Z,GACZga,IAAKpoB,EACLyR,OAAQiQ,GAAcwG,EAAQzW,QAAQzM,KACtCgN,UAAWkW,EAAQlW,aACjB,KAGV,OAAOgW,EAASxZ,OAAS,EACrBwZ,EAAS9X,IAAI,CAAClQ,EAAM0H,KAChB3I,EAAAA,EAAAA,MAAA,OAAiC3B,UAAS,kBAAAQ,OAA8B,SAAVY,EAAmB,cAAgB,eAAgBQ,SAAA,EAC7GtB,EAAAA,EAAAA,KAAA,KAAGyC,KAAMH,EAAKooB,IAAK5M,OAAO,SAAS6M,IAAI,sBAAsBjrB,UAAU,0CAAyC4B,SAAEgB,EAAKooB,OACvHrpB,EAAAA,EAAAA,MAAA,KAAG3B,UAAS,gBAAAQ,OAA4B,SAAVY,EAAmB,gBAAkB,iBAAkBQ,SAAA,CAAC,aAAWgB,EAAKyR,OAAO,OAAK,IAAI3B,KAAK9P,EAAKgS,WAAWoP,0BAAyB,GAAAxjB,OAF3JoC,EAAKoO,GAAE,KAAAxQ,OAAI8J,MAM5BhK,EAAAA,EAAAA,KAAA,KAAGN,UAAS,mBAAAQ,OAA+B,SAAVY,EAAmB,gBAAkB,iBAAkBQ,SAAC,gCAEhG,EAtBA,cA8B5BwK,KACG9L,EAAAA,EAAAA,KAAA,OAAKN,UAAU,gFAAgF8B,QAASA,IAAMuK,GAAe,MAAMzK,UAC/HtB,EAAAA,EAAAA,KAAA,OAAKuD,IAAKuI,GAAazE,IAAI,YAAY3H,UAAU,2CAA2C8B,QAAUE,GAAMA,EAAEE,sBAIrHwK,KACGpM,EAAAA,EAAAA,KAAA,OAAKN,UAAU,wEAAuE4B,UAClFD,EAAAA,EAAAA,MAAA,OAAK3B,UAAS,4CAAAQ,OAAwD,SAAVY,EAAmB,cAAgB,YAAaQ,SAAA,EACxGtB,EAAAA,EAAAA,KAAA,MAAIN,UAAS,0BAAAQ,OAAsC,SAAVY,EAAmB,aAAe,iBAAkBQ,SAAC,iBAC9FtB,EAAAA,EAAAA,KAAA,KAAGN,UAAS,QAAAQ,OAAoB,SAAVY,EAAmB,gBAAkB,iBAAkBQ,SAAC,6FAC9ED,EAAAA,EAAAA,MAAA,OAAK3B,UAAU,yBAAwB4B,SAAA,EACnCtB,EAAAA,EAAAA,KAAA,UAAQwB,QAASA,IAAM6K,IAAoB,GAAQ3M,UAAS,oEAAAQ,OAAgF,SAAVY,EAAmB,2CAA6C,IAAKQ,SAAC,YAGxMtB,EAAAA,EAAAA,KAAA,UAAQwB,QA94BDC,UAC3B,GAAKgH,EACL,UACUmiB,EAAAA,EAAAA,IAAiBnjB,EAAYiJ,GAAIjI,EAAakI,QACpD7H,EAAYkK,IAAIP,EAAAA,EAAAA,IAAAA,EAAAA,EAAAA,GAAA,GAAUO,GAAI,IAAE,CAACvK,EAAakI,QAAS,MACvDgD,GAAkBlL,EAAakI,OAAQ,KAC3C,CAAE,MAAO3N,GACLC,QAAQD,MAAM,wBAAyBA,EAC3C,CAAC,QACGqJ,IAAoB,EACxB,GAo4B6D3M,UAAU,8DAA6D4B,SAAC,yBAS7I,EC30EMupB,EAAuBA,KACzBxpB,EAAAA,EAAAA,MAAA,OAAK3B,UAAU,kCAAiC4B,SAAA,EAC5CtB,EAAAA,EAAAA,KAAA,OAAKN,UAAU,sDACf2B,EAAAA,EAAAA,MAAA,OAAK3B,UAAU,mBAAkB4B,SAAA,EAC7BtB,EAAAA,EAAAA,KAAA,OAAKN,UAAU,iDACfM,EAAAA,EAAAA,KAAA,OAAKN,UAAU,sDAKrBorB,EAAkBvrB,IAAA,IAAC,MAAEuB,GAAOvB,EAAA,OAC9B8B,EAAAA,EAAAA,MAAA,OAAK3B,UAAS,0CAAAQ,OAAsD,SAAVY,EAAmB,cAAgB,eAAgBQ,SAAA,EAEzGD,EAAAA,EAAAA,MAAA,OAAK3B,UAAS,gFAAAQ,OAA4F,SAAVY,EAAmB,cAAgB,YAAaQ,SAAA,EAC5ItB,EAAAA,EAAAA,KAAA,OAAKN,UAAU,oDACf2B,EAAAA,EAAAA,MAAA,OAAK3B,UAAU,2CAA0C4B,SAAA,EACrDtB,EAAAA,EAAAA,KAAC6qB,EAAoB,KACrB7qB,EAAAA,EAAAA,KAAC6qB,EAAoB,KACrB7qB,EAAAA,EAAAA,KAAC6qB,EAAoB,KACrB7qB,EAAAA,EAAAA,KAAC6qB,EAAoB,KACrB7qB,EAAAA,EAAAA,KAAC6qB,EAAoB,KACrB7qB,EAAAA,EAAAA,KAAC6qB,EAAoB,KACrB7qB,EAAAA,EAAAA,KAAC6qB,EAAoB,KACrB7qB,EAAAA,EAAAA,KAAC6qB,EAAoB,KACrB7qB,EAAAA,EAAAA,KAAC6qB,EAAoB,KACrB7qB,EAAAA,EAAAA,KAAC6qB,EAAoB,KACrB7qB,EAAAA,EAAAA,KAAC6qB,EAAoB,KACrB7qB,EAAAA,EAAAA,KAAC6qB,EAAoB,WAK7B7qB,EAAAA,EAAAA,KAAA,OAAKN,UAAS,kEAAAQ,OAA8E,SAAVY,EAAmB,cAAgB,YAAaQ,UAC9HtB,EAAAA,EAAAA,KAAA,OAAKN,UAAU,0CAAyC4B,UACpDtB,EAAAA,EAAAA,KAAA,OAAKN,UAAU,cAAa4B,UACxBtB,EAAAA,EAAAA,KAAA,KAAGN,UAAS,WAAAQ,OAAgC,iBAAoCoB,SAAC,+BAqHrG,QA7GA,WACI,MAAM,OAAEqY,IAAWoR,EAAAA,EAAAA,MACb,MAAEjqB,EAAK,SAACkqB,IAAYtc,EAAAA,EAAAA,YAAWC,EAAAA,KAC9Bsc,EAAUC,IAAennB,EAAAA,EAAAA,UAAS,CAAEsE,OAAQ,GAAIC,iBAAkB,MAClE6iB,EAAWC,IAAgBrnB,EAAAA,EAAAA,WAAS,IACpC+D,EAAgBujB,IAAqBtnB,EAAAA,EAAAA,WAAS,IAC9CunB,EAAMC,IAAWxnB,EAAAA,EAAAA,UAAS,IAC1B8D,EAAS2jB,IAAcznB,EAAAA,EAAAA,WAAS,GAEjC0nB,GAAe7nB,EAAAA,EAAAA,SAAO,GAEtB6D,EAAc,CAChBH,MAAc,OAAR0jB,QAAQ,IAARA,OAAQ,EAARA,EAAU7G,cAAe,MAC/BzT,GAAIiJ,EACJvS,SAAiB,OAAR4jB,QAAQ,IAARA,OAAQ,EAARA,EAAU5G,gBAAiB,sDAGlCsH,EAAYjqB,UAGd,GAFAwB,QAAQ/D,IAAI,2CAADgB,OAA4C2S,GAAW,mCAE7DhL,IAAW4jB,EAAa/mB,QAA7B,CAKA+mB,EAAa/mB,SAAU,EAEP,IAAZmO,EACAuY,GAAa,GAEbC,GAAkB,GAGtB,IACIpoB,QAAQ/D,IAAI,oCAADgB,OAAqC2S,GAAW,iBAC3D,MAAM8Y,QAAwBC,EAAAA,EAAAA,IAAgBjS,EAAQ9G,EAAS,IAE/D,GAA+B,IAA3B8Y,EAAgB7a,OAEhB,YADA0a,GAAW,GAIf,MAAMK,GAAoB9Z,EAAAA,EAAAA,IAA4B4Z,EAAiBhS,GAEvEuR,EAAYY,IACR,GAAgB,IAAZjZ,EACA,OAAOgZ,EAEX,MAAME,EAAmB,IAAIjR,IAAIgR,EAAazjB,OAAOmK,IAAIsG,GAAKA,EAAEnI,SAC1Dqb,EAAqB,IAAIlR,IAAIgR,EAAaxjB,iBAAiBkK,IAAI6F,GAAKA,EAAE1H,SACtEsb,EAAkBJ,EAAkBxjB,OAAOkP,OAAOuB,IAAMiT,EAAiBxQ,IAAIzC,EAAEnI,SAC/Eub,EAAmBL,EAAkBvjB,iBAAiBiP,OAAOc,IAAM2T,EAAmBzQ,IAAIlD,EAAE1H,SAClG,MAAO,CACHtI,OAAQ,IAAIyjB,EAAazjB,UAAW4jB,GACpC3jB,iBAAkB,IAAIwjB,EAAaxjB,oBAAqB4jB,MAI5DP,EAAgB7a,OAAS,IACzB0a,GAAW,EAEnB,CAAE,MAAOxoB,GACLC,QAAQD,MAAM,uBAAwBA,EAC1C,CAAC,QACmB,IAAZ6P,GACAuY,GAAa,GAEjBC,GAAkB,GAElBI,EAAa/mB,SAAU,EACvBzB,QAAQ/D,IAAI,8BAADgB,OAA+B2S,EAAO,oBAAoB,iBACzE,CAhDA,MAFI5P,QAAQ/D,IAAI,uBAADgB,OAAwB2S,EAAO,sBAAA3S,OAAqB2H,EAAO,2BAAA3H,OAA0BurB,EAAa/mB,SAAW,gBAsEhI,OANAF,EAAAA,EAAAA,WAAU,KACFmV,GACA+R,EAAU,IAEf,CAAC/R,KAGA3Z,EAAAA,EAAAA,KAAA,OAAKN,UAAS,sBAAAQ,OAAkC,SAAVY,EAAmB,cAAgB,eAAgBQ,SACpF6pB,GACGnrB,EAAAA,EAAAA,KAAC8qB,EAAe,CAAChqB,MAAOA,KAExBd,EAAAA,EAAAA,KAACmsB,EAAe,CACZ1kB,YAAaA,EACbC,MAAOujB,EACPrjB,cAzBOwkB,KAEnB,GADAnpB,QAAQ/D,IAAI,6BACRusB,EAAa/mB,UAAYmD,EAEzB,YADA5E,QAAQ/D,IAAI,uDAGhB,MAAM+mB,EAAWqF,EAAO,EACxBC,EAAQtF,GACRyF,EAAUzF,IAkBEpe,QAASA,EACTC,eAAgBA,EAChBhH,MAAOA,KAK3B,C","sources":["TechLife/HRMS/Components/Chats/ChatApplication.jsx","TechLife/HRMS/Components/Chats/ChatApp.jsx"],"sourcesContent":["import React, { useEffect, useState, useRef, useMemo, useCallback, useContext } from 'react';\r\nimport { useLocation, useNavigate } from 'react-router-dom';\r\nimport { Context } from '../HrmsContext';\r\nimport { Client } from '@stomp/stompjs';\r\nimport {\r\n    FaMicrophone, FaPaperclip, FaSmile, FaPaperPlane, FaArrowLeft, FaStop,\r\n    FaFileAlt, FaDownload, FaPlay, FaPause, FaReply, FaEdit, FaThumbtack, FaShare, FaTrash, FaTimes, FaCheck,\r\n    FaChevronDown, FaImage, FaFileAudio, FaAngleDoubleRight, FaUsers, FaUser,\r\n    FaFilePdf, FaFileWord, FaFilePowerpoint, FaFileExcel, FaFileArchive, FaChevronUp, FaCheckDouble, FaEye\r\n} from 'react-icons/fa';\r\nimport { BsThreeDotsVertical } from 'react-icons/bs';\r\nimport EmojiPicker from 'emoji-picker-react';\r\nimport {\r\n    getMessages,\r\n    deleteMessageForMe,\r\n    deleteMessageForEveryone,\r\n    uploadFile,\r\n    forwardMessage,\r\n    getPinnedMessage,\r\n    pinMessage,\r\n    unpinMessage,\r\n    clearChatHistory,\r\n    uploadVoiceMessage,\r\n    getGroupMembers,\r\n    searchMessages,\r\n    getMessageContext,\r\n    getChatAttachments,\r\n    searchChatOverview\r\n} from '../../../../services/apiService';\r\nimport { transformMessageDTOToUIMessage, generateChatListPreview, transformOverviewToChatList } from '../../../../services/dataTransformer';\r\nimport { chatApi } from '../../../../axiosInstance';\r\n\r\n// Utility function to convert file size from bytes to a human-readable string (KB, MB, GB, etc.)\r\nconst formatFileSize = (bytes) => {\r\n    if (!bytes || bytes === 0) return '0 Bytes';\r\n    const k = 1024;\r\n    const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];\r\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\r\n    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\r\n};\r\n\r\n// Component to display the correct icon based on the file extension (PDF, Word, Image, etc.)\r\nconst FileIcon = ({ fileName, className = \"text-3xl\" }) => {\r\n    const extension = fileName?.split('.').pop()?.toLowerCase();\r\n    if (['pdf'].includes(extension)) return <FaFilePdf className={`text-red-500 ${className}`} />;\r\n    if (['doc', 'docx'].includes(extension)) return <FaFileWord className={`text-blue-700 ${className}`} />;\r\n    if (['ppt', 'pptx'].includes(extension)) return <FaFilePowerpoint className={`text-orange-500 ${className}`} />;\r\n    if (['xls', 'xlsx'].includes(extension)) return <FaFileExcel className={`text-green-600 ${className}`} />;\r\n    if (['zip', 'rar', '7z'].includes(extension)) return <FaFileArchive className={`text-yellow-500 ${className}`} />;\r\n    if (['png', 'jpg', 'jpeg', 'gif', 'webp'].includes(extension)) return <FaImage className={`text-purple-500 ${className}`} />;\r\n    if (['mp3', 'wav', 'ogg'].includes(extension)) return <FaFileAudio className={`text-pink-500 ${className}`} />;\r\n    return <FaFileAlt className={`text-gray-500 ${className}`} />;\r\n};\r\n\r\n// Component to render a non-image file message (document, zip, etc.) with a download button\r\nconst FileMessage = ({ msg, isMyMessage, theme }) => {\r\n    const downloadUrl = `${chatApi.defaults.baseURL}/chat/file/${msg.messageId}`;\r\n\r\n    const handleDownloadClick = async (e) => {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        try {\r\n            const response = await fetch(downloadUrl);\r\n            if (!response.ok) {\r\n                throw new Error('Network response was not ok');\r\n            }\r\n            const blob = await response.blob();\r\n            const blobUrl = window.URL.createObjectURL(blob);\r\n            const link = document.createElement('a');\r\n            link.href = blobUrl;\r\n            link.setAttribute('download', msg.fileName || 'download');\r\n            document.body.appendChild(link);\r\n            link.click();\r\n            link.remove();\r\n            window.URL.revokeObjectURL(blobUrl);\r\n        } catch (error) {\r\n            console.error('Download failed:', error);\r\n            window.open(downloadUrl, '_blank');\r\n        }\r\n    };\r\n\r\n    const content = (\r\n        <div className={`flex items-center gap-3 p-2 rounded-lg max-w-xs md:max-w-sm ${isMyMessage ? 'bg-blue-600' : (theme === 'dark' ? 'bg-gray-700' : 'bg-gray-200')}`}>\r\n            <div className=\"flex-shrink-0 p-2 bg-white/20 rounded-lg\">\r\n                <FileIcon fileName={msg.fileName} className=\"text-4xl\" />\r\n            </div>\r\n            <div className=\"flex-grow overflow-hidden mr-2\">\r\n                <p className={`font-semibold truncate ${isMyMessage ? 'text-white' : (theme === 'dark' ? 'text-white' : 'text-gray-800')}`}>{msg.fileName}</p>\r\n                <p className={`text-sm ${isMyMessage ? 'text-blue-200' : (theme === 'dark' ? 'text-gray-400' : 'text-gray-600')}`}>{formatFileSize(msg.fileSize)}</p>\r\n            </div>\r\n            <div\r\n                onClick={handleDownloadClick}\r\n                className=\"flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center bg-black/20 hover:bg-black/30 text-white transition-colors cursor-pointer\"\r\n            >\r\n                <FaDownload size={18} />\r\n            </div>\r\n        </div>\r\n    );\r\n    return !isMyMessage ? <div onClick={() => window.open(downloadUrl, '_blank')} className=\"cursor-pointer\">{content}</div> : content;\r\n};\r\n\r\n// Component to handle playback, progress, and download of audio/voice messages. It fetches the audio blob on demand if a local source isn't present.\r\nconst AudioPlayer = ({ src, fileUrl, isSender, initialDuration = 0, fileSize = 0, theme }) => {\r\n    const audioRef = useRef(null);\r\n    const [isPlaying, setIsPlaying] = useState(false);\r\n    const [progress, setProgress] = useState(0);\r\n    const [duration, setDuration] = useState(initialDuration);\r\n    const [localSrc, setLocalSrc] = useState(src || null);\r\n    const [isDownloading, setIsDownloading] = useState(false);\r\n\r\n    useEffect(() => {\r\n        const audio = audioRef.current;\r\n        if (!audio) return;\r\n\r\n        const setAudioData = () => {\r\n            if (audio.duration !== Infinity && audio.duration > 0) {\r\n                setDuration(audio.duration);\r\n            }\r\n        };\r\n        const setAudioTime = () => setProgress(audio.currentTime);\r\n        const handleEnded = () => setIsPlaying(false);\r\n\r\n        audio.addEventListener('loadedmetadata', setAudioData);\r\n        audio.addEventListener('timeupdate', setAudioTime);\r\n        audio.addEventListener('ended', handleEnded);\r\n\r\n        return () => {\r\n            audio.removeEventListener('loadedmetadata', setAudioData);\r\n            audio.removeEventListener('timeupdate', setAudioTime);\r\n            audio.removeEventListener('ended', handleEnded);\r\n        };\r\n    }, [localSrc]);\r\n\r\n    const handleDownload = async () => {\r\n        if (isDownloading) return;\r\n        setIsDownloading(true);\r\n        try {\r\n            const response = await fetch(fileUrl);\r\n            const blob = await response.blob();\r\n            const localUrl = URL.createObjectURL(blob);\r\n            setLocalSrc(localUrl);\r\n        } catch (error) {\r\n            console.error(\"Failed to download audio:\", error);\r\n        } finally {\r\n            setIsDownloading(false);\r\n        }\r\n    };\r\n\r\n    const togglePlayPause = () => {\r\n        if (!audioRef.current) return;\r\n        if (isPlaying) {\r\n            audioRef.current.pause();\r\n        } else {\r\n            audioRef.current.play().catch(e => console.error(\"Audio play failed:\", e));\r\n        }\r\n        setIsPlaying(!isPlaying);\r\n    };\r\n\r\n    const formatTime = (time) => {\r\n        if (!time || time === Infinity) return '0:00';\r\n        const minutes = Math.floor(time / 60);\r\n        const seconds = Math.floor(time % 60);\r\n        return `${minutes}:${seconds.toString().padStart(2, '0')}`;\r\n    };\r\n\r\n    const progressPercentage = duration ? (progress / duration) * 100 : 0;\r\n\r\n    if (!localSrc) {\r\n        return (\r\n            <div className=\"flex items-center gap-3 p-2 w-64\">\r\n                {isDownloading ? (\r\n                    <div className=\"flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center bg-gray-400 bg-opacity-30\">\r\n                        <div className=\"animate-spin rounded-full h-5 w-5 border-b-2 border-white\"></div>\r\n                    </div>\r\n                ) : (\r\n                    <button onClick={handleDownload} className=\"flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center bg-gray-400 bg-opacity-30 text-white hover:bg-opacity-40 transition-colors\">\r\n                        <FaDownload size={16} />\r\n                    </button>\r\n                )}\r\n                <div className=\"flex-grow flex flex-col justify-center\">\r\n                    <p className={`text-sm ${isSender ? 'text-white' : (theme === 'dark' ? 'text-white' : 'text-gray-700')}`}>Voice Message</p>\r\n                    <div className=\"flex justify-between items-center mt-1\">\r\n                        <span className={`text-xs ${isSender ? 'text-blue-200' : (theme === 'dark' ? 'text-gray-400' : 'text-gray-500')}`}>{formatFileSize(fileSize)}</span>\r\n                        <span className={`text-xs ${isSender ? 'text-blue-200' : (theme === 'dark' ? 'text-gray-400' : 'text-gray-500')}`}>{formatTime(duration)}</span>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n    return (\r\n        <div className=\"flex items-center gap-3 p-2 w-64\">\r\n            <audio ref={audioRef} src={localSrc} preload=\"metadata\" />\r\n            <button onClick={togglePlayPause} className={`flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center ${isSender ? 'bg-white text-blue-600' : (theme === 'dark' ? 'bg-gray-400 bg-opacity-30 text-white' : 'bg-gray-400 bg-opacity-30 text-white')}`}>\r\n                {isPlaying ? <FaPause size={16} /> : <FaPlay size={16} className=\"ml-1\" />}\r\n            </button>\r\n            <div className=\"flex-grow flex flex-col justify-center\">\r\n                <div className=\"w-full h-1.5 bg-black/20 rounded-full cursor-pointer\" onClick={(e) => {\r\n                    if (!duration) return;\r\n                    const rect = e.currentTarget.getBoundingClientRect();\r\n                    const clickX = e.clientX - rect.left;\r\n                    const newTime = (clickX / rect.width) * duration;\r\n                    if (audioRef.current) audioRef.current.currentTime = newTime;\r\n                }}>\r\n                    <div style={{ width: `${progressPercentage}%` }} className={`h-full rounded-full ${isSender ? 'bg-white' : (theme === 'dark' ? 'bg-gray-300' : 'bg-gray-300')}`}></div>\r\n                </div>\r\n                <span className={`text-xs self-end mt-1 ${isSender ? 'text-blue-200' : (theme === 'dark' ? 'text-gray-400' : 'text-gray-500')}`}>{formatTime(duration)}</span>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n// Component for displaying animated loading states (skeletons) for messages while content is fetched.\r\nconst MessageSkeleton = ({ theme }) => (\r\n    <div className=\"space-y-4 p-4\">\r\n        <div className=\"flex items-end gap-2 justify-start\">\r\n            <div className={`w-8 h-8 rounded-full ${theme === 'dark' ? 'bg-gray-700' : 'bg-gray-200'} animate-pulse flex-shrink-0`}></div>\r\n            <div className={`h-10 rounded-lg ${theme === 'dark' ? 'bg-gray-700' : 'bg-gray-200'} animate-pulse w-48`}></div>\r\n        </div>\r\n        <div className=\"flex items-end gap-2 justify-end\">\r\n            <div className={`h-12 rounded-lg ${theme === 'dark' ? 'bg-blue-700' : 'bg-blue-200'} animate-pulse w-32`}></div>\r\n            <div className={`w-8 h-8 rounded-full ${theme === 'dark' ? 'bg-gray-700' : 'bg-gray-200'} animate-pulse flex-shrink-0`}></div>\r\n        </div>\r\n        <div className=\"flex items-end gap-2 justify-start\">\r\n            <div className={`w-8 h-8 rounded-full ${theme === 'dark' ? 'bg-gray-700' : 'bg-gray-200'} animate-pulse flex-shrink-0`}></div>\r\n            <div className={`h-16 rounded-lg ${theme === 'dark' ? 'bg-gray-700' : 'bg-gray-200'} animate-pulse w-64`}></div>\r\n        </div>\r\n        <div className=\"flex items-end gap-2 justify-end\">\r\n            <div className={`h-10 rounded-lg ${theme === 'dark' ? 'bg-blue-700' : 'bg-blue-200'} animate-pulse w-40`}></div>\r\n            <div className={`w-8 h-8 rounded-full ${theme === 'dark' ? 'bg-gray-700' : 'bg-gray-200'} animate-pulse flex-shrink-0`}></div>\r\n        </div>\r\n        <div className=\"flex items-end gap-2 justify-start\">\r\n            <div className={`w-8 h-8 rounded-full ${theme === 'dark' ? 'bg-gray-700' : 'bg-gray-200'} animate-pulse flex-shrink-0`}></div>\r\n            <div className={`h-10 rounded-lg ${theme === 'dark' ? 'bg-gray-700' : 'bg-gray-200'} animate-pulse w-32`}></div>\r\n        </div>\r\n        <div className=\"flex items-end gap-2 justify-start\">\r\n            <div className={`w-8 h-8 rounded-full ${theme === 'dark' ? 'bg-gray-700' : 'bg-gray-200'} animate-pulse flex-shrink-0`}></div>\r\n            <div className={`h-10 rounded-lg ${theme === 'dark' ? 'bg-gray-700' : 'bg-gray-200'} animate-pulse w-48`}></div>\r\n        </div>\r\n        <div className=\"flex items-end gap-2 justify-end\">\r\n            <div className={`h-12 rounded-lg ${theme === 'dark' ? 'bg-blue-700' : 'bg-blue-200'} animate-pulse w-32`}></div>\r\n            <div className={`w-8 h-8 rounded-full ${theme === 'dark' ? 'bg-gray-700' : 'bg-gray-200'} animate-pulse flex-shrink-0`}></div>\r\n        </div>\r\n        <div className=\"flex items-end gap-2 justify-start\">\r\n            <div className={`w-8 h-8 rounded-full ${theme === 'dark' ? 'bg-gray-700' : 'bg-gray-200'} animate-pulse flex-shrink-0`}></div>\r\n            <div className={`h-16 rounded-lg ${theme === 'dark' ? 'bg-gray-700' : 'bg-gray-200'} animate-pulse w-64`}></div>\r\n        </div>\r\n        <div className=\"flex items-end gap-2 justify-end\">\r\n            <div className={`h-10 rounded-lg ${theme === 'dark' ? 'bg-blue-700' : 'bg-blue-200'} animate-pulse w-40`}></div>\r\n            <div className={`w-8 h-8 rounded-full ${theme === 'dark' ? 'bg-gray-700' : 'bg-gray-200'} animate-pulse flex-shrink-0`}></div>\r\n        </div>\r\n        <div className=\"flex items-end gap-2 justify-start\">\r\n            <div className={`w-8 h-8 rounded-full ${theme === 'dark' ? 'bg-gray-700' : 'bg-gray-200'} animate-pulse flex-shrink-0`}></div>\r\n            <div className={`h-10 rounded-lg ${theme === 'dark' ? 'bg-gray-700' : 'bg-gray-200'} animate-pulse w-32`}></div>\r\n        </div>\r\n        <div className=\"flex items-end gap-2 justify-start\">\r\n            <div className={`w-8 h-8 rounded-full ${theme === 'dark' ? 'bg-gray-700' : 'bg-gray-200'} animate-pulse flex-shrink-0`}></div>\r\n            <div className={`h-10 rounded-lg ${theme === 'dark' ? 'bg-gray-700' : 'bg-gray-200'} animate-pulse w-48`}></div>\r\n        </div>\r\n        <div className=\"flex items-end gap-2 justify-end\">\r\n            <div className={`h-12 rounded-lg ${theme === 'dark' ? 'bg-blue-700' : 'bg-blue-200'} animate-pulse w-32`}></div>\r\n            <div className={`w-8 h-8 rounded-full ${theme === 'dark' ? 'bg-gray-700' : 'bg-gray-200'} animate-pulse flex-shrink-0`}></div>\r\n        </div>\r\n        <div className=\"flex items-end gap-2 justify-start\">\r\n            <div className={`w-8 h-8 rounded-full ${theme === 'dark' ? 'bg-gray-700' : 'bg-gray-200'} animate-pulse flex-shrink-0`}></div>\r\n            <div className={`h-16 rounded-lg ${theme === 'dark' ? 'bg-gray-700' : 'bg-gray-200'} animate-pulse w-64`}></div>\r\n        </div>\r\n    </div>\r\n);\r\n\r\n// Utility function using Web Audio API to calculate the duration of an audio Blob before upload.\r\nconst getAudioDuration = (audioBlob) =>\r\n    new Promise((resolve) => {\r\n        const reader = new FileReader();\r\n\r\n        reader.onload = (event) => {\r\n            const audioContext = new (window.AudioContext || window.webkitAudioContext)();\r\n            audioContext.decodeAudioData(event.target.result,\r\n                (buffer) => {\r\n                    const duration = buffer.duration ? Math.round(buffer.duration) : 0;\r\n                    audioContext.close();\r\n                    resolve(duration);\r\n                },\r\n                (error) => {\r\n                    console.error(\"Error decoding audio data:\", error);\r\n                    audioContext.close();\r\n                    resolve(0);\r\n                }\r\n            );\r\n        };\r\n\r\n        reader.onerror = (error) => {\r\n            console.error(\"Error reading blob as ArrayBuffer:\", error);\r\n            resolve(0);\r\n        };\r\n\r\n        reader.readAsArrayBuffer(audioBlob);\r\n    });\r\n\r\n// Modal component for displaying a contact's profile picture in full view on mobile devices.\r\nconst ContactProfileModal = ({ chat, onClose, theme }) => {\r\n    const [isZoomed, setIsZoomed] = useState(false);\r\n\r\n    if (isZoomed && chat.type === 'private') {\r\n        return (\r\n            <div\r\n                className=\"fixed inset-0 bg-black bg-opacity-90 flex justify-center items-center z-[120]\"\r\n                onClick={() => setIsZoomed(false)}\r\n            >\r\n                <img\r\n                    src={chat?.profile}\r\n                    alt={chat?.name}\r\n                    className=\"max-w-[90vw] max-h-[90vh] object-contain\"\r\n                />\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div\r\n            className=\"fixed inset-0 bg-black/30 backdrop-blur-sm flex justify-center items-center z-[110] md:hidden\"\r\n            onClick={onClose}\r\n        >\r\n            <div\r\n                className=\"relative w-11/12 max-w-xs cursor-pointer\"\r\n                onClick={(e) => {\r\n                    e.stopPropagation();\r\n                    if (chat.type === 'private') setIsZoomed(true);\r\n                }}\r\n            >\r\n                {chat.type === 'group' ? (\r\n                    <div className=\"w-full aspect-square bg-gray-700 rounded-lg shadow-lg flex items-center justify-center\">\r\n                        <FaUsers className=\"text-gray-400\" size={120} />\r\n                    </div>\r\n                ) : (\r\n                    <img\r\n                        src={chat?.profile}\r\n                        alt={chat?.name}\r\n                        className=\"w-full aspect-square object-cover rounded-lg shadow-lg\"\r\n                    />\r\n                )}\r\n                <div className=\"absolute bottom-0 left-0 right-0 p-3 bg-gradient-to-t from-black/80 to-transparent rounded-b-lg\">\r\n                    <h3 className=\"text-xl font-bold text-white text-center truncate\">{chat?.name}</h3>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nfunction ChatApplication({ currentUser, chats: initialChats, loadMoreChats, hasMore, isFetchingMore, theme }) {\r\n    const location = useLocation();\r\n    const navigate = useNavigate();\r\n    const [chatData, setChatData] = useState({ groups: [], privateChatsWith: [] });\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n    const [selectedChat, setSelectedChat] = useState(null);\r\n    const [message, setMessage] = useState('');\r\n    const [messages, setMessages] = useState({});\r\n    const [isMessagesLoading, setIsMessagesLoading] = useState(false);\r\n    const [isChatOpen, setIsChatOpen] = useState(false);\r\n    const [showEmojiPicker, setShowEmojiPicker] = useState(false);\r\n    const [isRecording, setIsRecording] = useState(false);\r\n    const [showChatMenu, setShowChatMenu] = useState(false);\r\n    const [downloadedMedia, setDownloadedMedia] = useState({});\r\n    const [contextMenu, setContextMenu] = useState({ visible: false, x: 0, y: 0, message: null, index: null });\r\n    const [editingInfo, setEditingInfo] = useState({ index: null, originalContent: '' });\r\n    const [replyingTo, setReplyingTo] = useState(null);\r\n    const [lastDeleted, setLastDeleted] = useState(null);\r\n    const [pinnedMessage, setPinnedMessage] = useState(null);\r\n    const [forwardingInfo, setForwardingInfo] = useState({ visible: false, message: null });\r\n    const [forwardRecipients, setForwardRecipients] = useState([]);\r\n    const [forwardSearchTerm, setForwardSearchTerm] = useState('');\r\n    const [showPinnedMenu, setShowPinnedMenu] = useState(false);\r\n    const [isProfileModalOpen, setIsProfileModalOpen] = useState(false);\r\n    const [isGroupInfoModalOpen, setIsGroupInfoModalOpen] = useState(false);\r\n    const [activeGroupInfoTab, setActiveGroupInfoTab] = useState('Overview');\r\n    const [groupMembers, setGroupMembers] = useState([]);\r\n    const [isGroupDataLoading, setIsGroupDataLoading] = useState(false);\r\n    const [groupMembersCache, setGroupMembersCache] = useState({});\r\n    const [imageInView, setImageInView] = useState(null);\r\n    const [isChatDataReady, setIsChatDataReady] = useState(false);\r\n    const [isConnected, setIsConnected] = useState(false);\r\n    const [showClearConfirm, setShowClearConfirm] = useState(false);\r\n    const [typingUsers, setTypingUsers] = useState({});\r\n    const [messagePages, setMessagePages] = useState({});\r\n    const [hasMoreMessages, setHasMoreMessages] = useState({});\r\n    const [isFetchingMoreMessages, setIsFetchingMoreMessages] = useState(false);\r\n    const [showScrollToBottom, setShowScrollToBottom] = useState(false);\r\n    const [newMessagesCount, setNewMessagesCount] = useState(0);\r\n    const [viewingProfile, setViewingProfile] = useState(null);\r\n    const [searchChatResults, setSearchChatResults] = useState(null);\r\n    const [isSearching, setIsSearching] = useState(false);\r\n    const [groupMedia, setGroupMedia] = useState([]);\r\n    const [groupFiles, setGroupFiles] = useState([]);\r\n    const [groupLinks, setGroupLinks] = useState([]);\r\n    const [isAttachmentLoading, setIsAttachmentLoading] = useState(false);\r\n    const [isSearchVisible, setIsSearchVisible] = useState(false);\r\n    const [searchQuery, setSearchQuery] = useState('');\r\n    const [searchResults, setSearchResults] = useState([]);\r\n    const [currentResultIndex, setCurrentResultIndex] = useState(-1);\r\n    const { setIsChatWindowVisible, setChatUnreadCount } = useContext(Context);\r\n\r\n    useEffect(() => {\r\n        if (setIsChatWindowVisible) {\r\n            setIsChatWindowVisible(isChatOpen);\r\n        }\r\n    }, [isChatOpen, setIsChatWindowVisible]);\r\n\r\n    const sidebarScrollRef = useRef(null);\r\n    const chatContainerRef = useRef(null);\r\n    const stompClient = useRef(null);\r\n    const typingTimeoutRef = useRef({});\r\n    const fileInputRef = useRef(null);\r\n    const mediaRecorderRef = useRef(null);\r\n    const audioChunksRef = useRef([]);\r\n    const streamRef = useRef(null);\r\n    const emojiPickerRef = useRef(null);\r\n    const emojiButtonRef = useRef(null);\r\n    const chatMenuRef = useRef(null);\r\n    const chatMenuButtonRef = useRef(null);\r\n    const contextMenuRef = useRef(null);\r\n    const messageInputRef = useRef(null);\r\n    const isManuallyClosing = useRef(false);\r\n    const pinnedMenuRef = useRef(null);\r\n    const pinnedMenuButtonRef = useRef(null);\r\n    const onMessageReceivedRef = useRef(null);\r\n    const isFetchingOldMessages = useRef(false);\r\n    const subscriptions = useRef({});\r\n\r\n    const chatIdFromUrl = useMemo(() => {\r\n        if (location.pathname.includes('/with')) {\r\n            const params = new URLSearchParams(location.search);\r\n            return params.get('id');\r\n        }\r\n        return null;\r\n    }, [location.pathname, location.search]);\r\n\r\n    const handleSearchChange = (e) => {\r\n        setSearchQuery(e.target.value);\r\n    };\r\n\r\n    // Debounced effect to trigger message search in the currently selected chat on search query change\r\n    useEffect(() => {\r\n        if (searchQuery.trim() === '') {\r\n            setSearchResults([]);\r\n            setCurrentResultIndex(-1);\r\n            return;\r\n        }\r\n\r\n        const timerId = setTimeout(() => {\r\n            if (selectedChat) {\r\n                searchMessages(currentUser.id, selectedChat.chatId, searchQuery).then(results => {\r\n                    setSearchResults(results);\r\n                    setCurrentResultIndex(results.length > 0 ? 0 : -1);\r\n                });\r\n            }\r\n        }, 500);\r\n\r\n        return () => clearTimeout(timerId);\r\n    }, [searchQuery, selectedChat, currentUser.id]);\r\n\r\n    // Handlers to navigate between search results within the chat view\r\n    const handleNextResult = () => {\r\n        if (currentResultIndex < searchResults.length - 1) {\r\n            setCurrentResultIndex(prev => prev + 1);\r\n        }\r\n    };\r\n\r\n    const handlePrevResult = () => {\r\n        if (currentResultIndex > 0) {\r\n            setCurrentResultIndex(prev => prev - 1);\r\n        }\r\n    };\r\n\r\n    // Effect to scroll the chat container to the highlighted search result\r\n    useEffect(() => {\r\n        if (currentResultIndex !== -1 && searchResults[currentResultIndex]) {\r\n            const messageId = searchResults[currentResultIndex].messageId;\r\n            const messageElement = document.getElementById(`msg-${messageId}`);\r\n            if (messageElement) {\r\n                messageElement.scrollIntoView({ behavior: 'smooth', block: 'center' });\r\n            }\r\n        }\r\n    }, [currentResultIndex, searchResults]);\r\n\r\n    // Fetches a block of messages around a specific search result and scrolls to it, highlighting the message.\r\n    const handleJumpToMessage = async (message) => {\r\n        setIsSearchVisible(false);\r\n        setSearchQuery('');\r\n        setSearchResults([]);\r\n\r\n        const contextMessagesRaw = await getMessageContext(message.messageId, currentUser.id, selectedChat.chatId);\r\n        if (contextMessagesRaw && contextMessagesRaw.length > 0) {\r\n            const transformedContext = contextMessagesRaw.map(transformMessageDTOToUIMessage);\r\n\r\n            setMessages(prev => ({\r\n                ...prev,\r\n                [selectedChat.chatId]: transformedContext\r\n            }));\r\n\r\n            setTimeout(() => {\r\n                const element = document.getElementById(`msg-${message.messageId}`);\r\n                if (element) {\r\n                    element.scrollIntoView({ behavior: 'smooth', block: 'center' });\r\n                    element.classList.add('bg-blue-200', 'transition-all', 'duration-1000');\r\n                    setTimeout(() => {\r\n                        element.classList.remove('bg-blue-200');\r\n                    }, 2000);\r\n                }\r\n            }, 100);\r\n        }\r\n    };\r\n\r\n    // Logic for infinite scrolling in the chat sidebar to load more chat previews/overviews.\r\n    const handleSidebarScroll = () => {\r\n        const container = sidebarScrollRef.current;\r\n        if (container) {\r\n            const { scrollTop, scrollHeight, clientHeight } = container;\r\n            if (scrollHeight - scrollTop - clientHeight < 100) {\r\n                console.log(`Scroll condition met. isFetchingMore: ${isFetchingMore}, hasMore: ${hasMore}`);\r\n                if (hasMore && !isFetchingMore) {\r\n                    loadMoreChats();\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    // Logic for infinite scrolling in the chat container to load older messages when scrolled to the top.\r\n    const handleChatScroll = () => {\r\n        const container = chatContainerRef.current;\r\n        if (!container) return;\r\n\r\n        const { scrollTop, scrollHeight, clientHeight } = container;\r\n\r\n        if (scrollTop === 0 && !isMessagesLoading && !isFetchingMoreMessages) {\r\n            const chatId = selectedChat.chatId;\r\n            if (hasMoreMessages[chatId] !== false) {\r\n                const nextPage = (messagePages[chatId] || 0) + 1;\r\n                setMessagePages(prev => ({ ...prev, [chatId]: nextPage }));\r\n                loadMoreMessages(chatId, nextPage);\r\n            }\r\n        }\r\n\r\n        const isScrolledUp = scrollHeight - scrollTop - clientHeight > 200;\r\n        if (isScrolledUp !== showScrollToBottom) {\r\n            setShowScrollToBottom(isScrolledUp);\r\n            if (!isScrolledUp) {\r\n                setNewMessagesCount(0);\r\n            }\r\n        }\r\n    };\r\n\r\n    // Function to smoothly scroll the message container to the most recent message and reset the new message count.\r\n    const scrollToBottom = (behavior = 'smooth') => {\r\n        if (chatContainerRef.current) {\r\n            chatContainerRef.current.scrollTo({\r\n                top: chatContainerRef.current.scrollHeight,\r\n                behavior: behavior\r\n            });\r\n        }\r\n        setNewMessagesCount(0);\r\n    };\r\n\r\n    // Debounced effect to search through all chat overviews (sidebar chat list).\r\n    useEffect(() => {\r\n        if (searchTerm.trim() === '') {\r\n            setSearchChatResults(null);\r\n            setIsSearching(false);\r\n            return;\r\n        }\r\n\r\n        setIsSearching(true);\r\n        const debounceTimer = setTimeout(() => {\r\n            searchChatOverview(currentUser.id, searchTerm)\r\n                .then(rawResults => {\r\n                    const formattedResults = transformOverviewToChatList(rawResults, currentUser.id);\r\n                    const combinedResults = [...formattedResults.privateChatsWith, ...formattedResults.groups]\r\n                        .sort((a, b) => new Date(b.lastMessageTimestamp) - new Date(a.lastMessageTimestamp));\r\n                    setSearchChatResults(combinedResults);\r\n                })\r\n                .finally(() => setIsSearching(false));\r\n        }, 300);\r\n\r\n        return () => clearTimeout(debounceTimer);\r\n    }, [searchTerm, currentUser.id]);\r\n\r\n    useEffect(() => {\r\n        if (initialChats) {\r\n            const correctedChats = {\r\n                groups: initialChats.groups.map(chat =>\r\n                    chat.chatId.toString() === chatIdFromUrl\r\n                        ? { ...chat, unreadMessageCount: 0 }\r\n                        : chat\r\n                ),\r\n                privateChatsWith: initialChats.privateChatsWith.map(chat =>\r\n                    chat.chatId.toString() === chatIdFromUrl\r\n                        ? { ...chat, unreadMessageCount: 0 }\r\n                        : chat\r\n                ),\r\n            };\r\n            setChatData(correctedChats);\r\n            setIsChatDataReady(true);\r\n        }\r\n    }, [initialChats, chatIdFromUrl]);\r\n\r\n    // Core function to fetch historical messages for a specific chat, handling pagination (page load = 0, scroll load > 0).\r\n    const loadMoreMessages = useCallback(async (chatId, pageNum) => {\r\n        if ((pageNum > 0 && isFetchingMoreMessages) || (pageNum === 0 && isMessagesLoading)) {\r\n            return;\r\n        }\r\n\r\n        if (pageNum > 0) {\r\n            setIsFetchingMoreMessages(true);\r\n            isFetchingOldMessages.current = true;\r\n        } else {\r\n            setIsMessagesLoading(true);\r\n        }\r\n\r\n        try {\r\n            const rawMessages = await getMessages(currentUser.id, chatId, pageNum, 15);\r\n            console.log(\"%c REFRESH (API) RAW DATA:\", \"color: red; font-weight: bold;\", rawMessages);\r\n\r\n            if (rawMessages.length === 0) {\r\n                setHasMoreMessages(prev => ({ ...prev, [chatId]: false }));\r\n                return;\r\n            }\r\n\r\n            const transformedMessages = rawMessages.map(transformMessageDTOToUIMessage);\r\n\r\n            const chatContainer = chatContainerRef.current;\r\n            const previousScrollHeight = chatContainer ? chatContainer.scrollHeight : 0;\r\n            const previousScrollTop = chatContainer ? chatContainer.scrollTop : 0;\r\n\r\n            setMessages(prev => ({\r\n                ...prev,\r\n                [chatId]: pageNum === 0\r\n                    ? transformedMessages\r\n                    : [...transformedMessages, ...(prev[chatId] || [])]\r\n            }));\r\n\r\n            if (pageNum > 0) {\r\n                requestAnimationFrame(() => {\r\n                    if (chatContainer) {\r\n                        chatContainer.scrollTop = (chatContainer.scrollHeight - previousScrollHeight) + previousScrollTop;\r\n                    }\r\n                });\r\n            }\r\n\r\n            if (rawMessages.length === 0) {\r\n                setHasMoreMessages(prev => ({ ...prev, [chatId]: false }));\r\n            }\r\n\r\n        } catch (error) {\r\n            console.error(`Failed to load messages for chat ${chatId}:`, error);\r\n        } finally {\r\n            if (pageNum > 0) {\r\n                setIsFetchingMoreMessages(false);\r\n                setTimeout(() => { isFetchingOldMessages.current = false; }, 100);\r\n            } else {\r\n                setIsMessagesLoading(false);\r\n            }\r\n        }\r\n    }, [currentUser.id, isFetchingMoreMessages, isMessagesLoading, getMessages]);\r\n\r\n    useEffect(() => {\r\n        if (!selectedChat) return;\r\n\r\n        const chatId = selectedChat.chatId;\r\n\r\n        setMessagePages(prev => ({ ...prev, [chatId]: 0 }));\r\n        setHasMoreMessages(prev => ({ ...prev, [chatId]: true }));\r\n        setMessages(prev => ({ ...prev, [chatId]: [] }));\r\n\r\n        loadMoreMessages(chatId, 0);\r\n\r\n        const fetchPinnedMessage = async () => {\r\n            try {\r\n                const pinnedMsgData = await getPinnedMessage(chatId, selectedChat.type, currentUser.id);\r\n                setPinnedMessage(pinnedMsgData);\r\n            } catch (error) {\r\n                console.error(\"Failed to fetch pinned message:\", error);\r\n                setPinnedMessage(null);\r\n            }\r\n        };\r\n        fetchPinnedMessage();\r\n\r\n    }, [selectedChat, currentUser.id]);\r\n\r\n    const updateLastMessage = useCallback((chatId, message) => {\r\n        setChatData(prev => {\r\n            const updateChat = (chat) => {\r\n                if (chat.chatId === chatId) {\r\n                    const isNewUnread = message && message.type !== 'deleted' && !message.isDeleted && message.sender !== currentUser.id && selectedChat?.chatId !== chatId;\r\n\r\n                    const overviewItem = {\r\n                        lastMessage: message ? (message.fileName || message.content) : '',\r\n                        lastMessageType: message ? message.type.toUpperCase() : null,\r\n                        lastMessageSenderId: message ? message.sender : null\r\n                    };\r\n\r\n                    return {\r\n                        ...chat,\r\n                        lastMessage: message ? generateChatListPreview(overviewItem, currentUser.id) : 'Chat cleared',\r\n                        lastMessageTimestamp: message?.timestamp || new Date(0).toISOString(),\r\n                        unreadMessageCount: (chat.unreadMessageCount || 0) + (isNewUnread ? 1 : 0)\r\n                    };\r\n                }\r\n                return chat;\r\n            };\r\n\r\n            const newGroups = prev.groups.map(updateChat);\r\n            const newPrivate = prev.privateChatsWith.map(updateChat);\r\n\r\n            return { groups: newGroups, privateChatsWith: newPrivate };\r\n        });\r\n    }, [currentUser.id, selectedChat]);\r\n\r\n    // Central handler for all incoming WebSocket messages (new message, status updates, pin/unpin, delete, edit).\r\n    const onMessageReceived = useCallback((payload) => {\r\n        const container = chatContainerRef.current;\r\n        const shouldScrollOnReceive = container\r\n            ? (container.scrollHeight - container.scrollTop - container.clientHeight) < 300\r\n            : true;\r\n\r\n        const parsedData = JSON.parse(payload.body);\r\n        console.log(\"%c LIVE MSG (WebSocket) RAW DATA:\", \"color: green; font-weight: bold;\", parsedData);\r\n        console.log(\"Received WebSocket Message:\", parsedData);\r\n\r\n        if (parsedData.type === 'STATUS_UPDATE') {\r\n            const { status, chatId, messageIds } = parsedData;\r\n\r\n            setMessages(prevMessages => {\r\n                const chatKey = selectedChat?.type === 'group' ? parsedData.groupId : chatId;\r\n                const chatMessages = prevMessages[chatKey] || [];\r\n                const newStatus = status.toLowerCase();\r\n\r\n                const updatedMessages = chatMessages.map(msg => {\r\n                    if (messageIds.includes(msg.messageId)) {\r\n                        if (newStatus === 'seen') {\r\n                            return { ...msg, status: 'seen' };\r\n                        }\r\n                        if (newStatus === 'delivered' && msg.status === 'sent') {\r\n                            return { ...msg, status: 'delivered' };\r\n                        }\r\n                    }\r\n                    return msg;\r\n                });\r\n                return { ...prevMessages, [chatKey]: updatedMessages };\r\n            });\r\n            return;\r\n        }\r\n\r\n\r\n        if (parsedData.type === 'PIN_UPDATE') {\r\n            const pinnedDto = parsedData.payload;\r\n            const eventChatId = pinnedDto.groupId || (pinnedDto.sender === currentUser.id ? pinnedDto.receiver : pinnedDto.sender);\r\n\r\n            if (selectedChat?.chatId === eventChatId) {\r\n                setPinnedMessage(pinnedDto);\r\n            }\r\n            return;\r\n\r\n        } else if (parsedData.type === 'UNPIN_UPDATE') {\r\n            const unpinPayload = parsedData.payload;\r\n\r\n            let eventChatId;\r\n            if (selectedChat.type === 'group') {\r\n                eventChatId = unpinPayload.groupId;\r\n            } else {\r\n                eventChatId = unpinPayload.senderId === currentUser.id\r\n                    ? unpinPayload.receiverId\r\n                    : unpinPayload.senderId;\r\n            }\r\n            if (selectedChat?.chatId === eventChatId) {\r\n                setPinnedMessage(null);\r\n            }\r\n            return;\r\n        }\r\n\r\n        const receivedMessage = parsedData;\r\n        const messageChatId = receivedMessage.groupId || (receivedMessage.sender === currentUser.id ? receivedMessage.receiver : receivedMessage.sender);\r\n\r\n        if (!messageChatId) {\r\n            console.warn(\"Received message without a clear chat ID\", receivedMessage);\r\n            return;\r\n        }\r\n\r\n        if (receivedMessage.isDeleted || receivedMessage.type === 'deleted') {\r\n            setMessages(prevMessages => {\r\n                const chatMessages = prevMessages[messageChatId] || [];\r\n                let wasLastMessage = false;\r\n\r\n                if (chatMessages.length > 0) {\r\n                    const lastMessage = chatMessages[chatMessages.length - 1];\r\n                    wasLastMessage = lastMessage.messageId === receivedMessage.messageId || lastMessage.id === receivedMessage.messageId;\r\n                }\r\n\r\n                const updatedMessages = chatMessages.map(msg => {\r\n                    if (msg.messageId === receivedMessage.messageId || msg.id === receivedMessage.messageId) {\r\n                        return { ...msg, type: 'deleted', content: 'This message was deleted', fileName: null, fileSize: null, isDeleted: true };\r\n                    }\r\n                    return msg;\r\n                });\r\n\r\n                if (wasLastMessage) {\r\n                    const newLastMessage = updatedMessages.length > 0 ? updatedMessages[updatedMessages.length - 1] : null;\r\n                    updateLastMessage(messageChatId, newLastMessage);\r\n                }\r\n\r\n                return { ...prevMessages, [messageChatId]: updatedMessages };\r\n            });\r\n            return;\r\n        }\r\n\r\n        if (receivedMessage.isEdited) {\r\n            setMessages(prevMessages => {\r\n                const chatMessages = prevMessages[messageChatId] || [];\r\n\r\n                const updatedMessages = chatMessages.map(msg => {\r\n                    if (msg.messageId === receivedMessage.id || msg.messageId === receivedMessage.messageId) {\r\n                        const updatedMsg = {\r\n                            ...msg,\r\n                            content: receivedMessage.content,\r\n                            isEdited: true\r\n                        };\r\n\r\n                        if (chatMessages.length > 0 && chatMessages[chatMessages.length - 1].messageId === msg.messageId) {\r\n                            updateLastMessage(messageChatId, updatedMsg);\r\n                        }\r\n\r\n                        return updatedMsg;\r\n                    }\r\n\r\n                    return msg;\r\n                });\r\n\r\n                return { ...prevMessages, [messageChatId]: updatedMessages };\r\n            });\r\n            return;\r\n        }\r\n\r\n        const transformedForEditCheck = transformMessageDTOToUIMessage(receivedMessage);\r\n\r\n        setMessages(prevMessages => {\r\n            const chatMessages = prevMessages[messageChatId] || [];\r\n            const finalServerId = receivedMessage.messageId || receivedMessage.id;\r\n\r\n            const messageAlreadyExists = chatMessages.some(m => m.messageId === finalServerId && m.status === 'sent');\r\n            if (messageAlreadyExists) {\r\n                return prevMessages;\r\n            }\r\n\r\n            let newChatMessages = [...chatMessages];\r\n            let messageProcessed = false;\r\n            let finalMessageForUpdate = null;\r\n\r\n            const isProperAck = receivedMessage.sender === currentUser.id && receivedMessage.client_id;\r\n            const isBroadcastOfOwnMessage = receivedMessage.sender === currentUser.id && !receivedMessage.client_id;\r\n            const isIncoming = receivedMessage.sender !== currentUser.id;\r\n\r\n            if (isProperAck) {\r\n                const optimisticIndex = newChatMessages.findIndex(m => m.id === receivedMessage.client_id);\r\n                if (optimisticIndex > -1) {\r\n                    const transformedServerMessage = transformMessageDTOToUIMessage(receivedMessage);\r\n                    newChatMessages[optimisticIndex] = { ...newChatMessages[optimisticIndex], ...transformedServerMessage, status: 'sent' };\r\n                    finalMessageForUpdate = newChatMessages[optimisticIndex];\r\n                    messageProcessed = true;\r\n                }\r\n            } else if (isBroadcastOfOwnMessage) {\r\n                const optimisticIndex = newChatMessages.findLastIndex(m => m.status === 'sending' && m.sender === currentUser.id);\r\n                if (optimisticIndex > -1) {\r\n                    const transformedServerMessage = transformMessageDTOToUIMessage(receivedMessage);\r\n                    newChatMessages[optimisticIndex] = { ...newChatMessages[optimisticIndex], ...transformedServerMessage, status: 'sent' };\r\n                    finalMessageForUpdate = newChatMessages[optimisticIndex];\r\n                    messageProcessed = true;\r\n                } else if (!chatMessages.some(m => m.messageId === finalServerId)) {\r\n                    const finalMessage = transformMessageDTOToUIMessage(receivedMessage);\r\n                    newChatMessages.push(finalMessage);\r\n                    finalMessageForUpdate = finalMessage;\r\n                    messageProcessed = true;\r\n                }\r\n            } else if (isIncoming) {\r\n                if (!chatMessages.some(m => m.messageId === finalServerId)) {\r\n                    const finalMessage = transformMessageDTOToUIMessage(receivedMessage);\r\n                    newChatMessages.push(finalMessage);\r\n                    finalMessageForUpdate = finalMessage;\r\n                    messageProcessed = true;\r\n\r\n                    if (showScrollToBottom) {\r\n                        setNewMessagesCount(prevCount => prevCount + 1);\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (messageProcessed) {\r\n                updateLastMessage(messageChatId, finalMessageForUpdate);\r\n                return { ...prevMessages, [messageChatId]: newChatMessages };\r\n            }\r\n\r\n            return prevMessages;\r\n        });\r\n        const isIncoming = parsedData.sender !== currentUser.id && !parsedData.isEdited && !parsedData.isDeleted && parsedData.type !== 'deleted';\r\n        if (isIncoming && shouldScrollOnReceive) {\r\n            setTimeout(() => scrollToBottom('smooth'), 100);\r\n        }\r\n    }, [currentUser.id, updateLastMessage, selectedChat, showScrollToBottom]);\r\n\r\n    const allChats = useMemo(() => [\r\n        ...chatData.privateChatsWith.filter(user => user.chatId !== currentUser?.id),\r\n        ...chatData.groups,\r\n    ].sort((a, b) => new Date(b.lastMessageTimestamp) - new Date(a.lastMessageTimestamp)), [chatData, currentUser.id]);\r\n\r\n    useEffect(() => {\r\n        const totalUnread = allChats.reduce((acc, chat) => acc + (chat.unreadMessageCount || 0), 0);\r\n        setChatUnreadCount(totalUnread);\r\n    }, [allChats, setChatUnreadCount]);\r\n\r\n    const handleTypingEvent = useCallback((payload) => {\r\n        const typingUpdate = JSON.parse(payload.body);\r\n\r\n        if (typingUpdate.senderId === currentUser.id) return;\r\n\r\n        const chatIdKey = typingUpdate.type === 'TEAM' ? typingUpdate.groupId : typingUpdate.senderId;\r\n        if (!chatIdKey) return;\r\n        const senderChatInfo = allChats.find(c => c.chatId === typingUpdate.senderId);\r\n        const senderName = senderChatInfo?.name || 'Someone';\r\n\r\n        setTypingUsers(prev => {\r\n            const newTypingUsers = { ...prev };\r\n\r\n            if (typingTimeoutRef.current[chatIdKey]) {\r\n                clearTimeout(typingTimeoutRef.current[chatIdKey]);\r\n            }\r\n\r\n            if (typingUpdate.typing) {\r\n                newTypingUsers[chatIdKey] = `${senderName} is typing...`;\r\n                typingTimeoutRef.current[chatIdKey] = setTimeout(() => {\r\n                    setTypingUsers(p => {\r\n                        const updated = { ...p };\r\n                        delete updated[chatIdKey];\r\n                        return updated;\r\n                    });\r\n                }, 3000);\r\n\r\n            } else {\r\n                delete newTypingUsers[chatIdKey];\r\n            }\r\n            return newTypingUsers;\r\n        });\r\n    }, [currentUser.id, allChats]);\r\n\r\n    const onSidebarUpdate = useCallback((payload) => {\r\n        const updatedChatList = JSON.parse(payload.body);\r\n        const { privateChatsWith: updatedPrivate, groups: updatedGroups } = transformOverviewToChatList(updatedChatList, currentUser.id);\r\n\r\n        setChatData(prev => ({\r\n            ...prev,\r\n            privateChatsWith: prev.privateChatsWith.map(pc => {\r\n                const update = updatedPrivate.find(upc => upc.chatId === pc.chatId);\r\n                return update ? { ...pc, ...update } : pc;\r\n            }),\r\n            groups: prev.groups.map(g => {\r\n                const update = updatedGroups.find(ug => ug.chatId === g.chatId);\r\n                return update ? { ...g, ...update } : g;\r\n            })\r\n        }));\r\n    }, [currentUser.id]);\r\n\r\n    useEffect(() => {\r\n        onMessageReceivedRef.current = onMessageReceived;\r\n    });\r\n\r\n    useEffect(() => {\r\n        if (!isMessagesLoading && chatContainerRef.current) {\r\n            scrollToBottom('auto');\r\n        }\r\n    }, [isMessagesLoading, selectedChat]);\r\n\r\n    // Initializes and manages the STOMP WebSocket client connection, subscribes to global and private queues, and handles lifecycle.\r\n    useEffect(() => {\r\n        if (!currentUser?.id || !isChatDataReady) return;\r\n\r\n        if (stompClient.current) {\r\n            return;\r\n        }\r\n\r\n        const token = localStorage.getItem('accessToken');\r\n        const brokerURL = `wss://hrms.anasolconsultancyservices.com/api/chat?employeeId=${currentUser.id}&token=${token}`;\r\n        const client = new Client({\r\n            brokerURL,\r\n            reconnectDelay: 5000,\r\n            onConnect: () => {\r\n                setIsConnected(true);\r\n                const messageHandler = (payload) => {\r\n                    if (onMessageReceivedRef.current) {\r\n                        onMessageReceivedRef.current(payload);\r\n                    }\r\n                };\r\n\r\n                const presenceHandler = (payload) => {\r\n                    const statusUpdate = JSON.parse(payload.body);\r\n                    if (statusUpdate.userId === currentUser.id) return;\r\n\r\n                    setChatData(prev => {\r\n                        const newPrivateChats = prev.privateChatsWith.map(chat => {\r\n                            if (chat.chatId === statusUpdate.userId) {\r\n                                return { ...chat, isOnline: statusUpdate.isOnline };\r\n                            }\r\n                            return chat;\r\n                        });\r\n                        return { ...prev, privateChatsWith: newPrivateChats };\r\n                    });\r\n                };\r\n                subscriptions.current['sidebar'] = client.subscribe(`/user/queue/sidebar`, onSidebarUpdate);\r\n                subscriptions.current['private'] = client.subscribe(`/user/queue/private`, messageHandler);\r\n                subscriptions.current['private-ack'] = client.subscribe(`/user/queue/private-ack`, messageHandler);\r\n                subscriptions.current['group-ack'] = client.subscribe(`user/queue/group-ack`, messageHandler);\r\n                subscriptions.current['presence'] = client.subscribe('/topic/presence', presenceHandler);\r\n                subscriptions.current['typing'] = client.subscribe('/user/queue/typing-status', handleTypingEvent);\r\n            },\r\n            onWebSocketError: (error) => console.error('WebSocket Error:', error),\r\n            onStompError: (frame) => console.error('STOMP Error:', frame.headers['message'], frame.body),\r\n            onWebSocketClose: () => {\r\n                setIsConnected(false);\r\n            }\r\n        });\r\n\r\n        client.activate();\r\n        stompClient.current = client;\r\n\r\n        return () => {\r\n            if (selectedChat && stompClient.current?.active) {\r\n                const destination = `/app/presence/close/${selectedChat.chatId}`;\r\n                stompClient.current.publish({ destination, body: \"{}\" });\r\n                console.log(`Sent CLOSE presence for ${selectedChat.chatId} on component unmount.`);\r\n            }\r\n\r\n            if (stompClient.current?.active) {\r\n                stompClient.current.deactivate();\r\n                stompClient.current = null;\r\n                console.log(\"STOMP client deactivated on component unmount.\");\r\n            }\r\n        };\r\n    }, [currentUser?.id, isChatDataReady, selectedChat]);\r\n\r\n    const groupIds = useMemo(() => {\r\n        return (chatData.groups || []).map(g => g.chatId).sort().join(',');\r\n    }, [chatData.groups]);\r\n\r\n    // Dynamically subscribes/unsubscribes to group message topics as the user's group list changes.\r\n    useEffect(() => {\r\n        if (!isConnected || !stompClient.current?.active) return;\r\n\r\n        const messageHandler = (payload) => {\r\n            if (onMessageReceivedRef.current) {\r\n                onMessageReceivedRef.current(payload);\r\n            }\r\n        };\r\n\r\n        const requiredGroupIds = new Set((chatData.groups || []).map(g => g.chatId.toString()));\r\n        const currentSubKeys = Object.keys(subscriptions.current);\r\n        const subscribedGroupIds = new Set(currentSubKeys.filter(key => key.startsWith('group-')).map(key => key.replace('group-', '')));\r\n\r\n        subscribedGroupIds.forEach(groupId => {\r\n            if (!requiredGroupIds.has(groupId)) {\r\n                const subId = `group-${groupId}`;\r\n                if (subscriptions.current[subId]) {\r\n                    subscriptions.current[subId].unsubscribe();\r\n                    delete subscriptions.current[subId];\r\n                }\r\n            }\r\n        });\r\n\r\n        requiredGroupIds.forEach(groupId => {\r\n            if (!subscribedGroupIds.has(groupId)) {\r\n                const subId = `group-${groupId}`;\r\n                subscriptions.current[subId] = stompClient.current.subscribe(`/topic/team-${groupId}`, messageHandler);\r\n                const typingSubId = `group-typing-${groupId}`;\r\n                subscriptions.current[typingSubId] = stompClient.current.subscribe(`/topic/typing-status/${groupId}`, handleTypingEvent);\r\n            }\r\n        });\r\n\r\n    }, [isConnected, groupIds, chatData.groups, groupMembers, currentUser.id]);\r\n\r\n    // Opens a selected chat, sends a 'presence/open' status to the server, and fetches initial group data (members).\r\n    const openChat = useCallback(async (targetChat) => {\r\n        if (!currentUser?.id || !stompClient.current?.active) {\r\n            return;\r\n        }\r\n        const destination = `/app/presence/open/${targetChat.chatId}`;\r\n        const payload = {\r\n            userId: currentUser.id,\r\n            type: targetChat.type === 'group' ? 'TEAM' : 'PRIVATE'\r\n        };\r\n        stompClient.current.publish({ destination, body: JSON.stringify(payload) });\r\n\r\n        if (targetChat.type === 'group' && !groupMembersCache[targetChat.chatId]) {\r\n            try {\r\n                const teamDetailsResponse = await getGroupMembers(targetChat.chatId);\r\n                const members = teamDetailsResponse?.[0]?.employees || [];\r\n                if (members.length > 0) {\r\n                    setGroupMembersCache(prevCache => ({\r\n                        ...prevCache,\r\n                        [targetChat.chatId]: members\r\n                    }));\r\n                }\r\n            } catch (error) {\r\n                console.error(\"Failed to fetch group members:\", error);\r\n            }\r\n        }\r\n\r\n        setSelectedChat(targetChat);\r\n        setIsChatOpen(true);\r\n\r\n        const newUrl = `/chat/${currentUser.id}/with?id=${targetChat.chatId}`;\r\n        window.history.pushState({ path: newUrl }, '', newUrl);\r\n\r\n    }, [currentUser.id, groupMembersCache]);\r\n\r\n    // Closes the current chat view, sends a 'presence/close' status, and navigates the URL\r\n    const closeChat = useCallback(() => {\r\n        isManuallyClosing.current = true;\r\n\r\n        if (!selectedChat || !currentUser?.id) {\r\n            isManuallyClosing.current = false;\r\n            return;\r\n        }\r\n\r\n        if (stompClient.current?.active) {\r\n            const destination = `/app/presence/close/${selectedChat.chatId}`;\r\n            stompClient.current.publish({ destination, body: \"{}\" });\r\n        }\r\n\r\n        setSelectedChat(null);\r\n        setIsChatOpen(false);\r\n        setShowScrollToBottom(false);\r\n        setNewMessagesCount(0);\r\n\r\n        const newUrl = `/chat/${currentUser.id}`;\r\n        navigate(newUrl);\r\n\r\n    }, [selectedChat, currentUser.id, navigate]);\r\n\r\n    // Handles click on a chat in the sidebar: clears unread count and calls openChat.\r\n    const handleChatSelect = useCallback((chat) => {\r\n        if (selectedChat && selectedChat.chatId !== chat.chatId && stompClient.current?.active) {\r\n            const destination = `/app/presence/close/${selectedChat.chatId}`;\r\n            stompClient.current.publish({ destination, body: \"{}\" });\r\n            console.log(`Sent CLOSE presence for previous chat: ${selectedChat.chatId}`);\r\n        }\r\n\r\n        if (chat.unreadMessageCount > 0) {\r\n            setChatData(prev => {\r\n                const isGroup = chat.type === 'group';\r\n                const list = isGroup ? prev.groups : prev.privateChatsWith;\r\n                const updatedList = list.map(c =>\r\n                    c.chatId === chat.chatId ? { ...c, unreadMessageCount: 0 } : c\r\n                );\r\n                return isGroup\r\n                    ? { ...prev, groups: updatedList }\r\n                    : { ...prev, privateChatsWith: updatedList };\r\n            });\r\n        }\r\n\r\n        openChat(chat);\r\n        setSearchTerm('');\r\n\r\n    }, [openChat, selectedChat]);\r\n\r\n\r\n\r\n    useEffect(() => {\r\n        const handleBeforeUnload = () => {\r\n            if (selectedChat && stompClient.current && stompClient.current.active) {\r\n                const destination = `/app/presence/close/${selectedChat.chatId}`;\r\n                stompClient.current.publish({ destination, body: \"{}\" });\r\n            }\r\n        };\r\n        window.addEventListener('beforeunload', handleBeforeUnload);\r\n        return () => window.removeEventListener('beforeunload', handleBeforeUnload);\r\n    }, [selectedChat]);\r\n\r\n    useEffect(() => {\r\n        const fetchGroupData = async () => {\r\n            if (!isGroupInfoModalOpen || !selectedChat || selectedChat.type !== 'group') {\r\n                return;\r\n            }\r\n\r\n            setIsGroupDataLoading(true);\r\n            setIsAttachmentLoading(true);\r\n\r\n            try {\r\n                if (activeGroupInfoTab === 'Members' && groupMembers.length === 0) {\r\n                    const teamDetailsResponse = await getGroupMembers(selectedChat.chatId);\r\n                    const teamDetails = Array.isArray(teamDetailsResponse) && teamDetailsResponse.length > 0 ? teamDetailsResponse[0] : null;\r\n                    setGroupMembers(teamDetails?.employees || []);\r\n                } else if (activeGroupInfoTab === 'Media' && groupMedia.length === 0) {\r\n                    const media = await getChatAttachments(selectedChat.chatId, 'media');\r\n                    setGroupMedia(media.map(transformMessageDTOToUIMessage));\r\n                } else if (activeGroupInfoTab === 'Files' && groupFiles.length === 0) {\r\n                    const files = await getChatAttachments(selectedChat.chatId, 'files');\r\n                    setGroupFiles(files.map(transformMessageDTOToUIMessage));\r\n                } else if (activeGroupInfoTab === 'Links' && groupLinks.length === 0) {\r\n                    const links = await getChatAttachments(selectedChat.chatId, 'links');\r\n                    setGroupLinks(links);\r\n                }\r\n            } catch (error) {\r\n                console.error(\"Failed to fetch group data for tab:\", activeGroupInfoTab, error);\r\n            } finally {\r\n                setIsGroupDataLoading(false);\r\n                setIsAttachmentLoading(false);\r\n            }\r\n        };\r\n\r\n        fetchGroupData();\r\n    }, [isGroupInfoModalOpen, activeGroupInfoTab, selectedChat]);\r\n\r\n    useEffect(() => {\r\n        const handleClickOutside = (event) => {\r\n            if (showEmojiPicker && emojiPickerRef.current && !emojiPickerRef.current.contains(event.target) && !emojiButtonRef.current?.contains(event.target)) setShowEmojiPicker(false);\r\n            if (showChatMenu && chatMenuRef.current && !chatMenuRef.current.contains(event.target) && !chatMenuButtonRef.current?.contains(event.target)) setShowChatMenu(false);\r\n            if (contextMenu.visible && contextMenuRef.current && !contextMenuRef.current.contains(event.target)) setContextMenu({ visible: false, x: 0, y: 0, message: null, index: null });\r\n            if (showPinnedMenu && pinnedMenuRef.current && !pinnedMenuRef.current.contains(event.target) && !pinnedMenuButtonRef.current?.contains(event.target)) setShowPinnedMenu(false);\r\n        };\r\n        document.addEventListener('mousedown', handleClickOutside);\r\n        return () => document.removeEventListener('mousedown', handleClickOutside);\r\n    }, [showEmojiPicker, showChatMenu, contextMenu.visible, showPinnedMenu]);\r\n\r\n    // Publishes a STOMP message to inform other chat participants of the current user's typing status.\r\n    const sendTypingStatus = (isTyping) => {\r\n        if (!stompClient.current?.active || !selectedChat) return;\r\n\r\n        const payload = {\r\n            senderId: currentUser.id,\r\n            typing: isTyping,\r\n            type: selectedChat.type === 'group' ? 'TEAM' : 'PRIVATE',\r\n            receiverId: selectedChat.type === 'private' ? selectedChat.chatId : null,\r\n            groupId: selectedChat.type === 'group' ? selectedChat.chatId : null,\r\n        };\r\n\r\n        stompClient.current.publish({\r\n            destination: '/app/typing',\r\n            body: JSON.stringify(payload),\r\n        });\r\n    };\r\n\r\n    // Sends a new text or reply message via STOMP, creating an optimistic message view first.\r\n    const handleSendMessage = () => {\r\n        if (!message.trim() || !selectedChat) return;\r\n\r\n        sendTypingStatus(false);\r\n\r\n        const clientId = Date.now().toString() + Math.random().toString(36).substring(2, 9);\r\n        const isReply = replyingTo !== null;\r\n\r\n        const optimisticMessage = {\r\n            id: clientId,\r\n            messageId: clientId,\r\n            sender: currentUser.id,\r\n            content: message,\r\n            timestamp: new Date().toISOString(),\r\n            status: 'sending',\r\n            type: 'text',\r\n            fileName: null,\r\n            fileSize: null,\r\n            isEdited: false,\r\n            replyTo: replyingTo,\r\n            isForwarded: false,\r\n        };\r\n\r\n        updateLastMessage(selectedChat.chatId, optimisticMessage);\r\n        setMessages(prev => ({\r\n            ...prev,\r\n            [selectedChat.chatId]: [...(prev[selectedChat.chatId] || []), optimisticMessage]\r\n        }));\r\n\r\n        let destination;\r\n        let payload;\r\n\r\n        if (isReply) {\r\n            destination = '/app/reply';\r\n            payload = {\r\n                replyToMessageId: replyingTo.messageId,\r\n                sender: currentUser.id,\r\n                content: message,\r\n                clientId: clientId,\r\n                receiver: selectedChat.type === 'private' ? selectedChat.chatId : null,\r\n                groupId: selectedChat.type === 'group' ? selectedChat.chatId : null,\r\n                type: selectedChat.type === 'group' ? 'TEAM' : 'PRIVATE',\r\n            };\r\n        } else {\r\n            destination = '/app/send';\r\n            payload = {\r\n                sender: currentUser.id,\r\n                content: message,\r\n                type: selectedChat.type === 'group' ? 'TEAM' : 'PRIVATE',\r\n                receiver: selectedChat.type === 'private' ? selectedChat.chatId : null,\r\n                groupId: selectedChat.type === 'group' ? selectedChat.chatId : null,\r\n                clientId: clientId,\r\n            };\r\n        }\r\n\r\n        stompClient.current.publish({ destination, body: JSON.stringify(payload) });\r\n\r\n        setMessage('');\r\n        setShowEmojiPicker(false);\r\n        setReplyingTo(null);\r\n        setTimeout(() => scrollToBottom('smooth'), 100);\r\n    };\r\n\r\n    const handleKeyDown = (event) => { if (event.key === 'Enter' && !event.shiftKey) { event.preventDefault(); if (editingInfo.index !== null) handleSaveEdit(); else handleSendMessage(); } };\r\n    const onEmojiClick = (emojiObject) => setMessage(prev => prev + emojiObject.emoji);\r\n    const handleFileButtonClick = () => fileInputRef.current.click();\r\n\r\n    // Handles file selection, uploads the file via API, and creates an optimistic 'sending' file message in the chat.\r\n    const handleFileChange = async (event) => {\r\n        const file = event.target.files[0];\r\n        if (!file || !selectedChat) return;\r\n\r\n        let messageType = 'file';\r\n        if (file.type.startsWith('image/')) {\r\n            messageType = 'image';\r\n        } else if (file.type.startsWith('audio/')) {\r\n            messageType = 'audio';\r\n        }\r\n\r\n        const clientId = Date.now().toString() + Math.random().toString(36).substring(2, 9);\r\n\r\n        const localPreviewContent = URL.createObjectURL(file);\r\n\r\n        const optimisticMessage = {\r\n            id: clientId,\r\n            messageId: clientId,\r\n            sender: currentUser.id,\r\n            content: localPreviewContent,\r\n            timestamp: new Date().toISOString(),\r\n            status: 'sending',\r\n            type: messageType,\r\n            fileName: file.name,\r\n            fileSize: file.size,\r\n            fileUrl: localPreviewContent,\r\n            isEdited: false,\r\n        };\r\n\r\n        updateLastMessage(selectedChat.chatId, optimisticMessage);\r\n\r\n        setMessages(prev => ({\r\n            ...prev,\r\n            [selectedChat.chatId]: [...(prev[selectedChat.chatId] || []), optimisticMessage]\r\n        }));\r\n\r\n        const formData = new FormData();\r\n        formData.append('file', file);\r\n        formData.append('sender', currentUser.id);\r\n        formData.append('client_id', clientId);\r\n        formData.append('fileType', file.type);\r\n        formData.append('type', selectedChat.type === 'group' ? 'TEAM' : 'PRIVATE');\r\n\r\n        if (selectedChat.type === 'group') {\r\n            formData.append('groupId', selectedChat.chatId);\r\n        } else {\r\n            formData.append('receiver', selectedChat.chatId);\r\n        }\r\n\r\n        try {\r\n            await uploadFile(formData);\r\n        } catch (error) {\r\n            console.error(\"File upload failed in component:\", error);\r\n            setMessages(prev => {\r\n                const chatMessages = prev[selectedChat.chatId] || [];\r\n                const newMessages = chatMessages.map(m => m.id === clientId ? { ...m, status: 'failed' } : m);\r\n                return { ...prev, [selectedChat.chatId]: newMessages };\r\n            });\r\n        } finally {\r\n            event.target.value = null;\r\n        }\r\n    };\r\n\r\n    // Toggles the voice recording state and captures the microphone input.\r\n    const handleMicButtonClick = () => { if (isRecording) stopRecording(); else startRecording(); };\r\n    // Detailed logic for starting, capturing data, stopping, and uploading a voice message as an audio blob/file.\r\n    const startRecording = () => {\r\n        navigator.mediaDevices.getUserMedia({ audio: true })\r\n            .then(stream => {\r\n                console.log('Permission granted, starting MediaRecorder...');\r\n                setIsRecording(true);\r\n\r\n                streamRef.current = stream;\r\n\r\n                audioChunksRef.current = [];\r\n                const mediaRecorder = new MediaRecorder(stream);\r\n                mediaRecorderRef.current = mediaRecorder;\r\n\r\n                mediaRecorder.ondataavailable = (event) => {\r\n                    audioChunksRef.current.push(event.data);\r\n                };\r\n\r\n                mediaRecorder.onstop = async () => {\r\n                    console.log('Recording stopped, creating blob from chunks...');\r\n                    const audioBlob = new Blob(audioChunksRef.current, { type: 'audio/webm' });\r\n\r\n                    if (!selectedChat) return;\r\n\r\n                    const audioFile = new File([audioBlob], `voice-message-${Date.now()}.webm`, {\r\n                        type: 'audio/webm',\r\n                        lastModified: Date.now()\r\n                    });\r\n\r\n                    const reader = new FileReader();\r\n                    reader.readAsDataURL(audioFile);\r\n                    reader.onloadend = async () => {\r\n                        const base64String = reader.result.split(',')[1];\r\n                        const clientId = Date.now().toString() + Math.random().toString(36).substring(2, 9);\r\n                        const localPreviewUrl = URL.createObjectURL(audioFile);\r\n\r\n                        const optimisticMessage = {\r\n                            id: clientId, messageId: clientId, sender: currentUser.id,\r\n                            content: localPreviewUrl, timestamp: new Date().toISOString(),\r\n                            status: 'sending', type: 'audio', fileName: audioFile.name,\r\n                            fileSize: audioFile.size, fileUrl: localPreviewUrl, isEdited: false,\r\n                            duration: 0\r\n                        };\r\n\r\n                        updateLastMessage(selectedChat.chatId, optimisticMessage);\r\n                        setMessages(prev => ({ ...prev, [selectedChat.chatId]: [...(prev[selectedChat.chatId] || []), optimisticMessage] }));\r\n\r\n                        const voiceData = {\r\n                            sender: currentUser.id, clientId: clientId,\r\n                            fileType: audioFile.type, fileName: audioFile.name,\r\n                            fileData: base64String, type: selectedChat.type === 'group' ? 'TEAM' : 'PRIVATE',\r\n                            groupId: selectedChat.type === 'group' ? selectedChat.chatId : null,\r\n                            receiver: selectedChat.type === 'private' ? selectedChat.chatId : null,\r\n                            duration: 0,\r\n                        };\r\n\r\n                        try {\r\n                            await uploadVoiceMessage(voiceData);\r\n                        } catch (error) {\r\n                            console.error(\"Voice message upload failed:\", error);\r\n                            setMessages(prev => {\r\n                                const chatMessages = prev[selectedChat.chatId] || [];\r\n                                const newMessages = chatMessages.map(m => m.id === clientId ? { ...m, status: 'failed' } : m);\r\n                                return { ...prev, [selectedChat.chatId]: newMessages };\r\n                            });\r\n                        }\r\n                    };\r\n                };\r\n\r\n                mediaRecorder.start();\r\n            })\r\n            .catch((e) => {\r\n                console.error('Microphone permission denied:', e);\r\n                setIsRecording(false);\r\n                alert('Microphone permission is required for voice messages.');\r\n            });\r\n    };\r\n\r\n    const stopRecording = () => {\r\n        console.log('Stopping MediaRecorder...');\r\n        if (mediaRecorderRef.current && mediaRecorderRef.current.state === \"recording\") {\r\n            mediaRecorderRef.current.stop();\r\n        }\r\n        if (streamRef.current) {\r\n            streamRef.current.getTracks().forEach(track => track.stop());\r\n        }\r\n        setIsRecording(false);\r\n    };\r\n\r\n    // Clears all messages in the current chat and updates the last message display.\r\n    const handleConfirmClearChat = async () => {\r\n        if (!selectedChat) return;\r\n        try {\r\n            await clearChatHistory(currentUser.id, selectedChat.chatId);\r\n            setMessages(prev => ({ ...prev, [selectedChat.chatId]: [] }));\r\n            updateLastMessage(selectedChat.chatId, null);\r\n        } catch (error) {\r\n            console.error(\"Failed to clear chat:\", error);\r\n        } finally {\r\n            setShowClearConfirm(false);\r\n        }\r\n    };\r\n\r\n    const handleMediaDownload = useCallback(async (src, fileName, event) => {\r\n        if (event) {\r\n            event.stopPropagation();\r\n            event.preventDefault();\r\n        }\r\n        try {\r\n            const response = await fetch(src);\r\n            if (!response.ok) {\r\n                throw new Error('Network response was not ok');\r\n            }\r\n            const blob = await response.blob();\r\n            const blobUrl = window.URL.createObjectURL(blob);\r\n            const link = document.createElement('a');\r\n            link.href = blobUrl;\r\n            link.setAttribute('download', fileName || 'download');\r\n            document.body.appendChild(link);\r\n            link.click();\r\n            link.remove();\r\n            window.URL.revokeObjectURL(blobUrl);\r\n        } catch (error) {\r\n            console.error('Download failed:', error);\r\n            window.open(src, '_blank');\r\n        }\r\n    }, []);\r\n\r\n    // Displays the right-click context menu (reply, edit, delete, pin) at the click coordinates.\r\n    const handleContextMenu = (event, message, index) => { event.preventDefault(); event.stopPropagation(); const menuWidth = 180; const menuHeight = 250; let x = event.pageX; let y = event.pageY; if (x + menuWidth > window.innerWidth) x -= menuWidth; if (y + menuHeight > window.innerHeight) y -= menuHeight; setContextMenu({ visible: true, x, y, message, index }); };\r\n    const handleReply = () => { setReplyingTo(contextMenu.message); setContextMenu({ visible: false, x: 0, y: 0, message: null, index: null }); messageInputRef.current.focus(); };\r\n    const handleEdit = () => { setEditingInfo({ index: contextMenu.index, originalContent: contextMenu.message.content }); setMessage(contextMenu.message.content); setContextMenu({ visible: false, x: 0, y: 0, message: null, index: null }); messageInputRef.current.focus(); };\r\n\r\n    // Updates the message content optimistically, publishes the edit event to STOMP, and cleans up the editing state.\r\n    const handleSaveEdit = () => {\r\n        const updatedContent = message.trim();\r\n\r\n        if (updatedContent === '' || editingInfo.index === null || !stompClient.current?.active) {\r\n            cancelEdit();\r\n            return;\r\n        }\r\n\r\n        const chatId = selectedChat.chatId;\r\n        const currentMessages = messages[chatId];\r\n        const messageToEdit = currentMessages[editingInfo.index];\r\n        const messageId = messageToEdit.messageId;\r\n\r\n        if (updatedContent === editingInfo.originalContent || typeof messageId !== 'number') {\r\n            cancelEdit();\r\n            return;\r\n        }\r\n\r\n        const optimisticUpdatedMessage = {\r\n            ...messageToEdit,\r\n            content: updatedContent,\r\n            isEdited: true,\r\n        };\r\n\r\n        const updatedMessagesList = currentMessages.map((msg, index) =>\r\n            index === editingInfo.index ? optimisticUpdatedMessage : msg\r\n        );\r\n\r\n        setMessages(prev => ({\r\n            ...prev,\r\n            [chatId]: updatedMessagesList,\r\n        }));\r\n\r\n        if (editingInfo.index === currentMessages.length - 1) {\r\n            updateLastMessage(chatId, optimisticUpdatedMessage);\r\n        }\r\n\r\n        const payload = {\r\n            messageId: messageId,\r\n            content: updatedContent,\r\n            sender: currentUser.id,\r\n        };\r\n\r\n        const destination = '/app/edit';\r\n\r\n        stompClient.current.publish({\r\n            destination,\r\n            body: JSON.stringify(payload)\r\n        });\r\n\r\n        cancelEdit();\r\n    };\r\n\r\n    const cancelEdit = () => { setEditingInfo({ index: null, originalContent: '' }); setMessage(''); };\r\n\r\n    // Deletes a message for the current user or for everyone based on the context menu selection.\r\n    const handleDelete = async (forEveryone) => {\r\n        const chatId = selectedChat.chatId;\r\n        const currentMessages = [...(messages[chatId] || [])];\r\n        const messageToDelete = currentMessages[contextMenu.index];\r\n        const messageId = messageToDelete?.messageId;\r\n\r\n        if (!messageId || typeof messageId !== 'number' || messageToDelete.status === 'sending' || messageToDelete.status === 'failed') {\r\n            console.error(\"Invalid messageId or message status for deletion:\", messageId, messageToDelete.status);\r\n            setContextMenu({ visible: false, x: 0, y: 0, message: null, index: null });\r\n            return;\r\n        }\r\n\r\n        try {\r\n            if (forEveryone) {\r\n                await deleteMessageForEveryone(messageId, currentUser.id);\r\n            } else {\r\n                await deleteMessageForMe(messageId, currentUser.id);\r\n                const nextMessages = currentMessages.filter((_, i) => i !== contextMenu.index);\r\n                setMessages(prev => ({ ...prev, [chatId]: nextMessages }));\r\n                const newLastMessage = nextMessages.length > 0 ? nextMessages[nextMessages.length - 1] : null;\r\n                updateLastMessage(chatId, newLastMessage);\r\n            }\r\n        } catch (error) {\r\n            console.error(`Failed to delete message ${messageId} in component:`, error);\r\n        } finally {\r\n            setContextMenu({ visible: false, x: 0, y: 0, message: null, index: null });\r\n        }\r\n    };\r\n\r\n    const handleUndoDelete = () => { if (!lastDeleted) return; const currentMessages = [...messages[selectedChat.chatId]]; currentMessages[lastDeleted.index] = lastDeleted.message; setMessages(prev => ({ ...prev, [selectedChat.chatId]: currentMessages })); setLastDeleted(null); };\r\n    // Handlers to pin or unpin a message, communicating with the server API.   \r\n    const handlePin = async () => {\r\n        if (!contextMenu.message?.messageId) return;\r\n\r\n        try {\r\n            const messageIdToPin = contextMenu.message.messageId;\r\n            const response = await pinMessage(messageIdToPin, currentUser.id);\r\n            setPinnedMessage(response);\r\n        } catch (error) {\r\n            console.error(\"Failed to pin message:\", error);\r\n        } finally {\r\n            setContextMenu({ visible: false, x: 0, y: 0, message: null, index: null });\r\n        }\r\n    };\r\n\r\n    const handleUnpin = async () => {\r\n        if (!pinnedMessage?.messageId) return;\r\n\r\n        try {\r\n            await unpinMessage(pinnedMessage.messageId, currentUser.id);\r\n            setPinnedMessage(null);\r\n        } catch (error) {\r\n            console.error(\"Failed to unpin message:\", error);\r\n        } finally {\r\n            setShowPinnedMenu(false);\r\n        }\r\n    };\r\n\r\n    const handleGoToMessage = () => {\r\n        setShowPinnedMenu(false);\r\n        if (pinnedMessage) {\r\n            const messageIndex = chatMessages.findIndex(m => m.messageId === pinnedMessage.messageId);\r\n\r\n            if (messageIndex !== -1) {\r\n                const messageElement = document.querySelector(`[data-message-index='${messageIndex}']`);\r\n                if (messageElement) {\r\n                    messageElement.scrollIntoView({ behavior: 'smooth', block: 'center' });\r\n                    messageElement.classList.add('animate-pulse', 'bg-blue-200');\r\n                    setTimeout(() => messageElement.classList.remove('animate-pulse', 'bg-blue-200'), 2500);\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    const handleForward = () => {\r\n        setForwardingInfo({ visible: true, message: contextMenu.message });\r\n        setContextMenu({ visible: false, x: 0, y: 0, message: null, index: null });\r\n    };\r\n\r\n    // Sends the selected message to multiple recipients via API and updates the local last message for each recipient.\r\n    const handleConfirmForward = async () => {\r\n        const originalMsg = forwardingInfo.message;\r\n        if (!originalMsg || forwardRecipients.length === 0) {\r\n            return;\r\n        }\r\n\r\n        const forwardData = {\r\n            sender: currentUser.id,\r\n            forwardMessageId: originalMsg.messageId,\r\n            forwardTo: forwardRecipients.map(chatId => {\r\n                const chat = allChats.find(c => c.chatId === chatId);\r\n                if (chat.type === 'private') {\r\n                    return { receiver: chat.chatId };\r\n                } else {\r\n                    return { groupId: chat.chatId };\r\n                }\r\n            })\r\n        };\r\n\r\n        try {\r\n            await forwardMessage(forwardData);\r\n            const newLastMessageObject = {\r\n                ...forwardingInfo.message,\r\n                sender: currentUser.id,\r\n                timestamp: new Date().toISOString(),\r\n            };\r\n            forwardRecipients.forEach(chatId => {\r\n                updateLastMessage(chatId, newLastMessageObject);\r\n            });\r\n\r\n        } catch (error) {\r\n            console.error(\"Failed to forward message:\", error);\r\n        } finally {\r\n            setForwardingInfo({ visible: false, message: null });\r\n            setForwardRecipients([]);\r\n            setForwardSearchTerm('');\r\n        }\r\n    };\r\n\r\n    const chatsToDisplay = searchChatResults !== null ? searchChatResults : allChats;\r\n\r\n    // Syncs the currently selected chat with the URL parameter on load or chat list change.\r\n    useEffect(() => {\r\n        if (chatIdFromUrl && allChats.length > 0 && isConnected && !selectedChat) {\r\n            if (isManuallyClosing.current) {\r\n                return;\r\n            }\r\n\r\n            const chatToSelect = allChats.find(c => c.chatId.toString() === chatIdFromUrl);\r\n            if (chatToSelect) {\r\n                handleChatSelect(chatToSelect);\r\n            }\r\n        } else if (!chatIdFromUrl) {\r\n            isManuallyClosing.current = false;\r\n        }\r\n    }, [allChats, chatIdFromUrl, selectedChat, handleChatSelect, isConnected]);\r\n\r\n    useEffect(() => {\r\n        const newChatTarget = location.state?.newChatTarget;\r\n        if (newChatTarget && isChatDataReady) {\r\n            const chatExists = allChats.some(chat => chat.chatId === newChatTarget.chatId);\r\n            if (!chatExists) {\r\n                console.log(\"New chat detected. Adding to chat list:\", newChatTarget);\r\n\r\n                setChatData(prevData => {\r\n                    const updatedPrivateChats = [newChatTarget, ...prevData.privateChatsWith];\r\n\r\n                    return {\r\n                        ...prevData,\r\n                        privateChatsWith: updatedPrivateChats,\r\n                    };\r\n                });\r\n            }\r\n        }\r\n    }, [isChatDataReady, allChats, location.state]);\r\n\r\n    const openGroupInfoModal = () => {\r\n        if (selectedChat?.type === 'group') {\r\n            setActiveGroupInfoTab('Overview');\r\n            setGroupMembers([]);\r\n            setIsGroupInfoModalOpen(true);\r\n        }\r\n    };\r\n\r\n    const formatTimestamp = (isoString) => {\r\n        if (!isoString) return '';\r\n        const date = new Date(isoString.endsWith('Z') ? isoString : isoString + 'Z');\r\n        if (isNaN(date)) return '';\r\n        return date.toLocaleTimeString('en-US', {\r\n            hour: '2-digit',\r\n            minute: '2-digit',\r\n            hour12: true\r\n        });\r\n    };\r\n\r\n    const formatDateHeader = (isoString) => {\r\n        if (!isoString) return '';\r\n        const date = new Date(String(isoString).endsWith('Z') ? isoString : isoString + 'Z');\r\n        if (isNaN(date)) return 'Invalid Date';\r\n        const today = new Date();\r\n        const yesterday = new Date(today);\r\n        yesterday.setDate(yesterday.getDate() - 1);\r\n        if (date.toDateString() === today.toDateString()) return 'Today';\r\n        if (date.toDateString() === yesterday.toDateString()) return 'Yesterday';\r\n        return date.toLocaleDateString([], { year: 'numeric', month: 'long', day: 'numeric' });\r\n    };\r\n\r\n    const formatLastSeen = (isoString) => {\r\n        if (!isoString) return 'Offline';\r\n        const date = new Date(String(isoString).endsWith('Z') ? isoString : isoString + 'Z');\r\n        if (isNaN(date)) return 'Offline';\r\n        const today = new Date();\r\n        if (date.toDateString() === today.toDateString()) {\r\n            return `last seen today at ${formatTimestamp(isoString)}`;\r\n        }\r\n        return `last seen on ${date.toLocaleDateString()}`;\r\n    };\r\n\r\n    let lastMessageDate = null;\r\n\r\n    const currentChatInfo = selectedChat ? allChats.find(c => c.chatId === selectedChat.chatId) : null;\r\n    const chatMessages = currentChatInfo ? messages[currentChatInfo.chatId] || [] : [];\r\n\r\n    const getSenderInfo = (senderId) => {\r\n        if (!currentUser) return { name: 'Unknown User', profile: null };\r\n        if (senderId === currentUser.id) return { name: 'You', profile: currentUser.profile };\r\n\r\n        let member = chatData.privateChatsWith.find(m => m.chatId === senderId || m.employeeId === senderId);\r\n        if (member) {\r\n            return { name: member.name || member.displayName, profile: member.profile || member.employeeImage || null };\r\n        }\r\n        if (selectedChat?.type === 'group' && groupMembersCache[selectedChat.chatId]) {\r\n            member = groupMembersCache[selectedChat.chatId].find(m => m.employeeId === senderId);\r\n        }\r\n\r\n        return member\r\n            ? { name: member.name || member.displayName, profile: member.profile || member.employeeImage || null }\r\n            : { name: 'Unknown User', profile: null };\r\n    };\r\n\r\n    const getFileUrl = (msg) => {\r\n        const baseUrl = chatApi.defaults.baseURL;\r\n\r\n        if (msg.fileUrl && msg.fileUrl.startsWith('blob:')) {\r\n            return msg.fileUrl;\r\n        }\r\n\r\n        if (msg.fileUrl && msg.fileUrl.startsWith('/api')) {\r\n            const origin = new URL(baseUrl).origin;\r\n            return `${origin}${msg.fileUrl}`;\r\n        } else if (msg.fileUrl) {\r\n            return msg.fileUrl;\r\n        }\r\n\r\n        const messageIdForUrl = msg.id || msg.messageId;\r\n        if (messageIdForUrl) {\r\n            return `${baseUrl}/chat/file/${messageIdForUrl}`;\r\n        }\r\n        return msg.content;\r\n    };\r\n\r\n    return (\r\n        // Main Chat Application Container\r\n        <div className={`w-full h-full ${theme === 'dark' ? 'bg-gray-900' : 'bg-gray-100'} font-sans`}>\r\n            {/* Content Area: Sidebar (30%) and Chat Window (70%) */}\r\n            <div className=\"flex w-full h-full p-0 md:p-4 md:gap-4\">\r\n                {/* Sidebar / Chat List Container */}\r\n                <div className={`relative w-full md:w-[30%] h-full p-4 flex flex-col shadow-xl md:rounded-lg ${isChatOpen ? 'hidden md:flex' : 'flex'} ${theme === 'dark' ? 'bg-gray-800' : 'bg-white'}`}>\r\n                    {/* Chat List Search Input */}\r\n                    <div className=\"mb-4 flex-shrink-0\"><input type=\"text\" placeholder=\"Search chats users...\" className={`w-full p-3 rounded-lg border bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 ${theme === 'dark' ? 'bg-gray-700 text-white border-gray-600' : 'bg-gray-50 border-gray-300'}`} value={searchTerm} onChange={e => setSearchTerm(e.target.value)} /></div>\r\n                    {/* Chat List Scrollable Area */}\r\n                    <div ref={sidebarScrollRef} onScroll={handleSidebarScroll} className=\"flex-grow space-y-2 pr-2 overflow-y-auto custom-scrollbar\">\r\n                        {isSearching ? (\r\n                            <div className=\"text-center p-4 text-gray-500\">Searching...</div>\r\n                        ) : (\r\n                            chatsToDisplay.map(chat => (\r\n                                <div key={chat.chatId} onClick={() => handleChatSelect(chat)} className={`p-3 flex items-center rounded-lg cursor-pointer group ${selectedChat?.chatId === chat.chatId ? 'bg-blue-100 dark:bg-blue-900/30' : (theme === 'dark' ? 'hover:bg-gray-700' : 'hover:bg-blue-50')}`}>\r\n                                    <div className=\"relative flex-shrink-0\">\r\n                                        {chat.type === 'group' ? (\r\n                                            <div\r\n                                                onClick={(e) => {\r\n                                                    e.stopPropagation();\r\n                                                    setViewingProfile(chat);\r\n                                                }}\r\n                                                className={`w-11 h-11 rounded-full flex items-center justify-center cursor-pointer md:cursor-default ${theme === 'dark' ? 'bg-gray-700' : 'bg-gray-200'}`}\r\n                                            >\r\n                                                <FaUsers className={`text-gray-500`} size={24} />\r\n                                            </div>\r\n                                        ) : chat.profile ? (\r\n                                            <div\r\n                                                onClick={(e) => {\r\n                                                    e.stopPropagation();\r\n                                                    setViewingProfile(chat);\r\n                                                }}\r\n                                                className=\"w-11 h-11 rounded-full cursor-pointer md:cursor-default\"\r\n                                            >\r\n                                                <img src={chat.profile} alt={chat.name} className=\"w-full h-full rounded-full object-cover\" />\r\n                                            </div>\r\n                                        ) : (\r\n                                            <div className={`w-11 h-11 rounded-full flex items-center justify-center ${theme === 'dark' ? 'bg-gray-700' : 'bg-gray-200'}`}>\r\n                                                <FaUser className={`text-gray-500`} size={24} />\r\n                                            </div>\r\n                                        )}\r\n                                        {chat.isOnline && (<span className=\"absolute bottom-0 right-0 block h-3 w-3 rounded-full ring-2 ring-white bg-green-500\"></span>)}\r\n                                    </div>\r\n                                    <div className=\"flex-1 min-w-0 mx-3\"><p className={`font-semibold truncate ${theme === 'dark' ? 'text-white' : 'text-gray-800'}`}>{chat.name}</p><p className={`text-sm truncate ${theme === 'dark' ? 'text-gray-400' : 'text-gray-500'}`}>{chat.lastMessage || 'No messages yet'}</p></div>\r\n                                    {(chat.unreadMessageCount || 0) > 0 && (<div className=\"flex-shrink-0\"><span className=\"bg-blue-600 text-white text-xs font-bold px-2 py-1 rounded-full\">{chat.unreadMessageCount}</span></div>)}\r\n                                </div>\r\n                            ))\r\n                        )}\r\n                        {searchTerm === '' && isFetchingMore && (\r\n                            <div className=\"flex justify-center items-center p-4\">\r\n                                <div className=\"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600\"></div>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n                {/* Chat Window Container (Messages, Header, Input) */}\r\n                <div className={`flex-col shadow-xl fixed inset-0 z-[100] overflow-hidden md:relative md:inset-auto md:z-auto md:w-[70%] md:h-full md:rounded-lg ${isChatOpen ? 'flex' : 'hidden md:flex'} ${theme === 'dark' ? 'bg-gray-800' : 'bg-white'} `}>\r\n                    {!currentChatInfo ? (\r\n                        <div className=\"flex items-center justify-center h-full\">\r\n                            <div className=\"text-center\">\r\n                                <FaUsers className={`mx-auto text-6xl ${theme === 'dark' ? 'text-gray-600' : 'text-gray-300'}`} />\r\n                                <p className={`mt-4 text-xl text-center ${theme === 'dark' ? 'text-gray-400' : 'text-gray-600'}`}>Select a chat to begin</p>\r\n                                <p className={`text-sm ${theme === 'dark' ? 'text-gray-500' : 'text-gray-400'}`}>Start a conversation with your team or colleagues.</p>\r\n                            </div>\r\n                        </div>\r\n                    ) : (\r\n                        <>\r\n                            <div className={`flex-shrink-0 flex items-center justify-between p-4 border-b z-10 ${theme === 'dark' ? 'border-gray-700 bg-gray-800' : 'border-gray-200 bg-white'}`}>\r\n                                <div className=\"flex items-center space-x-3 flex-grow min-w-0\">\r\n                                    <button onClick={closeChat} className={`md:hidden p-2 rounded-full ${theme === 'dark' ? 'hover:bg-gray-700 text-white' : 'hover:bg-gray-100'}`}><FaArrowLeft /></button>\r\n                                    <button onClick={() => currentChatInfo.type !== 'group' && currentChatInfo.profile && setIsProfileModalOpen(true)} className=\"flex-shrink-0\">\r\n                                        {currentChatInfo.type === 'group' ? (\r\n                                            <div className={`w-12 h-12 rounded-full flex items-center justify-center ${theme === 'dark' ? 'bg-gray-700' : 'bg-gray-200'}`}>\r\n                                                <FaUsers className={`text-gray-500`} size={28} />\r\n                                            </div>\r\n                                        ) : currentChatInfo.profile ? (\r\n                                            <img src={currentChatInfo.profile} alt={currentChatInfo.name} className=\"w-12 h-12 rounded-full object-cover\" />\r\n                                        ) : (\r\n                                            <div className={`w-12 h-12 rounded-full flex items-center justify-center ${theme === 'dark' ? 'bg-gray-700' : 'bg-gray-200'}`}>\r\n                                                <FaUser className={`text-gray-500`} size={28} />\r\n                                            </div>\r\n                                        )}\r\n                                    </button>\r\n                                    <div className=\"truncate\">\r\n                                        <button\r\n                                            onClick={() => {\r\n                                                if (currentChatInfo.type === 'private') {\r\n                                                    navigate(`/employees/${currentUser.id}/public/${currentChatInfo.chatId}`);\r\n                                                } else {\r\n                                                    openGroupInfoModal();\r\n                                                }\r\n                                            }}\r\n                                            disabled={!currentChatInfo}\r\n                                            className=\"text-left\"\r\n                                        >\r\n                                            <p className={`font-bold text-lg truncate ${theme === 'dark' ? 'text-white' : 'text-gray-800'}`}>{currentChatInfo.name}</p>\r\n                                        </button>\r\n                                        {currentChatInfo.type === 'private' ? (\r\n                                            <p className={`text-sm ${theme === 'dark' ? 'text-gray-400' : 'text-gray-500'}`}>\r\n                                                {currentChatInfo.isOnline\r\n                                                    ? 'Online'\r\n                                                    : (currentChatInfo.userLastSeen ? formatLastSeen(currentChatInfo.userLastSeen) : 'Offline')}\r\n                                            </p>) : (\r\n                                            <p className={`text-sm ${theme === 'dark' ? 'text-gray-400' : 'text-gray-500'}`}>{currentChatInfo.memberCount || 0} members</p>\r\n                                        )}\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"flex items-center space-x-2\"><div className=\"relative\"><button ref={chatMenuButtonRef} onClick={() => setShowChatMenu(!showChatMenu)} className={`p-2 rounded-full hover:bg-gray-100 ${theme === 'dark' ? 'text-gray-300 hover:bg-gray-700' : 'text-gray-600'}`}><BsThreeDotsVertical size={20} /></button>{showChatMenu && (<div ref={chatMenuRef} className=\"absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg z-20\"><button onClick={() => { setIsSearchVisible(true); setShowChatMenu(false); }}\r\n                                    className=\"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100\">Search</button><button onClick={() => { setShowClearConfirm(true); setShowChatMenu(false); }} className=\"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100\">Clear chat</button></div>)}</div></div>\r\n                            </div>\r\n\r\n                            {isSearchVisible && (\r\n                                <div className={`flex-shrink-0 flex items-center justify-between p-4 border-b sticky top-0 z-10 ${theme === 'dark' ? 'border-gray-700 bg-gray-800' : 'border-gray-200 bg-white'}`}>\r\n                                    <input\r\n                                        type=\"text\"\r\n                                        placeholder=\"Search messages...\"\r\n                                        className={`w-full p-2 border rounded-lg ${theme === 'dark' ? 'bg-gray-700 text-white' : ''}`}\r\n                                        value={searchQuery}\r\n                                        onChange={handleSearchChange}\r\n                                        autoFocus\r\n                                    />\r\n                                    {searchResults.length > 0 && (\r\n                                        <span className=\"mx-2 text-sm\">{currentResultIndex + 1} of {searchResults.length}</span>\r\n                                    )}\r\n                                    <div className=\"flex\">\r\n                                        <button onClick={handlePrevResult} disabled={currentResultIndex <= 0} className=\"p-2 disabled:opacity-50\"><FaChevronUp /></button>\r\n                                        <button onClick={handleNextResult} disabled={currentResultIndex >= searchResults.length - 1} className=\"p-2 disabled:opacity-50\"><FaChevronDown /></button>\r\n                                        <button onClick={() => { setIsSearchVisible(false); setSearchQuery(''); setSearchResults([]); }} className=\"p-2\"><FaTimes /></button>\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n\r\n                            {pinnedMessage && (\r\n                                <div className={`flex-shrink-0 flex items-center justify-between p-2 border-b bg-gray-50 ${theme === 'dark' ? 'bg-gray-700 border-gray-700' : 'border-gray-200'}`}>\r\n                                    <div className=\"flex items-center gap-2 text-sm overflow-hidden cursor-pointer flex-grow min-w-0\" onClick={handleGoToMessage}>\r\n                                        <FaThumbtack className={`flex-shrink-0 ${theme === 'dark' ? 'text-gray-400' : 'text-gray-500'}`} />\r\n                                        <FileIcon fileName={pinnedMessage.fileName || ''} type={pinnedMessage.messageType} className=\"text-lg flex-shrink-0\" />\r\n                                        <div className=\"truncate\">\r\n                                            <p className={`font-bold text-blue-600`}>Pinned Message</p>\r\n                                            <p className={`truncate ${theme === 'dark' ? 'text-gray-300' : 'text-gray-600'}`}>\r\n                                                {pinnedMessage.messageType === 'text' ? pinnedMessage.content : pinnedMessage.fileName || 'Pinned Media'}\r\n                                            </p>\r\n                                        </div>\r\n                                    </div>\r\n                                    <div className=\"relative flex-shrink-0\">\r\n                                        <button ref={pinnedMenuButtonRef} onClick={() => setShowPinnedMenu(!showPinnedMenu)} className={`p-2 rounded-full ${theme === 'dark' ? 'hover:bg-gray-600 text-gray-300' : 'hover:bg-gray-200'}`}>\r\n                                            <FaChevronDown />\r\n                                        </button>\r\n                                        {showPinnedMenu && (\r\n                                            <div ref={pinnedMenuRef} className={`absolute right-0 mt-2 w-48 rounded-md shadow-lg z-20 text-sm ${theme === 'dark' ? 'bg-gray-700 text-white' : 'bg-white'}`}>\r\n                                                <ul className=\"py-1\">\r\n                                                    <li onClick={handleGoToMessage} className={`px-4 py-2 hover:bg-gray-100 cursor-pointer flex items-center gap-3 ${theme === 'dark' ? 'text-gray-300 hover:bg-gray-600' : 'text-gray-700'}`}>\r\n                                                        <FaAngleDoubleRight /> Go to message\r\n                                                    </li>\r\n                                                    <li onClick={handleUnpin} className={`px-4 py-2 hover:bg-gray-100 cursor-pointer flex items-center gap-3 text-red-600 ${theme === 'dark' ? 'text-red-400 hover:bg-gray-600' : ''}`}>\r\n                                                        <FaTimes /> Unpin\r\n                                                    </li>\r\n                                                </ul>\r\n                                            </div>\r\n                                        )}\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n\r\n                            <div ref={chatContainerRef} onScroll={handleChatScroll} className={`flex-grow p-4 overflow-y-auto min-h-0 ${theme === 'dark' ? 'bg-gray-900' : 'bg-gray-50'}`}>\r\n                                {isSearchVisible ? (\r\n                                    <div className=\"space-y-2\">\r\n                                        {searchResults.length > 0 ? (\r\n                                            searchResults.map(msg => (\r\n                                                <div\r\n                                                    key={msg.messageId}\r\n                                                    onClick={() => handleJumpToMessage(msg)}\r\n                                                    className={`p-3 rounded-lg cursor-pointer ${theme === 'dark' ? 'hover:bg-gray-700' : 'hover:bg-gray-100'}`}\r\n                                                >\r\n                                                    <div className=\"flex justify-between text-xs mb-1\">\r\n                                                        <span className=\"font-bold\">{getSenderInfo(msg.sender).name}</span>\r\n                                                        <span className={`${theme === 'dark' ? 'text-gray-400' : 'text-gray-500'}`}>\r\n                                                            {new Date(msg.timestamp).toLocaleDateString()}\r\n                                                        </span>\r\n                                                    </div>\r\n                                                    <p className={`truncate ${theme === 'dark' ? 'text-gray-300' : 'text-gray-700'}`}>\r\n                                                        {msg.fileName ? ` ${msg.fileName}` : msg.content}\r\n                                                    </p>\r\n                                                </div>\r\n                                            ))\r\n                                        ) : (\r\n                                            <div className=\"text-center text-gray-500 mt-10\">No results found for \"{searchQuery}\"</div>\r\n                                        )}\r\n                                    </div>\r\n                                ) : (\r\n                                    isMessagesLoading ? (\r\n                                        <MessageSkeleton theme={theme} />\r\n                                    ) : (\r\n                                        <div className=\"space-y-2\">\r\n                                            {chatMessages.map((msg, index) => {\r\n                                                const isMyMessage = msg.sender === currentUser?.id;\r\n                                                const msgDate = new Date(msg.timestamp).toDateString();\r\n                                                const showDateHeader = lastMessageDate !== msgDate;\r\n                                                if (showDateHeader) {\r\n                                                    lastMessageDate = msgDate;\r\n                                                }\r\n                                                const senderInfo = !isMyMessage ? getSenderInfo(msg.sender) : null;\r\n\r\n                                                const fileUrl = getFileUrl(msg);\r\n\r\n                                                return (\r\n                                                    <React.Fragment key={msg.messageId || msg.id}>\r\n                                                        {showDateHeader && (\r\n                                                            <div className=\"text-center my-4\">\r\n                                                                <span className={`px-3 py-1 rounded-full text-xs font-semibold ${theme === 'dark' ? 'bg-gray-700 text-gray-300' : 'bg-gray-200 text-gray-600'}`}>{formatDateHeader(msg.timestamp)}</span>\r\n                                                            </div>\r\n                                                        )}\r\n                                                        <div\r\n                                                            id={`msg-${msg.messageId}`}\r\n                                                            data-message-index={index}\r\n                                                            className={`flex items-end gap-2 p-1 rounded-lg transition-all\r\n                                                            ${isMyMessage ? 'justify-end' : 'justify-start'}\r\n                                                            ${searchResults[currentResultIndex]?.messageId === msg.messageId ? 'bg-yellow-400/30' : ''}\r\n                                                        `}\r\n                                                        >\r\n                                                            {!isMyMessage && (() => {\r\n                                                                const profileSrc = currentChatInfo.type === 'group' ? senderInfo?.profile : currentChatInfo.profile;\r\n                                                                const profileName = currentChatInfo.type === 'group' ? senderInfo?.name : currentChatInfo.name;\r\n                                                                return profileSrc ? (\r\n                                                                    <img src={profileSrc} alt={profileName} className=\"w-8 h-8 rounded-full object-cover self-start flex-shrink-0\" />\r\n                                                                ) : (\r\n                                                                    <div className={`w-8 h-8 rounded-full flex items-center justify-center self-start flex-shrink-0 ${theme === 'dark' ? 'bg-gray-700' : 'bg-gray-200'}`}>\r\n                                                                        <FaUser className=\"text-gray-500\" size={18} />\r\n                                                                    </div>\r\n                                                                );\r\n                                                            })()}\r\n                                                            <div className={`flex flex-col ${isMyMessage ? 'items-end' : 'items-start'}`}>\r\n                                                                {currentChatInfo.type === 'group' && !isMyMessage && (\r\n                                                                    <p className={`text-xs text-gray-500 mb-1 ml-2 font-semibold ${theme === 'dark' ? 'text-gray-400' : 'text-gray-500'}`}>{senderInfo?.name}</p>\r\n                                                                )}\r\n                                                                <div onContextMenu={(e) => handleContextMenu(e, msg, index)} className={`rounded-lg max-w-xs md:max-w-md group relative\r\n                                                                ${(msg.type === 'image' || msg.type === 'deleted') ? 'p-0 bg-transparent' : ''}\r\n                                                                ${(msg.type === 'text') ? (isMyMessage ? 'bg-blue-600 text-white p-3' : (theme === 'dark' ? 'bg-gray-700 text-white p-3' : 'bg-gray-200 text-gray-800 p-3')) : ''}\r\n                                                                ${(msg.type === 'audio' || msg.type === 'file') ? (isMyMessage ? 'bg-blue-600' : (theme === 'dark' ? 'bg-gray-700' : 'bg-gray-200')) : ''}\r\n                                                                `}>\r\n                                                                    {msg.type === 'deleted' ? (\r\n                                                                        <div className=\"flex items-center gap-2 italic text-sm opacity-70 p-3\">\r\n                                                                            <span>This message was deleted</span>\r\n                                                                            {lastDeleted?.index === index && <button onClick={handleUndoDelete} className=\"font-semibold hover:underline\">Undo</button>}\r\n                                                                        </div>\r\n                                                                    ) : (\r\n                                                                        <>\r\n                                                                            {msg.isForwarded && <div className=\"flex items-center gap-1.5 text-xs opacity-70 mb-1 font-semibold\"><FaShare /> Forwarded</div>}\r\n\r\n                                                                            {msg.replyTo && (\r\n                                                                                <div className={`p-2 rounded mb-2 text-sm ${isMyMessage ? 'bg-blue-500' : (theme === 'dark' ? 'bg-gray-600' : 'bg-gray-300')}`}>\r\n                                                                                    <p className=\"font-semibold\">{msg.replyTo.sender === currentUser?.id ? 'You' : getSenderInfo(msg.replyTo.sender).name}</p>\r\n                                                                                    <p className=\"opacity-80 truncate\">\r\n                                                                                        {['image', 'audio', 'file'].includes(msg.replyTo.type) ? msg.replyTo.content : msg.replyTo.content}\r\n                                                                                    </p>\r\n                                                                                </div>\r\n                                                                            )}\r\n\r\n                                                                            {msg.type === 'image' ? (\r\n                                                                                <div className=\"relative\">\r\n                                                                                    <button onClick={() => setImageInView(fileUrl)} className=\"cursor-pointer\">\r\n                                                                                        <img src={fileUrl} alt={msg.fileName || 'image'} className=\"rounded-md max-w-full\" style={{ maxHeight: '300px' }} />\r\n                                                                                    </button>\r\n                                                                                    {!isMyMessage && (\r\n                                                                                        <a\r\n                                                                                            href={fileUrl}\r\n                                                                                            download={msg.fileName}\r\n                                                                                            onClick={(e) => handleMediaDownload(fileUrl, msg.fileName, e)}\r\n                                                                                            className=\"absolute bottom-2 right-2 bg-black bg-opacity-50 text-white p-2 rounded-full opacity-0 group-hover:opacity-100 transition-opacity\"\r\n                                                                                        >\r\n                                                                                            <FaDownload />\r\n                                                                                        </a>\r\n                                                                                    )}\r\n                                                                                </div>\r\n                                                                            ) : msg.type === 'audio' ? (\r\n                                                                                <div className={`${isMyMessage ? 'bg-blue-600' : (theme === 'dark' ? 'bg-gray-700' : 'bg-gray-200')} rounded-lg`}>\r\n                                                                                    <AudioPlayer src={fileUrl} fileUrl={fileUrl} isSender={isMyMessage} initialDuration={msg.duration} fileSize={msg.fileSize} theme={theme} />\r\n                                                                                </div>\r\n                                                                            ) : msg.type === 'file' ? (\r\n                                                                                <FileMessage msg={msg} isMyMessage={isMyMessage} theme={theme} />\r\n                                                                            ) : (\r\n                                                                                <p className=\"text-sm break-words\">{msg.content}</p>\r\n                                                                            )}\r\n                                                                        </>\r\n                                                                    )}\r\n                                                                </div>\r\n                                                                <span className={`flex items-center justify-end gap-1 text-xs mt-1 px-1 ${theme === 'dark' ? 'text-gray-400' : 'text-gray-500'}`}>\r\n                                                                    <span className=\"leading-none\">\r\n                                                                        {msg.status === 'sending' ? 'Sending...' : msg.status === 'failed' ? 'Failed' : formatTimestamp(msg.timestamp)}\r\n                                                                    </span>\r\n\r\n                                                                    {msg.isEdited ? <span className=\"leading-none\">(edited)</span> : ''}\r\n\r\n                                                                    {isMyMessage && msg.status !== 'sending' && msg.status !== 'failed' && (\r\n                                                                        <span className=\"flex-shrink-0\">\r\n                                                                            {msg.status === 'sent' && <FaCheck size={14} className={`${theme === 'dark' ? 'text-gray-500' : 'text-gray-400'}`} />}\r\n                                                                            {msg.status === 'delivered' && <FaCheckDouble size={14} className=\"text-blue-500\" />}\r\n                                                                            {msg.status === 'seen' && <FaEye size={14} className=\"text-blue-500\" />}\r\n                                                                        </span>\r\n                                                                    )}\r\n                                                                </span>\r\n                                                            </div>\r\n                                                            {isMyMessage && (\r\n                                                                <div className={`relative w-8 h-8 self-start flex-shrink-0`}>\r\n                                                                    <img src={currentUser?.profile || 'https://placehold.co/100x100/E2E8F0/4A5568?text=Me'} alt=\"current user\" className=\"w-full h-full rounded-full object-cover\" />\r\n                                                                </div>\r\n                                                            )}\r\n                                                        </div>\r\n                                                    </React.Fragment>\r\n                                                );\r\n                                            })}\r\n\r\n                                            {typingUsers[selectedChat.chatId] && (\r\n                                                <div className=\"flex items-end gap-2 justify-start\">\r\n                                                    <div className={`w-8 h-8 rounded-full flex items-center justify-center self-start flex-shrink-0 ${theme === 'dark' ? 'bg-gray-700' : 'bg-gray-200'}`}>\r\n                                                        <FaUser className=\"text-gray-500\" size={18} />\r\n                                                    </div>\r\n                                                    <div className=\"flex flex-col items-start\">\r\n                                                        <div className={`p-3 rounded-lg text-gray-800 ${theme === 'dark' ? 'bg-gray-700' : 'bg-gray-200'}`}>\r\n                                                            <div className=\"flex items-center justify-center gap-1.5\">\r\n                                                                <span className=\"h-2 w-2 bg-gray-500 rounded-full animate-bounce [animation-delay:-0.3s]\"></span>\r\n                                                                <span className=\"h-2 w-2 bg-gray-500 rounded-full animate-bounce [animation-delay:-0.15s]\"></span>\r\n                                                                <span className=\"h-2 w-2 bg-gray-500 rounded-full animate-bounce\"></span>\r\n                                                            </div>\r\n                                                        </div>\r\n                                                    </div>\r\n                                                </div>\r\n                                            )}\r\n                                        </div>\r\n                                    )\r\n                                )}\r\n                            </div>\r\n                            {/* Message Input Area Container */}\r\n                            <div className={`flex-shrink-0 flex flex-col p-4 border-t ${theme === 'dark' ? 'bg-gray-800 border-gray-700' : 'bg-white border-gray-200'}`}>\r\n                                {replyingTo && (\r\n                                    <div className={`p-2 rounded-t-lg flex justify-between items-center ${theme === 'dark' ? 'bg-gray-700' : 'bg-gray-100'}`}>\r\n                                        <div className=\"text-sm overflow-hidden\">\r\n                                            <p className=\"font-semibold text-blue-600\">Replying to {replyingTo.sender === currentUser?.id ? 'yourself' : getSenderInfo(replyingTo.sender).name}</p>\r\n                                            <p className={`truncate opacity-80 ${theme === 'dark' ? 'text-gray-300' : 'text-gray-600'}`}>\r\n                                                {['image', 'audio', 'file'].includes(replyingTo.type) ? replyingTo.fileName : replyingTo.content}\r\n                                            </p>\r\n                                        </div>\r\n                                        <button onClick={() => setReplyingTo(null)}><FaTimes /></button>\r\n                                    </div>\r\n                                )}\r\n\r\n                                {editingInfo.index !== null && (<div className={`p-2 rounded-t-lg flex justify-between items-center ${theme === 'dark' ? 'bg-gray-700' : 'bg-gray-100'}`}><div className=\"text-sm overflow-hidden\"><p className=\"font-semibold text-blue-600\">Editing message</p><p className={`truncate opacity-80 ${theme === 'dark' ? 'text-gray-300' : 'text-gray-600'}`}>{editingInfo.originalContent}</p></div><button onClick={cancelEdit}><FaTimes /></button></div>)}\r\n                                {currentChatInfo && (\r\n                                    <div className={`relative flex items-center w-full space-x-2 ${(replyingTo || editingInfo.index !== null) ? 'pt-2' : ''}`}>\r\n                                        {showEmojiPicker && (\r\n                                            <div ref={emojiPickerRef} className=\"absolute bottom-full mb-2 left-0 z-40 w-[95vw] max-w-sm\">\r\n                                                <EmojiPicker onEmojiClick={onEmojiClick} width=\"100%\" height={350} theme={theme} />\r\n                                            </div>\r\n                                        )}\r\n                                        <div className=\"relative flex-grow\">\r\n                                            <input ref={messageInputRef} type=\"text\" placeholder={isRecording ? \"Recording...\" : \"Type a message...\"} className={`w-full p-3 pr-24 rounded-full border bg-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500 ${theme === 'dark' ? 'bg-gray-700 text-white border-gray-600' : 'bg-gray-100 border-gray-300'}`} value={message} onChange={(e) => { setMessage(e.target.value); sendTypingStatus(true); }} onKeyDown={handleKeyDown} disabled={isRecording} />\r\n                                            <div className=\"absolute right-2 top-1/2 -translate-y-1/2 flex items-center\">\r\n                                                <button ref={emojiButtonRef} onClick={() => setShowEmojiPicker(!showEmojiPicker)} className={`p-2 rounded-full hover:bg-gray-100 ${theme === 'dark' ? 'text-gray-300 hover:bg-gray-700' : 'text-gray-500 hover:text-blue-600'}`}><FaSmile size={20} /></button>\r\n                                                <button onClick={handleFileButtonClick} className={`p-2 rounded-full hover:bg-gray-100 ${theme === 'dark' ? 'text-gray-300 hover:bg-gray-700' : 'text-gray-500 hover:text-blue-600'}`}><FaPaperclip size={20} /></button>\r\n                                            </div>\r\n                                        </div>\r\n                                        {message.trim() || editingInfo.index !== null ? (\r\n                                            <button onClick={editingInfo.index !== null ? handleSaveEdit : handleSendMessage} className={`p-3 rounded-full text-white ${editingInfo.index !== null ? 'bg-green-600 hover:bg-green-700' : 'bg-blue-600 hover:bg-blue-700'}`}>\r\n                                                {editingInfo.index !== null ? <FaCheck size={20} /> : <FaPaperPlane size={20} />}\r\n                                            </button>\r\n                                        ) : (\r\n                                            <button onClick={handleMicButtonClick} className={`p-3 rounded-full hover:bg-gray-100 ${isRecording ? 'text-red-500 animate-pulse' : (theme === 'dark' ? 'text-gray-300 hover:bg-gray-700' : 'text-gray-500 hover:text-blue-600')}`}>\r\n                                                {isRecording ? <FaStop size={20} /> : <FaMicrophone size={20} />}\r\n                                            </button>\r\n                                        )}\r\n                                        <input type=\"file\" ref={fileInputRef} onChange={handleFileChange} className=\"hidden\" />\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        </>\r\n                    )}\r\n                </div>\r\n                {showScrollToBottom && (\r\n                    <button\r\n                        onClick={() => scrollToBottom()}\r\n                        className=\"absolute bottom-24 right-8 z-[110] bg-blue-600/80 backdrop-blur-sm text-white rounded-full p-3 shadow-xl hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all transform hover:scale-110 animate-fade-in\"\r\n                        aria-label=\"Scroll to bottom\"\r\n                    >\r\n                        {newMessagesCount > 0 && (\r\n                            <span className=\"absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center\">\r\n                                {newMessagesCount > 9 ? '9+' : newMessagesCount}\r\n                            </span>\r\n                        )}\r\n                        <FaChevronDown size={20} />\r\n                    </button>\r\n                )}\r\n            </div>\r\n\r\n            {viewingProfile && (\r\n                <ContactProfileModal\r\n                    chat={viewingProfile}\r\n                    onClose={() => setViewingProfile(null)}\r\n                    theme={theme}\r\n                />\r\n            )}\r\n\r\n            {contextMenu.visible && (\r\n                <div ref={contextMenuRef} style={{ top: contextMenu.y, left: contextMenu.x }} className={`absolute rounded-md shadow-lg z-[110] text-sm ${theme === 'dark' ? 'bg-gray-800' : 'bg-white'}`}>\r\n                    <ul className=\"py-1\">\r\n                        {contextMenu.message.type === 'deleted' ? (\r\n                            <li onClick={() => handleDelete(false)} className={`px-4 py-2 hover:bg-gray-100 cursor-pointer flex items-center gap-3 text-red-600 ${theme === 'dark' ? 'text-red-400 hover:bg-gray-700' : ''}`}><FaTrash /> Delete for me</li>\r\n                        ) : (\r\n                            <>\r\n                                <li onClick={handleReply} className={`px-4 py-2 hover:bg-gray-100 cursor-pointer flex items-center gap-3 ${theme === 'dark' ? 'text-gray-300 hover:bg-gray-700' : 'text-gray-700'}`}><FaReply /> Reply</li>\r\n                                <li onClick={handlePin} className={`px-4 py-2 hover:bg-gray-100 cursor-pointer flex items-center gap-3 ${theme === 'dark' ? 'text-gray-300 hover:bg-gray-700' : 'text-gray-700'}`}><FaThumbtack /> Pin</li>\r\n                                <li onClick={handleForward} className={`px-4 py-2 hover:bg-gray-100 cursor-pointer flex items-center gap-3 ${theme === 'dark' ? 'text-gray-300 hover:bg-gray-700' : 'text-gray-700'}`}><FaShare /> Forward</li>\r\n\r\n                                {contextMenu.message.status !== 'sending' && contextMenu.message.status !== 'failed' && (\r\n                                    <>\r\n                                        {contextMenu.message.sender === currentUser?.id && contextMenu.message.type === 'text' && !contextMenu.message.isForwarded && (new Date() - new Date(contextMenu.message.timestamp) < 15 * 60 * 1000) && (\r\n                                            <li onClick={handleEdit} className={`px-4 py-2 hover:bg-gray-100 cursor-pointer flex items-center gap-3 ${theme === 'dark' ? 'text-gray-300 hover:bg-gray-700' : 'text-gray-700'}`}><FaEdit /> Edit</li>\r\n                                        )}\r\n                                        <hr className={`my-1 ${theme === 'dark' ? 'border-gray-700' : ''}`} />\r\n                                        <li onClick={() => handleDelete(false)} className={`px-4 py-2 hover:bg-gray-100 cursor-pointer flex items-center gap-3 text-red-600 ${theme === 'dark' ? 'text-red-400 hover:bg-gray-700' : ''}`}><FaTrash /> Delete for me</li>\r\n                                        {contextMenu.message.sender === currentUser?.id && (\r\n                                            <li onClick={() => handleDelete(true)} className={`px-4 py-2 hover:bg-gray-100 cursor-pointer flex items-center gap-3 text-red-600 ${theme === 'dark' ? 'text-red-400 hover:bg-gray-700' : ''}`}><FaTrash /> Delete for everyone</li>\r\n                                        )}\r\n                                    </>\r\n                                )}\r\n                            </>\r\n                        )}\r\n                    </ul>\r\n                </div>\r\n            )}\r\n\r\n            {forwardingInfo.visible && (<div className=\"fixed inset-0 bg-opacity-100 flex items-center justify-center z-[100]\"><div className={`rounded-lg shadow-2xl w-full max-w-md ${theme === 'dark' ? 'bg-gray-800 text-white' : 'bg-white'}`}><div className={`p-4 border-b flex justify-between items-center ${theme === 'dark' ? 'border-gray-700' : 'border-gray-200'}`}><h3 className=\"font-bold text-lg\">Forward message to...</h3><button onClick={() => setForwardingInfo({ visible: false, message: null })}><FaTimes /></button></div><div className=\"p-4\"><input type=\"text\" placeholder=\"Search for users or groups\" className={`w-full p-2 border rounded-lg ${theme === 'dark' ? 'bg-gray-700 text-white border-gray-600' : 'bg-gray-100 border-gray-300'}`} value={forwardSearchTerm} onChange={(e) => setForwardSearchTerm(e.target.value)} /></div><div className=\"h-64 overflow-y-auto p-4\">{allChats.filter(c => c.name?.toLowerCase().includes(forwardSearchTerm.toLowerCase())).map(chat => (<div key={chat.chatId} className={`flex items-center p-2 rounded-lg hover:bg-gray-100 ${theme === 'dark' ? 'hover:bg-gray-700' : ''}`}><input type=\"checkbox\" id={`fwd-${chat.chatId}`} className=\"mr-3 h-4 w-4 accent-blue-600\" checked={forwardRecipients.includes(chat.chatId)} onChange={(e) => { if (e.target.checked) setForwardRecipients([...forwardRecipients, chat.chatId]); else setForwardRecipients(forwardRecipients.filter(id => id !== chat.chatId)); }} />\r\n                <label htmlFor={`fwd-${chat.chatId}`} className=\"flex-grow flex items-center gap-3 cursor-pointer\">\r\n                    {chat.type === 'group' ? (\r\n                        <div className={`w-10 h-10 rounded-full flex items-center justify-center ${theme === 'dark' ? 'bg-gray-700' : 'bg-gray-200'}`}><FaUsers className={`text-gray-500`} /></div>\r\n                    ) : (\r\n                        <img src={chat.profile} alt={chat.name} className=\"w-10 h-10 rounded-full object-cover\" onError={(e) => { e.target.src = 'https://placehold.co/100x100/E2E8F0/4A5568?text=U' }} />\r\n                    )}\r\n                    <span className={`${theme === 'dark' ? 'text-gray-300' : 'text-gray-800'}`}>{chat.name}</span>\r\n                </label>\r\n            </div>))}</div><div className={`p-4 border-t text-right ${theme === 'dark' ? 'border-gray-700' : 'border-gray-200'}`}><button onClick={handleConfirmForward} disabled={forwardRecipients.length === 0} className=\"bg-blue-600 text-white px-4 py-2 rounded-lg disabled:bg-gray-400 disabled:cursor-not-allowed cursor-pointer\">Forward</button></div></div></div>)}\r\n\r\n            {isProfileModalOpen && currentChatInfo && currentChatInfo.type !== 'group' && (\r\n                <div className=\"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[151]\" onClick={() => setIsProfileModalOpen(false)}>\r\n                    <img src={currentChatInfo.profile} alt={currentChatInfo.name} className=\"max-w-[80vw] max-h-[90vh] object-contain\" onClick={(e) => e.stopPropagation()} />\r\n                </div>\r\n            )}\r\n\r\n            {isGroupInfoModalOpen && currentChatInfo?.type === 'group' && (\r\n                <div className=\"fixed inset-0 bg-opacity-100 flex items-center justify-center z-[100]\" onClick={() => setIsGroupInfoModalOpen(false)}>\r\n                    <div className={`rounded-lg shadow-2xl w-full max-w-lg h-[80vh] flex flex-col ${theme === 'dark' ? 'bg-gray-800 text-white' : 'bg-white'}`} onClick={(e) => e.stopPropagation()}>\r\n                        <div className={`p-4 border-b flex justify-between items-center flex-shrink-0 ${theme === 'dark' ? 'border-gray-700' : 'border-gray-200'}`}>\r\n                            <h3 className=\"font-bold text-xl\">Group Info</h3>\r\n                            <button onClick={() => setIsGroupInfoModalOpen(false)} className={`p-2 rounded-full ${theme === 'dark' ? 'hover:bg-gray-700 text-gray-300' : 'hover:bg-gray-200'}`}><FaTimes /></button>\r\n                        </div>\r\n                        <div className={`flex border-b flex-shrink-0 ${theme === 'dark' ? 'border-gray-700' : 'border-gray-200'}`}>\r\n                            {['Overview', 'Members', 'Media', 'Files', 'Links'].map(tab => (\r\n                                <button key={tab} onClick={() => setActiveGroupInfoTab(tab)} className={`flex-1 p-3 text-sm font-semibold ${activeGroupInfoTab === tab ? 'text-blue-600 border-b-2 border-blue-600' : (theme === 'dark' ? 'text-gray-400 hover:bg-gray-700' : 'text-gray-500 hover:bg-gray-100')}`}>\r\n                                    {tab}\r\n                                </button>\r\n                            ))}\r\n                        </div>\r\n                        <div className=\"p-4 overflow-y-auto flex-grow\">\r\n                            {activeGroupInfoTab === 'Overview' && (\r\n                                <div className=\"flex flex-col items-center text-center space-y-4\">\r\n                                    <div className={`w-40 h-40 rounded-full flex items-center justify-center ${theme === 'dark' ? 'bg-gray-700' : 'bg-gray-200'}`}>\r\n                                        <FaUsers className=\"text-gray-500\" size={80} />\r\n                                    </div>\r\n                                    <h2 className=\"text-2xl font-bold\">{currentChatInfo.name}</h2>\r\n                                    <p className={`text-gray-600 ${theme === 'dark' ? 'text-gray-400' : ''}`}>{currentChatInfo.memberCount || 0} members</p>\r\n                                </div>\r\n                            )}\r\n                            {activeGroupInfoTab === 'Members' && (\r\n                                <div className=\"space-y-3\">\r\n                                    {isGroupDataLoading ? (\r\n                                        <p className=\"text-center text-gray-500\">Loading members...</p>\r\n                                    ) : (\r\n                                        groupMembers.map((member, i) => (\r\n                                            <div\r\n                                                key={member.employeeId || i}\r\n                                                className={`flex items-center gap-4 p-2 rounded-lg cursor-pointer ${theme === 'dark' ? 'hover:bg-gray-700' : 'hover:bg-gray-50'}`}\r\n                                                onClick={() => {\r\n                                                    setIsGroupInfoModalOpen(false); \r\n                                                    navigate(`/employees/${currentUser.id}/public/${member.employeeId}`); \r\n                                                }}\r\n                                            >                                                {member.employeeImage ? (\r\n                                                <img src={member.employeeImage} alt={member.displayName} className=\"w-10 h-10 rounded-full object-cover\" />\r\n                                            ) : (\r\n                                                <div className={`w-10 h-10 rounded-full flex items-center justify-center ${theme === 'dark' ? 'bg-gray-700' : 'bg-gray-200'}`}>\r\n                                                    <FaUser className={`text-gray-500`} size={20} />\r\n                                                </div>\r\n                                            )}\r\n                                                <div>\r\n                                                    <span className={`font-semibold ${theme === 'dark' ? 'text-white' : 'text-gray-800'}`}>{member.displayName}</span>\r\n                                                    {member.jobTitlePrimary && <p className={`text-sm ${theme === 'dark' ? 'text-gray-400' : 'text-gray-500'}`}>{member.jobTitlePrimary}</p>}\r\n                                                </div>\r\n                                            </div>\r\n                                        ))\r\n                                    )}\r\n                                </div>\r\n                            )}\r\n                            {activeGroupInfoTab === 'Media' && (\r\n                                isAttachmentLoading ? <p className=\"text-center p-4 text-gray-500\">Loading Media...</p> :\r\n                                    <div className=\"grid grid-cols-3 md:grid-cols-4 gap-2\">\r\n                                        {groupMedia.length > 0 ? groupMedia.map((msg, i) => (\r\n                                            <button key={i} onClick={() => setImageInView(getFileUrl(msg))}>\r\n                                                <img src={getFileUrl(msg)} alt={msg.fileName} className=\"w-full h-24 object-cover rounded-md cursor-pointer hover:opacity-80\" />\r\n                                            </button>\r\n                                        )) : <p className=\"col-span-full text-center p-4 text-gray-500\">No media found.</p>}\r\n                                    </div>\r\n                            )}\r\n\r\n                            {activeGroupInfoTab === 'Files' && (\r\n                                isAttachmentLoading ? <p className=\"text-center p-4 text-gray-500\">Loading Files...</p> :\r\n                                    <div className=\"space-y-3\">\r\n                                        {groupFiles.length > 0 ? groupFiles.map(fileMsg => (\r\n                                            <FileMessage key={fileMsg.id} msg={fileMsg} isMyMessage={false} theme={theme} />\r\n                                        )) : <p className=\"text-center p-4 text-gray-500\">No files found in this chat.</p>}\r\n                                    </div>\r\n                            )}\r\n\r\n                            {activeGroupInfoTab === 'Links' && (\r\n                                isAttachmentLoading ? <p className=\"text-center p-4 text-gray-500\">Loading Links...</p> :\r\n                                    <div className=\"space-y-3\">\r\n                                        {(() => {\r\n                                            const allLinks = groupLinks.flatMap(linkMsg => {\r\n                                                const linkRegex = /(https?:\\/\\/[^\\s]+)/g;\r\n                                                const links = linkMsg.content.match(linkRegex);\r\n                                                return links ? links.map(link => ({\r\n                                                    id: linkMsg.id,\r\n                                                    url: link,\r\n                                                    sender: getSenderInfo(linkMsg.sender).name,\r\n                                                    timestamp: linkMsg.timestamp\r\n                                                })) : [];\r\n                                            });\r\n\r\n                                            return allLinks.length > 0 ? (\r\n                                                allLinks.map((link, index) => (\r\n                                                    <div key={`${link.id}-${index}`} className={`p-3 rounded-lg ${theme === 'dark' ? 'bg-gray-700' : 'bg-gray-100'}`}>\r\n                                                        <a href={link.url} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-blue-600 hover:underline break-all\">{link.url}</a>\r\n                                                        <p className={`text-xs mt-1 ${theme === 'dark' ? 'text-gray-400' : 'text-gray-500'}`}>Shared by {link.sender} on {new Date(link.timestamp).toLocaleDateString()}</p>\r\n                                                    </div>\r\n                                                ))\r\n                                            ) : (\r\n                                                <p className={`text-center p-4 ${theme === 'dark' ? 'text-gray-400' : 'text-gray-500'}`}>No links found in this chat.</p>\r\n                                            );\r\n                                        })()}\r\n                                    </div>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {imageInView && (\r\n                <div className=\"fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-[151]\" onClick={() => setImageInView(null)}>\r\n                    <img src={imageInView} alt=\"Full view\" className=\"max-w-[90vw] max-h-[90vh] object-contain\" onClick={(e) => e.stopPropagation()} />\r\n                </div>\r\n            )}\r\n\r\n            {showClearConfirm && (\r\n                <div className=\"fixed inset-0 bg-opacity-100 flex items-center justify-center z-[110]\">\r\n                    <div className={`rounded-lg shadow-xl p-6 w-full max-w-sm ${theme === 'dark' ? 'bg-gray-800' : 'bg-white'}`}>\r\n                        <h3 className={`text-lg font-bold mb-4 ${theme === 'dark' ? 'text-white' : 'text-gray-800'}`}>Clear Chat?</h3>\r\n                        <p className={`mb-6 ${theme === 'dark' ? 'text-gray-400' : 'text-gray-600'}`}>Are you sure you want to clear all messages in this chat? This action cannot be undone.</p>\r\n                        <div className=\"flex justify-end gap-4\">\r\n                            <button onClick={() => setShowClearConfirm(false)} className={`px-4 py-2 rounded-lg text-gray-700 bg-gray-200 hover:bg-gray-300 ${theme === 'dark' ? 'bg-gray-600 text-white hover:bg-gray-700' : ''}`}>\r\n                                Cancel\r\n                            </button>\r\n                            <button onClick={handleConfirmClearChat} className=\"px-4 py-2 rounded-lg text-white bg-red-600 hover:bg-red-700\">\r\n                                Clear Chat\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default ChatApplication;","import { useEffect, useState, useRef, useContext } from 'react';\r\nimport { useParams } from 'react-router-dom';\r\nimport { getChatOverview } from '../../../../services/apiService';\r\nimport { transformOverviewToChatList } from '../../../../services/dataTransformer';\r\nimport ChatApplication from './ChatApplication';\r\nimport { Context } from '../HrmsContext';\r\n\r\nconst ChatListItemSkeleton = () => (\r\n    <div className=\"flex items-center space-x-4 p-3\">\r\n        <div className=\"w-11 h-11 bg-gray-200 rounded-full animate-pulse\"></div>\r\n        <div className=\"flex-1 space-y-2\">\r\n            <div className=\"h-4 bg-gray-200 rounded w-3/4 animate-pulse\"></div>\r\n            <div className=\"h-3 bg-gray-200 rounded w-1/2 animate-pulse\"></div>\r\n        </div>\r\n    </div>\r\n);\r\n\r\nconst ChatAppSkeleton = ({ theme }) => (\r\n    <div className={`flex w-full h-full p-0 md:p-4 md:gap-4 ${theme === 'dark' ? 'bg-gray-900' : 'bg-gray-100'}`}>\r\n        {/* Sidebar Skeleton */}\r\n        <div className={`w-full md:w-[30%] h-full p-4 flex flex-col shadow-xl md:rounded-lg space-y-4 ${theme === 'dark' ? 'bg-gray-800' : 'bg-white'}`}>\r\n            <div className=\"h-12 bg-gray-200 rounded-lg animate-pulse mb-4\"></div>\r\n            <div className=\"flex-grow space-y-2 pr-2 overflow-hidden\">\r\n                <ChatListItemSkeleton />\r\n                <ChatListItemSkeleton />\r\n                <ChatListItemSkeleton />\r\n                <ChatListItemSkeleton />\r\n                <ChatListItemSkeleton />\r\n                <ChatListItemSkeleton />\r\n                <ChatListItemSkeleton />\r\n                <ChatListItemSkeleton />\r\n                <ChatListItemSkeleton />\r\n                <ChatListItemSkeleton />\r\n                <ChatListItemSkeleton />\r\n                <ChatListItemSkeleton />\r\n            </div>\r\n        </div>\r\n\r\n        {/* This part is hidden on mobile to match the final layout's behavior */}\r\n        <div className={`hidden md:flex flex-col w-[70%] h-full md:rounded-lg shadow-xl ${theme === 'dark' ? 'bg-gray-800' : 'bg-white'}`}>\r\n            <div className=\"flex items-center justify-center h-full\">\r\n                <div className=\"text-center\">\r\n                    <p className={`text-xl ${theme === 'dark' ? 'text-gray-400' : 'text-gray-400'}`}>Loading Chats...</p>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n);\r\n\r\n\r\nfunction ChatApp() {\r\n    const { userId } = useParams();\r\n    const { theme,userData} = useContext(Context);\r\n    const [chatList, setChatList] = useState({ groups: [], privateChatsWith: [] });\r\n    const [isLoading, setIsLoading] = useState(true);\r\n    const [isFetchingMore, setIsFetchingMore] = useState(false);\r\n    const [page, setPage] = useState(0);\r\n    const [hasMore, setHasMore] = useState(true);\r\n\r\n    const fetchingMore = useRef(false);\r\n\r\n    const currentUser = {\r\n        name: userData?.displayName || 'You',\r\n        id: userId,\r\n        profile: userData?.employeeImage || 'https://placehold.co/100x100/E2E8F0/4A5568?text=Me'\r\n    };\r\n\r\n    const loadChats = async (pageNum) => {\r\n        console.log(`%c loadChats function started for page: ${pageNum}`, 'color: blue; font-weight: bold;');\r\n\r\n        if (!hasMore || fetchingMore.current) {\r\n            console.log(`%c Request for page ${pageNum} blocked. hasMore=${hasMore}, fetchingMore.current=${fetchingMore.current}`, 'color: red;');\r\n            return;\r\n        }\r\n\r\n        fetchingMore.current = true;\r\n\r\n        if (pageNum === 0) {\r\n            setIsLoading(true);\r\n        } else {\r\n            setIsFetchingMore(true);\r\n        }\r\n\r\n        try {\r\n            console.log(`%c Sending API request for page: ${pageNum}`, 'color: green;');\r\n            const rawChatListData = await getChatOverview(userId, pageNum, 10);\r\n\r\n            if (rawChatListData.length === 0) {\r\n                setHasMore(false);\r\n                return;\r\n            }\r\n\r\n            const formattedChatList = transformOverviewToChatList(rawChatListData, userId);\r\n\r\n            setChatList(prevChatList => {\r\n                if (pageNum === 0) {\r\n                    return formattedChatList;\r\n                }\r\n                const existingGroupIds = new Set(prevChatList.groups.map(g => g.chatId));\r\n                const existingPrivateIds = new Set(prevChatList.privateChatsWith.map(p => p.chatId));\r\n                const newUniqueGroups = formattedChatList.groups.filter(g => !existingGroupIds.has(g.chatId));\r\n                const newUniquePrivate = formattedChatList.privateChatsWith.filter(p => !existingPrivateIds.has(p.chatId));\r\n                return {\r\n                    groups: [...prevChatList.groups, ...newUniqueGroups],\r\n                    privateChatsWith: [...prevChatList.privateChatsWith, ...newUniquePrivate]\r\n                };\r\n            });\r\n\r\n            if (rawChatListData.length < 10) {\r\n                setHasMore(false);\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Error loading chats:\", error);\r\n        } finally {\r\n            if (pageNum === 0) {\r\n                setIsLoading(false);\r\n            }\r\n            setIsFetchingMore(false);\r\n\r\n            fetchingMore.current = false;\r\n            console.log(`%c Finished fetch for page ${pageNum}. Lock released.`, 'color: orange;');\r\n        }\r\n    };\r\n\r\n    const handleLoadMore = () => {\r\n        console.log(\"handleLoadMore triggered!\");\r\n        if (fetchingMore.current || !hasMore) {\r\n            console.log(\"handleLoadMore blocked by ref lock or no more data.\");\r\n            return;\r\n        }\r\n        const nextPage = page + 1;\r\n        setPage(nextPage);\r\n        loadChats(nextPage);\r\n    };\r\n\r\n    useEffect(() => {\r\n        if (userId) {\r\n            loadChats(0);\r\n        }\r\n    }, [userId]);\r\n\r\n    return (\r\n        <div className={`flex h-full w-full ${theme === 'dark' ? 'bg-gray-900' : 'bg-gray-100'}`}>\r\n            {isLoading ? (\r\n                <ChatAppSkeleton theme={theme} />\r\n            ) : (\r\n                <ChatApplication\r\n                    currentUser={currentUser}\r\n                    chats={chatList}\r\n                    loadMoreChats={handleLoadMore}\r\n                    hasMore={hasMore}\r\n                    isFetchingMore={isFetchingMore}\r\n                    theme={theme}\r\n                />\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default ChatApp;"],"names":["formatFileSize","bytes","i","Math","floor","log","parseFloat","pow","toFixed","FileIcon","_ref","_fileName$split$pop","fileName","className","extension","split","pop","toLowerCase","includes","_jsx","FaFilePdf","concat","FaFileWord","FaFilePowerpoint","FaFileExcel","FaFileArchive","FaImage","FaFileAudio","FaFileAlt","FileMessage","_ref2","msg","isMyMessage","theme","downloadUrl","chatApi","defaults","baseURL","messageId","content","_jsxs","children","fileSize","onClick","async","e","preventDefault","stopPropagation","response","fetch","ok","Error","blob","blobUrl","window","URL","createObjectURL","link","document","createElement","href","setAttribute","body","appendChild","click","remove","revokeObjectURL","error","console","open","FaDownload","size","AudioPlayer","_ref3","src","fileUrl","isSender","initialDuration","audioRef","useRef","isPlaying","setIsPlaying","useState","progress","setProgress","duration","setDuration","localSrc","setLocalSrc","isDownloading","setIsDownloading","useEffect","audio","current","setAudioData","Infinity","setAudioTime","currentTime","handleEnded","addEventListener","removeEventListener","handleDownload","localUrl","formatTime","time","minutes","seconds","toString","padStart","progressPercentage","ref","preload","togglePlayPause","pause","play","catch","FaPause","FaPlay","rect","currentTarget","getBoundingClientRect","newTime","clientX","left","width","style","MessageSkeleton","_ref4","ContactProfileModal","_ref5","chat","onClose","isZoomed","setIsZoomed","type","profile","alt","name","FaUsers","_ref6","currentUser","chats","initialChats","loadMoreChats","hasMore","isFetchingMore","location","useLocation","navigate","useNavigate","chatData","setChatData","groups","privateChatsWith","searchTerm","setSearchTerm","selectedChat","setSelectedChat","message","setMessage","messages","setMessages","isMessagesLoading","setIsMessagesLoading","isChatOpen","setIsChatOpen","showEmojiPicker","setShowEmojiPicker","isRecording","setIsRecording","showChatMenu","setShowChatMenu","downloadedMedia","setDownloadedMedia","contextMenu","setContextMenu","visible","x","y","index","editingInfo","setEditingInfo","originalContent","replyingTo","setReplyingTo","lastDeleted","setLastDeleted","pinnedMessage","setPinnedMessage","forwardingInfo","setForwardingInfo","forwardRecipients","setForwardRecipients","forwardSearchTerm","setForwardSearchTerm","showPinnedMenu","setShowPinnedMenu","isProfileModalOpen","setIsProfileModalOpen","isGroupInfoModalOpen","setIsGroupInfoModalOpen","activeGroupInfoTab","setActiveGroupInfoTab","groupMembers","setGroupMembers","isGroupDataLoading","setIsGroupDataLoading","groupMembersCache","setGroupMembersCache","imageInView","setImageInView","isChatDataReady","setIsChatDataReady","isConnected","setIsConnected","showClearConfirm","setShowClearConfirm","typingUsers","setTypingUsers","messagePages","setMessagePages","hasMoreMessages","setHasMoreMessages","isFetchingMoreMessages","setIsFetchingMoreMessages","showScrollToBottom","setShowScrollToBottom","newMessagesCount","setNewMessagesCount","viewingProfile","setViewingProfile","searchChatResults","setSearchChatResults","isSearching","setIsSearching","groupMedia","setGroupMedia","groupFiles","setGroupFiles","groupLinks","setGroupLinks","isAttachmentLoading","setIsAttachmentLoading","isSearchVisible","setIsSearchVisible","searchQuery","setSearchQuery","searchResults","setSearchResults","currentResultIndex","setCurrentResultIndex","setIsChatWindowVisible","setChatUnreadCount","useContext","Context","sidebarScrollRef","chatContainerRef","stompClient","typingTimeoutRef","fileInputRef","mediaRecorderRef","audioChunksRef","streamRef","emojiPickerRef","emojiButtonRef","chatMenuRef","chatMenuButtonRef","contextMenuRef","messageInputRef","isManuallyClosing","pinnedMenuRef","pinnedMenuButtonRef","onMessageReceivedRef","isFetchingOldMessages","subscriptions","chatIdFromUrl","useMemo","pathname","URLSearchParams","search","get","trim","timerId","setTimeout","searchMessages","id","chatId","then","results","length","clearTimeout","messageElement","getElementById","scrollIntoView","behavior","block","scrollToBottom","arguments","undefined","scrollTo","top","scrollHeight","debounceTimer","searchChatOverview","rawResults","formattedResults","transformOverviewToChatList","combinedResults","sort","a","b","Date","lastMessageTimestamp","finally","correctedChats","map","_objectSpread","unreadMessageCount","loadMoreMessages","useCallback","pageNum","rawMessages","getMessages","prev","transformedMessages","transformMessageDTOToUIMessage","chatContainer","previousScrollHeight","previousScrollTop","scrollTop","requestAnimationFrame","pinnedMsgData","getPinnedMessage","fetchPinnedMessage","updateLastMessage","updateChat","isNewUnread","isDeleted","sender","overviewItem","lastMessage","lastMessageType","toUpperCase","lastMessageSenderId","generateChatListPreview","timestamp","toISOString","onMessageReceived","payload","container","shouldScrollOnReceive","clientHeight","parsedData","JSON","parse","status","messageIds","prevMessages","chatKey","groupId","chatMessages","newStatus","updatedMessages","pinnedDto","eventChatId","receiver","unpinPayload","senderId","receiverId","receivedMessage","messageChatId","warn","wasLastMessage","newLastMessage","isEdited","updatedMsg","finalServerId","some","m","newChatMessages","messageProcessed","finalMessageForUpdate","isProperAck","client_id","isBroadcastOfOwnMessage","isIncoming","optimisticIndex","findIndex","transformedServerMessage","findLastIndex","finalMessage","push","prevCount","allChats","filter","user","totalUnread","reduce","acc","handleTypingEvent","typingUpdate","chatIdKey","senderChatInfo","find","c","senderName","newTypingUsers","typing","p","updated","onSidebarUpdate","updatedChatList","updatedPrivate","updatedGroups","pc","update","upc","g","ug","token","localStorage","getItem","brokerURL","client","Client","reconnectDelay","onConnect","messageHandler","subscribe","statusUpdate","userId","newPrivateChats","isOnline","onWebSocketError","onStompError","frame","headers","onWebSocketClose","activate","_stompClient$current","_stompClient$current2","active","destination","publish","deactivate","groupIds","join","_stompClient$current3","requiredGroupIds","Set","currentSubKeys","Object","keys","subscribedGroupIds","key","startsWith","replace","forEach","has","subId","unsubscribe","typingSubId","openChat","_stompClient$current4","targetChat","stringify","_teamDetailsResponse$","teamDetailsResponse","getGroupMembers","members","employees","prevCache","newUrl","history","pushState","path","closeChat","_stompClient$current5","handleChatSelect","_stompClient$current6","isGroup","updatedList","handleBeforeUnload","teamDetails","Array","isArray","media","getChatAttachments","files","links","fetchGroupData","handleClickOutside","event","_emojiButtonRef$curre","_chatMenuButtonRef$cu","_pinnedMenuButtonRef$","contains","target","sendTypingStatus","isTyping","_stompClient$current7","handleSendMessage","clientId","now","random","substring","isReply","optimisticMessage","replyTo","isForwarded","replyToMessageId","startRecording","navigator","mediaDevices","getUserMedia","stream","mediaRecorder","MediaRecorder","ondataavailable","data","onstop","audioBlob","Blob","audioFile","File","lastModified","reader","FileReader","readAsDataURL","onloadend","base64String","result","localPreviewUrl","voiceData","fileType","fileData","uploadVoiceMessage","newMessages","start","alert","stopRecording","state","stop","getTracks","track","handleMediaDownload","handleSaveEdit","_stompClient$current8","updatedContent","cancelEdit","currentMessages","messageToEdit","optimisticUpdatedMessage","updatedMessagesList","handleDelete","messageToDelete","forEveryone","deleteMessageForEveryone","deleteMessageForMe","nextMessages","_","handleUndoDelete","handleGoToMessage","messageIndex","querySelector","classList","add","chatsToDisplay","chatToSelect","_location$state","newChatTarget","prevData","updatedPrivateChats","formatTimestamp","isoString","date","endsWith","isNaN","toLocaleTimeString","hour","minute","hour12","formatDateHeader","String","today","yesterday","setDate","getDate","toDateString","toLocaleDateString","year","month","day","lastMessageDate","currentChatInfo","getSenderInfo","member","employeeId","displayName","employeeImage","getFileUrl","baseUrl","origin","messageIdForUrl","placeholder","value","onChange","onScroll","handleSidebarScroll","FaUser","_Fragment","FaArrowLeft","disabled","userLastSeen","formatLastSeen","memberCount","BsThreeDotsVertical","autoFocus","handlePrevResult","FaChevronUp","handleNextResult","FaChevronDown","FaTimes","FaThumbtack","messageType","FaAngleDoubleRight","unpinMessage","handleChatScroll","nextPage","isScrolledUp","contextMessagesRaw","getMessageContext","transformedContext","element","handleJumpToMessage","_searchResults$curren","msgDate","showDateHeader","senderInfo","React","profileSrc","profileName","onContextMenu","handleContextMenu","pageX","pageY","innerWidth","innerHeight","FaShare","maxHeight","download","FaCheck","FaCheckDouble","FaEye","EmojiPicker","onEmojiClick","emojiObject","emoji","height","onKeyDown","shiftKey","FaSmile","handleFileButtonClick","FaPaperclip","FaPaperPlane","handleMicButtonClick","FaStop","FaMicrophone","file","localPreviewContent","formData","FormData","append","uploadFile","FaTrash","handleReply","focus","FaReply","_contextMenu$message","messageIdToPin","pinMessage","handleForward","handleEdit","FaEdit","_c$name","checked","htmlFor","onError","originalMsg","forwardData","forwardMessageId","forwardTo","forwardMessage","newLastMessageObject","tab","jobTitlePrimary","fileMsg","allLinks","flatMap","linkMsg","match","url","rel","clearChatHistory","ChatListItemSkeleton","ChatAppSkeleton","useParams","userData","chatList","setChatList","isLoading","setIsLoading","setIsFetchingMore","page","setPage","setHasMore","fetchingMore","loadChats","rawChatListData","getChatOverview","formattedChatList","prevChatList","existingGroupIds","existingPrivateIds","newUniqueGroups","newUniquePrivate","ChatApplication","handleLoadMore"],"sourceRoot":""}