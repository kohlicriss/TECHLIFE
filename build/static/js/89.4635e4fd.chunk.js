"use strict";(self.webpackChunktechlife=self.webpackChunktechlife||[]).push([[89],{6089:(e,s,r)=>{r.r(s),r.d(s,{default:()=>u});var t=r(5043),a=r(3679),l=r(184),n=r(614),o=r(9910),i=r(2397),d=r(579);const c=e=>{let{isOpen:s,onClose:r,type:a,title:o,message:i,theme:c}=e;const[m,u]=(0,t.useState)(!1);(0,t.useEffect)(()=>{if(s&&(u(!0),"success"===a||"error"===a)){const e=setTimeout(()=>{x()},3e3);return()=>clearTimeout(e)}},[s,a]);const x=()=>{u(!1),setTimeout(()=>r(),300)};if(!s)return null;return(0,d.jsx)("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-md flex justify-center items-center z-[200] transition-opacity duration-300 "+(m?"opacity-100":"opacity-0"),children:(0,d.jsxs)("div",{className:`p-6 rounded-3xl shadow-2xl w-full max-w-md m-4 border transform transition-all duration-300 ${m?"scale-100 translate-y-0":"scale-95 translate-y-4"} ${"dark"===c?"bg-gray-800 border-gray-700":"bg-white border-gray-200"}`,children:[(0,d.jsxs)("div",{className:"flex items-center mb-4",children:[(()=>{switch(a){case"success":return(0,d.jsx)(l.A7C,{className:"w-6 h-6 text-green-500"});case"error":return(0,d.jsx)(l.BS8,{className:"w-6 h-6 text-red-500"});case"info":return(0,d.jsx)(l.__w,{className:"w-6 h-6 text-blue-500"});default:return null}})(),(0,d.jsx)("h3",{className:`text-xl font-bold ml-3 ${(()=>{switch(a){case"success":return"text-green-600 dark:text-green-400";case"error":return"text-red-600 dark:text-red-400";case"info":return"text-blue-600 dark:text-blue-400";default:return"dark"===c?"text-white":"text-gray-800"}})()}`,children:o}),"success"!==a&&"error"!==a&&(0,d.jsx)("button",{onClick:x,className:"ml-auto p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200",children:(0,d.jsx)(n.A,{size:20})})]}),(0,d.jsx)("p",{className:""+("dark"===c?"text-gray-300":"text-gray-600"),children:i}),("success"===a||"error"===a)&&(0,d.jsx)("div",{className:"mt-4 flex justify-end",children:(0,d.jsx)("button",{onClick:x,className:"px-4 py-2 rounded-lg font-medium transition-colors "+("success"===a?"bg-green-500 hover:bg-green-600 text-white":"bg-red-500 hover:bg-red-600 text-white"),children:"OK"})})]})})},m=e=>{let{isOpen:s,onClose:r,onConfirm:a,title:o,message:i,confirmText:c,isConfirming:m,theme:u,type:x="warning"}=e;const[g,b]=(0,t.useState)(!1);(0,t.useEffect)(()=>{s&&b(!0)},[s]);const h=()=>{b(!1),setTimeout(()=>r(),300)};if(!s)return null;return(0,d.jsx)("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-md flex justify-center items-center z-[200] transition-opacity duration-300 "+(g?"opacity-100":"opacity-0"),children:(0,d.jsxs)("div",{className:`p-6 rounded-3xl shadow-2xl w-full max-w-md m-4 border transform transition-all duration-300 ${g?"scale-100 translate-y-0":"scale-95 translate-y-4"} ${"dark"===u?"bg-gray-800 border-gray-700":"bg-white border-gray-200"}`,children:[(0,d.jsxs)("div",{className:"flex items-center mb-4",children:[(()=>{switch(x){case"danger":return(0,d.jsx)(l.BS8,{className:"w-6 h-6 text-red-500"});case"warning":default:return(0,d.jsx)(l.BS8,{className:"w-6 h-6 text-yellow-500"});case"info":return(0,d.jsx)(l.__w,{className:"w-6 h-6 text-blue-500"})}})(),(0,d.jsx)("h3",{className:`text-xl font-bold ml-3 ${(()=>{switch(x){case"danger":return"text-red-600 dark:text-red-400";case"warning":default:return"text-yellow-600 dark:text-yellow-400";case"info":return"text-blue-600 dark:text-blue-400"}})()}`,children:o}),(0,d.jsx)("button",{onClick:h,className:"ml-auto p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200",children:(0,d.jsx)(n.A,{size:20})})]}),(0,d.jsx)("p",{className:"mb-6 "+("dark"===u?"text-gray-300":"text-gray-600"),children:i}),(0,d.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,d.jsx)("button",{onClick:h,className:"px-4 py-2 rounded-lg font-medium transition-colors "+("dark"===u?"bg-gray-600 hover:bg-gray-500 text-gray-200":"bg-gray-200 hover:bg-gray-300 text-gray-700"),children:"Cancel"}),(0,d.jsx)("button",{onClick:a,disabled:m,className:`px-4 py-2 rounded-lg font-medium text-white transition-colors flex items-center ${(()=>{switch(x){case"danger":return"bg-red-600 hover:bg-red-700";case"warning":default:return"bg-yellow-600 hover:bg-yellow-700";case"info":return"bg-blue-600 hover:bg-blue-700"}})()} ${m?"opacity-75 cursor-not-allowed":""}`,children:m?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{className:"h-4 w-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Processing..."]}):c})]})]})})},u=()=>{var e,s;const{theme:r,permissionsdata:u,userData:x,setPermissionsData:g}=(0,t.useContext)(o.ob),[b,h]=(0,t.useState)({}),[p,y]=(0,t.useState)(!0),[f,w]=(0,t.useState)(!1),[v,j]=(0,t.useState)(null),[N,k]=(0,t.useState)({isOpen:!1,type:"",title:"",message:""}),[C,S]=(0,t.useState)({isOpen:!1,title:"",message:"",confirmText:"",onConfirm:null,type:"warning",isConfirming:!1}),[E,R]=(0,t.useState)(!1),A=null===x||void 0===x||null===(e=x.roles[0])||void 0===e?void 0:e.toUpperCase(),O=A||null;console.log("Searching for role:",O);const T=u.find(e=>e.roleName.trim()===O.trim());(0,t.useEffect)(()=>{T&&j(T)},[T]),console.log("Found object:",v);const[_,P]=(0,t.useState)(""),[$,L]=(0,t.useState)([]),[D,U]=(0,t.useState)(!1),[F,z]=(0,t.useState)(""),[M,I]=(0,t.useState)(!1),[B,Q]=(0,t.useState)(!1),[Z,V]=(0,t.useState)(null),W=(e,s,r)=>{k({isOpen:!0,type:e,title:s,message:r})},H=()=>{S({isOpen:!1,title:"",message:"",confirmText:"",onConfirm:null,type:"warning",isConfirming:!1})},K=e=>e?e.replace("ROLE_","").toLowerCase():null,q=()=>{if(!u||!Array.isArray(u))return{};const e={};return u.forEach(s=>{const r=K(s.roleName);r&&(e[r]={id:s.id,permissions:s.permissions?[...new Set(s.permissions)]:[]})}),e};(0,t.useEffect)(()=>{if(u&&Array.isArray(u)){const e=(()=>{if(!u||!Array.isArray(u))return[];const e=u.flatMap(e=>e.permissions||[]);return[...new Set(e)].map(e=>{let s=e.replace(/_/g," ").toLowerCase().replace(/\b\w/g,e=>e.toUpperCase());return"CREAT_USER"===e&&(s="Create User"),"DELETE_USER"===e&&(s="Delete User"),"CREATE_TASK"===e&&(s="Create Task"),"VIEW_TASKS"===e&&(s="View Tasks"),"VIEW_REPORTS"===e&&(s="View Reports"),"PERMISSIONS_BUTTENS"===e&&(s="Permissions Buttons"),"CREATE_HR"===e&&(s="Create HR"),{value:e,label:s}}).sort((e,s)=>e.label.localeCompare(s.label))})();L(e);const s=q();h(s),y(!1),R(!0)}else y(!1)},[u]);const G={};if(p)return(0,d.jsx)("div",{children:"Loading..."});const J=Object.keys(b).sort();return(0,d.jsxs)(d.Fragment,{children:[D&&(0,d.jsx)("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-md flex items-center justify-center z-151",children:(0,d.jsxs)("div",{className:"p-6 rounded-3xl shadow-2xl w-full max-w-md m-4 border "+("dark"===r?"bg-gray-800 border-gray-700":"bg-white border-gray-200"),children:[(0,d.jsxs)("div",{className:"flex items-center mb-4",children:[(0,d.jsx)(l.__w,{className:"w-6 h-6 text-blue-500"}),(0,d.jsx)("h2",{className:"text-xl font-bold ml-3 "+("dark"===r?"text-white":"text-gray-800"),children:"Add a New Role"}),(0,d.jsx)("button",{onClick:()=>U(!1),className:"ml-auto p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200",children:(0,d.jsx)(n.A,{size:20})})]}),(0,d.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),!F.trim()||!F.toUpperCase().startsWith("ROLE_"))return void W("error","Invalid Role Name","Please enter a valid role name starting with 'ROLE_'.");const s=K(F);if(b[s])return void W("error","Role Already Exists","This role already exists.");I(!0);const r={roleName:F.trim().toUpperCase(),permissions:[]};try{await i.ZQ.post("/role-access",r);const e=await i.ZQ.get("/role-access/all");g(e.data),U(!1),z(""),W("success","Role Created Successfully",`Role '${r.roleName}' created successfully and UI has been updated!`)}catch(l){var t,a;console.error("Failed to create new role or refresh data:",l);const e=(null===(t=l.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||"An error occurred.";W("error","Role Creation Failed",`Error: ${e}`)}finally{I(!1)}},children:[(0,d.jsx)("input",{type:"text",value:F,onChange:e=>z(e.target.value),placeholder:"ROLE_ROLENAME",className:"w-full p-3 border rounded-lg focus:outline-none focus:ring-2 mb-4 "+("dark"===r?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300")}),(0,d.jsxs)("div",{className:"flex justify-end gap-4",children:[(0,d.jsx)("button",{type:"button",onClick:()=>U(!1),className:"px-4 py-2 rounded-lg font-medium transition-colors "+("dark"===r?"bg-gray-600 hover:bg-gray-500 text-gray-200":"bg-gray-200 hover:bg-gray-300 text-gray-700"),disabled:M,children:"Cancel"}),(0,d.jsx)("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 disabled:bg-blue-400 flex items-center",disabled:M,children:M?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{className:"h-4 w-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Adding..."]}):"Add Role"})]})]})]})}),(0,d.jsx)("div",{className:"min-h-screen px-0 sm:px-4 md:px-6 lg:px-8 py-4 sm:py-6 "+("dark"===r?"bg-gray-900 text-white":"bg-gray-50 text-gray-800"),children:(0,d.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,d.jsxs)("div",{className:"mb-6 sm:mb-8 px-4 sm:px-0 flex justify-between items-center",children:[(0,d.jsxs)("div",{children:[(null===v||void 0===v||null===(s=v.permissions)||void 0===s?void 0:s.includes("DELETE_USER"))&&(0,d.jsx)("h1",{className:"text-2xl sm:text-3xl font-bold mb-2",children:"Permissions Management"}),(0,d.jsx)("p",{className:"text-sm "+("dark"===r?"text-gray-400":"text-gray-600"),children:"Configure role-based permissions"})]}),(0,d.jsx)("div",{children:(0,d.jsx)("button",{onClick:()=>{Q(!B),V(null)},className:"p-3 rounded-full transition-colors duration-200 "+(B?"bg-blue-600 text-white":"dark"===r?"bg-gray-700 hover:bg-gray-600":"bg-gray-200 hover:bg-gray-300"),title:B?"Cancel Edit":"Edit Roles",children:(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.5L14.732 3.732z"})})})})]}),(0,d.jsx)("div",{className:"p-4 sm:p-6 rounded-lg shadow-md mb-8 "+("dark"===r?"bg-gray-800":"bg-white"),children:(0,d.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start gap-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Add a New Permission"}),(0,d.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,d.jsx)("input",{type:"text",value:_,onChange:e=>P(e.target.value),placeholder:"Enter new permission label",className:"flex-grow p-3 border rounded-lg "+("dark"===r?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300")}),(0,d.jsx)("button",{type:"button",onClick:()=>{if(!_.trim())return void W("error","Validation Error","Please enter a label for the new permission.");const e=_.trim().toUpperCase().replace(/\s+/g,"_");if($.some(s=>s.value===e))return void W("error","Duplicate Permission","A permission with this value already exists.");const s={value:e,label:_.trim()};L(e=>[...e,s].sort((e,s)=>e.label.localeCompare(s.label))),P(""),W("success","Permission Added","New permission has been added successfully.")},className:"px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700",children:"Add Permission"})]})]}),(0,d.jsxs)("div",{className:"flex-shrink-0 mt-4 sm:mt-0",children:[(0,d.jsx)("h3",{className:"text-lg font-semibold mb-2 text-transparent select-none hidden sm:block",children:"."}),(0,d.jsx)("button",{onClick:()=>U(!0),className:"w-full px-6 py-3 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700",children:"Add New Role"})]})]})}),(0,d.jsxs)("div",{className:"space-y-4 sm:space-y-6 md:space-y-8",children:[J.map(e=>{const s=$.filter(s=>{var r,t;return null===(r=b[e])||void 0===r||null===(t=r.permissions)||void 0===t?void 0:t.includes(s.value)});return(0,d.jsx)("div",{className:"mx-4 sm:mx-0 rounded-lg shadow-md border transition-all duration-300 "+(Z===e?"border-red-500 ring-2 ring-red-500/50":"dark"===r?"border-gray-700":"border-gray-200"),children:(0,d.jsxs)("div",{className:"p-4 sm:p-6 md:p-8 flex items-start gap-4",children:[B&&(0,d.jsx)("input",{type:"checkbox",className:"mt-2 h-6 w-6 rounded border-gray-300 text-blue-600 focus:ring-blue-500 disabled:opacity-50 cursor-pointer",checked:Z===e,onChange:()=>{return s=e,void V(e=>e===s?null:s);var s},disabled:null!==Z&&Z!==e}),(0,d.jsxs)("div",{className:"flex-grow",children:[(0,d.jsx)("h2",{className:"text-lg sm:text-xl font-semibold capitalize mb-4 pb-2 border-b "+("dark"===r?"border-gray-700":"border-gray-200"),children:e.replace(/_/g," ")}),(0,d.jsx)(a.Ay,{isMulti:!0,options:$,value:s,onChange:s=>((e,s)=>{const r=e?e.map(e=>e.value):[];h(e=>({...e,[s]:{...e[s],permissions:r}}))})(s,e),styles:G,placeholder:"Select permissions...",closeMenuOnSelect:!1,isDisabled:B}),(0,d.jsxs)("p",{className:"text-xs mt-3 "+("dark"===r?"text-gray-400":"text-gray-500"),children:[s.length," permission(s) selected"]})]})]})},e)}),(0,d.jsx)("div",{className:"pt-4 sm:pt-6 px-4 sm:px-0",children:(0,d.jsx)("div",{className:"flex flex-col sm:flex-row justify-end gap-3 sm:gap-4",children:B?(0,d.jsx)("button",{type:"button",onClick:async()=>{if(!Z)return void W("error","No Role Selected","Please select a role to delete.");const e=`ROLE_${Z.toUpperCase()}`;!function(e,s,r,t){S({isOpen:!0,title:e,message:s,confirmText:r,onConfirm:t,type:arguments.length>4&&void 0!==arguments[4]?arguments[4]:"warning",isConfirming:!1})}("Delete Role",`Are you sure you want to delete the role: ${e}? This action cannot be undone.`,"Delete Role",async()=>{S(e=>({...e,isConfirming:!0}));try{const s="ADMIN";await i.ZQ.delete(`role-access/delete/${s}/${e}`);const r=await i.ZQ.get("/role-access/all");g(r.data),H(),W("success","Role Deleted",`Role '${e}' has been deleted successfully.`),V(null),Q(!1)}catch(t){var s,r;console.error("Failed to delete role:",t);const e=(null===(s=t.response)||void 0===s||null===(r=s.data)||void 0===r?void 0:r.message)||"An error occurred while deleting the role.";H(),W("error","Delete Failed",`Error: ${e}`)}},"danger")},disabled:!Z,className:"w-full sm:w-auto px-8 py-3 bg-red-600 text-white font-bold rounded-lg shadow-lg disabled:bg-red-400 disabled:cursor-not-allowed",children:"Delete Selected Role"}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("button",{type:"button",onClick:()=>{if(u&&Array.isArray(u)){const e=q();h(e),W("success","Permissions Reset","Permissions have been reset to their original state.")}},className:"w-full sm:w-auto px-6 py-3 border-2 rounded-lg font-semibold "+("dark"===r?"border-gray-600 text-gray-200 hover:bg-gray-600":"border-gray-300 text-gray-700 hover:bg-gray-100"),children:"Reset"}),(0,d.jsx)("button",{type:"button",onClick:async e=>{e.preventDefault(),w(!0);const s=Object.keys(b).map(e=>{const s={roleName:`ROLE_${e.toUpperCase()}`,permissions:b[e].permissions||[]};return null!==b[e].id&&(s.id=b[e].id),s});try{await i.ZQ.post("role-access/updateAll",s);const e=await i.ZQ.get("/role-access/all");g(e.data),W("success","Permissions Saved","Permissions have been saved successfully!")}catch(a){var r,t;console.error("Error saving permissions:",a);const e=(null===(r=a.response)||void 0===r||null===(t=r.data)||void 0===t?void 0:t.message)||"An error occurred while saving permissions.";W("error","Save Failed",`Error: ${e}`)}finally{w(!1)}},disabled:f,className:"w-full sm:w-auto flex items-center justify-center gap-2 px-8 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-bold rounded-lg "+(f?"cursor-not-allowed opacity-75":"hover:shadow-lg"),children:f?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{className:"h-4 w-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Saving..."]}):"Save Permissions"})]})})})]})]})}),(0,d.jsx)(c,{isOpen:N.isOpen,onClose:()=>{k({isOpen:!1,type:"",title:"",message:""})},type:N.type,title:N.title,message:N.message,theme:r}),(0,d.jsx)(m,{isOpen:C.isOpen,onClose:H,onConfirm:C.onConfirm,title:C.title,message:C.message,confirmText:C.confirmText,isConfirming:C.isConfirming,theme:r,type:C.type})]})}}}]);
//# sourceMappingURL=89.4635e4fd.chunk.js.map