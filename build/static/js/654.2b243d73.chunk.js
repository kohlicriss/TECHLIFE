"use strict";(self.webpackChunktechlife=self.webpackChunktechlife||[]).push([[654],{654:(e,t,a)=>{a.r(t),a.d(t,{default:()=>A});var s=a(5043),r=a(5439),n=a(2397);const l=async function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:15;try{const r=await n.Pt.get("/chat/".concat(e,"/").concat(t,"?page=").concat(a,"&size=").concat(s));return console.log("Response for messages page ".concat(a,":"),r),r.data}catch(r){return console.error("Failed to fetch messages for chat ".concat(t,":"),r),[]}},c=async e=>{try{const t=await n.yE.get("/employee/team/employee/".concat(e));return console.log("Response:",t),t.data}catch(t){return console.error("Failed to fetch members for team ".concat(e,":"),t),null}},i=async(e,t)=>{try{const a=await n.Pt.get("/chat/".concat(e,"/attachments"),{params:{type:t}});return console.log("Response for ".concat(t,":"),a.data),a.data}catch(a){return console.error("Failed to fetch ".concat(t," for chat ").concat(e,":"),a),[]}},o=(e,t)=>{if(!e.lastMessage||"Chat cleared"===e.lastMessage)return"";const a=e.lastMessage,s=e.lastMessageSenderId===t?"You: ":"";if(e.lastMessageType)switch(e.lastMessageType.toUpperCase()){case"IMAGE":return s+"\ud83d\udcf7 Image";case"AUDIO":return s+"\ud83c\udfa4 Voice Message";case"FILE":return s+"\ud83d\udcce ".concat(a);case"DELETED":return"This message was deleted"}return a.match(/\.(jpeg|jpg|gif|png|webp)$/i)?s+"\ud83d\udcf7 Image":a.match(/\.(mp3|wav|ogg|m4a|webm)$/i)?s+"\ud83c\udfa4 Voice Message":a.match(/\.(pdf|doc|docx|ppt|pptx|xls|xlsx|zip|rar)$/i)?s+"\ud83d\udcce ".concat(a):s+a},d=(e,t)=>{if(!e||!Array.isArray(e))return{groups:[],privateChatsWith:[]};const a={groups:[],privateChatsWith:[]};return e.forEach(e=>{const s={chatId:e.chatId,name:e.groupName||e.employeeName,lastMessage:o(e,t),lastMessageTimestamp:e.lastSeen,unreadMessageCount:e.unreadMessageCount,profile:e.profile||null,isOnline:e.isOnline,memberCount:e.memberCount||0,type:"GROUP"===e.chatType?"group":"private"};"group"===s.type?a.groups.push(s):a.privateChatsWith.push(s)}),a},u=e=>{let t;try{if(e.timestamp){const a=String(e.timestamp);t=new Date(a.endsWith("Z")?a:a+"Z").toISOString()}else t=e.date&&e.time?new Date("".concat(e.date," ").concat(e.time," UTC")).toISOString():(new Date).toISOString()}catch(c){t=(new Date).toISOString()}let a="text",s=e.fileUrl||null;e.fileName?a=e.fileType?e.fileType.startsWith("image/")?"image":e.fileType.startsWith("audio/")?"audio":e.fileType.startsWith("video/")?"video":"file":e.fileName.match(/\.(jpeg|jpg|gif|png|webp)$/i)?"image":e.fileName.match(/\.(mp3|wav|ogg|m4a)$/i)?"audio":e.fileName.match(/\.(mp4|webm|mov)$/i)?"video":"file":e.kind&&"text"!==e.kind&&(a=e.kind.toLowerCase());const r=e.id||e.messageId;if(!s&&["image","video","audio","file"].includes(a)&&r){const e=n.Pt.defaults.baseURL;s="".concat(e,"/chat/file/").concat(r)}e.isDeleted&&(a="deleted");const l=e.id||e.messageId;return{id:l,messageId:l,content:e.content,sender:e.sender,timestamp:t,status:!0===e.seen||"true"===String(e.isSeen)?"seen":"sent",type:a,isEdited:e.isEdited||!1,isPinned:e.pinned||!1,fileName:e.fileName||null,fileUrl:s,fileSize:e.fileSize||null,duration:e.duration||0,clientId:e.clientId||null,isForwarded:e.forwarded||!1,forwardedFrom:e.forwardedFrom||null,isReply:!!e.replyTo,replyTo:e.replyTo?{sender:e.replyTo.senderId,content:e.replyTo.content,originalMessageId:e.replyTo.originalMessageId,type:e.replyTo.type}:null}};var g=a(9379),m=a(7234),h=a(1266),x=a(184),p=a(1462),f=a(4258),y=a(579);const b=e=>{if(!e||0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB","TB"][t]},v=e=>{var t;let{fileName:a,className:s="text-3xl"}=e;const r=null===a||void 0===a||null===(t=a.split(".").pop())||void 0===t?void 0:t.toLowerCase();return["pdf"].includes(r)?(0,y.jsx)(x.kl1,{className:"text-red-500 ".concat(s)}):["doc","docx"].includes(r)?(0,y.jsx)(x.WLb,{className:"text-blue-700 ".concat(s)}):["ppt","pptx"].includes(r)?(0,y.jsx)(x.rgF,{className:"text-orange-500 ".concat(s)}):["xls","xlsx"].includes(r)?(0,y.jsx)(x.Ru,{className:"text-green-600 ".concat(s)}):["zip","rar","7z"].includes(r)?(0,y.jsx)(x.aw1,{className:"text-yellow-500 ".concat(s)}):["png","jpg","jpeg","gif","webp"].includes(r)?(0,y.jsx)(x.dkL,{className:"text-purple-500 ".concat(s)}):["mp3","wav","ogg"].includes(r)?(0,y.jsx)(x.EVA,{className:"text-pink-500 ".concat(s)}):(0,y.jsx)(x.t69,{className:"text-gray-500 ".concat(s)})},j=e=>{let{msg:t,isMyMessage:a,theme:s}=e;const r="".concat(n.Pt.defaults.baseURL,"/chat/file/").concat(t.messageId),l=(0,y.jsxs)("div",{className:"flex items-center gap-3 p-2 rounded-lg max-w-xs md:max-w-sm ".concat(a?"bg-blue-600":"dark"===s?"bg-gray-700":"bg-gray-200"),children:[(0,y.jsx)("div",{className:"flex-shrink-0 p-2 bg-white/20 rounded-lg",children:(0,y.jsx)(v,{fileName:t.fileName,className:"text-4xl"})}),(0,y.jsxs)("div",{className:"flex-grow overflow-hidden mr-2",children:[(0,y.jsx)("p",{className:"font-semibold truncate ".concat(a||"dark"===s?"text-white":"text-gray-800"),children:t.fileName}),(0,y.jsx)("p",{className:"text-sm ".concat(a?"text-blue-200":"dark"===s?"text-gray-400":"text-gray-600"),children:b(t.fileSize)})]}),(0,y.jsx)("div",{onClick:async e=>{e.preventDefault(),e.stopPropagation();try{const e=await fetch(r);if(!e.ok)throw new Error("Network response was not ok");const a=await e.blob(),s=window.URL.createObjectURL(a),n=document.createElement("a");n.href=s,n.setAttribute("download",t.fileName||"download"),document.body.appendChild(n),n.click(),n.remove(),window.URL.revokeObjectURL(s)}catch(a){console.error("Download failed:",a),window.open(r,"_blank")}},className:"flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center bg-black/20 hover:bg-black/30 text-white transition-colors cursor-pointer",children:(0,y.jsx)(x.WCW,{size:18})})]});return a?l:(0,y.jsx)("div",{onClick:()=>window.open(r,"_blank"),className:"cursor-pointer",children:l})},w=e=>{let{src:t,fileUrl:a,isSender:r,initialDuration:n=0,fileSize:l=0,theme:c}=e;const i=(0,s.useRef)(null),[o,d]=(0,s.useState)(!1),[u,g]=(0,s.useState)(0),[m,h]=(0,s.useState)(n),[p,f]=(0,s.useState)(t||null),[v,j]=(0,s.useState)(!1);(0,s.useEffect)(()=>{const e=i.current;if(!e)return;const t=()=>{e.duration!==1/0&&e.duration>0&&h(e.duration)},a=()=>g(e.currentTime),s=()=>d(!1);return e.addEventListener("loadedmetadata",t),e.addEventListener("timeupdate",a),e.addEventListener("ended",s),()=>{e.removeEventListener("loadedmetadata",t),e.removeEventListener("timeupdate",a),e.removeEventListener("ended",s)}},[p]);const w=async()=>{if(!v){j(!0);try{const e=await fetch(a),t=await e.blob(),s=URL.createObjectURL(t);f(s)}catch(e){console.error("Failed to download audio:",e)}finally{j(!1)}}},N=e=>{if(!e||e===1/0)return"0:00";const t=Math.floor(e/60),a=Math.floor(e%60);return"".concat(t,":").concat(a.toString().padStart(2,"0"))},k=m?u/m*100:0;return p?(0,y.jsxs)("div",{className:"flex items-center gap-3 p-2 w-64",children:[(0,y.jsx)("audio",{ref:i,src:p,preload:"metadata"}),(0,y.jsx)("button",{onClick:()=>{i.current&&(o?i.current.pause():i.current.play().catch(e=>console.error("Audio play failed:",e)),d(!o))},className:"flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center ".concat(r?"bg-white text-blue-600":"bg-gray-400 bg-opacity-30 text-white"),children:o?(0,y.jsx)(x.kwt,{size:16}):(0,y.jsx)(x.gSK,{size:16,className:"ml-1"})}),(0,y.jsxs)("div",{className:"flex-grow flex flex-col justify-center",children:[(0,y.jsx)("div",{className:"w-full h-1.5 bg-black/20 rounded-full cursor-pointer",onClick:e=>{if(!m)return;const t=e.currentTarget.getBoundingClientRect(),a=(e.clientX-t.left)/t.width*m;i.current&&(i.current.currentTime=a)},children:(0,y.jsx)("div",{style:{width:"".concat(k,"%")},className:"h-full rounded-full ".concat(r?"bg-white":"bg-gray-300")})}),(0,y.jsx)("span",{className:"text-xs self-end mt-1 ".concat(r?"text-blue-200":"dark"===c?"text-gray-400":"text-gray-500"),children:N(m)})]})]}):(0,y.jsxs)("div",{className:"flex items-center gap-3 p-2 w-64",children:[v?(0,y.jsx)("div",{className:"flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center bg-gray-400 bg-opacity-30",children:(0,y.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"})}):(0,y.jsx)("button",{onClick:w,className:"flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center bg-gray-400 bg-opacity-30 text-white hover:bg-opacity-40 transition-colors",children:(0,y.jsx)(x.WCW,{size:16})}),(0,y.jsxs)("div",{className:"flex-grow flex flex-col justify-center",children:[(0,y.jsx)("p",{className:"text-sm ".concat(r||"dark"===c?"text-white":"text-gray-700"),children:"Voice Message"}),(0,y.jsxs)("div",{className:"flex justify-between items-center mt-1",children:[(0,y.jsx)("span",{className:"text-xs ".concat(r?"text-blue-200":"dark"===c?"text-gray-400":"text-gray-500"),children:b(l)}),(0,y.jsx)("span",{className:"text-xs ".concat(r?"text-blue-200":"dark"===c?"text-gray-400":"text-gray-500"),children:N(m)})]})]})]})},N=e=>{let{theme:t}=e;return(0,y.jsxs)("div",{className:"space-y-4 p-4",children:[(0,y.jsxs)("div",{className:"flex items-end gap-2 justify-start",children:[(0,y.jsx)("div",{className:"w-8 h-8 rounded-full ".concat("dark"===t?"bg-gray-700":"bg-gray-200"," animate-pulse flex-shrink-0")}),(0,y.jsx)("div",{className:"h-10 rounded-lg ".concat("dark"===t?"bg-gray-700":"bg-gray-200"," animate-pulse w-48")})]}),(0,y.jsxs)("div",{className:"flex items-end gap-2 justify-end",children:[(0,y.jsx)("div",{className:"h-12 rounded-lg ".concat("dark"===t?"bg-blue-700":"bg-blue-200"," animate-pulse w-32")}),(0,y.jsx)("div",{className:"w-8 h-8 rounded-full ".concat("dark"===t?"bg-gray-700":"bg-gray-200"," animate-pulse flex-shrink-0")})]}),(0,y.jsxs)("div",{className:"flex items-end gap-2 justify-start",children:[(0,y.jsx)("div",{className:"w-8 h-8 rounded-full ".concat("dark"===t?"bg-gray-700":"bg-gray-200"," animate-pulse flex-shrink-0")}),(0,y.jsx)("div",{className:"h-16 rounded-lg ".concat("dark"===t?"bg-gray-700":"bg-gray-200"," animate-pulse w-64")})]}),(0,y.jsxs)("div",{className:"flex items-end gap-2 justify-end",children:[(0,y.jsx)("div",{className:"h-10 rounded-lg ".concat("dark"===t?"bg-blue-700":"bg-blue-200"," animate-pulse w-40")}),(0,y.jsx)("div",{className:"w-8 h-8 rounded-full ".concat("dark"===t?"bg-gray-700":"bg-gray-200"," animate-pulse flex-shrink-0")})]}),(0,y.jsxs)("div",{className:"flex items-end gap-2 justify-start",children:[(0,y.jsx)("div",{className:"w-8 h-8 rounded-full ".concat("dark"===t?"bg-gray-700":"bg-gray-200"," animate-pulse flex-shrink-0")}),(0,y.jsx)("div",{className:"h-10 rounded-lg ".concat("dark"===t?"bg-gray-700":"bg-gray-200"," animate-pulse w-32")})]}),(0,y.jsxs)("div",{className:"flex items-end gap-2 justify-start",children:[(0,y.jsx)("div",{className:"w-8 h-8 rounded-full ".concat("dark"===t?"bg-gray-700":"bg-gray-200"," animate-pulse flex-shrink-0")}),(0,y.jsx)("div",{className:"h-10 rounded-lg ".concat("dark"===t?"bg-gray-700":"bg-gray-200"," animate-pulse w-48")})]}),(0,y.jsxs)("div",{className:"flex items-end gap-2 justify-end",children:[(0,y.jsx)("div",{className:"h-12 rounded-lg ".concat("dark"===t?"bg-blue-700":"bg-blue-200"," animate-pulse w-32")}),(0,y.jsx)("div",{className:"w-8 h-8 rounded-full ".concat("dark"===t?"bg-gray-700":"bg-gray-200"," animate-pulse flex-shrink-0")})]}),(0,y.jsxs)("div",{className:"flex items-end gap-2 justify-start",children:[(0,y.jsx)("div",{className:"w-8 h-8 rounded-full ".concat("dark"===t?"bg-gray-700":"bg-gray-200"," animate-pulse flex-shrink-0")}),(0,y.jsx)("div",{className:"h-16 rounded-lg ".concat("dark"===t?"bg-gray-700":"bg-gray-200"," animate-pulse w-64")})]}),(0,y.jsxs)("div",{className:"flex items-end gap-2 justify-end",children:[(0,y.jsx)("div",{className:"h-10 rounded-lg ".concat("dark"===t?"bg-blue-700":"bg-blue-200"," animate-pulse w-40")}),(0,y.jsx)("div",{className:"w-8 h-8 rounded-full ".concat("dark"===t?"bg-gray-700":"bg-gray-200"," animate-pulse flex-shrink-0")})]}),(0,y.jsxs)("div",{className:"flex items-end gap-2 justify-start",children:[(0,y.jsx)("div",{className:"w-8 h-8 rounded-full ".concat("dark"===t?"bg-gray-700":"bg-gray-200"," animate-pulse flex-shrink-0")}),(0,y.jsx)("div",{className:"h-10 rounded-lg ".concat("dark"===t?"bg-gray-700":"bg-gray-200"," animate-pulse w-32")})]}),(0,y.jsxs)("div",{className:"flex items-end gap-2 justify-start",children:[(0,y.jsx)("div",{className:"w-8 h-8 rounded-full ".concat("dark"===t?"bg-gray-700":"bg-gray-200"," animate-pulse flex-shrink-0")}),(0,y.jsx)("div",{className:"h-10 rounded-lg ".concat("dark"===t?"bg-gray-700":"bg-gray-200"," animate-pulse w-48")})]}),(0,y.jsxs)("div",{className:"flex items-end gap-2 justify-end",children:[(0,y.jsx)("div",{className:"h-12 rounded-lg ".concat("dark"===t?"bg-blue-700":"bg-blue-200"," animate-pulse w-32")}),(0,y.jsx)("div",{className:"w-8 h-8 rounded-full ".concat("dark"===t?"bg-gray-700":"bg-gray-200"," animate-pulse flex-shrink-0")})]}),(0,y.jsxs)("div",{className:"flex items-end gap-2 justify-start",children:[(0,y.jsx)("div",{className:"w-8 h-8 rounded-full ".concat("dark"===t?"bg-gray-700":"bg-gray-200"," animate-pulse flex-shrink-0")}),(0,y.jsx)("div",{className:"h-16 rounded-lg ".concat("dark"===t?"bg-gray-700":"bg-gray-200"," animate-pulse w-64")})]})]})},k=e=>{let{chat:t,onClose:a,theme:r}=e;const[n,l]=(0,s.useState)(!1);return n&&"private"===t.type?(0,y.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex justify-center items-center z-[120]",onClick:()=>l(!1),children:(0,y.jsx)("img",{src:null===t||void 0===t?void 0:t.profile,alt:null===t||void 0===t?void 0:t.name,className:"max-w-[90vw] max-h-[90vh] object-contain"})}):(0,y.jsx)("div",{className:"fixed inset-0 bg-black/30 backdrop-blur-sm flex justify-center items-center z-[110] md:hidden",onClick:a,children:(0,y.jsxs)("div",{className:"relative w-11/12 max-w-xs cursor-pointer",onClick:e=>{e.stopPropagation(),"private"===t.type&&l(!0)},children:["group"===t.type?(0,y.jsx)("div",{className:"w-full aspect-square bg-gray-700 rounded-lg shadow-lg flex items-center justify-center",children:(0,y.jsx)(x.YXz,{className:"text-gray-400",size:120})}):(0,y.jsx)("img",{src:null===t||void 0===t?void 0:t.profile,alt:null===t||void 0===t?void 0:t.name,className:"w-full aspect-square object-cover rounded-lg shadow-lg"}),(0,y.jsx)("div",{className:"absolute bottom-0 left-0 right-0 p-3 bg-gradient-to-t from-black/80 to-transparent rounded-b-lg",children:(0,y.jsx)("h3",{className:"text-xl font-bold text-white text-center truncate",children:null===t||void 0===t?void 0:t.name})})]})})};const I=function(e){let{currentUser:t,chats:a,loadMoreChats:b,hasMore:I,isFetchingMore:C,theme:S}=e;const A=(0,r.zy)(),M=(0,r.Zp)(),[E,T]=(0,s.useState)({groups:[],privateChatsWith:[]}),[R,D]=(0,s.useState)(""),[L,z]=(0,s.useState)(null),[F,U]=(0,s.useState)(""),[W,P]=(0,s.useState)({}),[O,V]=(0,s.useState)(!1),[q,H]=(0,s.useState)(!1),[Y,B]=(0,s.useState)(!1),[Z,$]=(0,s.useState)(!1),[_,J]=(0,s.useState)(!1),[X,Q]=(0,s.useState)({}),[G,K]=(0,s.useState)({visible:!1,x:0,y:0,message:null,index:null}),[ee,te]=(0,s.useState)({index:null,originalContent:""}),[ae,se]=(0,s.useState)(null),[re,ne]=(0,s.useState)(null),[le,ce]=(0,s.useState)(null),[ie,oe]=(0,s.useState)({visible:!1,message:null}),[de,ue]=(0,s.useState)([]),[ge,me]=(0,s.useState)(""),[he,xe]=(0,s.useState)(!1),[pe,fe]=(0,s.useState)(!1),[ye,be]=(0,s.useState)(!1),[ve,je]=(0,s.useState)("Overview"),[we,Ne]=(0,s.useState)([]),[ke,Ie]=(0,s.useState)(!1),[Ce,Se]=(0,s.useState)({}),[Ae,Me]=(0,s.useState)(null),[Ee,Te]=(0,s.useState)(!1),[Re,De]=(0,s.useState)(!1),[Le,ze]=(0,s.useState)(!1),[Fe,Ue]=(0,s.useState)({}),[We,Pe]=(0,s.useState)({}),[Oe,Ve]=(0,s.useState)({}),[qe,He]=(0,s.useState)(!1),[Ye,Be]=(0,s.useState)(!1),[Ze,$e]=(0,s.useState)(0),[_e,Je]=(0,s.useState)(null),[Xe,Qe]=(0,s.useState)(null),[Ge,Ke]=(0,s.useState)(!1),[et,tt]=(0,s.useState)([]),[at,st]=(0,s.useState)([]),[rt,nt]=(0,s.useState)([]),[lt,ct]=(0,s.useState)(!1),[it,ot]=(0,s.useState)(!1),[dt,ut]=(0,s.useState)(""),[gt,mt]=(0,s.useState)([]),[ht,xt]=(0,s.useState)(-1),{setIsChatWindowVisible:pt,setChatUnreadCount:ft}=(0,s.useContext)(m.ob);(0,s.useEffect)(()=>{pt&&pt(q)},[q,pt]);const yt=(0,s.useRef)(null),bt=(0,s.useRef)(null),vt=(0,s.useRef)(null),jt=(0,s.useRef)({}),wt=(0,s.useRef)(null),Nt=(0,s.useRef)(null),kt=(0,s.useRef)([]),It=(0,s.useRef)(null),Ct=(0,s.useRef)(null),St=(0,s.useRef)(null),At=(0,s.useRef)(null),Mt=(0,s.useRef)(null),Et=(0,s.useRef)(null),Tt=(0,s.useRef)(null),Rt=(0,s.useRef)(!1),Dt=(0,s.useRef)(null),Lt=(0,s.useRef)(null),zt=(0,s.useRef)(null),Ft=(0,s.useRef)(!1),Ut=(0,s.useRef)({}),Wt=(0,s.useMemo)(()=>{if(A.pathname.includes("/with")){return new URLSearchParams(A.search).get("id")}return null},[A.pathname,A.search]);(0,s.useEffect)(()=>{if(""===dt.trim())return mt([]),void xt(-1);const e=setTimeout(()=>{L&&(async(e,t,a)=>{try{return(await n.Pt.get("/chat/search",{params:{userId:e,chatId:t,query:a}})).data}catch(s){return console.error("Failed to search messages in chat ".concat(t,":"),s),[]}})(t.id,L.chatId,dt).then(e=>{mt(e),xt(e.length>0?0:-1)})},500);return()=>clearTimeout(e)},[dt,L,t.id]),(0,s.useEffect)(()=>{if(-1!==ht&&gt[ht]){const e=gt[ht].messageId,t=document.getElementById("msg-".concat(e));t&&t.scrollIntoView({behavior:"smooth",block:"center"})}},[ht,gt]);const Pt=async e=>{ot(!1),ut(""),mt([]);const a=await(async(e,t,a)=>{try{return(await n.Pt.get("/chat/context",{params:{messageId:e,userId:t,chatId:a}})).data}catch(s){return console.error("Failed to fetch message context for message ".concat(e,":"),s),[]}})(e.messageId,t.id,L.chatId);if(a&&a.length>0){const t=a.map(u);P(e=>(0,g.A)((0,g.A)({},e),{},{[L.chatId]:t})),setTimeout(()=>{const t=document.getElementById("msg-".concat(e.messageId));t&&(t.scrollIntoView({behavior:"smooth",block:"center"}),t.classList.add("bg-blue-200","transition-all","duration-1000"),setTimeout(()=>{t.classList.remove("bg-blue-200")},2e3))},100)}},Ot=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"smooth";bt.current&&bt.current.scrollTo({top:bt.current.scrollHeight,behavior:e}),$e(0)};(0,s.useEffect)(()=>{if(""===R.trim())return Qe(null),void Ke(!1);Ke(!0);const e=setTimeout(()=>{(async(e,t)=>{try{return(await n.Pt.get("/chat/overview/search",{params:{employeeId:e,query:t}})).data}catch(a){return console.error("Failed to search chat overview:",a),[]}})(t.id,R).then(e=>{const a=d(e,t.id),s=[...a.privateChatsWith,...a.groups].sort((e,t)=>new Date(t.lastMessageTimestamp)-new Date(e.lastMessageTimestamp));Qe(s)}).finally(()=>Ke(!1))},300);return()=>clearTimeout(e)},[R,t.id]),(0,s.useEffect)(()=>{if(a){const e={groups:a.groups.map(e=>e.chatId.toString()===Wt?(0,g.A)((0,g.A)({},e),{},{unreadMessageCount:0}):e),privateChatsWith:a.privateChatsWith.map(e=>e.chatId.toString()===Wt?(0,g.A)((0,g.A)({},e),{},{unreadMessageCount:0}):e)};T(e),Te(!0)}},[a,Wt]);const Vt=(0,s.useCallback)(async(e,a)=>{if(!(a>0&&qe||0===a&&O)){a>0?(He(!0),Ft.current=!0):V(!0);try{const s=await l(t.id,e,a,15);if(console.log("%c REFRESH (API) RAW DATA:","color: red; font-weight: bold;",s),0===s.length)return void Ve(t=>(0,g.A)((0,g.A)({},t),{},{[e]:!1}));const r=s.map(u),n=bt.current,c=n?n.scrollHeight:0,i=n?n.scrollTop:0;P(t=>(0,g.A)((0,g.A)({},t),{},{[e]:0===a?r:[...r,...t[e]||[]]})),a>0&&requestAnimationFrame(()=>{n&&(n.scrollTop=n.scrollHeight-c+i)}),0===s.length&&Ve(t=>(0,g.A)((0,g.A)({},t),{},{[e]:!1}))}catch(s){console.error("Failed to load messages for chat ".concat(e,":"),s)}finally{a>0?(He(!1),setTimeout(()=>{Ft.current=!1},100)):V(!1)}}},[t.id,qe,O,l]);(0,s.useEffect)(()=>{if(!L)return;const e=L.chatId;Pe(t=>(0,g.A)((0,g.A)({},t),{},{[e]:0})),Ve(t=>(0,g.A)((0,g.A)({},t),{},{[e]:!0})),P(t=>(0,g.A)((0,g.A)({},t),{},{[e]:[]})),Vt(e,0);(async()=>{try{const a=await(async(e,t,a)=>{try{const s=await n.Pt.get("/chat/".concat(e,"/pinned?chatType=").concat(t,"&userId=").concat(a));return console.log("Response:",s),s.data}catch(s){return console.error("Failed to fetch pinned message for chat ".concat(e,":"),s),null}})(e,L.type,t.id);ce(a)}catch(a){console.error("Failed to fetch pinned message:",a),ce(null)}})()},[L,t.id]);const qt=(0,s.useCallback)((e,a)=>{T(s=>{const r=s=>{if(s.chatId===e){const r=a&&"deleted"!==a.type&&!a.isDeleted&&a.sender!==t.id&&(null===L||void 0===L?void 0:L.chatId)!==e,n={lastMessage:a?a.fileName||a.content:"",lastMessageType:a?a.type.toUpperCase():null,lastMessageSenderId:a?a.sender:null};return(0,g.A)((0,g.A)({},s),{},{lastMessage:a?o(n,t.id):"Chat cleared",lastMessageTimestamp:(null===a||void 0===a?void 0:a.timestamp)||new Date(0).toISOString(),unreadMessageCount:(s.unreadMessageCount||0)+(r?1:0)})}return s};return{groups:s.groups.map(r),privateChatsWith:s.privateChatsWith.map(r)}})},[t.id,L]),Ht=(0,s.useCallback)(e=>{const a=bt.current,s=!a||a.scrollHeight-a.scrollTop-a.clientHeight<300,r=JSON.parse(e.body);if(console.log("%c LIVE MSG (WebSocket) RAW DATA:","color: green; font-weight: bold;",r),console.log("Received WebSocket Message:",r),"STATUS_UPDATE"===r.type){const{status:e,chatId:t,messageIds:a}=r;return void P(s=>{const n="group"===(null===L||void 0===L?void 0:L.type)?r.groupId:t,l=s[n]||[],c=e.toLowerCase(),i=l.map(e=>{if(a.includes(e.messageId)){if("seen"===c)return(0,g.A)((0,g.A)({},e),{},{status:"seen"});if("delivered"===c&&"sent"===e.status)return(0,g.A)((0,g.A)({},e),{},{status:"delivered"})}return e});return(0,g.A)((0,g.A)({},s),{},{[n]:i})})}if("PIN_UPDATE"===r.type){const e=r.payload,a=e.groupId||(e.sender===t.id?e.receiver:e.sender);return void((null===L||void 0===L?void 0:L.chatId)===a&&ce(e))}if("UNPIN_UPDATE"===r.type){const e=r.payload;let a;return a="group"===L.type?e.groupId:e.senderId===t.id?e.receiverId:e.senderId,void((null===L||void 0===L?void 0:L.chatId)===a&&ce(null))}const n=r,l=n.groupId||(n.sender===t.id?n.receiver:n.sender);if(!l)return void console.warn("Received message without a clear chat ID",n);if(n.isDeleted||"deleted"===n.type)return void P(e=>{const t=e[l]||[];let a=!1;if(t.length>0){const e=t[t.length-1];a=e.messageId===n.messageId||e.id===n.messageId}const s=t.map(e=>e.messageId===n.messageId||e.id===n.messageId?(0,g.A)((0,g.A)({},e),{},{type:"deleted",content:"This message was deleted",fileName:null,fileSize:null,isDeleted:!0}):e);if(a){const e=s.length>0?s[s.length-1]:null;qt(l,e)}return(0,g.A)((0,g.A)({},e),{},{[l]:s})});if(n.isEdited)return void P(e=>{const t=e[l]||[],a=t.map(e=>{if(e.messageId===n.id||e.messageId===n.messageId){const a=(0,g.A)((0,g.A)({},e),{},{content:n.content,isEdited:!0});return t.length>0&&t[t.length-1].messageId===e.messageId&&qt(l,a),a}return e});return(0,g.A)((0,g.A)({},e),{},{[l]:a})});u(n);P(e=>{const a=e[l]||[],s=n.messageId||n.id;if(a.some(e=>e.messageId===s&&"sent"===e.status))return e;let r=[...a],c=!1,i=null;const o=n.sender===t.id&&n.client_id,d=n.sender===t.id&&!n.client_id,m=n.sender!==t.id;if(o){const e=r.findIndex(e=>e.id===n.client_id);if(e>-1){const t=u(n);r[e]=(0,g.A)((0,g.A)((0,g.A)({},r[e]),t),{},{status:"sent"}),i=r[e],c=!0}}else if(d){const e=r.findLastIndex(e=>"sending"===e.status&&e.sender===t.id);if(e>-1){const t=u(n);r[e]=(0,g.A)((0,g.A)((0,g.A)({},r[e]),t),{},{status:"sent"}),i=r[e],c=!0}else if(!a.some(e=>e.messageId===s)){const e=u(n);r.push(e),i=e,c=!0}}else if(m&&!a.some(e=>e.messageId===s)){const e=u(n);r.push(e),i=e,c=!0,Ye&&$e(e=>e+1)}return c?(qt(l,i),(0,g.A)((0,g.A)({},e),{},{[l]:r})):e});r.sender!==t.id&&!r.isEdited&&!r.isDeleted&&"deleted"!==r.type&&s&&setTimeout(()=>Ot("smooth"),100)},[t.id,qt,L,Ye]),Yt=(0,s.useMemo)(()=>[...E.privateChatsWith.filter(e=>e.chatId!==(null===t||void 0===t?void 0:t.id)),...E.groups].sort((e,t)=>new Date(t.lastMessageTimestamp)-new Date(e.lastMessageTimestamp)),[E,t.id]);(0,s.useEffect)(()=>{const e=Yt.reduce((e,t)=>e+(t.unreadMessageCount||0),0);ft(e)},[Yt,ft]);const Bt=(0,s.useCallback)(e=>{const a=JSON.parse(e.body);if(a.senderId===t.id)return;const s="TEAM"===a.type?a.groupId:a.senderId;if(!s)return;const r=Yt.find(e=>e.chatId===a.senderId),n=(null===r||void 0===r?void 0:r.name)||"Someone";Ue(e=>{const t=(0,g.A)({},e);return jt.current[s]&&clearTimeout(jt.current[s]),a.typing?(t[s]="".concat(n," is typing..."),jt.current[s]=setTimeout(()=>{Ue(e=>{const t=(0,g.A)({},e);return delete t[s],t})},3e3)):delete t[s],t})},[t.id,Yt]),Zt=(0,s.useCallback)(e=>{const a=JSON.parse(e.body),{privateChatsWith:s,groups:r}=d(a,t.id);T(e=>(0,g.A)((0,g.A)({},e),{},{privateChatsWith:e.privateChatsWith.map(e=>{const t=s.find(t=>t.chatId===e.chatId);return t?(0,g.A)((0,g.A)({},e),t):e}),groups:e.groups.map(e=>{const t=r.find(t=>t.chatId===e.chatId);return t?(0,g.A)((0,g.A)({},e),t):e})}))},[t.id]);(0,s.useEffect)(()=>{zt.current=Ht}),(0,s.useEffect)(()=>{!O&&bt.current&&Ot("auto")},[O,L]),(0,s.useEffect)(()=>{if(null===t||void 0===t||!t.id||!Ee)return;if(vt.current)return;const e=localStorage.getItem("accessToken"),a="wss://hrms.anasolconsultancyservices.com/api/chat?employeeId=".concat(t.id,"&token=").concat(e),s=new h.K({brokerURL:a,reconnectDelay:5e3,onConnect:()=>{De(!0);const e=e=>{zt.current&&zt.current(e)};Ut.current.sidebar=s.subscribe("/user/queue/sidebar",Zt),Ut.current.private=s.subscribe("/user/queue/private",e),Ut.current["private-ack"]=s.subscribe("/user/queue/private-ack",e),Ut.current["group-ack"]=s.subscribe("user/queue/group-ack",e),Ut.current.presence=s.subscribe("/topic/presence",e=>{const a=JSON.parse(e.body);a.userId!==t.id&&T(e=>{const t=e.privateChatsWith.map(e=>e.chatId===a.userId?(0,g.A)((0,g.A)({},e),{},{isOnline:a.isOnline}):e);return(0,g.A)((0,g.A)({},e),{},{privateChatsWith:t})})}),Ut.current.typing=s.subscribe("/user/queue/typing-status",Bt)},onWebSocketError:e=>console.error("WebSocket Error:",e),onStompError:e=>console.error("STOMP Error:",e.headers.message,e.body),onWebSocketClose:()=>{De(!1)}});return s.activate(),vt.current=s,()=>{var e,t;if(L&&null!==(e=vt.current)&&void 0!==e&&e.active){const e="/app/presence/close/".concat(L.chatId);vt.current.publish({destination:e,body:"{}"}),console.log("Sent CLOSE presence for ".concat(L.chatId," on component unmount."))}null!==(t=vt.current)&&void 0!==t&&t.active&&(vt.current.deactivate(),vt.current=null,console.log("STOMP client deactivated on component unmount."))}},[null===t||void 0===t?void 0:t.id,Ee,L]);const $t=(0,s.useMemo)(()=>(E.groups||[]).map(e=>e.chatId).sort().join(","),[E.groups]);(0,s.useEffect)(()=>{var e;if(!Re||null===(e=vt.current)||void 0===e||!e.active)return;const t=e=>{zt.current&&zt.current(e)},a=new Set((E.groups||[]).map(e=>e.chatId.toString())),s=Object.keys(Ut.current),r=new Set(s.filter(e=>e.startsWith("group-")).map(e=>e.replace("group-","")));r.forEach(e=>{if(!a.has(e)){const t="group-".concat(e);Ut.current[t]&&(Ut.current[t].unsubscribe(),delete Ut.current[t])}}),a.forEach(e=>{if(!r.has(e)){const a="group-".concat(e);Ut.current[a]=vt.current.subscribe("/topic/team-".concat(e),t);const s="group-typing-".concat(e);Ut.current[s]=vt.current.subscribe("/topic/typing-status/".concat(e),Bt)}})},[Re,$t,E.groups,we,t.id]);const _t=(0,s.useCallback)(async e=>{var a;if(null===t||void 0===t||!t.id||null===(a=vt.current)||void 0===a||!a.active)return;const s="/app/presence/open/".concat(e.chatId),r={userId:t.id,type:"group"===e.type?"TEAM":"PRIVATE"};if(vt.current.publish({destination:s,body:JSON.stringify(r)}),"group"===e.type&&!Ce[e.chatId])try{var n;const t=await c(e.chatId),a=(null===t||void 0===t||null===(n=t[0])||void 0===n?void 0:n.employees)||[];a.length>0&&Se(t=>(0,g.A)((0,g.A)({},t),{},{[e.chatId]:a}))}catch(i){console.error("Failed to fetch group members:",i)}z(e),H(!0);const l="/chat/".concat(t.id,"/with?id=").concat(e.chatId);window.history.pushState({path:l},"",l)},[t.id,Ce]),Jt=(0,s.useCallback)(()=>{var e;if(Rt.current=!0,!L||null===t||void 0===t||!t.id)return void(Rt.current=!1);if(null!==(e=vt.current)&&void 0!==e&&e.active){const e="/app/presence/close/".concat(L.chatId);vt.current.publish({destination:e,body:"{}"})}z(null),H(!1),Be(!1),$e(0);const a="/chat/".concat(t.id);M(a)},[L,t.id,M]),Xt=(0,s.useCallback)(e=>{var t;if(L&&L.chatId!==e.chatId&&null!==(t=vt.current)&&void 0!==t&&t.active){const e="/app/presence/close/".concat(L.chatId);vt.current.publish({destination:e,body:"{}"}),console.log("Sent CLOSE presence for previous chat: ".concat(L.chatId))}e.unreadMessageCount>0&&T(t=>{const a="group"===e.type,s=(a?t.groups:t.privateChatsWith).map(t=>t.chatId===e.chatId?(0,g.A)((0,g.A)({},t),{},{unreadMessageCount:0}):t);return a?(0,g.A)((0,g.A)({},t),{},{groups:s}):(0,g.A)((0,g.A)({},t),{},{privateChatsWith:s})}),_t(e),D("")},[_t,L]);(0,s.useEffect)(()=>{const e=()=>{if(L&&vt.current&&vt.current.active){const e="/app/presence/close/".concat(L.chatId);vt.current.publish({destination:e,body:"{}"})}};return window.addEventListener("beforeunload",e),()=>window.removeEventListener("beforeunload",e)},[L]),(0,s.useEffect)(()=>{(async()=>{if(ye&&L&&"group"===L.type){Ie(!0),ct(!0);try{if("Members"===ve&&0===we.length){const e=await c(L.chatId),t=Array.isArray(e)&&e.length>0?e[0]:null;Ne((null===t||void 0===t?void 0:t.employees)||[])}else if("Media"===ve&&0===et.length){const e=await i(L.chatId,"media");tt(e.map(u))}else if("Files"===ve&&0===at.length){const e=await i(L.chatId,"files");st(e.map(u))}else if("Links"===ve&&0===rt.length){const e=await i(L.chatId,"links");nt(e)}}catch(e){console.error("Failed to fetch group data for tab:",ve,e)}finally{Ie(!1),ct(!1)}}})()},[ye,ve,L]),(0,s.useEffect)(()=>{const e=e=>{var t,a,s;!Y||!Ct.current||Ct.current.contains(e.target)||null!==(t=St.current)&&void 0!==t&&t.contains(e.target)||B(!1),!_||!At.current||At.current.contains(e.target)||null!==(a=Mt.current)&&void 0!==a&&a.contains(e.target)||J(!1),G.visible&&Et.current&&!Et.current.contains(e.target)&&K({visible:!1,x:0,y:0,message:null,index:null}),!he||!Dt.current||Dt.current.contains(e.target)||null!==(s=Lt.current)&&void 0!==s&&s.contains(e.target)||xe(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[Y,_,G.visible,he]);const Qt=e=>{var a;if(null===(a=vt.current)||void 0===a||!a.active||!L)return;const s={senderId:t.id,typing:e,type:"group"===L.type?"TEAM":"PRIVATE",receiverId:"private"===L.type?L.chatId:null,groupId:"group"===L.type?L.chatId:null};vt.current.publish({destination:"/app/typing",body:JSON.stringify(s)})},Gt=()=>{if(!F.trim()||!L)return;Qt(!1);const e=Date.now().toString()+Math.random().toString(36).substring(2,9),a=null!==ae,s={id:e,messageId:e,sender:t.id,content:F,timestamp:(new Date).toISOString(),status:"sending",type:"text",fileName:null,fileSize:null,isEdited:!1,replyTo:ae,isForwarded:!1};let r,n;qt(L.chatId,s),P(e=>(0,g.A)((0,g.A)({},e),{},{[L.chatId]:[...e[L.chatId]||[],s]})),a?(r="/app/reply",n={replyToMessageId:ae.messageId,sender:t.id,content:F,clientId:e,receiver:"private"===L.type?L.chatId:null,groupId:"group"===L.type?L.chatId:null,type:"group"===L.type?"TEAM":"PRIVATE"}):(r="/app/send",n={sender:t.id,content:F,type:"group"===L.type?"TEAM":"PRIVATE",receiver:"private"===L.type?L.chatId:null,groupId:"group"===L.type?L.chatId:null,clientId:e}),vt.current.publish({destination:r,body:JSON.stringify(n)}),U(""),B(!1),se(null),setTimeout(()=>Ot("smooth"),100)},Kt=()=>{navigator.mediaDevices.getUserMedia({audio:!0}).then(e=>{console.log("Permission granted, starting MediaRecorder..."),$(!0),It.current=e,kt.current=[];const a=new MediaRecorder(e);Nt.current=a,a.ondataavailable=e=>{kt.current.push(e.data)},a.onstop=async()=>{console.log("Recording stopped, creating blob from chunks...");const e=new Blob(kt.current,{type:"audio/webm"});if(!L)return;const a=new File([e],"voice-message-".concat(Date.now(),".webm"),{type:"audio/webm",lastModified:Date.now()}),s=new FileReader;s.readAsDataURL(a),s.onloadend=async()=>{const e=s.result.split(",")[1],r=Date.now().toString()+Math.random().toString(36).substring(2,9),l=URL.createObjectURL(a),c={id:r,messageId:r,sender:t.id,content:l,timestamp:(new Date).toISOString(),status:"sending",type:"audio",fileName:a.name,fileSize:a.size,fileUrl:l,isEdited:!1,duration:0};qt(L.chatId,c),P(e=>(0,g.A)((0,g.A)({},e),{},{[L.chatId]:[...e[L.chatId]||[],c]}));const i={sender:t.id,clientId:r,fileType:a.type,fileName:a.name,fileData:e,type:"group"===L.type?"TEAM":"PRIVATE",groupId:"group"===L.type?L.chatId:null,receiver:"private"===L.type?L.chatId:null,duration:0};try{await(async e=>{try{const t=await n.Pt.post("/chat/voice/upload",e);return console.log("Response:",t),t.data}catch(t){throw console.error("Voice message upload failed:",t),t}})(i)}catch(o){console.error("Voice message upload failed:",o),P(e=>{const t=(e[L.chatId]||[]).map(e=>e.id===r?(0,g.A)((0,g.A)({},e),{},{status:"failed"}):e);return(0,g.A)((0,g.A)({},e),{},{[L.chatId]:t})})}}},a.start()}).catch(e=>{console.error("Microphone permission denied:",e),$(!1),alert("Microphone permission is required for voice messages.")})},ea=()=>{console.log("Stopping MediaRecorder..."),Nt.current&&"recording"===Nt.current.state&&Nt.current.stop(),It.current&&It.current.getTracks().forEach(e=>e.stop()),$(!1)},ta=(0,s.useCallback)(async(e,t,a)=>{a&&(a.stopPropagation(),a.preventDefault());try{const a=await fetch(e);if(!a.ok)throw new Error("Network response was not ok");const s=await a.blob(),r=window.URL.createObjectURL(s),n=document.createElement("a");n.href=r,n.setAttribute("download",t||"download"),document.body.appendChild(n),n.click(),n.remove(),window.URL.revokeObjectURL(r)}catch(s){console.error("Download failed:",s),window.open(e,"_blank")}},[]),aa=()=>{var e;const a=F.trim();if(""===a||null===ee.index||null===(e=vt.current)||void 0===e||!e.active)return void sa();const s=L.chatId,r=W[s],n=r[ee.index],l=n.messageId;if(a===ee.originalContent||"number"!==typeof l)return void sa();const c=(0,g.A)((0,g.A)({},n),{},{content:a,isEdited:!0}),i=r.map((e,t)=>t===ee.index?c:e);P(e=>(0,g.A)((0,g.A)({},e),{},{[s]:i})),ee.index===r.length-1&&qt(s,c);const o={messageId:l,content:a,sender:t.id};vt.current.publish({destination:"/app/edit",body:JSON.stringify(o)}),sa()},sa=()=>{te({index:null,originalContent:""}),U("")},ra=async e=>{const a=L.chatId,s=[...W[a]||[]],r=s[G.index],l=null===r||void 0===r?void 0:r.messageId;if(!l||"number"!==typeof l||"sending"===r.status||"failed"===r.status)return console.error("Invalid messageId or message status for deletion:",l,r.status),void K({visible:!1,x:0,y:0,message:null,index:null});try{if(e)await(async(e,t)=>{try{const a=await n.Pt.post("/chat/delete/".concat(e,"/everyone?userId=").concat(t));return console.log("Response:",a),a.data}catch(a){throw console.error("Failed to delete message ".concat(e," for everyone:"),a),a}})(l,t.id);else{await(async(e,t)=>{try{const a=await n.Pt.post("/chat/delete/".concat(e,"/me?userId=").concat(t));return console.log("Response:",a),a.data}catch(a){throw console.error("Failed to delete message ".concat(e," for me:"),a),a}})(l,t.id);const e=s.filter((e,t)=>t!==G.index);P(t=>(0,g.A)((0,g.A)({},t),{},{[a]:e}));const r=e.length>0?e[e.length-1]:null;qt(a,r)}}catch(c){console.error("Failed to delete message ".concat(l," in component:"),c)}finally{K({visible:!1,x:0,y:0,message:null,index:null})}},na=()=>{if(!re)return;const e=[...W[L.chatId]];e[re.index]=re.message,P(t=>(0,g.A)((0,g.A)({},t),{},{[L.chatId]:e})),ne(null)},la=()=>{if(xe(!1),le){const e=ga.findIndex(e=>e.messageId===le.messageId);if(-1!==e){const t=document.querySelector("[data-message-index='".concat(e,"']"));t&&(t.scrollIntoView({behavior:"smooth",block:"center"}),t.classList.add("animate-pulse","bg-blue-200"),setTimeout(()=>t.classList.remove("animate-pulse","bg-blue-200"),2500))}}},ca=null!==Xe?Xe:Yt;(0,s.useEffect)(()=>{if(Wt&&Yt.length>0&&Re&&!L){if(Rt.current)return;const e=Yt.find(e=>e.chatId.toString()===Wt);e&&Xt(e)}else Wt||(Rt.current=!1)},[Yt,Wt,L,Xt,Re]),(0,s.useEffect)(()=>{var e;const t=null===(e=A.state)||void 0===e?void 0:e.newChatTarget;if(t&&Ee){Yt.some(e=>e.chatId===t.chatId)||(console.log("New chat detected. Adding to chat list:",t),T(e=>{const a=[t,...e.privateChatsWith];return(0,g.A)((0,g.A)({},e),{},{privateChatsWith:a})}))}},[Ee,Yt,A.state]);const ia=e=>{if(!e)return"";const t=new Date(e.endsWith("Z")?e:e+"Z");return isNaN(t)?"":t.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})},oa=e=>{if(!e)return"";const t=new Date(String(e).endsWith("Z")?e:e+"Z");if(isNaN(t))return"Invalid Date";const a=new Date,s=new Date(a);return s.setDate(s.getDate()-1),t.toDateString()===a.toDateString()?"Today":t.toDateString()===s.toDateString()?"Yesterday":t.toLocaleDateString([],{year:"numeric",month:"long",day:"numeric"})};let da=null;const ua=L?Yt.find(e=>e.chatId===L.chatId):null,ga=ua&&W[ua.chatId]||[],ma=e=>{if(!t)return{name:"Unknown User",profile:null};if(e===t.id)return{name:"You",profile:t.profile};let a=E.privateChatsWith.find(t=>t.chatId===e||t.employeeId===e);return a?{name:a.name||a.displayName,profile:a.profile||a.employeeImage||null}:("group"===(null===L||void 0===L?void 0:L.type)&&Ce[L.chatId]&&(a=Ce[L.chatId].find(t=>t.employeeId===e)),a?{name:a.name||a.displayName,profile:a.profile||a.employeeImage||null}:{name:"Unknown User",profile:null})},ha=e=>{const t=n.Pt.defaults.baseURL;if(e.fileUrl&&e.fileUrl.startsWith("blob:"))return e.fileUrl;if(e.fileUrl&&e.fileUrl.startsWith("/api")){const a=new URL(t).origin;return"".concat(a).concat(e.fileUrl)}if(e.fileUrl)return e.fileUrl;const a=e.id||e.messageId;return a?"".concat(t,"/chat/file/").concat(a):e.content};return(0,y.jsxs)("div",{className:"w-full h-full ".concat("dark"===S?"bg-gray-900":"bg-gray-100"," font-sans"),children:[(0,y.jsxs)("div",{className:"flex w-full h-full p-0 md:p-4 md:gap-4",children:[(0,y.jsxs)("div",{className:"relative w-full md:w-[30%] h-full p-4 flex flex-col shadow-xl md:rounded-lg ".concat(q?"hidden md:flex":"flex"," ").concat("dark"===S?"bg-gray-800":"bg-white"),children:[(0,y.jsx)("div",{className:"mb-4 flex-shrink-0",children:(0,y.jsx)("input",{type:"text",placeholder:"Search chats users...",className:"w-full p-3 rounded-lg border bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat("dark"===S?"bg-gray-700 text-white border-gray-600":"bg-gray-50 border-gray-300"),value:R,onChange:e=>D(e.target.value)})}),(0,y.jsxs)("div",{ref:yt,onScroll:()=>{const e=yt.current;if(e){const{scrollTop:t,scrollHeight:a,clientHeight:s}=e;a-t-s<100&&(console.log("Scroll condition met. isFetchingMore: ".concat(C,", hasMore: ").concat(I)),I&&!C&&b())}},className:"flex-grow space-y-2 pr-2 overflow-y-auto custom-scrollbar",children:[Ge?(0,y.jsx)("div",{className:"text-center p-4 text-gray-500",children:"Searching..."}):ca.map(e=>(0,y.jsxs)("div",{onClick:()=>Xt(e),className:"p-3 flex items-center rounded-lg cursor-pointer group ".concat((null===L||void 0===L?void 0:L.chatId)===e.chatId?"bg-blue-100 dark:bg-blue-900/30":"dark"===S?"hover:bg-gray-700":"hover:bg-blue-50"),children:[(0,y.jsxs)("div",{className:"relative flex-shrink-0",children:["group"===e.type?(0,y.jsx)("div",{onClick:t=>{t.stopPropagation(),Je(e)},className:"w-11 h-11 rounded-full flex items-center justify-center cursor-pointer md:cursor-default ".concat("dark"===S?"bg-gray-700":"bg-gray-200"),children:(0,y.jsx)(x.YXz,{className:"text-gray-500",size:24})}):e.profile?(0,y.jsx)("div",{onClick:t=>{t.stopPropagation(),Je(e)},className:"w-11 h-11 rounded-full cursor-pointer md:cursor-default",children:(0,y.jsx)("img",{src:e.profile,alt:e.name,className:"w-full h-full rounded-full object-cover"})}):(0,y.jsx)("div",{className:"w-11 h-11 rounded-full flex items-center justify-center ".concat("dark"===S?"bg-gray-700":"bg-gray-200"),children:(0,y.jsx)(x.x$1,{className:"text-gray-500",size:24})}),e.isOnline&&(0,y.jsx)("span",{className:"absolute bottom-0 right-0 block h-3 w-3 rounded-full ring-2 ring-white bg-green-500"})]}),(0,y.jsxs)("div",{className:"flex-1 min-w-0 mx-3",children:[(0,y.jsx)("p",{className:"font-semibold truncate ".concat("dark"===S?"text-white":"text-gray-800"),children:e.name}),(0,y.jsx)("p",{className:"text-sm truncate ".concat("dark"===S?"text-gray-400":"text-gray-500"),children:e.lastMessage||"No messages yet"})]}),(e.unreadMessageCount||0)>0&&(0,y.jsx)("div",{className:"flex-shrink-0",children:(0,y.jsx)("span",{className:"bg-blue-600 text-white text-xs font-bold px-2 py-1 rounded-full",children:e.unreadMessageCount})})]},e.chatId)),""===R&&C&&(0,y.jsx)("div",{className:"flex justify-center items-center p-4",children:(0,y.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"})})]})]}),(0,y.jsx)("div",{className:"flex-col shadow-xl fixed inset-0 z-[100] overflow-hidden md:relative md:inset-auto md:z-auto md:w-[70%] md:h-full md:rounded-lg ".concat(q?"flex":"hidden md:flex"," ").concat("dark"===S?"bg-gray-800":"bg-white"," "),children:ua?(0,y.jsxs)(y.Fragment,{children:[(0,y.jsxs)("div",{className:"flex-shrink-0 flex items-center justify-between p-4 border-b z-10 ".concat("dark"===S?"border-gray-700 bg-gray-800":"border-gray-200 bg-white"),children:[(0,y.jsxs)("div",{className:"flex items-center space-x-3 flex-grow min-w-0",children:[(0,y.jsx)("button",{onClick:Jt,className:"md:hidden p-2 rounded-full ".concat("dark"===S?"hover:bg-gray-700 text-white":"hover:bg-gray-100"),children:(0,y.jsx)(x.QVr,{})}),(0,y.jsx)("button",{onClick:()=>"group"!==ua.type&&ua.profile&&fe(!0),className:"flex-shrink-0",children:"group"===ua.type?(0,y.jsx)("div",{className:"w-12 h-12 rounded-full flex items-center justify-center ".concat("dark"===S?"bg-gray-700":"bg-gray-200"),children:(0,y.jsx)(x.YXz,{className:"text-gray-500",size:28})}):ua.profile?(0,y.jsx)("img",{src:ua.profile,alt:ua.name,className:"w-12 h-12 rounded-full object-cover"}):(0,y.jsx)("div",{className:"w-12 h-12 rounded-full flex items-center justify-center ".concat("dark"===S?"bg-gray-700":"bg-gray-200"),children:(0,y.jsx)(x.x$1,{className:"text-gray-500",size:28})})}),(0,y.jsxs)("div",{className:"truncate",children:[(0,y.jsx)("button",{onClick:()=>{"private"===ua.type?M("/employees/".concat(t.id,"/public/").concat(ua.chatId)):"group"===(null===L||void 0===L?void 0:L.type)&&(je("Overview"),Ne([]),be(!0))},disabled:!ua,className:"text-left",children:(0,y.jsx)("p",{className:"font-bold text-lg truncate ".concat("dark"===S?"text-white":"text-gray-800"),children:ua.name})}),"private"===ua.type?(0,y.jsx)("p",{className:"text-sm ".concat("dark"===S?"text-gray-400":"text-gray-500"),children:ua.isOnline?"Online":(e=>{if(!e)return"Offline";const t=new Date(String(e).endsWith("Z")?e:e+"Z");if(isNaN(t))return"Offline";const a=new Date;return t.toDateString()===a.toDateString()?"last seen today at ".concat(ia(e)):"last seen on ".concat(t.toLocaleDateString())})(ua.lastMessageTimestamp)}):(0,y.jsxs)("p",{className:"text-sm ".concat("dark"===S?"text-gray-400":"text-gray-500"),children:[ua.memberCount||0," members"]})]})]}),(0,y.jsx)("div",{className:"flex items-center space-x-2",children:(0,y.jsxs)("div",{className:"relative",children:[(0,y.jsx)("button",{ref:Mt,onClick:()=>J(!_),className:"p-2 rounded-full hover:bg-gray-100 ".concat("dark"===S?"text-gray-300 hover:bg-gray-700":"text-gray-600"),children:(0,y.jsx)(p.mqA,{size:20})}),_&&(0,y.jsxs)("div",{ref:At,className:"absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg z-20",children:[(0,y.jsx)("button",{onClick:()=>{ot(!0),J(!1)},className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:"Search"}),(0,y.jsx)("button",{onClick:()=>{ze(!0),J(!1)},className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:"Clear chat"})]})]})})]}),it&&(0,y.jsxs)("div",{className:"flex-shrink-0 flex items-center justify-between p-4 border-b sticky top-0 z-10 ".concat("dark"===S?"border-gray-700 bg-gray-800":"border-gray-200 bg-white"),children:[(0,y.jsx)("input",{type:"text",placeholder:"Search messages...",className:"w-full p-2 border rounded-lg ".concat("dark"===S?"bg-gray-700 text-white":""),value:dt,onChange:e=>{ut(e.target.value)},autoFocus:!0}),gt.length>0&&(0,y.jsxs)("span",{className:"mx-2 text-sm",children:[ht+1," of ",gt.length]}),(0,y.jsxs)("div",{className:"flex",children:[(0,y.jsx)("button",{onClick:()=>{ht>0&&xt(e=>e-1)},disabled:ht<=0,className:"p-2 disabled:opacity-50",children:(0,y.jsx)(x.Ucs,{})}),(0,y.jsx)("button",{onClick:()=>{ht<gt.length-1&&xt(e=>e+1)},disabled:ht>=gt.length-1,className:"p-2 disabled:opacity-50",children:(0,y.jsx)(x.Vr3,{})}),(0,y.jsx)("button",{onClick:()=>{ot(!1),ut(""),mt([])},className:"p-2",children:(0,y.jsx)(x.QCr,{})})]})]}),le&&(0,y.jsxs)("div",{className:"flex-shrink-0 flex items-center justify-between p-2 border-b bg-gray-50 ".concat("dark"===S?"bg-gray-700 border-gray-700":"border-gray-200"),children:[(0,y.jsxs)("div",{className:"flex items-center gap-2 text-sm overflow-hidden cursor-pointer flex-grow min-w-0",onClick:la,children:[(0,y.jsx)(x.LBY,{className:"flex-shrink-0 ".concat("dark"===S?"text-gray-400":"text-gray-500")}),(0,y.jsx)(v,{fileName:le.fileName||"",type:le.messageType,className:"text-lg flex-shrink-0"}),(0,y.jsxs)("div",{className:"truncate",children:[(0,y.jsx)("p",{className:"font-bold text-blue-600",children:"Pinned Message"}),(0,y.jsx)("p",{className:"truncate ".concat("dark"===S?"text-gray-300":"text-gray-600"),children:"text"===le.messageType?le.content:le.fileName||"Pinned Media"})]})]}),(0,y.jsxs)("div",{className:"relative flex-shrink-0",children:[(0,y.jsx)("button",{ref:Lt,onClick:()=>xe(!he),className:"p-2 rounded-full ".concat("dark"===S?"hover:bg-gray-600 text-gray-300":"hover:bg-gray-200"),children:(0,y.jsx)(x.Vr3,{})}),he&&(0,y.jsx)("div",{ref:Dt,className:"absolute right-0 mt-2 w-48 rounded-md shadow-lg z-20 text-sm ".concat("dark"===S?"bg-gray-700 text-white":"bg-white"),children:(0,y.jsxs)("ul",{className:"py-1",children:[(0,y.jsxs)("li",{onClick:la,className:"px-4 py-2 hover:bg-gray-100 cursor-pointer flex items-center gap-3 ".concat("dark"===S?"text-gray-300 hover:bg-gray-600":"text-gray-700"),children:[(0,y.jsx)(x.eaw,{})," Go to message"]}),(0,y.jsxs)("li",{onClick:async()=>{if(null!==le&&void 0!==le&&le.messageId)try{await(async(e,t)=>{try{const a=await n.Pt.post("/chat/unpin/".concat(e,"?userId=").concat(t));return console.log("Response:",a),a.data}catch(a){throw console.error("Failed to unpin message ".concat(e,":"),a),a}})(le.messageId,t.id),ce(null)}catch(e){console.error("Failed to unpin message:",e)}finally{xe(!1)}},className:"px-4 py-2 hover:bg-gray-100 cursor-pointer flex items-center gap-3 text-red-600 ".concat("dark"===S?"text-red-400 hover:bg-gray-600":""),children:[(0,y.jsx)(x.QCr,{})," Unpin"]})]})})]})]}),(0,y.jsx)("div",{ref:bt,onScroll:()=>{const e=bt.current;if(!e)return;const{scrollTop:t,scrollHeight:a,clientHeight:s}=e;if(0===t&&!O&&!qe){const e=L.chatId;if(!1!==Oe[e]){const t=(We[e]||0)+1;Pe(a=>(0,g.A)((0,g.A)({},a),{},{[e]:t})),Vt(e,t)}}const r=a-t-s>200;r!==Ye&&(Be(r),r||$e(0))},className:"flex-grow p-4 overflow-y-auto min-h-0 ".concat("dark"===S?"bg-gray-900":"bg-gray-50"),children:it?(0,y.jsx)("div",{className:"space-y-2",children:gt.length>0?gt.map(e=>(0,y.jsxs)("div",{onClick:()=>Pt(e),className:"p-3 rounded-lg cursor-pointer ".concat("dark"===S?"hover:bg-gray-700":"hover:bg-gray-100"),children:[(0,y.jsxs)("div",{className:"flex justify-between text-xs mb-1",children:[(0,y.jsx)("span",{className:"font-bold",children:ma(e.sender).name}),(0,y.jsx)("span",{className:"".concat("dark"===S?"text-gray-400":"text-gray-500"),children:new Date(e.timestamp).toLocaleDateString()})]}),(0,y.jsx)("p",{className:"truncate ".concat("dark"===S?"text-gray-300":"text-gray-700"),children:e.fileName?"\ud83d\udcce ".concat(e.fileName):e.content})]},e.messageId)):(0,y.jsxs)("div",{className:"text-center text-gray-500 mt-10",children:['No results found for "',dt,'"']})}):O?(0,y.jsx)(N,{theme:S}):(0,y.jsxs)("div",{className:"space-y-2",children:[ga.map((e,a)=>{var r;const n=e.sender===(null===t||void 0===t?void 0:t.id),l=new Date(e.timestamp).toDateString(),c=da!==l;c&&(da=l);const i=n?null:ma(e.sender),o=ha(e);return(0,y.jsxs)(s.Fragment,{children:[c&&(0,y.jsx)("div",{className:"text-center my-4",children:(0,y.jsx)("span",{className:"px-3 py-1 rounded-full text-xs font-semibold ".concat("dark"===S?"bg-gray-700 text-gray-300":"bg-gray-200 text-gray-600"),children:oa(e.timestamp)})}),(0,y.jsxs)("div",{id:"msg-".concat(e.messageId),"data-message-index":a,className:"flex items-end gap-2 p-1 rounded-lg transition-all\n                                                            ".concat(n?"justify-end":"justify-start","\n                                                            ").concat((null===(r=gt[ht])||void 0===r?void 0:r.messageId)===e.messageId?"bg-yellow-400/30":"","\n                                                        "),children:[!n&&(()=>{const e="group"===ua.type?null===i||void 0===i?void 0:i.profile:ua.profile,t="group"===ua.type?null===i||void 0===i?void 0:i.name:ua.name;return e?(0,y.jsx)("img",{src:e,alt:t,className:"w-8 h-8 rounded-full object-cover self-start flex-shrink-0"}):(0,y.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center self-start flex-shrink-0 ".concat("dark"===S?"bg-gray-700":"bg-gray-200"),children:(0,y.jsx)(x.x$1,{className:"text-gray-500",size:18})})})(),(0,y.jsxs)("div",{className:"flex flex-col ".concat(n?"items-end":"items-start"),children:["group"===ua.type&&!n&&(0,y.jsx)("p",{className:"text-xs text-gray-500 mb-1 ml-2 font-semibold ".concat("dark"===S?"text-gray-400":"text-gray-500"),children:null===i||void 0===i?void 0:i.name}),(0,y.jsx)("div",{onContextMenu:t=>((e,t,a)=>{e.preventDefault(),e.stopPropagation();let s=e.pageX,r=e.pageY;s+180>window.innerWidth&&(s-=180),r+250>window.innerHeight&&(r-=250),K({visible:!0,x:s,y:r,message:t,index:a})})(t,e,a),className:"rounded-lg max-w-xs md:max-w-md group relative\n                                                                ".concat("image"===e.type||"deleted"===e.type?"p-0 bg-transparent":"","\n                                                                ").concat("text"===e.type?n?"bg-blue-600 text-white p-3":"dark"===S?"bg-gray-700 text-white p-3":"bg-gray-200 text-gray-800 p-3":"","\n                                                                ").concat("audio"===e.type||"file"===e.type?n?"bg-blue-600":"dark"===S?"bg-gray-700":"bg-gray-200":"","\n                                                                "),children:"deleted"===e.type?(0,y.jsxs)("div",{className:"flex items-center gap-2 italic text-sm opacity-70 p-3",children:[(0,y.jsx)("span",{children:"This message was deleted"}),(null===re||void 0===re?void 0:re.index)===a&&(0,y.jsx)("button",{onClick:na,className:"font-semibold hover:underline",children:"Undo"})]}):(0,y.jsxs)(y.Fragment,{children:[e.isForwarded&&(0,y.jsxs)("div",{className:"flex items-center gap-1.5 text-xs opacity-70 mb-1 font-semibold",children:[(0,y.jsx)(x.Zzu,{})," Forwarded"]}),e.replyTo&&(0,y.jsxs)("div",{className:"p-2 rounded mb-2 text-sm ".concat(n?"bg-blue-500":"dark"===S?"bg-gray-600":"bg-gray-300"),children:[(0,y.jsx)("p",{className:"font-semibold",children:e.replyTo.sender===(null===t||void 0===t?void 0:t.id)?"You":ma(e.replyTo.sender).name}),(0,y.jsx)("p",{className:"opacity-80 truncate",children:(["image","audio","file"].includes(e.replyTo.type),e.replyTo.content)})]}),"image"===e.type?(0,y.jsxs)("div",{className:"relative",children:[(0,y.jsx)("button",{onClick:()=>Me(o),className:"cursor-pointer",children:(0,y.jsx)("img",{src:o,alt:e.fileName||"image",className:"rounded-md max-w-full",style:{maxHeight:"300px"}})}),!n&&(0,y.jsx)("a",{href:o,download:e.fileName,onClick:t=>ta(o,e.fileName,t),className:"absolute bottom-2 right-2 bg-black bg-opacity-50 text-white p-2 rounded-full opacity-0 group-hover:opacity-100 transition-opacity",children:(0,y.jsx)(x.WCW,{})})]}):"audio"===e.type?(0,y.jsx)("div",{className:"".concat(n?"bg-blue-600":"dark"===S?"bg-gray-700":"bg-gray-200"," rounded-lg"),children:(0,y.jsx)(w,{src:o,fileUrl:o,isSender:n,initialDuration:e.duration,fileSize:e.fileSize,theme:S})}):"file"===e.type?(0,y.jsx)(j,{msg:e,isMyMessage:n,theme:S}):(0,y.jsx)("p",{className:"text-sm break-words",children:e.content})]})}),(0,y.jsxs)("span",{className:"flex items-center justify-end gap-1 text-xs mt-1 px-1 ".concat("dark"===S?"text-gray-400":"text-gray-500"),children:[(0,y.jsx)("span",{className:"leading-none",children:"sending"===e.status?"Sending...":"failed"===e.status?"Failed":ia(e.timestamp)}),e.isEdited?(0,y.jsx)("span",{className:"leading-none",children:"(edited)"}):"",n&&"sending"!==e.status&&"failed"!==e.status&&(0,y.jsxs)("span",{className:"flex-shrink-0",children:["sent"===e.status&&(0,y.jsx)(x.CMH,{size:14,className:"".concat("dark"===S?"text-gray-500":"text-gray-400")}),"delivered"===e.status&&(0,y.jsx)(x.flP,{size:14,className:"text-blue-500"}),"seen"===e.status&&(0,y.jsx)(x.Ny1,{size:14,className:"text-blue-500"})]})]})]}),n&&(0,y.jsx)("div",{className:"relative w-8 h-8 self-start flex-shrink-0",children:(0,y.jsx)("img",{src:(null===t||void 0===t?void 0:t.profile)||"https://placehold.co/100x100/E2E8F0/4A5568?text=Me",alt:"current user",className:"w-full h-full rounded-full object-cover"})})]})]},e.messageId||e.id)}),Fe[L.chatId]&&(0,y.jsxs)("div",{className:"flex items-end gap-2 justify-start",children:[(0,y.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center self-start flex-shrink-0 ".concat("dark"===S?"bg-gray-700":"bg-gray-200"),children:(0,y.jsx)(x.x$1,{className:"text-gray-500",size:18})}),(0,y.jsx)("div",{className:"flex flex-col items-start",children:(0,y.jsx)("div",{className:"p-3 rounded-lg text-gray-800 ".concat("dark"===S?"bg-gray-700":"bg-gray-200"),children:(0,y.jsxs)("div",{className:"flex items-center justify-center gap-1.5",children:[(0,y.jsx)("span",{className:"h-2 w-2 bg-gray-500 rounded-full animate-bounce [animation-delay:-0.3s]"}),(0,y.jsx)("span",{className:"h-2 w-2 bg-gray-500 rounded-full animate-bounce [animation-delay:-0.15s]"}),(0,y.jsx)("span",{className:"h-2 w-2 bg-gray-500 rounded-full animate-bounce"})]})})})]})]})}),(0,y.jsxs)("div",{className:"flex-shrink-0 flex flex-col p-4 border-t ".concat("dark"===S?"bg-gray-800 border-gray-700":"bg-white border-gray-200"),children:[ae&&(0,y.jsxs)("div",{className:"p-2 rounded-t-lg flex justify-between items-center ".concat("dark"===S?"bg-gray-700":"bg-gray-100"),children:[(0,y.jsxs)("div",{className:"text-sm overflow-hidden",children:[(0,y.jsxs)("p",{className:"font-semibold text-blue-600",children:["Replying to ",ae.sender===(null===t||void 0===t?void 0:t.id)?"yourself":ma(ae.sender).name]}),(0,y.jsx)("p",{className:"truncate opacity-80 ".concat("dark"===S?"text-gray-300":"text-gray-600"),children:["image","audio","file"].includes(ae.type)?ae.fileName:ae.content})]}),(0,y.jsx)("button",{onClick:()=>se(null),children:(0,y.jsx)(x.QCr,{})})]}),null!==ee.index&&(0,y.jsxs)("div",{className:"p-2 rounded-t-lg flex justify-between items-center ".concat("dark"===S?"bg-gray-700":"bg-gray-100"),children:[(0,y.jsxs)("div",{className:"text-sm overflow-hidden",children:[(0,y.jsx)("p",{className:"font-semibold text-blue-600",children:"Editing message"}),(0,y.jsx)("p",{className:"truncate opacity-80 ".concat("dark"===S?"text-gray-300":"text-gray-600"),children:ee.originalContent})]}),(0,y.jsx)("button",{onClick:sa,children:(0,y.jsx)(x.QCr,{})})]}),ua&&(0,y.jsxs)("div",{className:"relative flex items-center w-full space-x-2 ".concat(ae||null!==ee.index?"pt-2":""),children:[Y&&(0,y.jsx)("div",{ref:Ct,className:"absolute bottom-full mb-2 left-0 z-40 w-[95vw] max-w-sm",children:(0,y.jsx)(f.Ay,{onEmojiClick:e=>U(t=>t+e.emoji),width:"100%",height:350,theme:S})}),(0,y.jsxs)("div",{className:"relative flex-grow",children:[(0,y.jsx)("input",{ref:Tt,type:"text",placeholder:Z?"Recording...":"Type a message...",className:"w-full p-3 pr-24 rounded-full border bg-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat("dark"===S?"bg-gray-700 text-white border-gray-600":"bg-gray-100 border-gray-300"),value:F,onChange:e=>{U(e.target.value),Qt(!0)},onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),null!==ee.index?aa():Gt())},disabled:Z}),(0,y.jsxs)("div",{className:"absolute right-2 top-1/2 -translate-y-1/2 flex items-center",children:[(0,y.jsx)("button",{ref:St,onClick:()=>B(!Y),className:"p-2 rounded-full hover:bg-gray-100 ".concat("dark"===S?"text-gray-300 hover:bg-gray-700":"text-gray-500 hover:text-blue-600"),children:(0,y.jsx)(x.Ky9,{size:20})}),(0,y.jsx)("button",{onClick:()=>wt.current.click(),className:"p-2 rounded-full hover:bg-gray-100 ".concat("dark"===S?"text-gray-300 hover:bg-gray-700":"text-gray-500 hover:text-blue-600"),children:(0,y.jsx)(x.EHs,{size:20})})]})]}),F.trim()||null!==ee.index?(0,y.jsx)("button",{onClick:null!==ee.index?aa:Gt,className:"p-3 rounded-full text-white ".concat(null!==ee.index?"bg-green-600 hover:bg-green-700":"bg-blue-600 hover:bg-blue-700"),children:null!==ee.index?(0,y.jsx)(x.CMH,{size:20}):(0,y.jsx)(x.Cer,{size:20})}):(0,y.jsx)("button",{onClick:()=>{Z?ea():Kt()},className:"p-3 rounded-full hover:bg-gray-100 ".concat(Z?"text-red-500 animate-pulse":"dark"===S?"text-gray-300 hover:bg-gray-700":"text-gray-500 hover:text-blue-600"),children:Z?(0,y.jsx)(x.wFo,{size:20}):(0,y.jsx)(x.i0t,{size:20})}),(0,y.jsx)("input",{type:"file",ref:wt,onChange:async e=>{const a=e.target.files[0];if(!a||!L)return;let s="file";a.type.startsWith("image/")?s="image":a.type.startsWith("audio/")&&(s="audio");const r=Date.now().toString()+Math.random().toString(36).substring(2,9),l=URL.createObjectURL(a),c={id:r,messageId:r,sender:t.id,content:l,timestamp:(new Date).toISOString(),status:"sending",type:s,fileName:a.name,fileSize:a.size,fileUrl:l,isEdited:!1};qt(L.chatId,c),P(e=>(0,g.A)((0,g.A)({},e),{},{[L.chatId]:[...e[L.chatId]||[],c]}));const i=new FormData;i.append("file",a),i.append("sender",t.id),i.append("client_id",r),i.append("fileType",a.type),i.append("type","group"===L.type?"TEAM":"PRIVATE"),"group"===L.type?i.append("groupId",L.chatId):i.append("receiver",L.chatId);try{await(async e=>{try{const t=await n.Pt.post("/chat/upload",e,{headers:{"Content-Type":"multipart/form-data"}});return console.log("Response:",t),t.data}catch(t){throw console.error("File upload failed:",t),t}})(i)}catch(o){console.error("File upload failed in component:",o),P(e=>{const t=(e[L.chatId]||[]).map(e=>e.id===r?(0,g.A)((0,g.A)({},e),{},{status:"failed"}):e);return(0,g.A)((0,g.A)({},e),{},{[L.chatId]:t})})}finally{e.target.value=null}},className:"hidden"})]})]})]}):(0,y.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,y.jsxs)("div",{className:"text-center",children:[(0,y.jsx)(x.YXz,{className:"mx-auto text-6xl ".concat("dark"===S?"text-gray-600":"text-gray-300")}),(0,y.jsx)("p",{className:"mt-4 text-xl text-center ".concat("dark"===S?"text-gray-400":"text-gray-600"),children:"Select a chat to begin"}),(0,y.jsx)("p",{className:"text-sm ".concat("dark"===S?"text-gray-500":"text-gray-400"),children:"Start a conversation with your team or colleagues."})]})})}),Ye&&(0,y.jsxs)("button",{onClick:()=>Ot(),className:"absolute bottom-24 right-8 z-[110] bg-blue-600/80 backdrop-blur-sm text-white rounded-full p-3 shadow-xl hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all transform hover:scale-110 animate-fade-in","aria-label":"Scroll to bottom",children:[Ze>0&&(0,y.jsx)("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center",children:Ze>9?"9+":Ze}),(0,y.jsx)(x.Vr3,{size:20})]})]}),_e&&(0,y.jsx)(k,{chat:_e,onClose:()=>Je(null),theme:S}),G.visible&&(0,y.jsx)("div",{ref:Et,style:{top:G.y,left:G.x},className:"absolute rounded-md shadow-lg z-[110] text-sm ".concat("dark"===S?"bg-gray-800":"bg-white"),children:(0,y.jsx)("ul",{className:"py-1",children:"deleted"===G.message.type?(0,y.jsxs)("li",{onClick:()=>ra(!1),className:"px-4 py-2 hover:bg-gray-100 cursor-pointer flex items-center gap-3 text-red-600 ".concat("dark"===S?"text-red-400 hover:bg-gray-700":""),children:[(0,y.jsx)(x.qbC,{})," Delete for me"]}):(0,y.jsxs)(y.Fragment,{children:[(0,y.jsxs)("li",{onClick:()=>{se(G.message),K({visible:!1,x:0,y:0,message:null,index:null}),Tt.current.focus()},className:"px-4 py-2 hover:bg-gray-100 cursor-pointer flex items-center gap-3 ".concat("dark"===S?"text-gray-300 hover:bg-gray-700":"text-gray-700"),children:[(0,y.jsx)(x.w1Z,{})," Reply"]}),(0,y.jsxs)("li",{onClick:async()=>{var e;if(null!==(e=G.message)&&void 0!==e&&e.messageId)try{const e=G.message.messageId,a=await(async(e,t)=>{try{const a=await n.Pt.post("/chat/pin/".concat(e,"?userId=").concat(t));return console.log("Response:",a),a.data}catch(a){throw console.error("Failed to pin message ".concat(e,":"),a),a}})(e,t.id);ce(a)}catch(a){console.error("Failed to pin message:",a)}finally{K({visible:!1,x:0,y:0,message:null,index:null})}},className:"px-4 py-2 hover:bg-gray-100 cursor-pointer flex items-center gap-3 ".concat("dark"===S?"text-gray-300 hover:bg-gray-700":"text-gray-700"),children:[(0,y.jsx)(x.LBY,{})," Pin"]}),(0,y.jsxs)("li",{onClick:()=>{oe({visible:!0,message:G.message}),K({visible:!1,x:0,y:0,message:null,index:null})},className:"px-4 py-2 hover:bg-gray-100 cursor-pointer flex items-center gap-3 ".concat("dark"===S?"text-gray-300 hover:bg-gray-700":"text-gray-700"),children:[(0,y.jsx)(x.Zzu,{})," Forward"]}),"sending"!==G.message.status&&"failed"!==G.message.status&&(0,y.jsxs)(y.Fragment,{children:[G.message.sender===(null===t||void 0===t?void 0:t.id)&&"text"===G.message.type&&!G.message.isForwarded&&new Date-new Date(G.message.timestamp)<9e5&&(0,y.jsxs)("li",{onClick:()=>{te({index:G.index,originalContent:G.message.content}),U(G.message.content),K({visible:!1,x:0,y:0,message:null,index:null}),Tt.current.focus()},className:"px-4 py-2 hover:bg-gray-100 cursor-pointer flex items-center gap-3 ".concat("dark"===S?"text-gray-300 hover:bg-gray-700":"text-gray-700"),children:[(0,y.jsx)(x.uO9,{})," Edit"]}),(0,y.jsx)("hr",{className:"my-1 ".concat("dark"===S?"border-gray-700":"")}),(0,y.jsxs)("li",{onClick:()=>ra(!1),className:"px-4 py-2 hover:bg-gray-100 cursor-pointer flex items-center gap-3 text-red-600 ".concat("dark"===S?"text-red-400 hover:bg-gray-700":""),children:[(0,y.jsx)(x.qbC,{})," Delete for me"]}),G.message.sender===(null===t||void 0===t?void 0:t.id)&&(0,y.jsxs)("li",{onClick:()=>ra(!0),className:"px-4 py-2 hover:bg-gray-100 cursor-pointer flex items-center gap-3 text-red-600 ".concat("dark"===S?"text-red-400 hover:bg-gray-700":""),children:[(0,y.jsx)(x.qbC,{})," Delete for everyone"]})]})]})})}),ie.visible&&(0,y.jsx)("div",{className:"fixed inset-0 bg-opacity-100 flex items-center justify-center z-[100]",children:(0,y.jsxs)("div",{className:"rounded-lg shadow-2xl w-full max-w-md ".concat("dark"===S?"bg-gray-800 text-white":"bg-white"),children:[(0,y.jsxs)("div",{className:"p-4 border-b flex justify-between items-center ".concat("dark"===S?"border-gray-700":"border-gray-200"),children:[(0,y.jsx)("h3",{className:"font-bold text-lg",children:"Forward message to..."}),(0,y.jsx)("button",{onClick:()=>oe({visible:!1,message:null}),children:(0,y.jsx)(x.QCr,{})})]}),(0,y.jsx)("div",{className:"p-4",children:(0,y.jsx)("input",{type:"text",placeholder:"Search for users or groups",className:"w-full p-2 border rounded-lg ".concat("dark"===S?"bg-gray-700 text-white border-gray-600":"bg-gray-100 border-gray-300"),value:ge,onChange:e=>me(e.target.value)})}),(0,y.jsx)("div",{className:"h-64 overflow-y-auto p-4",children:Yt.filter(e=>{var t;return null===(t=e.name)||void 0===t?void 0:t.toLowerCase().includes(ge.toLowerCase())}).map(e=>(0,y.jsxs)("div",{className:"flex items-center p-2 rounded-lg hover:bg-gray-100 ".concat("dark"===S?"hover:bg-gray-700":""),children:[(0,y.jsx)("input",{type:"checkbox",id:"fwd-".concat(e.chatId),className:"mr-3 h-4 w-4 accent-blue-600",checked:de.includes(e.chatId),onChange:t=>{t.target.checked?ue([...de,e.chatId]):ue(de.filter(t=>t!==e.chatId))}}),(0,y.jsxs)("label",{htmlFor:"fwd-".concat(e.chatId),className:"flex-grow flex items-center gap-3 cursor-pointer",children:["group"===e.type?(0,y.jsx)("div",{className:"w-10 h-10 rounded-full flex items-center justify-center ".concat("dark"===S?"bg-gray-700":"bg-gray-200"),children:(0,y.jsx)(x.YXz,{className:"text-gray-500"})}):(0,y.jsx)("img",{src:e.profile,alt:e.name,className:"w-10 h-10 rounded-full object-cover",onError:e=>{e.target.src="https://placehold.co/100x100/E2E8F0/4A5568?text=U"}}),(0,y.jsx)("span",{className:"".concat("dark"===S?"text-gray-300":"text-gray-800"),children:e.name})]})]},e.chatId))}),(0,y.jsx)("div",{className:"p-4 border-t text-right ".concat("dark"===S?"border-gray-700":"border-gray-200"),children:(0,y.jsx)("button",{onClick:async()=>{const e=ie.message;if(!e||0===de.length)return;const a={sender:t.id,forwardMessageId:e.messageId,forwardTo:de.map(e=>{const t=Yt.find(t=>t.chatId===e);return"private"===t.type?{receiver:t.chatId}:{groupId:t.chatId}})};try{await(async e=>{try{const t=await n.Pt.post("/chat/forward",e);return console.log("Response:",t),t.data}catch(t){throw console.error("Failed to forward message ".concat(e.forwardMessageId,":"),t),t}})(a);const e=(0,g.A)((0,g.A)({},ie.message),{},{sender:t.id,timestamp:(new Date).toISOString()});de.forEach(t=>{qt(t,e)})}catch(s){console.error("Failed to forward message:",s)}finally{oe({visible:!1,message:null}),ue([]),me("")}},disabled:0===de.length,className:"bg-blue-600 text-white px-4 py-2 rounded-lg disabled:bg-gray-400 disabled:cursor-not-allowed cursor-pointer",children:"Forward"})})]})}),pe&&ua&&"group"!==ua.type&&(0,y.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[151]",onClick:()=>fe(!1),children:(0,y.jsx)("img",{src:ua.profile,alt:ua.name,className:"max-w-[80vw] max-h-[90vh] object-contain",onClick:e=>e.stopPropagation()})}),ye&&"group"===(null===ua||void 0===ua?void 0:ua.type)&&(0,y.jsx)("div",{className:"fixed inset-0 bg-opacity-100 flex items-center justify-center z-[100]",onClick:()=>be(!1),children:(0,y.jsxs)("div",{className:"rounded-lg shadow-2xl w-full max-w-lg h-[80vh] flex flex-col ".concat("dark"===S?"bg-gray-800 text-white":"bg-white"),onClick:e=>e.stopPropagation(),children:[(0,y.jsxs)("div",{className:"p-4 border-b flex justify-between items-center flex-shrink-0 ".concat("dark"===S?"border-gray-700":"border-gray-200"),children:[(0,y.jsx)("h3",{className:"font-bold text-xl",children:"Group Info"}),(0,y.jsx)("button",{onClick:()=>be(!1),className:"p-2 rounded-full ".concat("dark"===S?"hover:bg-gray-700 text-gray-300":"hover:bg-gray-200"),children:(0,y.jsx)(x.QCr,{})})]}),(0,y.jsx)("div",{className:"flex border-b flex-shrink-0 ".concat("dark"===S?"border-gray-700":"border-gray-200"),children:["Overview","Members","Media","Files","Links"].map(e=>(0,y.jsx)("button",{onClick:()=>je(e),className:"flex-1 p-3 text-sm font-semibold ".concat(ve===e?"text-blue-600 border-b-2 border-blue-600":"dark"===S?"text-gray-400 hover:bg-gray-700":"text-gray-500 hover:bg-gray-100"),children:e},e))}),(0,y.jsxs)("div",{className:"p-4 overflow-y-auto flex-grow",children:["Overview"===ve&&(0,y.jsxs)("div",{className:"flex flex-col items-center text-center space-y-4",children:[(0,y.jsx)("div",{className:"w-40 h-40 rounded-full flex items-center justify-center ".concat("dark"===S?"bg-gray-700":"bg-gray-200"),children:(0,y.jsx)(x.YXz,{className:"text-gray-500",size:80})}),(0,y.jsx)("h2",{className:"text-2xl font-bold",children:ua.name}),(0,y.jsxs)("p",{className:"text-gray-600 ".concat("dark"===S?"text-gray-400":""),children:[ua.memberCount||0," members"]})]}),"Members"===ve&&(0,y.jsx)("div",{className:"space-y-3",children:ke?(0,y.jsx)("p",{className:"text-center text-gray-500",children:"Loading members..."}):we.map((e,t)=>(0,y.jsxs)("div",{className:"flex items-center gap-4 p-2 rounded-lg ".concat("dark"===S?"hover:bg-gray-700":"hover:bg-gray-50"),children:[e.employeeImage?(0,y.jsx)("img",{src:e.employeeImage,alt:e.displayName,className:"w-10 h-10 rounded-full object-cover"}):(0,y.jsx)("div",{className:"w-10 h-10 rounded-full flex items-center justify-center ".concat("dark"===S?"bg-gray-700":"bg-gray-200"),children:(0,y.jsx)(x.x$1,{className:"text-gray-500",size:20})}),(0,y.jsxs)("div",{children:[(0,y.jsx)("span",{className:"font-semibold ".concat("dark"===S?"text-white":"text-gray-800"),children:e.displayName}),e.jobTitlePrimary&&(0,y.jsx)("p",{className:"text-sm ".concat("dark"===S?"text-gray-400":"text-gray-500"),children:e.jobTitlePrimary})]})]},e.employeeId||t))}),"Media"===ve&&(lt?(0,y.jsx)("p",{className:"text-center p-4 text-gray-500",children:"Loading Media..."}):(0,y.jsx)("div",{className:"grid grid-cols-3 md:grid-cols-4 gap-2",children:et.length>0?et.map((e,t)=>(0,y.jsx)("button",{onClick:()=>Me(ha(e)),children:(0,y.jsx)("img",{src:ha(e),alt:e.fileName,className:"w-full h-24 object-cover rounded-md cursor-pointer hover:opacity-80"})},t)):(0,y.jsx)("p",{className:"col-span-full text-center p-4 text-gray-500",children:"No media found."})})),"Files"===ve&&(lt?(0,y.jsx)("p",{className:"text-center p-4 text-gray-500",children:"Loading Files..."}):(0,y.jsx)("div",{className:"space-y-3",children:at.length>0?at.map(e=>(0,y.jsx)(j,{msg:e,isMyMessage:!1,theme:S},e.id)):(0,y.jsx)("p",{className:"text-center p-4 text-gray-500",children:"No files found in this chat."})})),"Links"===ve&&(lt?(0,y.jsx)("p",{className:"text-center p-4 text-gray-500",children:"Loading Links..."}):(0,y.jsx)("div",{className:"space-y-3",children:(()=>{const e=rt.flatMap(e=>{const t=e.content.match(/(https?:\/\/[^\s]+)/g);return t?t.map(t=>({id:e.id,url:t,sender:ma(e.sender).name,timestamp:e.timestamp})):[]});return e.length>0?e.map((e,t)=>(0,y.jsxs)("div",{className:"p-3 rounded-lg ".concat("dark"===S?"bg-gray-700":"bg-gray-100"),children:[(0,y.jsx)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline break-all",children:e.url}),(0,y.jsxs)("p",{className:"text-xs mt-1 ".concat("dark"===S?"text-gray-400":"text-gray-500"),children:["Shared by ",e.sender," on ",new Date(e.timestamp).toLocaleDateString()]})]},"".concat(e.id,"-").concat(t))):(0,y.jsx)("p",{className:"text-center p-4 ".concat("dark"===S?"text-gray-400":"text-gray-500"),children:"No links found in this chat."})})()}))]})]})}),Ae&&(0,y.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-[151]",onClick:()=>Me(null),children:(0,y.jsx)("img",{src:Ae,alt:"Full view",className:"max-w-[90vw] max-h-[90vh] object-contain",onClick:e=>e.stopPropagation()})}),Le&&(0,y.jsx)("div",{className:"fixed inset-0 bg-opacity-100 flex items-center justify-center z-[110]",children:(0,y.jsxs)("div",{className:"rounded-lg shadow-xl p-6 w-full max-w-sm ".concat("dark"===S?"bg-gray-800":"bg-white"),children:[(0,y.jsx)("h3",{className:"text-lg font-bold mb-4 ".concat("dark"===S?"text-white":"text-gray-800"),children:"Clear Chat?"}),(0,y.jsx)("p",{className:"mb-6 ".concat("dark"===S?"text-gray-400":"text-gray-600"),children:"Are you sure you want to clear all messages in this chat? This action cannot be undone."}),(0,y.jsxs)("div",{className:"flex justify-end gap-4",children:[(0,y.jsx)("button",{onClick:()=>ze(!1),className:"px-4 py-2 rounded-lg text-gray-700 bg-gray-200 hover:bg-gray-300 ".concat("dark"===S?"bg-gray-600 text-white hover:bg-gray-700":""),children:"Cancel"}),(0,y.jsx)("button",{onClick:async()=>{if(L)try{await(async(e,t)=>{try{const a=await n.Pt.post("/chat/clear?userId=".concat(e,"&chatId=").concat(t));return console.log("Response:",a),a.data}catch(a){throw console.error("Failed to clear chat for ".concat(t,":"),a),a}})(t.id,L.chatId),P(e=>(0,g.A)((0,g.A)({},e),{},{[L.chatId]:[]})),qt(L.chatId,null)}catch(e){console.error("Failed to clear chat:",e)}finally{ze(!1)}},className:"px-4 py-2 rounded-lg text-white bg-red-600 hover:bg-red-700",children:"Clear Chat"})]})]})})]})},C=()=>(0,y.jsxs)("div",{className:"flex items-center space-x-4 p-3",children:[(0,y.jsx)("div",{className:"w-11 h-11 bg-gray-200 rounded-full animate-pulse"}),(0,y.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,y.jsx)("div",{className:"h-4 bg-gray-200 rounded w-3/4 animate-pulse"}),(0,y.jsx)("div",{className:"h-3 bg-gray-200 rounded w-1/2 animate-pulse"})]})]}),S=e=>{let{theme:t}=e;return(0,y.jsxs)("div",{className:"flex w-full h-full p-0 md:p-4 md:gap-4 ".concat("dark"===t?"bg-gray-900":"bg-gray-100"),children:[(0,y.jsxs)("div",{className:"w-full md:w-[30%] h-full p-4 flex flex-col shadow-xl md:rounded-lg space-y-4 ".concat("dark"===t?"bg-gray-800":"bg-white"),children:[(0,y.jsx)("div",{className:"h-12 bg-gray-200 rounded-lg animate-pulse mb-4"}),(0,y.jsxs)("div",{className:"flex-grow space-y-2 pr-2 overflow-hidden",children:[(0,y.jsx)(C,{}),(0,y.jsx)(C,{}),(0,y.jsx)(C,{}),(0,y.jsx)(C,{}),(0,y.jsx)(C,{}),(0,y.jsx)(C,{}),(0,y.jsx)(C,{}),(0,y.jsx)(C,{}),(0,y.jsx)(C,{}),(0,y.jsx)(C,{}),(0,y.jsx)(C,{}),(0,y.jsx)(C,{})]})]}),(0,y.jsx)("div",{className:"hidden md:flex flex-col w-[70%] h-full md:rounded-lg shadow-xl ".concat("dark"===t?"bg-gray-800":"bg-white"),children:(0,y.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,y.jsx)("div",{className:"text-center",children:(0,y.jsx)("p",{className:"text-xl ".concat("text-gray-400"),children:"Loading Chats..."})})})})]})};const A=function(){const{userId:e}=(0,r.g)(),{theme:t,userData:a}=(0,s.useContext)(m.ob),[l,c]=(0,s.useState)({groups:[],privateChatsWith:[]}),[i,o]=(0,s.useState)(!0),[u,g]=(0,s.useState)(!1),[h,x]=(0,s.useState)(0),[p,f]=(0,s.useState)(!0),b=(0,s.useRef)(!1),v={name:(null===a||void 0===a?void 0:a.displayName)||"You",id:e,profile:(null===a||void 0===a?void 0:a.employeeImage)||"https://placehold.co/100x100/E2E8F0/4A5568?text=Me"},j=async t=>{if(console.log("%c loadChats function started for page: ".concat(t),"color: blue; font-weight: bold;"),p&&!b.current){b.current=!0,0===t?o(!0):g(!0);try{console.log("%c Sending API request for page: ".concat(t),"color: green;");const a=await async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;try{const s=await n.Pt.get("/chat/overview/".concat(e,"?page=").concat(t,"&size=").concat(a));return console.log("Response for page ".concat(t,":"),s),s.data}catch(s){return console.error("Failed to fetch chat overview:",s),[]}}(e,t,10);if(0===a.length)return void f(!1);const s=d(a,e);c(e=>{if(0===t)return s;const a=new Set(e.groups.map(e=>e.chatId)),r=new Set(e.privateChatsWith.map(e=>e.chatId)),n=s.groups.filter(e=>!a.has(e.chatId)),l=s.privateChatsWith.filter(e=>!r.has(e.chatId));return{groups:[...e.groups,...n],privateChatsWith:[...e.privateChatsWith,...l]}}),a.length<10&&f(!1)}catch(a){console.error("Error loading chats:",a)}finally{0===t&&o(!1),g(!1),b.current=!1,console.log("%c Finished fetch for page ".concat(t,". Lock released."),"color: orange;")}}else console.log("%c Request for page ".concat(t," blocked. hasMore=").concat(p,", fetchingMore.current=").concat(b.current),"color: red;")};return(0,s.useEffect)(()=>{e&&j(0)},[e]),(0,y.jsx)("div",{className:"flex h-full w-full ".concat("dark"===t?"bg-gray-900":"bg-gray-100"),children:i?(0,y.jsx)(S,{theme:t}):(0,y.jsx)(I,{currentUser:v,chats:l,loadMoreChats:()=>{if(console.log("handleLoadMore triggered!"),b.current||!p)return void console.log("handleLoadMore blocked by ref lock or no more data.");const e=h+1;x(e),j(e)},hasMore:p,isFetchingMore:u,theme:t})})}}}]);
//# sourceMappingURL=654.2b243d73.chunk.js.map