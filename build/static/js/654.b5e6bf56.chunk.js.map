{"version":3,"file":"static/js/654.b5e6bf56.chunk.js","mappings":"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","sources":["services/apiService.js","services/dataTransformer.js","TechLife/HRMS/Components/Chats/ChatApplication.jsx","TechLife/HRMS/Components/Chats/ChatApp.jsx"],"sourcesContent":["import axios from 'axios';\r\nimport { publicinfoApi } from '../axiosInstance';\r\n\r\nconst AUTH_API_URL = 'https://hrms.anasolconsultancyservices.com/api/auth/refresh-token';\r\n\r\nfunction cloneFormData(formData) {\r\n    const newFormData = new FormData();\r\n    for (let [key, value] of formData.entries()) {\r\n        newFormData.append(key, value);\r\n    }\r\n    return newFormData;\r\n}\r\n\r\nlet isRefreshing = false;\r\nlet failedQueue = [];\r\n\r\nconst processQueue = (error, token = null) => {\r\n    failedQueue.forEach(prom => {\r\n        if (error) {\r\n            prom.reject(error);\r\n        } else {\r\n            prom.resolve(token);\r\n        }\r\n    });\r\n    failedQueue = [];\r\n};\r\n\r\nconst createAxiosInstance = (baseURL) => {\r\n    const instance = axios.create({\r\n        baseURL: baseURL,\r\n    });\r\n\r\n    instance.interceptors.request.use(\r\n        (config) => {\r\n            const token = localStorage.getItem('accessToken');\r\n            if (token) {\r\n                config.headers['Authorization'] = `Bearer ${token}`;\r\n            }\r\n            console.log('Request Headers (from Interceptor):', config.headers);\r\n            return config;\r\n        },\r\n        (error) => Promise.reject(error)\r\n    );\r\n\r\n    instance.interceptors.response.use(\r\n        (response) => response,\r\n        async (error) => {\r\n            const originalRequest = error.config;\r\n\r\n            if (error.response?.status === 401 && !originalRequest._retry) {\r\n                if (isRefreshing) {\r\n                    return new Promise((resolve, reject) => {\r\n                        failedQueue.push({ resolve, reject });\r\n                    })\r\n                    .then(token => {\r\n                        originalRequest.headers['Authorization'] = `Bearer ${token}`;\r\n                        return instance(originalRequest);\r\n                    })\r\n                    .catch(err => Promise.reject(err));\r\n                }\r\n\r\n                originalRequest._retry = true;\r\n                isRefreshing = true;\r\n\r\n                const oldToken = localStorage.getItem('accessToken');\r\n                console.log(` Token expired for ${baseURL}. Old Token:`, oldToken);\r\n\r\n                try {\r\n                    const refreshResponse = await axios.post(\r\n                        AUTH_API_URL,\r\n                        {},\r\n                        { withCredentials: true }\r\n                    );\r\n\r\n                    const { accessToken } = refreshResponse.data;\r\n                    localStorage.setItem('accessToken', accessToken);\r\n                    console.log(` New Token for ${baseURL}:`, accessToken);\r\n\r\n                    if (originalRequest.data instanceof FormData) {\r\n                        originalRequest.data = cloneFormData(originalRequest.data);\r\n                    }\r\n\r\n                    processQueue(null, accessToken);\r\n\r\n                    const newInstance = createAxiosInstance(baseURL);\r\n                    originalRequest.headers['Authorization'] = `Bearer ${accessToken}`;\r\n\r\n                    return newInstance(originalRequest);\r\n\r\n                } catch (refreshError) {\r\n                    console.error(\"Refresh token failed. Logging out.\", refreshError);\r\n                    localStorage.clear();\r\n                    window.location.href = '/login';\r\n                    processQueue(refreshError);\r\n                    return Promise.reject(refreshError);\r\n\r\n                } finally {\r\n                    isRefreshing = false;\r\n                }\r\n            }\r\n\r\n            return Promise.reject(error);\r\n        }\r\n    );\r\n\r\n    return instance;\r\n};\r\n\r\nwindow.addEventListener('storage', (event) => {\r\n    if (event.key === 'accessToken') {\r\n        console.log(\" Token updated in another tab:\", event.newValue);\r\n    }\r\n});\r\nexport const chatApi = createAxiosInstance('https://hrms.anasolconsultancyservices.com/api');\r\n\r\nexport const getChatOverview = async (employeeId, page = 0, size = 10) => {\r\n  try {\r\n    const response = await chatApi.get(`/chat/overview/${employeeId}?page=${page}&size=${size}`);\r\n    console.log(`Response for page ${page}:`, response);\r\n    return response.data;\r\n  } catch (error) {\r\n    console.error(\"Failed to fetch chat overview:\", error);\r\n    return [];\r\n  }\r\n};\r\n\r\nexport const getMessages = async (employeeId, chatId, page = 0, size = 15) => {\r\n  try {\r\n    const response = await chatApi.get(`/chat/${employeeId}/${chatId}?page=${page}&size=${size}`);\r\n    console.log(`Response for messages page ${page}:`, response);\r\n    return response.data;\r\n  } catch (error) {\r\n    console.error(`Failed to fetch messages for chat ${chatId}:`, error);\r\n    return [];\r\n  }\r\n};\r\n\r\nexport const updateMessage = async (messageId, newContent, senderId) => {\r\n  try {\r\n    const requestBody = {\r\n      content: newContent,\r\n      sender: senderId,\r\n    };\r\n    const response = await chatApi.put(`/chat/update/${messageId}`, requestBody);\r\n    console.log('Response:', response);\r\n    return response.data;\r\n  } catch (error) {\r\n    console.error(`Failed to update message ${messageId}:`, error);\r\n    throw error;\r\n  }\r\n};\r\n\r\nexport const deleteMessageForMe = async (messageId, userId) => {\r\n  try {\r\n    const response = await chatApi.post(`/chat/delete/${messageId}/me?userId=${userId}`);\r\n    console.log('Response:', response);\r\n    return response.data;\r\n  } catch (error) {\r\n    console.error(`Failed to delete message ${messageId} for me:`, error);\r\n    throw error;\r\n  }\r\n};\r\n\r\nexport const deleteMessageForEveryone = async (messageId, userId) => {\r\n  try {\r\n    const response = await chatApi.post(`/chat/delete/${messageId}/everyone?userId=${userId}`);\r\n    console.log('Response:', response);\r\n    return response.data;\r\n  } catch (error) {\r\n    console.error(`Failed to delete message ${messageId} for everyone:`, error);\r\n    throw error;\r\n  }\r\n};\r\n\r\nexport const uploadFile = async (formData) => {\r\n    try {\r\n        const response = await chatApi.post('/chat/upload', formData, {\r\n            headers: {\r\n                'Content-Type': 'multipart/form-data',\r\n            },\r\n        });\r\n        console.log('Response:', response);\r\n        return response.data;\r\n    } catch (error) {\r\n        console.error(\"File upload failed:\", error);\r\n        throw error;\r\n    }\r\n};\r\n\r\nexport const forwardMessage = async (forwardData) => {\r\n    try {\r\n        const response = await chatApi.post('/chat/forward', forwardData);\r\n        console.log('Response:', response);\r\n        return response.data;\r\n    } catch (error) {\r\n        console.error(`Failed to forward message ${forwardData.forwardMessageId}:`, error);\r\n        throw error;\r\n    }\r\n};\r\n\r\nexport const pinMessage = async (messageId, userId) => {\r\n    try {\r\n        const response = await chatApi.post(`/chat/pin/${messageId}?userId=${userId}`);\r\n        console.log('Response:', response);\r\n        return response.data;\r\n    } catch (error) {\r\n        console.error(`Failed to pin message ${messageId}:`, error);\r\n        throw error;\r\n    }\r\n};\r\n\r\nexport const unpinMessage = async (messageId, userId) => {\r\n    try {\r\n        const response = await chatApi.post(`/chat/unpin/${messageId}?userId=${userId}`);\r\n        console.log('Response:', response);\r\n        return response.data;\r\n    } catch (error) {\r\n        console.error(`Failed to unpin message ${messageId}:`, error);\r\n        throw error;\r\n    }\r\n};\r\n\r\nexport const getPinnedMessage = async (chatId, chatType, userId) => {\r\n  try {\r\n    const response = await chatApi.get(`/chat/${chatId}/pinned?chatType=${chatType}&userId=${userId}`);\r\n    console.log('Response:', response);\r\n    return response.data;\r\n  } catch (error) {\r\n    console.error(`Failed to fetch pinned message for chat ${chatId}:`, error);\r\n    return null;\r\n  }\r\n};\r\n\r\nexport const clearChatHistory = async (userId, chatId) => {\r\n  try {\r\n    const response = await chatApi.post(`/chat/clear?userId=${userId}&chatId=${chatId}`);\r\n    console.log('Response:', response);\r\n    return response.data;\r\n  } catch (error) {\r\n    console.error(`Failed to clear chat for ${chatId}:`, error);\r\n    throw error;\r\n  }\r\n};\r\n\r\nexport const uploadVoiceMessage = async (voiceData) => {\r\n  try {\r\n    const response = await chatApi.post('/chat/voice/upload', voiceData);\r\n    console.log('Response:', response);\r\n    return response.data;\r\n  } catch (error) {\r\n    console.error(\"Voice message upload failed:\", error);\r\n    throw error;\r\n  }\r\n};\r\n\r\nexport const getGroupMembers = async (teamId) => {\r\n  try {\r\n    const response = await publicinfoApi.get(`/employee/team/employee/${teamId}`);\r\n    console.log('Response:', response);\r\n    return response.data;\r\n  } catch (error) {\r\n    console.error(`Failed to fetch members for team ${teamId}:`, error);\r\n    return null;\r\n  }\r\n};\r\n\r\nexport const searchMessages = async (userId, chatId, query) => {\r\n  try {\r\n    const response = await chatApi.get(`/chat/search`, {\r\n      params: { userId, chatId, query }\r\n    });\r\n    return response.data;\r\n  } catch (error) {\r\n    console.error(`Failed to search messages in chat ${chatId}:`, error);\r\n    return [];\r\n  }\r\n};\r\n\r\nexport const getMessageContext = async (messageId, userId, chatId) => {\r\n  try {\r\n    const response = await chatApi.get(`/chat/context`, {\r\n      params: { messageId, userId, chatId }\r\n    });\r\n    return response.data;\r\n  } catch (error) {\r\n    console.error(`Failed to fetch message context for message ${messageId}:`, error);\r\n    return [];\r\n  }\r\n};\r\n\r\nexport const getChatAttachments = async (chatId, type) => {\r\n  try {\r\n    const response = await chatApi.get(`/chat/${chatId}/attachments`, {\r\n      params: { type }\r\n    });\r\n    console.log(`Response for ${type}:`, response.data);\r\n    return response.data;\r\n  } catch (error) {\r\n    console.error(`Failed to fetch ${type} for chat ${chatId}:`, error);\r\n    return [];\r\n  }\r\n};\r\n\r\nexport const searchChatOverview = async (employeeId, query) => {\r\n  try {\r\n    const response = await chatApi.get(`/chat/overview/search`, {\r\n      params: { employeeId, query }\r\n    });\r\n    return response.data;\r\n  } catch (error) {\r\n    console.error(\"Failed to search chat overview:\", error);\r\n    return [];\r\n  }\r\n};","import { chatApi } from \"../axiosInstance\";\r\n\r\nexport const generateChatListPreview = (item, currentUserId) => {\r\n    if (!item.lastMessage || item.lastMessage === 'Chat cleared') {\r\n      return '';\r\n    }\r\n\r\n    const lastMessageContent = item.lastMessage;\r\n    const prefix = item.lastMessageSenderId === currentUserId ? 'You: ' : '';\r\n\r\n    if (item.lastMessageType) {\r\n        switch (item.lastMessageType.toUpperCase()) {\r\n            case 'IMAGE': return prefix + ' Image';\r\n            case 'AUDIO': return prefix + ' Voice Message';\r\n            case 'FILE': return prefix + ` ${lastMessageContent}`;\r\n            case 'DELETED': return 'This message was deleted';\r\n        }\r\n    }\r\n    if (lastMessageContent.match(/\\.(jpeg|jpg|gif|png|webp)$/i)) {\r\n        return prefix + ' Image';\r\n    }\r\n    if (lastMessageContent.match(/\\.(mp3|wav|ogg|m4a|webm)$/i)) {\r\n        return prefix + ' Voice Message';\r\n    }\r\n    if (lastMessageContent.match(/\\.(pdf|doc|docx|ppt|pptx|xls|xlsx|zip|rar)$/i)) {\r\n        return prefix + ` ${lastMessageContent}`;\r\n    }\r\n\r\n    return prefix + lastMessageContent;\r\n};\r\n\r\nexport const transformOverviewToChatList = (overviewData, currentUserId) => { \r\n    if (!overviewData || !Array.isArray(overviewData)) {\r\n        return { groups: [], privateChatsWith: [] };\r\n    }\r\n\r\n    const chatList = {\r\n        groups: [],\r\n        privateChatsWith: [],\r\n    };\r\n\r\n    overviewData.forEach(item => {\r\n        const chatItem = {\r\n            chatId: item.chatId,\r\n            name: item.groupName || item.employeeName,\r\n            lastMessage: generateChatListPreview(item, currentUserId), \r\n            lastMessageTimestamp: item.lastSeen,\r\n            unreadMessageCount: item.unreadMessageCount,\r\n            profile: item.profile || null,\r\n            isOnline: item.isOnline,\r\n            memberCount: item.memberCount || 0,\r\n            type: item.chatType === 'GROUP' ? 'group' : 'private',\r\n        };\r\n\r\n        if (chatItem.type === 'group') {\r\n            chatList.groups.push(chatItem);\r\n        } else {\r\n            chatList.privateChatsWith.push(chatItem);\r\n        }\r\n    });\r\n\r\n    return chatList;\r\n};\r\n\r\nexport const transformMessageDTOToUIMessage = (msgDto) => {\r\n    let timestamp;\r\n    try {\r\n        if (msgDto.timestamp) {\r\n            const tsString = String(msgDto.timestamp);\r\n            timestamp = new Date(tsString.endsWith('Z') ? tsString : tsString + 'Z').toISOString();\r\n        } else if (msgDto.date && msgDto.time) {\r\n            timestamp = new Date(`${msgDto.date} ${msgDto.time} UTC`).toISOString();\r\n        } else {\r\n            timestamp = new Date().toISOString();\r\n        }\r\n    } catch (e) {\r\n        timestamp = new Date().toISOString();\r\n    }\r\n    \r\n    let messageType = 'text';\r\n    let fileUrl = msgDto.fileUrl || null;\r\n\r\n    if (msgDto.fileName) {\r\n        if (msgDto.fileType) {\r\n            if (msgDto.fileType.startsWith('image/')) messageType = 'image';\r\n            else if (msgDto.fileType.startsWith('audio/')) messageType = 'audio';\r\n            else if (msgDto.fileType.startsWith('video/')) messageType = 'video';\r\n            else messageType = 'file';\r\n        } else {\r\n            if (msgDto.fileName.match(/\\.(jpeg|jpg|gif|png|webp)$/i)) messageType = 'image';\r\n            else if (msgDto.fileName.match(/\\.(mp3|wav|ogg|m4a)$/i)) messageType = 'audio';\r\n            else if (msgDto.fileName.match(/\\.(mp4|webm|mov)$/i)) messageType = 'video';\r\n            else messageType = 'file';\r\n        }\r\n    } else if (msgDto.kind && msgDto.kind !== 'text') {\r\n        messageType = msgDto.kind.toLowerCase();\r\n    }\r\n    \r\n    const messageIdForUrl = msgDto.id || msgDto.messageId;\r\n\r\n    if (!fileUrl && ['image', 'video', 'audio', 'file'].includes(messageType) && messageIdForUrl) {\r\n        const baseUrl = chatApi.defaults.baseURL;\r\n        fileUrl = `${baseUrl}/chat/file/${messageIdForUrl}`;\r\n    }\r\n    \r\n    if (msgDto.isDeleted) {\r\n        messageType = 'deleted';\r\n    }\r\n\r\n    const finalId = msgDto.id || msgDto.messageId;\r\n    \r\n    return {\r\n        id: finalId, \r\n        messageId: finalId, \r\n        content: msgDto.content,\r\n        sender: msgDto.sender,\r\n        timestamp: timestamp,\r\n        status: (msgDto.seen === true || String(msgDto.isSeen) === 'true') ? 'seen' : 'sent',\r\n        type: messageType,\r\n        isEdited: msgDto.isEdited || false,\r\n        isPinned: msgDto.pinned || false,\r\n        fileName: msgDto.fileName || null,\r\n        fileUrl: fileUrl,\r\n        fileSize: msgDto.fileSize || null,\r\n        duration: msgDto.duration || 0,\r\n        clientId: msgDto.clientId || null,\r\n        isForwarded: msgDto.forwarded || false,\r\n        forwardedFrom: msgDto.forwardedFrom || null,\r\n        isReply: !!msgDto.replyTo,\r\n        replyTo: msgDto.replyTo ? {\r\n            sender: msgDto.replyTo.senderId,\r\n            content: msgDto.replyTo.content,\r\n            originalMessageId: msgDto.replyTo.originalMessageId,\r\n            type: msgDto.replyTo.type\r\n        } : null,\r\n    };\r\n};\r\n","import React, { useEffect, useState, useRef, useMemo, useCallback, useContext } from 'react';\r\nimport { useLocation, useNavigate } from 'react-router-dom';\r\nimport { Context } from '../HrmsContext';\r\nimport { Client } from '@stomp/stompjs';\r\nimport {\r\n    FaMicrophone, FaPaperclip, FaSmile, FaPaperPlane, FaArrowLeft, FaStop,\r\n    FaFileAlt, FaDownload, FaPlay, FaPause, FaReply, FaEdit, FaThumbtack, FaShare, FaTrash, FaTimes, FaCheck,\r\n    FaChevronDown, FaImage, FaFileAudio, FaAngleDoubleRight, FaUsers, FaUser,\r\n    FaFilePdf, FaFileWord, FaFilePowerpoint, FaFileExcel, FaFileArchive, FaChevronUp\r\n} from 'react-icons/fa';\r\nimport { BsThreeDotsVertical } from 'react-icons/bs';\r\nimport EmojiPicker from 'emoji-picker-react';\r\nimport {\r\n    chatApi,\r\n    getMessages,\r\n    deleteMessageForMe,\r\n    deleteMessageForEveryone,\r\n    uploadFile,\r\n    forwardMessage,\r\n    getPinnedMessage,\r\n    pinMessage,\r\n    unpinMessage,\r\n    clearChatHistory,\r\n    uploadVoiceMessage,\r\n    getGroupMembers,\r\n    searchMessages,\r\n    getMessageContext,\r\n    getChatAttachments,\r\n    searchChatOverview\r\n} from '../../../../services/apiService';\r\nimport { transformMessageDTOToUIMessage, generateChatListPreview, transformOverviewToChatList } from '../../../../services/dataTransformer';\r\n\r\nconst formatFileSize = (bytes) => {\r\n    if (!bytes || bytes === 0) return '0 Bytes';\r\n    const k = 1024;\r\n    const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];\r\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\r\n    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\r\n};\r\n\r\nconst FileIcon = ({ fileName, className = \"text-3xl\" }) => {\r\n    const extension = fileName?.split('.').pop()?.toLowerCase();\r\n    if (['pdf'].includes(extension)) return <FaFilePdf className={`text-red-500 ${className}`} />;\r\n    if (['doc', 'docx'].includes(extension)) return <FaFileWord className={`text-blue-700 ${className}`} />;\r\n    if (['ppt', 'pptx'].includes(extension)) return <FaFilePowerpoint className={`text-orange-500 ${className}`} />;\r\n    if (['xls', 'xlsx'].includes(extension)) return <FaFileExcel className={`text-green-600 ${className}`} />;\r\n    if (['zip', 'rar', '7z'].includes(extension)) return <FaFileArchive className={`text-yellow-500 ${className}`} />;\r\n    if (['png', 'jpg', 'jpeg', 'gif', 'webp'].includes(extension)) return <FaImage className={`text-purple-500 ${className}`} />;\r\n    if (['mp3', 'wav', 'ogg'].includes(extension)) return <FaFileAudio className={`text-pink-500 ${className}`} />;\r\n    return <FaFileAlt className={`text-gray-500 ${className}`} />;\r\n};\r\n\r\nconst FileMessage = ({ msg, isMyMessage, theme }) => {\r\n    const downloadUrl = `${chatApi.defaults.baseURL}/chat/file/${msg.messageId}`;\r\n\r\n    const content = (\r\n        <div className={`flex items-center gap-3 p-2 rounded-lg max-w-xs md:max-w-sm ${isMyMessage ? 'bg-blue-600' : (theme === 'dark' ? 'bg-gray-700' : 'bg-gray-200')}`}>\r\n            <div className=\"flex-shrink-0 p-2 bg-white/20 rounded-lg\">\r\n                <FileIcon fileName={msg.fileName} className=\"text-4xl\" />\r\n            </div>\r\n            <div className=\"flex-grow overflow-hidden mr-2\">\r\n                <p className={`font-semibold truncate ${isMyMessage ? 'text-white' : (theme === 'dark' ? 'text-white' : 'text-gray-800')}`}>{msg.fileName}</p>\r\n                <p className={`text-sm ${isMyMessage ? 'text-blue-200' : (theme === 'dark' ? 'text-gray-400' : 'text-gray-600')}`}>{formatFileSize(msg.fileSize)}</p>\r\n            </div>\r\n            <div\r\n                onClick={(e) => {\r\n                    e.preventDefault();\r\n                    e.stopPropagation();\r\n                    window.open(downloadUrl, '_blank');\r\n                }}\r\n                className=\"flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center bg-black/20 hover:bg-black/30 text-white transition-colors cursor-pointer\"\r\n            >\r\n                <FaDownload size={18} />\r\n            </div>\r\n        </div>\r\n    );\r\n    return !isMyMessage ? <div onClick={() => window.open(downloadUrl, '_blank')} className=\"cursor-pointer\">{content}</div> : content;\r\n};\r\n\r\nconst AudioPlayer = ({ src, fileUrl, isSender, initialDuration = 0, fileSize = 0, theme }) => {\r\n    const audioRef = useRef(null);\r\n    const [isPlaying, setIsPlaying] = useState(false);\r\n    const [progress, setProgress] = useState(0);\r\n    const [duration, setDuration] = useState(initialDuration);\r\n    const [localSrc, setLocalSrc] = useState(src || null);\r\n    const [isDownloading, setIsDownloading] = useState(false);\r\n\r\n    useEffect(() => {\r\n        const audio = audioRef.current;\r\n        if (!audio) return;\r\n\r\n        const setAudioData = () => {\r\n            if (audio.duration !== Infinity && audio.duration > 0) {\r\n                setDuration(audio.duration);\r\n            }\r\n        };\r\n        const setAudioTime = () => setProgress(audio.currentTime);\r\n        const handleEnded = () => setIsPlaying(false);\r\n\r\n        audio.addEventListener('loadedmetadata', setAudioData);\r\n        audio.addEventListener('timeupdate', setAudioTime);\r\n        audio.addEventListener('ended', handleEnded);\r\n\r\n        return () => {\r\n            audio.removeEventListener('loadedmetadata', setAudioData);\r\n            audio.removeEventListener('timeupdate', setAudioTime);\r\n            audio.removeEventListener('ended', handleEnded);\r\n        };\r\n    }, [localSrc]);\r\n\r\n    const handleDownload = async () => {\r\n        if (isDownloading) return;\r\n        setIsDownloading(true);\r\n        try {\r\n            const response = await fetch(fileUrl);\r\n            const blob = await response.blob();\r\n            const localUrl = URL.createObjectURL(blob);\r\n            setLocalSrc(localUrl);\r\n        } catch (error) {\r\n            console.error(\"Failed to download audio:\", error);\r\n        } finally {\r\n            setIsDownloading(false);\r\n        }\r\n    };\r\n\r\n    const togglePlayPause = () => {\r\n        if (!audioRef.current) return;\r\n        if (isPlaying) {\r\n            audioRef.current.pause();\r\n        } else {\r\n            audioRef.current.play().catch(e => console.error(\"Audio play failed:\", e));\r\n        }\r\n        setIsPlaying(!isPlaying);\r\n    };\r\n\r\n    const formatTime = (time) => {\r\n        if (!time || time === Infinity) return '0:00';\r\n        const minutes = Math.floor(time / 60);\r\n        const seconds = Math.floor(time % 60);\r\n        return `${minutes}:${seconds.toString().padStart(2, '0')}`;\r\n    };\r\n\r\n    const progressPercentage = duration ? (progress / duration) * 100 : 0;\r\n\r\n    if (!localSrc) {\r\n        return (\r\n            <div className=\"flex items-center gap-3 p-2 w-64\">\r\n                {isDownloading ? (\r\n                    <div className=\"flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center bg-gray-400 bg-opacity-30\">\r\n                        <div className=\"animate-spin rounded-full h-5 w-5 border-b-2 border-white\"></div>\r\n                    </div>\r\n                ) : (\r\n                    <button onClick={handleDownload} className=\"flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center bg-gray-400 bg-opacity-30 text-white hover:bg-opacity-40 transition-colors\">\r\n                        <FaDownload size={16} />\r\n                    </button>\r\n                )}\r\n                <div className=\"flex-grow flex flex-col justify-center\">\r\n                    <p className={`text-sm ${isSender ? 'text-white' : (theme === 'dark' ? 'text-white' : 'text-gray-700')}`}>Voice Message</p>\r\n                    <div className=\"flex justify-between items-center mt-1\">\r\n                        <span className={`text-xs ${isSender ? 'text-blue-200' : (theme === 'dark' ? 'text-gray-400' : 'text-gray-500')}`}>{formatFileSize(fileSize)}</span>\r\n                        <span className={`text-xs ${isSender ? 'text-blue-200' : (theme === 'dark' ? 'text-gray-400' : 'text-gray-500')}`}>{formatTime(duration)}</span>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n    return (\r\n        <div className=\"flex items-center gap-3 p-2 w-64\">\r\n            <audio ref={audioRef} src={localSrc} preload=\"metadata\" />\r\n            <button onClick={togglePlayPause} className={`flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center ${isSender ? 'bg-white text-blue-600' : (theme === 'dark' ? 'bg-gray-400 bg-opacity-30 text-white' : 'bg-gray-400 bg-opacity-30 text-white')}`}>\r\n                {isPlaying ? <FaPause size={16} /> : <FaPlay size={16} className=\"ml-1\" />}\r\n            </button>\r\n            <div className=\"flex-grow flex flex-col justify-center\">\r\n                <div className=\"w-full h-1.5 bg-black/20 rounded-full cursor-pointer\" onClick={(e) => {\r\n                    if (!duration) return;\r\n                    const rect = e.currentTarget.getBoundingClientRect();\r\n                    const clickX = e.clientX - rect.left;\r\n                    const newTime = (clickX / rect.width) * duration;\r\n                    if (audioRef.current) audioRef.current.currentTime = newTime;\r\n                }}>\r\n                    <div style={{ width: `${progressPercentage}%` }} className={`h-full rounded-full ${isSender ? 'bg-white' : (theme === 'dark' ? 'bg-gray-300' : 'bg-gray-300')}`}></div>\r\n                </div>\r\n                <span className={`text-xs self-end mt-1 ${isSender ? 'text-blue-200' : (theme === 'dark' ? 'text-gray-400' : 'text-gray-500')}`}>{formatTime(duration)}</span>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\nconst MessageSkeleton = ({ theme }) => (\r\n    <div className=\"space-y-4 p-4\">\r\n        <div className=\"flex items-end gap-2 justify-start\">\r\n            <div className={`w-8 h-8 rounded-full ${theme === 'dark' ? 'bg-gray-700' : 'bg-gray-200'} animate-pulse flex-shrink-0`}></div>\r\n            <div className={`h-10 rounded-lg ${theme === 'dark' ? 'bg-gray-700' : 'bg-gray-200'} animate-pulse w-48`}></div>\r\n        </div>\r\n        <div className=\"flex items-end gap-2 justify-end\">\r\n            <div className={`h-12 rounded-lg ${theme === 'dark' ? 'bg-blue-700' : 'bg-blue-200'} animate-pulse w-32`}></div>\r\n            <div className={`w-8 h-8 rounded-full ${theme === 'dark' ? 'bg-gray-700' : 'bg-gray-200'} animate-pulse flex-shrink-0`}></div>\r\n        </div>\r\n        <div className=\"flex items-end gap-2 justify-start\">\r\n            <div className={`w-8 h-8 rounded-full ${theme === 'dark' ? 'bg-gray-700' : 'bg-gray-200'} animate-pulse flex-shrink-0`}></div>\r\n            <div className={`h-16 rounded-lg ${theme === 'dark' ? 'bg-gray-700' : 'bg-gray-200'} animate-pulse w-64`}></div>\r\n        </div>\r\n        <div className=\"flex items-end gap-2 justify-end\">\r\n            <div className={`h-10 rounded-lg ${theme === 'dark' ? 'bg-blue-700' : 'bg-blue-200'} animate-pulse w-40`}></div>\r\n            <div className={`w-8 h-8 rounded-full ${theme === 'dark' ? 'bg-gray-700' : 'bg-gray-200'} animate-pulse flex-shrink-0`}></div>\r\n        </div>\r\n        <div className=\"flex items-end gap-2 justify-start\">\r\n            <div className={`w-8 h-8 rounded-full ${theme === 'dark' ? 'bg-gray-700' : 'bg-gray-200'} animate-pulse flex-shrink-0`}></div>\r\n            <div className={`h-10 rounded-lg ${theme === 'dark' ? 'bg-gray-700' : 'bg-gray-200'} animate-pulse w-32`}></div>\r\n        </div>\r\n    </div>\r\n);\r\n\r\nconst getAudioDuration = (audioBlob) =>\r\n    new Promise((resolve) => {\r\n        const reader = new FileReader();\r\n\r\n        reader.onload = (event) => {\r\n            const audioContext = new (window.AudioContext || window.webkitAudioContext)();\r\n            audioContext.decodeAudioData(event.target.result,\r\n                (buffer) => {\r\n                    const duration = buffer.duration ? Math.round(buffer.duration) : 0;\r\n                    audioContext.close();\r\n                    resolve(duration);\r\n                },\r\n                (error) => {\r\n                    console.error(\"Error decoding audio data:\", error);\r\n                    audioContext.close();\r\n                    resolve(0);\r\n                }\r\n            );\r\n        };\r\n\r\n        reader.onerror = (error) => {\r\n            console.error(\"Error reading blob as ArrayBuffer:\", error);\r\n            resolve(0);\r\n        };\r\n\r\n        reader.readAsArrayBuffer(audioBlob);\r\n    });\r\n\r\nconst ContactProfileModal = ({ chat, onClose, theme }) => {\r\n    const [isZoomed, setIsZoomed] = useState(false);\r\n\r\n    if (isZoomed && chat.type === 'private') {\r\n        return (\r\n            <div\r\n                className=\"fixed inset-0 bg-black bg-opacity-90 flex justify-center items-center z-[120]\"\r\n                onClick={() => setIsZoomed(false)}\r\n            >\r\n                <img\r\n                    src={chat?.profile}\r\n                    alt={chat?.name}\r\n                    className=\"max-w-[90vw] max-h-[90vh] object-contain\"\r\n                />\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div\r\n            className=\"fixed inset-0 bg-black/30 backdrop-blur-sm flex justify-center items-center z-[110] md:hidden\"\r\n            onClick={onClose}\r\n        >\r\n            <div\r\n                className=\"relative w-11/12 max-w-xs cursor-pointer\"\r\n                onClick={(e) => {\r\n                    e.stopPropagation();\r\n                    if (chat.type === 'private') setIsZoomed(true);\r\n                }}\r\n            >\r\n                {chat.type === 'group' ? (\r\n                    <div className=\"w-full aspect-square bg-gray-700 rounded-lg shadow-lg flex items-center justify-center\">\r\n                        <FaUsers className=\"text-gray-400\" size={120} />\r\n                    </div>\r\n                ) : (\r\n                    <img\r\n                        src={chat?.profile}\r\n                        alt={chat?.name}\r\n                        className=\"w-full aspect-square object-cover rounded-lg shadow-lg\"\r\n                    />\r\n                )}\r\n                <div className=\"absolute bottom-0 left-0 right-0 p-3 bg-gradient-to-t from-black/80 to-transparent rounded-b-lg\">\r\n                    <h3 className=\"text-xl font-bold text-white text-center truncate\">{chat?.name}</h3>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nfunction ChatApplication({ currentUser, chats: initialChats, loadMoreChats, hasMore, isFetchingMore, theme }) {\r\n    const location = useLocation();\r\n    const navigate = useNavigate();\r\n    const [chatData, setChatData] = useState({ groups: [], privateChatsWith: [] });\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n    const [selectedChat, setSelectedChat] = useState(null);\r\n    const [message, setMessage] = useState('');\r\n    const [messages, setMessages] = useState({});\r\n    const [isMessagesLoading, setIsMessagesLoading] = useState(false);\r\n    const [isChatOpen, setIsChatOpen] = useState(false);\r\n    const [showEmojiPicker, setShowEmojiPicker] = useState(false);\r\n    const [isRecording, setIsRecording] = useState(false);\r\n    const [showChatMenu, setShowChatMenu] = useState(false);\r\n    const [downloadedMedia, setDownloadedMedia] = useState({});\r\n    const [contextMenu, setContextMenu] = useState({ visible: false, x: 0, y: 0, message: null, index: null });\r\n    const [editingInfo, setEditingInfo] = useState({ index: null, originalContent: '' });\r\n    const [replyingTo, setReplyingTo] = useState(null);\r\n    const [lastDeleted, setLastDeleted] = useState(null);\r\n    const [pinnedMessage, setPinnedMessage] = useState(null);\r\n    const [forwardingInfo, setForwardingInfo] = useState({ visible: false, message: null });\r\n    const [forwardRecipients, setForwardRecipients] = useState([]);\r\n    const [forwardSearchTerm, setForwardSearchTerm] = useState('');\r\n    const [showPinnedMenu, setShowPinnedMenu] = useState(false);\r\n    const [isProfileModalOpen, setIsProfileModalOpen] = useState(false);\r\n    const [isGroupInfoModalOpen, setIsGroupInfoModalOpen] = useState(false);\r\n    const [activeGroupInfoTab, setActiveGroupInfoTab] = useState('Overview');\r\n    const [groupMembers, setGroupMembers] = useState([]);\r\n    const [isGroupDataLoading, setIsGroupDataLoading] = useState(false);\r\n    const [groupMembersCache, setGroupMembersCache] = useState({});\r\n    const [imageInView, setImageInView] = useState(null);\r\n    const [isChatDataReady, setIsChatDataReady] = useState(false);\r\n    const [isConnected, setIsConnected] = useState(false);\r\n    const [showClearConfirm, setShowClearConfirm] = useState(false);\r\n    const [typingUsers, setTypingUsers] = useState({});\r\n    const [messagePages, setMessagePages] = useState({});\r\n    const [hasMoreMessages, setHasMoreMessages] = useState({});\r\n    const [isFetchingMoreMessages, setIsFetchingMoreMessages] = useState(false);\r\n    const [showScrollToBottom, setShowScrollToBottom] = useState(false);\r\n    const [newMessagesCount, setNewMessagesCount] = useState(0);\r\n    const [viewingProfile, setViewingProfile] = useState(null);\r\n    const [searchChatResults, setSearchChatResults] = useState(null);\r\n    const [isSearching, setIsSearching] = useState(false);\r\n    const [groupMedia, setGroupMedia] = useState([]);\r\n    const [groupFiles, setGroupFiles] = useState([]);\r\n    const [groupLinks, setGroupLinks] = useState([]);\r\n    const [isAttachmentLoading, setIsAttachmentLoading] = useState(false);\r\n    const [isSearchVisible, setIsSearchVisible] = useState(false);\r\n    const [searchQuery, setSearchQuery] = useState('');\r\n    const [searchResults, setSearchResults] = useState([]);\r\n    const [currentResultIndex, setCurrentResultIndex] = useState(-1);\r\n    const { setIsChatWindowVisible, setChatUnreadCount } = useContext(Context);\r\n\r\n    useEffect(() => {\r\n        if (setIsChatWindowVisible) {\r\n            setIsChatWindowVisible(isChatOpen);\r\n        }\r\n    }, [isChatOpen, setIsChatWindowVisible]);\r\n\r\n    const sidebarScrollRef = useRef(null);\r\n    const chatContainerRef = useRef(null);\r\n    const stompClient = useRef(null);\r\n    const typingTimeoutRef = useRef({});\r\n    const fileInputRef = useRef(null);\r\n    const mediaRecorderRef = useRef(null);\r\n    const audioChunksRef = useRef([]);\r\n    const streamRef = useRef(null);\r\n    const emojiPickerRef = useRef(null);\r\n    const emojiButtonRef = useRef(null);\r\n    const chatMenuRef = useRef(null);\r\n    const chatMenuButtonRef = useRef(null);\r\n    const contextMenuRef = useRef(null);\r\n    const messageInputRef = useRef(null);\r\n    const isManuallyClosing = useRef(false);\r\n    const pinnedMenuRef = useRef(null);\r\n    const pinnedMenuButtonRef = useRef(null);\r\n    const onMessageReceivedRef = useRef(null);\r\n    const isFetchingOldMessages = useRef(false);\r\n    const subscriptions = useRef({});\r\n\r\n    const chatIdFromUrl = useMemo(() => {\r\n        if (location.pathname.includes('/with')) {\r\n            const params = new URLSearchParams(location.search);\r\n            return params.get('id');\r\n        }\r\n        return null;\r\n    }, [location.pathname, location.search]);\r\n\r\n    const handleSearchChange = (e) => {\r\n        setSearchQuery(e.target.value);\r\n    };\r\n\r\n    useEffect(() => {\r\n        if (searchQuery.trim() === '') {\r\n            setSearchResults([]);\r\n            setCurrentResultIndex(-1);\r\n            return;\r\n        }\r\n\r\n        const timerId = setTimeout(() => {\r\n            if (selectedChat) {\r\n                searchMessages(currentUser.id, selectedChat.chatId, searchQuery).then(results => {\r\n                    setSearchResults(results);\r\n                    setCurrentResultIndex(results.length > 0 ? 0 : -1);\r\n                });\r\n            }\r\n        }, 500);\r\n\r\n        return () => clearTimeout(timerId);\r\n    }, [searchQuery, selectedChat, currentUser.id]);\r\n\r\n    const handleNextResult = () => {\r\n        if (currentResultIndex < searchResults.length - 1) {\r\n            setCurrentResultIndex(prev => prev + 1);\r\n        }\r\n    };\r\n\r\n    const handlePrevResult = () => {\r\n        if (currentResultIndex > 0) {\r\n            setCurrentResultIndex(prev => prev - 1);\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        if (currentResultIndex !== -1 && searchResults[currentResultIndex]) {\r\n            const messageId = searchResults[currentResultIndex].messageId;\r\n            const messageElement = document.getElementById(`msg-${messageId}`);\r\n            if (messageElement) {\r\n                messageElement.scrollIntoView({ behavior: 'smooth', block: 'center' });\r\n            }\r\n        }\r\n    }, [currentResultIndex, searchResults]);\r\n\r\n    const handleJumpToMessage = async (message) => {\r\n        setIsSearchVisible(false);\r\n        setSearchQuery('');\r\n        setSearchResults([]);\r\n\r\n        const contextMessagesRaw = await getMessageContext(message.messageId, currentUser.id, selectedChat.chatId);\r\n        if (contextMessagesRaw && contextMessagesRaw.length > 0) {\r\n            const transformedContext = contextMessagesRaw.map(transformMessageDTOToUIMessage);\r\n\r\n            setMessages(prev => ({\r\n                ...prev,\r\n                [selectedChat.chatId]: transformedContext\r\n            }));\r\n\r\n            setTimeout(() => {\r\n                const element = document.getElementById(`msg-${message.messageId}`);\r\n                if (element) {\r\n                    element.scrollIntoView({ behavior: 'smooth', block: 'center' });\r\n                    element.classList.add('bg-blue-200', 'transition-all', 'duration-1000');\r\n                    setTimeout(() => {\r\n                        element.classList.remove('bg-blue-200');\r\n                    }, 2000);\r\n                }\r\n            }, 100);\r\n        }\r\n    };\r\n\r\n    const handleSidebarScroll = () => {\r\n        const container = sidebarScrollRef.current;\r\n        if (container) {\r\n            const { scrollTop, scrollHeight, clientHeight } = container;\r\n            if (scrollHeight - scrollTop - clientHeight < 100) {\r\n                console.log(`Scroll condition met. isFetchingMore: ${isFetchingMore}, hasMore: ${hasMore}`);\r\n                if (hasMore && !isFetchingMore) {\r\n                    loadMoreChats();\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    const handleChatScroll = () => {\r\n        const container = chatContainerRef.current;\r\n        if (!container) return;\r\n\r\n        const { scrollTop, scrollHeight, clientHeight } = container;\r\n\r\n        if (scrollTop === 0 && !isMessagesLoading && !isFetchingMoreMessages) {\r\n            const chatId = selectedChat.chatId;\r\n            if (hasMoreMessages[chatId] !== false) {\r\n                const nextPage = (messagePages[chatId] || 0) + 1;\r\n                setMessagePages(prev => ({ ...prev, [chatId]: nextPage }));\r\n                loadMoreMessages(chatId, nextPage);\r\n            }\r\n        }\r\n\r\n        const isScrolledUp = scrollHeight - scrollTop - clientHeight > 200;\r\n        if (isScrolledUp !== showScrollToBottom) {\r\n            setShowScrollToBottom(isScrolledUp);\r\n            if (!isScrolledUp) {\r\n                setNewMessagesCount(0);\r\n            }\r\n        }\r\n    };\r\n\r\n    const scrollToBottom = (behavior = 'smooth') => {\r\n        if (chatContainerRef.current) {\r\n            chatContainerRef.current.scrollTo({\r\n                top: chatContainerRef.current.scrollHeight,\r\n                behavior: behavior\r\n            });\r\n        }\r\n        setNewMessagesCount(0);\r\n    };\r\n\r\n    useEffect(() => {\r\n        if (searchTerm.trim() === '') {\r\n            setSearchChatResults(null);\r\n            setIsSearching(false);\r\n            return;\r\n        }\r\n\r\n        setIsSearching(true);\r\n        const debounceTimer = setTimeout(() => {\r\n            searchChatOverview(currentUser.id, searchTerm)\r\n                .then(rawResults => {\r\n                    const formattedResults = transformOverviewToChatList(rawResults, currentUser.id);\r\n                    const combinedResults = [...formattedResults.privateChatsWith, ...formattedResults.groups]\r\n                        .sort((a, b) => new Date(b.lastMessageTimestamp) - new Date(a.lastMessageTimestamp));\r\n                    setSearchChatResults(combinedResults);\r\n                })\r\n                .finally(() => setIsSearching(false));\r\n        }, 300);\r\n\r\n        return () => clearTimeout(debounceTimer);\r\n    }, [searchTerm, currentUser.id]);\r\n\r\n    useEffect(() => {\r\n        if (initialChats) {\r\n            const correctedChats = {\r\n                groups: initialChats.groups.map(chat =>\r\n                    chat.chatId.toString() === chatIdFromUrl\r\n                        ? { ...chat, unreadMessageCount: 0 }\r\n                        : chat\r\n                ),\r\n                privateChatsWith: initialChats.privateChatsWith.map(chat =>\r\n                    chat.chatId.toString() === chatIdFromUrl\r\n                        ? { ...chat, unreadMessageCount: 0 }\r\n                        : chat\r\n                ),\r\n            };\r\n            setChatData(correctedChats);\r\n            setIsChatDataReady(true);\r\n        }\r\n    }, [initialChats, chatIdFromUrl]);\r\n\r\n    const loadMoreMessages = useCallback(async (chatId, pageNum) => {\r\n        if ((pageNum > 0 && isFetchingMoreMessages) || (pageNum === 0 && isMessagesLoading)) {\r\n            return;\r\n        }\r\n\r\n        if (pageNum > 0) {\r\n            setIsFetchingMoreMessages(true);\r\n            isFetchingOldMessages.current = true;\r\n        } else {\r\n            setIsMessagesLoading(true);\r\n        }\r\n\r\n        try {\r\n            const rawMessages = await getMessages(currentUser.id, chatId, pageNum, 15);\r\n            console.log(\"%c REFRESH (API) RAW DATA:\", \"color: red; font-weight: bold;\", rawMessages);\r\n\r\n            if (rawMessages.length === 0) {\r\n                setHasMoreMessages(prev => ({ ...prev, [chatId]: false }));\r\n                return;\r\n            }\r\n\r\n            const transformedMessages = rawMessages.map(transformMessageDTOToUIMessage);\r\n\r\n            const chatContainer = chatContainerRef.current;\r\n            const previousScrollHeight = chatContainer ? chatContainer.scrollHeight : 0;\r\n            const previousScrollTop = chatContainer ? chatContainer.scrollTop : 0;\r\n\r\n            setMessages(prev => ({\r\n                ...prev,\r\n                [chatId]: pageNum === 0\r\n                    ? transformedMessages\r\n                    : [...transformedMessages, ...(prev[chatId] || [])]\r\n            }));\r\n\r\n            if (pageNum > 0) {\r\n                requestAnimationFrame(() => {\r\n                    if (chatContainer) {\r\n                        chatContainer.scrollTop = (chatContainer.scrollHeight - previousScrollHeight) + previousScrollTop;\r\n                    }\r\n                });\r\n            }\r\n\r\n            if (rawMessages.length === 0) {\r\n                setHasMoreMessages(prev => ({ ...prev, [chatId]: false }));\r\n            }\r\n\r\n        } catch (error) {\r\n            console.error(`Failed to load messages for chat ${chatId}:`, error);\r\n        } finally {\r\n            if (pageNum > 0) {\r\n                setIsFetchingMoreMessages(false);\r\n                setTimeout(() => { isFetchingOldMessages.current = false; }, 100);\r\n            } else {\r\n                setIsMessagesLoading(false);\r\n            }\r\n        }\r\n    }, [currentUser.id, isFetchingMoreMessages, isMessagesLoading, getMessages]);\r\n    useEffect(() => {\r\n        if (!selectedChat) return;\r\n\r\n        const chatId = selectedChat.chatId;\r\n\r\n        setMessagePages(prev => ({ ...prev, [chatId]: 0 }));\r\n        setHasMoreMessages(prev => ({ ...prev, [chatId]: true }));\r\n        setMessages(prev => ({ ...prev, [chatId]: [] }));\r\n\r\n        loadMoreMessages(chatId, 0);\r\n\r\n        const fetchPinnedMessage = async () => {\r\n            try {\r\n                const pinnedMsgData = await getPinnedMessage(chatId, selectedChat.type, currentUser.id);\r\n                setPinnedMessage(pinnedMsgData);\r\n            } catch (error) {\r\n                console.error(\"Failed to fetch pinned message:\", error);\r\n                setPinnedMessage(null);\r\n            }\r\n        };\r\n        fetchPinnedMessage();\r\n\r\n    }, [selectedChat, currentUser.id]);\r\n\r\n    const updateLastMessage = useCallback((chatId, message) => {\r\n        setChatData(prev => {\r\n            const updateChat = (chat) => {\r\n                if (chat.chatId === chatId) {\r\n                    const isNewUnread = message && message.type !== 'deleted' && !message.isDeleted && message.sender !== currentUser.id && selectedChat?.chatId !== chatId;\r\n\r\n                    const overviewItem = {\r\n                        lastMessage: message ? (message.fileName || message.content) : '',\r\n                        lastMessageType: message ? message.type.toUpperCase() : null,\r\n                        lastMessageSenderId: message ? message.sender : null\r\n                    };\r\n\r\n                    return {\r\n                        ...chat,\r\n                        lastMessage: message ? generateChatListPreview(overviewItem, currentUser.id) : 'Chat cleared',\r\n                        lastMessageTimestamp: message?.timestamp || new Date(0).toISOString(),\r\n                        unreadMessageCount: (chat.unreadMessageCount || 0) + (isNewUnread ? 1 : 0)\r\n                    };\r\n                }\r\n                return chat;\r\n            };\r\n\r\n            const newGroups = prev.groups.map(updateChat);\r\n            const newPrivate = prev.privateChatsWith.map(updateChat);\r\n\r\n            return { groups: newGroups, privateChatsWith: newPrivate };\r\n        });\r\n    }, [currentUser.id, selectedChat]);\r\n\r\n    const onMessageReceived = useCallback((payload) => {\r\n        const container = chatContainerRef.current;\r\n        const shouldScrollOnReceive = container\r\n            ? (container.scrollHeight - container.scrollTop - container.clientHeight) < 300\r\n            : true;\r\n\r\n        const parsedData = JSON.parse(payload.body);\r\n        console.log(\"%c LIVE MSG (WebSocket) RAW DATA:\", \"color: green; font-weight: bold;\", parsedData);\r\n        console.log(\"Received WebSocket Message:\", parsedData);\r\n\r\n        if (parsedData.type === 'STATUS_UPDATE') {\r\n            const { status, chatId, messageIds } = parsedData;\r\n\r\n            setMessages(prevMessages => {\r\n                const chatKey = selectedChat?.type === 'group' ? parsedData.groupId : chatId;\r\n                const chatMessages = prevMessages[chatKey] || [];\r\n                const newStatus = status.toLowerCase();\r\n\r\n                const updatedMessages = chatMessages.map(msg => {\r\n                    if (messageIds.includes(msg.messageId)) {\r\n                        if (newStatus === 'seen') {\r\n                            return { ...msg, status: 'seen' };\r\n                        }\r\n                        if (newStatus === 'delivered' && msg.status === 'sent') {\r\n                            return { ...msg, status: 'delivered' };\r\n                        }\r\n                    }\r\n                    return msg;\r\n                });\r\n                return { ...prevMessages, [chatKey]: updatedMessages };\r\n            });\r\n            return;\r\n        }\r\n\r\n\r\n        if (parsedData.type === 'PIN_UPDATE') {\r\n            const pinnedDto = parsedData.payload;\r\n            const eventChatId = pinnedDto.groupId || (pinnedDto.sender === currentUser.id ? pinnedDto.receiver : pinnedDto.sender);\r\n\r\n            if (selectedChat?.chatId === eventChatId) {\r\n                setPinnedMessage(pinnedDto);\r\n            }\r\n            return;\r\n\r\n        } else if (parsedData.type === 'UNPIN_UPDATE') {\r\n            const unpinPayload = parsedData.payload;\r\n\r\n            let eventChatId;\r\n            if (selectedChat.type === 'group') {\r\n                eventChatId = unpinPayload.groupId;\r\n            } else {\r\n                eventChatId = unpinPayload.senderId === currentUser.id\r\n                    ? unpinPayload.receiverId\r\n                    : unpinPayload.senderId;\r\n            }\r\n            if (selectedChat?.chatId === eventChatId) {\r\n                setPinnedMessage(null);\r\n            }\r\n            return;\r\n        }\r\n\r\n        const receivedMessage = parsedData;\r\n        const messageChatId = receivedMessage.groupId || (receivedMessage.sender === currentUser.id ? receivedMessage.receiver : receivedMessage.sender);\r\n\r\n        if (!messageChatId) {\r\n            console.warn(\"Received message without a clear chat ID\", receivedMessage);\r\n            return;\r\n        }\r\n\r\n        if (receivedMessage.isDeleted || receivedMessage.type === 'deleted') {\r\n            setMessages(prevMessages => {\r\n                const chatMessages = prevMessages[messageChatId] || [];\r\n                let wasLastMessage = false;\r\n\r\n                if (chatMessages.length > 0) {\r\n                    const lastMessage = chatMessages[chatMessages.length - 1];\r\n                    wasLastMessage = lastMessage.messageId === receivedMessage.messageId || lastMessage.id === receivedMessage.messageId;\r\n                }\r\n\r\n                const updatedMessages = chatMessages.map(msg => {\r\n                    if (msg.messageId === receivedMessage.messageId || msg.id === receivedMessage.messageId) {\r\n                        return { ...msg, type: 'deleted', content: 'This message was deleted', fileName: null, fileSize: null, isDeleted: true };\r\n                    }\r\n                    return msg;\r\n                });\r\n\r\n                if (wasLastMessage) {\r\n                    const newLastMessage = updatedMessages.length > 0 ? updatedMessages[updatedMessages.length - 1] : null;\r\n                    updateLastMessage(messageChatId, newLastMessage);\r\n                }\r\n\r\n                return { ...prevMessages, [messageChatId]: updatedMessages };\r\n            });\r\n            return;\r\n        }\r\n\r\n        if (receivedMessage.isEdited) {\r\n            setMessages(prevMessages => {\r\n                const chatMessages = prevMessages[messageChatId] || [];\r\n\r\n                const updatedMessages = chatMessages.map(msg => {\r\n                    if (msg.messageId === receivedMessage.id || msg.messageId === receivedMessage.messageId) {\r\n                        const updatedMsg = {\r\n                            ...msg,\r\n                            content: receivedMessage.content,\r\n                            isEdited: true\r\n                        };\r\n\r\n                        if (chatMessages.length > 0 && chatMessages[chatMessages.length - 1].messageId === msg.messageId) {\r\n                            updateLastMessage(messageChatId, updatedMsg);\r\n                        }\r\n\r\n                        return updatedMsg;\r\n                    }\r\n\r\n                    return msg;\r\n                });\r\n\r\n                return { ...prevMessages, [messageChatId]: updatedMessages };\r\n            });\r\n            return;\r\n        }\r\n\r\n        const transformedForEditCheck = transformMessageDTOToUIMessage(receivedMessage);\r\n\r\n        setMessages(prevMessages => {\r\n            const chatMessages = prevMessages[messageChatId] || [];\r\n            const finalServerId = receivedMessage.messageId || receivedMessage.id;\r\n\r\n            const messageAlreadyExists = chatMessages.some(m => m.messageId === finalServerId && m.status === 'sent');\r\n            if (messageAlreadyExists) {\r\n                return prevMessages;\r\n            }\r\n\r\n            let newChatMessages = [...chatMessages];\r\n            let messageProcessed = false;\r\n            let finalMessageForUpdate = null;\r\n\r\n            const isProperAck = receivedMessage.sender === currentUser.id && receivedMessage.client_id;\r\n            const isBroadcastOfOwnMessage = receivedMessage.sender === currentUser.id && !receivedMessage.client_id;\r\n            const isIncoming = receivedMessage.sender !== currentUser.id;\r\n\r\n            if (isProperAck) {\r\n                const optimisticIndex = newChatMessages.findIndex(m => m.id === receivedMessage.client_id);\r\n                if (optimisticIndex > -1) {\r\n                    const transformedServerMessage = transformMessageDTOToUIMessage(receivedMessage);\r\n                    newChatMessages[optimisticIndex] = { ...newChatMessages[optimisticIndex], ...transformedServerMessage, status: 'sent' };\r\n                    finalMessageForUpdate = newChatMessages[optimisticIndex];\r\n                    messageProcessed = true;\r\n                }\r\n            } else if (isBroadcastOfOwnMessage) {\r\n                const optimisticIndex = newChatMessages.findLastIndex(m => m.status === 'sending' && m.sender === currentUser.id);\r\n                if (optimisticIndex > -1) {\r\n                    const transformedServerMessage = transformMessageDTOToUIMessage(receivedMessage);\r\n                    newChatMessages[optimisticIndex] = { ...newChatMessages[optimisticIndex], ...transformedServerMessage, status: 'sent' };\r\n                    finalMessageForUpdate = newChatMessages[optimisticIndex];\r\n                    messageProcessed = true;\r\n                } else if (!chatMessages.some(m => m.messageId === finalServerId)) {\r\n                    const finalMessage = transformMessageDTOToUIMessage(receivedMessage);\r\n                    newChatMessages.push(finalMessage);\r\n                    finalMessageForUpdate = finalMessage;\r\n                    messageProcessed = true;\r\n                }\r\n            } else if (isIncoming) {\r\n                if (!chatMessages.some(m => m.messageId === finalServerId)) {\r\n                    const finalMessage = transformMessageDTOToUIMessage(receivedMessage);\r\n                    newChatMessages.push(finalMessage);\r\n                    finalMessageForUpdate = finalMessage;\r\n                    messageProcessed = true;\r\n\r\n                    if (showScrollToBottom) {\r\n                        setNewMessagesCount(prevCount => prevCount + 1);\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (messageProcessed) {\r\n                updateLastMessage(messageChatId, finalMessageForUpdate);\r\n                return { ...prevMessages, [messageChatId]: newChatMessages };\r\n            }\r\n\r\n            return prevMessages;\r\n        });\r\n        const isIncoming = parsedData.sender !== currentUser.id && !parsedData.isEdited && !parsedData.isDeleted && parsedData.type !== 'deleted';\r\n        if (isIncoming && shouldScrollOnReceive) {\r\n            setTimeout(() => scrollToBottom('smooth'), 100);\r\n        }\r\n    }, [currentUser.id, updateLastMessage, selectedChat, showScrollToBottom]);\r\n\r\n    const allChats = useMemo(() => [\r\n        ...chatData.privateChatsWith.filter(user => user.chatId !== currentUser?.id),\r\n        ...chatData.groups,\r\n    ].sort((a, b) => new Date(b.lastMessageTimestamp) - new Date(a.lastMessageTimestamp)), [chatData, currentUser.id]);\r\n\r\n    useEffect(() => {\r\n        const totalUnread = allChats.reduce((acc, chat) => acc + (chat.unreadMessageCount || 0), 0);\r\n        setChatUnreadCount(totalUnread);\r\n    }, [allChats, setChatUnreadCount]);\r\n\r\n    const handleTypingEvent = useCallback((payload) => {\r\n        const typingUpdate = JSON.parse(payload.body);\r\n\r\n        if (typingUpdate.senderId === currentUser.id) return;\r\n\r\n        const chatIdKey = typingUpdate.type === 'TEAM' ? typingUpdate.groupId : typingUpdate.senderId;\r\n        if (!chatIdKey) return;\r\n        const senderChatInfo = allChats.find(c => c.chatId === typingUpdate.senderId);\r\n        const senderName = senderChatInfo?.name || 'Someone';\r\n\r\n        setTypingUsers(prev => {\r\n            const newTypingUsers = { ...prev };\r\n\r\n            if (typingTimeoutRef.current[chatIdKey]) {\r\n                clearTimeout(typingTimeoutRef.current[chatIdKey]);\r\n            }\r\n\r\n            if (typingUpdate.typing) {\r\n                newTypingUsers[chatIdKey] = `${senderName} is typing...`;\r\n                typingTimeoutRef.current[chatIdKey] = setTimeout(() => {\r\n                    setTypingUsers(p => {\r\n                        const updated = { ...p };\r\n                        delete updated[chatIdKey];\r\n                        return updated;\r\n                    });\r\n                }, 3000);\r\n\r\n            } else {\r\n                delete newTypingUsers[chatIdKey];\r\n            }\r\n            return newTypingUsers;\r\n        });\r\n    }, [currentUser.id, allChats]);\r\n\r\n    const onSidebarUpdate = useCallback((payload) => {\r\n        const updatedChatList = JSON.parse(payload.body);\r\n        const { privateChatsWith: updatedPrivate, groups: updatedGroups } = transformOverviewToChatList(updatedChatList, currentUser.id);\r\n\r\n        setChatData(prev => ({\r\n            ...prev,\r\n            privateChatsWith: prev.privateChatsWith.map(pc => {\r\n                const update = updatedPrivate.find(upc => upc.chatId === pc.chatId);\r\n                return update ? { ...pc, ...update } : pc;\r\n            }),\r\n            groups: prev.groups.map(g => {\r\n                const update = updatedGroups.find(ug => ug.chatId === g.chatId);\r\n                return update ? { ...g, ...update } : g;\r\n            })\r\n        }));\r\n    }, [currentUser.id]);\r\n\r\n    useEffect(() => {\r\n        onMessageReceivedRef.current = onMessageReceived;\r\n    });\r\n\r\n    useEffect(() => {\r\n        if (!isMessagesLoading && chatContainerRef.current) {\r\n            scrollToBottom('auto');\r\n        }\r\n    }, [isMessagesLoading, selectedChat]);\r\n\r\n    useEffect(() => {\r\n        if (!currentUser?.id || !isChatDataReady) return;\r\n\r\n        if (stompClient.current) {\r\n            return;\r\n        }\r\n\r\n        const token = localStorage.getItem('accessToken');\r\n        const brokerURL = `wss://hrms.anasolconsultancyservices.com/api/chat?employeeId=${currentUser.id}&token=${token}`;\r\n        const client = new Client({\r\n            brokerURL,\r\n            reconnectDelay: 5000,\r\n            onConnect: () => {\r\n                setIsConnected(true);\r\n                const messageHandler = (payload) => {\r\n                    if (onMessageReceivedRef.current) {\r\n                        onMessageReceivedRef.current(payload);\r\n                    }\r\n                };\r\n\r\n                const presenceHandler = (payload) => {\r\n                    const statusUpdate = JSON.parse(payload.body);\r\n                    if (statusUpdate.userId === currentUser.id) return;\r\n\r\n                    setChatData(prev => {\r\n                        const newPrivateChats = prev.privateChatsWith.map(chat => {\r\n                            if (chat.chatId === statusUpdate.userId) {\r\n                                return { ...chat, isOnline: statusUpdate.isOnline };\r\n                            }\r\n                            return chat;\r\n                        });\r\n                        return { ...prev, privateChatsWith: newPrivateChats };\r\n                    });\r\n                };\r\n                subscriptions.current['sidebar'] = client.subscribe(`/user/queue/sidebar`, onSidebarUpdate);\r\n                subscriptions.current['private'] = client.subscribe(`/user/queue/private`, messageHandler);\r\n                subscriptions.current['private-ack'] = client.subscribe(`/user/queue/private-ack`, messageHandler);\r\n                subscriptions.current['group-ack'] = client.subscribe(`/user/queue/group-ack`, messageHandler);\r\n                subscriptions.current['presence'] = client.subscribe('/topic/presence', presenceHandler);\r\n                subscriptions.current['typing'] = client.subscribe('/user/queue/typing-status', handleTypingEvent);\r\n            },\r\n            onWebSocketError: (error) => console.error('WebSocket Error:', error),\r\n            onStompError: (frame) => console.error('STOMP Error:', frame.headers['message'], frame.body),\r\n            onWebSocketClose: () => {\r\n                setIsConnected(false);\r\n            }\r\n        });\r\n\r\n        client.activate();\r\n        stompClient.current = client;\r\n\r\n        return () => {\r\n            if (selectedChat && stompClient.current?.active) {\r\n                const destination = `/app/presence/close/${selectedChat.chatId}`;\r\n                stompClient.current.publish({ destination, body: \"{}\" });\r\n                console.log(`Sent CLOSE presence for ${selectedChat.chatId} on component unmount.`);\r\n            }\r\n\r\n            if (stompClient.current?.active) {\r\n                stompClient.current.deactivate();\r\n                stompClient.current = null;\r\n                console.log(\"STOMP client deactivated on component unmount.\");\r\n            }\r\n        };\r\n    }, [currentUser?.id, isChatDataReady, selectedChat]);\r\n\r\n    const groupIds = useMemo(() => {\r\n        return (chatData.groups || []).map(g => g.chatId).sort().join(',');\r\n    }, [chatData.groups]);\r\n\r\n    useEffect(() => {\r\n        if (!isConnected || !stompClient.current?.active) return;\r\n\r\n        const messageHandler = (payload) => {\r\n            if (onMessageReceivedRef.current) {\r\n                onMessageReceivedRef.current(payload);\r\n            }\r\n        };\r\n\r\n        const requiredGroupIds = new Set((chatData.groups || []).map(g => g.chatId.toString()));\r\n        const currentSubKeys = Object.keys(subscriptions.current);\r\n        const subscribedGroupIds = new Set(currentSubKeys.filter(key => key.startsWith('group-')).map(key => key.replace('group-', '')));\r\n\r\n        subscribedGroupIds.forEach(groupId => {\r\n            if (!requiredGroupIds.has(groupId)) {\r\n                const subId = `group-${groupId}`;\r\n                if (subscriptions.current[subId]) {\r\n                    subscriptions.current[subId].unsubscribe();\r\n                    delete subscriptions.current[subId];\r\n                }\r\n            }\r\n        });\r\n\r\n        requiredGroupIds.forEach(groupId => {\r\n            if (!subscribedGroupIds.has(groupId)) {\r\n                const subId = `group-${groupId}`;\r\n                subscriptions.current[subId] = stompClient.current.subscribe(`/topic/team-${groupId}`, messageHandler);\r\n                const typingSubId = `group-typing-${groupId}`;\r\n                subscriptions.current[typingSubId] = stompClient.current.subscribe(`/topic/typing-status/${groupId}`, handleTypingEvent);\r\n            }\r\n        });\r\n\r\n    }, [isConnected, groupIds, chatData.groups, groupMembers, currentUser.id]);\r\n\r\n    const openChat = useCallback(async (targetChat) => {\r\n        if (!currentUser?.id || !stompClient.current?.active) {\r\n            return;\r\n        }\r\n        const destination = `/app/presence/open/${targetChat.chatId}`;\r\n        const payload = {\r\n            userId: currentUser.id,\r\n            type: targetChat.type === 'group' ? 'TEAM' : 'PRIVATE'\r\n        };\r\n        stompClient.current.publish({ destination, body: JSON.stringify(payload) });\r\n\r\n        if (targetChat.type === 'group' && !groupMembersCache[targetChat.chatId]) {\r\n            try {\r\n                const teamDetailsResponse = await getGroupMembers(targetChat.chatId);\r\n                const members = teamDetailsResponse?.[0]?.employees || [];\r\n                if (members.length > 0) {\r\n                    setGroupMembersCache(prevCache => ({\r\n                        ...prevCache,\r\n                        [targetChat.chatId]: members\r\n                    }));\r\n                }\r\n            } catch (error) {\r\n                console.error(\"Failed to fetch group members:\", error);\r\n            }\r\n        }\r\n\r\n        setSelectedChat(targetChat);\r\n        setIsChatOpen(true);\r\n\r\n        const newUrl = `/chat/${currentUser.id}/with?id=${targetChat.chatId}`;\r\n        window.history.pushState({ path: newUrl }, '', newUrl);\r\n\r\n    }, [currentUser.id, groupMembersCache]);\r\n\r\n    const closeChat = useCallback(() => {\r\n        isManuallyClosing.current = true;\r\n\r\n        if (!selectedChat || !currentUser?.id) {\r\n            isManuallyClosing.current = false;\r\n            return;\r\n        }\r\n\r\n        if (stompClient.current?.active) {\r\n            const destination = `/app/presence/close/${selectedChat.chatId}`;\r\n            stompClient.current.publish({ destination, body: \"{}\" });\r\n        }\r\n\r\n        setSelectedChat(null);\r\n        setIsChatOpen(false);\r\n        setShowScrollToBottom(false);\r\n        setNewMessagesCount(0);\r\n\r\n        const newUrl = `/chat/${currentUser.id}`;\r\n        navigate(newUrl);\r\n\r\n    }, [selectedChat, currentUser.id, navigate]);\r\n\r\n    const handleChatSelect = useCallback((chat) => {\r\n        if (selectedChat && selectedChat.chatId !== chat.chatId && stompClient.current?.active) {\r\n            const destination = `/app/presence/close/${selectedChat.chatId}`;\r\n            stompClient.current.publish({ destination, body: \"{}\" });\r\n            console.log(`Sent CLOSE presence for previous chat: ${selectedChat.chatId}`);\r\n        }\r\n\r\n        if (chat.unreadMessageCount > 0) {\r\n            setChatData(prev => {\r\n                const isGroup = chat.type === 'group';\r\n                const list = isGroup ? prev.groups : prev.privateChatsWith;\r\n                const updatedList = list.map(c =>\r\n                    c.chatId === chat.chatId ? { ...c, unreadMessageCount: 0 } : c\r\n                );\r\n                return isGroup\r\n                    ? { ...prev, groups: updatedList }\r\n                    : { ...prev, privateChatsWith: updatedList };\r\n            });\r\n        }\r\n\r\n        openChat(chat);\r\n        setSearchTerm('');\r\n\r\n    }, [openChat, selectedChat]);\r\n\r\n\r\n\r\n    useEffect(() => {\r\n        const handleBeforeUnload = () => {\r\n            if (selectedChat && stompClient.current && stompClient.current.active) {\r\n                const destination = `/app/presence/close/${selectedChat.chatId}`;\r\n                stompClient.current.publish({ destination, body: \"{}\" });\r\n            }\r\n        };\r\n        window.addEventListener('beforeunload', handleBeforeUnload);\r\n        return () => window.removeEventListener('beforeunload', handleBeforeUnload);\r\n    }, [selectedChat]);\r\n\r\n    useEffect(() => {\r\n        const fetchGroupData = async () => {\r\n            if (!isGroupInfoModalOpen || !selectedChat || selectedChat.type !== 'group') {\r\n                return;\r\n            }\r\n\r\n            setIsGroupDataLoading(true);\r\n            setIsAttachmentLoading(true);\r\n\r\n            try {\r\n                if (activeGroupInfoTab === 'Members' && groupMembers.length === 0) {\r\n                    const teamDetailsResponse = await getGroupMembers(selectedChat.chatId);\r\n                    const teamDetails = Array.isArray(teamDetailsResponse) && teamDetailsResponse.length > 0 ? teamDetailsResponse[0] : null;\r\n                    setGroupMembers(teamDetails?.employees || []);\r\n                } else if (activeGroupInfoTab === 'Media' && groupMedia.length === 0) {\r\n                    const media = await getChatAttachments(selectedChat.chatId, 'media');\r\n                    setGroupMedia(media.map(transformMessageDTOToUIMessage));\r\n                } else if (activeGroupInfoTab === 'Files' && groupFiles.length === 0) {\r\n                    const files = await getChatAttachments(selectedChat.chatId, 'files');\r\n                    setGroupFiles(files.map(transformMessageDTOToUIMessage));\r\n                } else if (activeGroupInfoTab === 'Links' && groupLinks.length === 0) {\r\n                    const links = await getChatAttachments(selectedChat.chatId, 'links');\r\n                    setGroupLinks(links);\r\n                }\r\n            } catch (error) {\r\n                console.error(\"Failed to fetch group data for tab:\", activeGroupInfoTab, error);\r\n            } finally {\r\n                setIsGroupDataLoading(false);\r\n                setIsAttachmentLoading(false);\r\n            }\r\n        };\r\n\r\n        fetchGroupData();\r\n    }, [isGroupInfoModalOpen, activeGroupInfoTab, selectedChat]);\r\n\r\n    useEffect(() => {\r\n        const handleClickOutside = (event) => {\r\n            if (showEmojiPicker && emojiPickerRef.current && !emojiPickerRef.current.contains(event.target) && !emojiButtonRef.current?.contains(event.target)) setShowEmojiPicker(false);\r\n            if (showChatMenu && chatMenuRef.current && !chatMenuRef.current.contains(event.target) && !chatMenuButtonRef.current?.contains(event.target)) setShowChatMenu(false);\r\n            if (contextMenu.visible && contextMenuRef.current && !contextMenuRef.current.contains(event.target)) setContextMenu({ visible: false, x: 0, y: 0, message: null, index: null });\r\n            if (showPinnedMenu && pinnedMenuRef.current && !pinnedMenuRef.current.contains(event.target) && !pinnedMenuButtonRef.current?.contains(event.target)) setShowPinnedMenu(false);\r\n        };\r\n        document.addEventListener('mousedown', handleClickOutside);\r\n        return () => document.removeEventListener('mousedown', handleClickOutside);\r\n    }, [showEmojiPicker, showChatMenu, contextMenu.visible, showPinnedMenu]);\r\n\r\n    const sendTypingStatus = (isTyping) => {\r\n        if (!stompClient.current?.active || !selectedChat) return;\r\n\r\n        const payload = {\r\n            senderId: currentUser.id,\r\n            typing: isTyping,\r\n            type: selectedChat.type === 'group' ? 'TEAM' : 'PRIVATE',\r\n            receiverId: selectedChat.type === 'private' ? selectedChat.chatId : null,\r\n            groupId: selectedChat.type === 'group' ? selectedChat.chatId : null,\r\n        };\r\n\r\n        stompClient.current.publish({\r\n            destination: '/app/typing',\r\n            body: JSON.stringify(payload),\r\n        });\r\n    };\r\n\r\n    const handleSendMessage = () => {\r\n        if (!message.trim() || !selectedChat) return;\r\n\r\n        sendTypingStatus(false);\r\n\r\n        const clientId = Date.now().toString() + Math.random().toString(36).substring(2, 9);\r\n        const isReply = replyingTo !== null;\r\n\r\n        const optimisticMessage = {\r\n            id: clientId,\r\n            messageId: clientId,\r\n            sender: currentUser.id,\r\n            content: message,\r\n            timestamp: new Date().toISOString(),\r\n            status: 'sending',\r\n            type: 'text',\r\n            fileName: null,\r\n            fileSize: null,\r\n            isEdited: false,\r\n            replyTo: replyingTo,\r\n            isForwarded: false,\r\n        };\r\n\r\n        updateLastMessage(selectedChat.chatId, optimisticMessage);\r\n        setMessages(prev => ({\r\n            ...prev,\r\n            [selectedChat.chatId]: [...(prev[selectedChat.chatId] || []), optimisticMessage]\r\n        }));\r\n\r\n        let destination;\r\n        let payload;\r\n\r\n        if (isReply) {\r\n            destination = '/app/reply';\r\n            payload = {\r\n                replyToMessageId: replyingTo.messageId,\r\n                sender: currentUser.id,\r\n                content: message,\r\n                clientId: clientId,\r\n                receiver: selectedChat.type === 'private' ? selectedChat.chatId : null,\r\n                groupId: selectedChat.type === 'group' ? selectedChat.chatId : null,\r\n                type: selectedChat.type === 'group' ? 'TEAM' : 'PRIVATE',\r\n            };\r\n        } else {\r\n            destination = '/app/send';\r\n            payload = {\r\n                sender: currentUser.id,\r\n                content: message,\r\n                type: selectedChat.type === 'group' ? 'TEAM' : 'PRIVATE',\r\n                receiver: selectedChat.type === 'private' ? selectedChat.chatId : null,\r\n                groupId: selectedChat.type === 'group' ? selectedChat.chatId : null,\r\n                clientId: clientId,\r\n            };\r\n        }\r\n\r\n        stompClient.current.publish({ destination, body: JSON.stringify(payload) });\r\n\r\n        setMessage('');\r\n        setShowEmojiPicker(false);\r\n        setReplyingTo(null);\r\n        setTimeout(() => scrollToBottom('smooth'), 100);\r\n    };\r\n\r\n    const handleKeyDown = (event) => { if (event.key === 'Enter' && !event.shiftKey) { event.preventDefault(); if (editingInfo.index !== null) handleSaveEdit(); else handleSendMessage(); } };\r\n    const onEmojiClick = (emojiObject) => setMessage(prev => prev + emojiObject.emoji);\r\n    const handleFileButtonClick = () => fileInputRef.current.click();\r\n\r\n    const handleFileChange = async (event) => {\r\n        const file = event.target.files[0];\r\n        if (!file || !selectedChat) return;\r\n\r\n        let messageType = 'file';\r\n        if (file.type.startsWith('image/')) {\r\n            messageType = 'image';\r\n        } else if (file.type.startsWith('audio/')) {\r\n            messageType = 'audio';\r\n        }\r\n\r\n        const clientId = Date.now().toString() + Math.random().toString(36).substring(2, 9);\r\n\r\n        const localPreviewContent = URL.createObjectURL(file);\r\n\r\n        const optimisticMessage = {\r\n            id: clientId,\r\n            messageId: clientId,\r\n            sender: currentUser.id,\r\n            content: localPreviewContent,\r\n            timestamp: new Date().toISOString(),\r\n            status: 'sending',\r\n            type: messageType,\r\n            fileName: file.name,\r\n            fileSize: file.size,\r\n            fileUrl: localPreviewContent,\r\n            isEdited: false,\r\n        };\r\n\r\n        updateLastMessage(selectedChat.chatId, optimisticMessage);\r\n\r\n        setMessages(prev => ({\r\n            ...prev,\r\n            [selectedChat.chatId]: [...(prev[selectedChat.chatId] || []), optimisticMessage]\r\n        }));\r\n\r\n        const formData = new FormData();\r\n        formData.append('file', file);\r\n        formData.append('sender', currentUser.id);\r\n        formData.append('client_id', clientId);\r\n        formData.append('fileType', file.type);\r\n        formData.append('type', selectedChat.type === 'group' ? 'TEAM' : 'PRIVATE');\r\n\r\n        if (selectedChat.type === 'group') {\r\n            formData.append('groupId', selectedChat.chatId);\r\n        } else {\r\n            formData.append('receiver', selectedChat.chatId);\r\n        }\r\n\r\n        try {\r\n            await uploadFile(formData);\r\n        } catch (error) {\r\n            console.error(\"File upload failed in component:\", error);\r\n            setMessages(prev => {\r\n                const chatMessages = prev[selectedChat.chatId] || [];\r\n                const newMessages = chatMessages.map(m => m.id === clientId ? { ...m, status: 'failed' } : m);\r\n                return { ...prev, [selectedChat.chatId]: newMessages };\r\n            });\r\n        } finally {\r\n            event.target.value = null;\r\n        }\r\n    };\r\n\r\n    const handleMicButtonClick = () => { if (isRecording) stopRecording(); else startRecording(); };\r\n    const startRecording = () => {\r\n        navigator.mediaDevices.getUserMedia({ audio: true })\r\n            .then(stream => {\r\n                console.log('Permission granted, starting MediaRecorder...');\r\n                setIsRecording(true);\r\n\r\n                streamRef.current = stream;\r\n\r\n                audioChunksRef.current = [];\r\n                const mediaRecorder = new MediaRecorder(stream);\r\n                mediaRecorderRef.current = mediaRecorder;\r\n\r\n                mediaRecorder.ondataavailable = (event) => {\r\n                    audioChunksRef.current.push(event.data);\r\n                };\r\n\r\n                mediaRecorder.onstop = async () => {\r\n                    console.log('Recording stopped, creating blob from chunks...');\r\n                    const audioBlob = new Blob(audioChunksRef.current, { type: 'audio/webm' });\r\n\r\n                    if (!selectedChat) return;\r\n\r\n                    const audioFile = new File([audioBlob], `voice-message-${Date.now()}.webm`, {\r\n                        type: 'audio/webm',\r\n                        lastModified: Date.now()\r\n                    });\r\n\r\n                    const reader = new FileReader();\r\n                    reader.readAsDataURL(audioFile);\r\n                    reader.onloadend = async () => {\r\n                        const base64String = reader.result.split(',')[1];\r\n                        const clientId = Date.now().toString() + Math.random().toString(36).substring(2, 9);\r\n                        const localPreviewUrl = URL.createObjectURL(audioFile);\r\n\r\n                        const optimisticMessage = {\r\n                            id: clientId, messageId: clientId, sender: currentUser.id,\r\n                            content: localPreviewUrl, timestamp: new Date().toISOString(),\r\n                            status: 'sending', type: 'audio', fileName: audioFile.name,\r\n                            fileSize: audioFile.size, fileUrl: localPreviewUrl, isEdited: false,\r\n                            duration: 0\r\n                        };\r\n\r\n                        updateLastMessage(selectedChat.chatId, optimisticMessage);\r\n                        setMessages(prev => ({ ...prev, [selectedChat.chatId]: [...(prev[selectedChat.chatId] || []), optimisticMessage] }));\r\n\r\n                        const voiceData = {\r\n                            sender: currentUser.id, clientId: clientId,\r\n                            fileType: audioFile.type, fileName: audioFile.name,\r\n                            fileData: base64String, type: selectedChat.type === 'group' ? 'TEAM' : 'PRIVATE',\r\n                            groupId: selectedChat.type === 'group' ? selectedChat.chatId : null,\r\n                            receiver: selectedChat.type === 'private' ? selectedChat.chatId : null,\r\n                            duration: 0,\r\n                        };\r\n\r\n                        try {\r\n                            await uploadVoiceMessage(voiceData);\r\n                        } catch (error) {\r\n                            console.error(\"Voice message upload failed:\", error);\r\n                            setMessages(prev => {\r\n                                const chatMessages = prev[selectedChat.chatId] || [];\r\n                                const newMessages = chatMessages.map(m => m.id === clientId ? { ...m, status: 'failed' } : m);\r\n                                return { ...prev, [selectedChat.chatId]: newMessages };\r\n                            });\r\n                        }\r\n                    };\r\n                };\r\n\r\n                mediaRecorder.start();\r\n            })\r\n            .catch((e) => {\r\n                console.error('Microphone permission denied:', e);\r\n                setIsRecording(false);\r\n                alert('Microphone permission is required for voice messages.');\r\n            });\r\n    };\r\n\r\n    const stopRecording = () => {\r\n        console.log('Stopping MediaRecorder...');\r\n        if (mediaRecorderRef.current && mediaRecorderRef.current.state === \"recording\") {\r\n            mediaRecorderRef.current.stop();\r\n        }\r\n        if (streamRef.current) {\r\n            streamRef.current.getTracks().forEach(track => track.stop());\r\n        }\r\n        setIsRecording(false);\r\n    };\r\n\r\n    const handleConfirmClearChat = async () => {\r\n        if (!selectedChat) return;\r\n        try {\r\n            await clearChatHistory(currentUser.id, selectedChat.chatId);\r\n            setMessages(prev => ({ ...prev, [selectedChat.chatId]: [] }));\r\n            updateLastMessage(selectedChat.chatId, null);\r\n        } catch (error) {\r\n            console.error(\"Failed to clear chat:\", error);\r\n        } finally {\r\n            setShowClearConfirm(false);\r\n        }\r\n    };\r\n\r\n    const handleMediaDownload = (src, fileName) => { const link = document.createElement('a'); link.href = src; link.setAttribute('download', fileName || 'download'); document.body.appendChild(link); link.click(); document.body.removeChild(link); };\r\n    const handleContextMenu = (event, message, index) => { event.preventDefault(); event.stopPropagation(); const menuWidth = 180; const menuHeight = 250; let x = event.pageX; let y = event.pageY; if (x + menuWidth > window.innerWidth) x -= menuWidth; if (y + menuHeight > window.innerHeight) y -= menuHeight; setContextMenu({ visible: true, x, y, message, index }); };\r\n    const handleReply = () => { setReplyingTo(contextMenu.message); setContextMenu({ visible: false, x: 0, y: 0, message: null, index: null }); messageInputRef.current.focus(); };\r\n    const handleEdit = () => { setEditingInfo({ index: contextMenu.index, originalContent: contextMenu.message.content }); setMessage(contextMenu.message.content); setContextMenu({ visible: false, x: 0, y: 0, message: null, index: null }); messageInputRef.current.focus(); };\r\n\r\n    const handleSaveEdit = () => {\r\n        const updatedContent = message.trim();\r\n\r\n        if (updatedContent === '' || editingInfo.index === null || !stompClient.current?.active) {\r\n            cancelEdit();\r\n            return;\r\n        }\r\n\r\n        const chatId = selectedChat.chatId;\r\n        const currentMessages = messages[chatId];\r\n        const messageToEdit = currentMessages[editingInfo.index];\r\n        const messageId = messageToEdit.messageId;\r\n\r\n        if (updatedContent === editingInfo.originalContent || typeof messageId !== 'number') {\r\n            cancelEdit();\r\n            return;\r\n        }\r\n\r\n        const optimisticUpdatedMessage = {\r\n            ...messageToEdit,\r\n            content: updatedContent,\r\n            isEdited: true,\r\n        };\r\n\r\n        const updatedMessagesList = currentMessages.map((msg, index) =>\r\n            index === editingInfo.index ? optimisticUpdatedMessage : msg\r\n        );\r\n\r\n        setMessages(prev => ({\r\n            ...prev,\r\n            [chatId]: updatedMessagesList,\r\n        }));\r\n\r\n        if (editingInfo.index === currentMessages.length - 1) {\r\n            updateLastMessage(chatId, optimisticUpdatedMessage);\r\n        }\r\n\r\n        const payload = {\r\n            messageId: messageId,\r\n            content: updatedContent,\r\n            sender: currentUser.id,\r\n        };\r\n\r\n        const destination = '/app/edit';\r\n\r\n        stompClient.current.publish({\r\n            destination,\r\n            body: JSON.stringify(payload)\r\n        });\r\n\r\n        cancelEdit();\r\n    };\r\n\r\n    const cancelEdit = () => { setEditingInfo({ index: null, originalContent: '' }); setMessage(''); };\r\n\r\n    const handleDelete = async (forEveryone) => {\r\n        const chatId = selectedChat.chatId;\r\n        const currentMessages = [...(messages[chatId] || [])];\r\n        const messageToDelete = currentMessages[contextMenu.index];\r\n        const messageId = messageToDelete?.messageId;\r\n\r\n        if (!messageId || typeof messageId !== 'number' || messageToDelete.status === 'sending' || messageToDelete.status === 'failed') {\r\n            console.error(\"Invalid messageId or message status for deletion:\", messageId, messageToDelete.status);\r\n            setContextMenu({ visible: false, x: 0, y: 0, message: null, index: null });\r\n            return;\r\n        }\r\n\r\n        try {\r\n            if (forEveryone) {\r\n                await deleteMessageForEveryone(messageId, currentUser.id);\r\n            } else {\r\n                await deleteMessageForMe(messageId, currentUser.id);\r\n                const nextMessages = currentMessages.filter((_, i) => i !== contextMenu.index);\r\n                setMessages(prev => ({ ...prev, [chatId]: nextMessages }));\r\n                const newLastMessage = nextMessages.length > 0 ? nextMessages[nextMessages.length - 1] : null;\r\n                updateLastMessage(chatId, newLastMessage);\r\n            }\r\n        } catch (error) {\r\n            console.error(`Failed to delete message ${messageId} in component:`, error);\r\n        } finally {\r\n            setContextMenu({ visible: false, x: 0, y: 0, message: null, index: null });\r\n        }\r\n    };\r\n\r\n    const handleUndoDelete = () => { if (!lastDeleted) return; const currentMessages = [...messages[selectedChat.chatId]]; currentMessages[lastDeleted.index] = lastDeleted.message; setMessages(prev => ({ ...prev, [selectedChat.chatId]: currentMessages })); setLastDeleted(null); };\r\n    const handlePin = async () => {\r\n        if (!contextMenu.message?.messageId) return;\r\n\r\n        try {\r\n            const messageIdToPin = contextMenu.message.messageId;\r\n            const response = await pinMessage(messageIdToPin, currentUser.id);\r\n            setPinnedMessage(response);\r\n        } catch (error) {\r\n            console.error(\"Failed to pin message:\", error);\r\n        } finally {\r\n            setContextMenu({ visible: false, x: 0, y: 0, message: null, index: null });\r\n        }\r\n    };\r\n\r\n    const handleUnpin = async () => {\r\n        if (!pinnedMessage?.messageId) return;\r\n\r\n        try {\r\n            await unpinMessage(pinnedMessage.messageId, currentUser.id);\r\n            setPinnedMessage(null);\r\n        } catch (error) {\r\n            console.error(\"Failed to unpin message:\", error);\r\n        } finally {\r\n            setShowPinnedMenu(false);\r\n        }\r\n    };\r\n\r\n    const handleGoToMessage = () => {\r\n        setShowPinnedMenu(false);\r\n        if (pinnedMessage) {\r\n            const messageIndex = chatMessages.findIndex(m => m.messageId === pinnedMessage.messageId);\r\n\r\n            if (messageIndex !== -1) {\r\n                const messageElement = document.querySelector(`[data-message-index='${messageIndex}']`);\r\n                if (messageElement) {\r\n                    messageElement.scrollIntoView({ behavior: 'smooth', block: 'center' });\r\n                    messageElement.classList.add('animate-pulse', 'bg-blue-200');\r\n                    setTimeout(() => messageElement.classList.remove('animate-pulse', 'bg-blue-200'), 2500);\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    const handleForward = () => {\r\n        setForwardingInfo({ visible: true, message: contextMenu.message });\r\n        setContextMenu({ visible: false, x: 0, y: 0, message: null, index: null });\r\n    };\r\n\r\n    const handleConfirmForward = async () => {\r\n        const originalMsg = forwardingInfo.message;\r\n        if (!originalMsg || forwardRecipients.length === 0) {\r\n            return;\r\n        }\r\n\r\n        const forwardData = {\r\n            sender: currentUser.id,\r\n            forwardMessageId: originalMsg.messageId,\r\n            forwardTo: forwardRecipients.map(chatId => {\r\n                const chat = allChats.find(c => c.chatId === chatId);\r\n                if (chat.type === 'private') {\r\n                    return { receiver: chat.chatId };\r\n                } else {\r\n                    return { groupId: chat.chatId };\r\n                }\r\n            })\r\n        };\r\n\r\n        try {\r\n            await forwardMessage(forwardData);\r\n            const newLastMessageObject = {\r\n                ...forwardingInfo.message,\r\n                sender: currentUser.id,\r\n                timestamp: new Date().toISOString(),\r\n            };\r\n            forwardRecipients.forEach(chatId => {\r\n                updateLastMessage(chatId, newLastMessageObject);\r\n            });\r\n\r\n        } catch (error) {\r\n            console.error(\"Failed to forward message:\", error);\r\n        } finally {\r\n            setForwardingInfo({ visible: false, message: null });\r\n            setForwardRecipients([]);\r\n            setForwardSearchTerm('');\r\n        }\r\n    };\r\n\r\n    const chatsToDisplay = searchChatResults !== null ? searchChatResults : allChats;\r\n\r\n    useEffect(() => {\r\n        if (chatIdFromUrl && allChats.length > 0 && isConnected && !selectedChat) {\r\n            if (isManuallyClosing.current) {\r\n                return;\r\n            }\r\n\r\n            const chatToSelect = allChats.find(c => c.chatId.toString() === chatIdFromUrl);\r\n            if (chatToSelect) {\r\n                handleChatSelect(chatToSelect);\r\n            }\r\n        } else if (!chatIdFromUrl) {\r\n            isManuallyClosing.current = false;\r\n        }\r\n    }, [allChats, chatIdFromUrl, selectedChat, handleChatSelect, isConnected]);\r\n\r\n    useEffect(() => {\r\n        const newChatTarget = location.state?.newChatTarget;\r\n        if (newChatTarget && isChatDataReady) {\r\n            const chatExists = allChats.some(chat => chat.chatId === newChatTarget.chatId);\r\n            if (!chatExists) {\r\n                console.log(\"New chat detected. Adding to chat list:\", newChatTarget);\r\n\r\n                setChatData(prevData => {\r\n                    const updatedPrivateChats = [newChatTarget, ...prevData.privateChatsWith];\r\n\r\n                    return {\r\n                        ...prevData,\r\n                        privateChatsWith: updatedPrivateChats,\r\n                    };\r\n                });\r\n            }\r\n        }\r\n    }, [isChatDataReady, allChats, location.state]);\r\n\r\n    const openGroupInfoModal = () => {\r\n        if (selectedChat?.type === 'group') {\r\n            setActiveGroupInfoTab('Overview');\r\n            setGroupMembers([]);\r\n            setIsGroupInfoModalOpen(true);\r\n        }\r\n    };\r\n\r\n    const formatTimestamp = (isoString) => {\r\n        if (!isoString) return '';\r\n        const date = new Date(isoString.endsWith('Z') ? isoString : isoString + 'Z');\r\n        if (isNaN(date)) return '';\r\n        return date.toLocaleTimeString('en-US', {\r\n            hour: '2-digit',\r\n            minute: '2-digit',\r\n            hour12: true\r\n        });\r\n    };\r\n\r\n    const formatDateHeader = (isoString) => {\r\n        if (!isoString) return '';\r\n        const date = new Date(String(isoString).endsWith('Z') ? isoString : isoString + 'Z');\r\n        if (isNaN(date)) return 'Invalid Date';\r\n        const today = new Date();\r\n        const yesterday = new Date(today);\r\n        yesterday.setDate(yesterday.getDate() - 1);\r\n        if (date.toDateString() === today.toDateString()) return 'Today';\r\n        if (date.toDateString() === yesterday.toDateString()) return 'Yesterday';\r\n        return date.toLocaleDateString([], { year: 'numeric', month: 'long', day: 'numeric' });\r\n    };\r\n\r\n    const formatLastSeen = (isoString) => {\r\n        if (!isoString) return 'Offline';\r\n        const date = new Date(String(isoString).endsWith('Z') ? isoString : isoString + 'Z');\r\n        if (isNaN(date)) return 'Offline';\r\n        const today = new Date();\r\n        if (date.toDateString() === today.toDateString()) {\r\n            return `last seen today at ${formatTimestamp(isoString)}`;\r\n        }\r\n        return `last seen on ${date.toLocaleDateString()}`;\r\n    };\r\n\r\n    const getStatusRingColor = (status) => {\r\n        switch (status) {\r\n            case 'sending': return 'ring-yellow-400';\r\n            case 'sent': return 'ring-gray-400';\r\n            case 'delivered': return 'ring-blue-500';\r\n            case 'seen': return 'ring-green-500';\r\n            case 'failed': return 'ring-red-500';\r\n            default: return 'ring-transparent';\r\n        }\r\n    };\r\n\r\n    let lastMessageDate = null;\r\n\r\n    const currentChatInfo = selectedChat ? allChats.find(c => c.chatId === selectedChat.chatId) : null;\r\n    const chatMessages = currentChatInfo ? messages[currentChatInfo.chatId] || [] : [];\r\n\r\n    const getSenderInfo = (senderId) => {\r\n        if (!currentUser) return { name: 'Unknown User', profile: null };\r\n        if (senderId === currentUser.id) return { name: 'You', profile: currentUser.profile };\r\n\r\n        let member = chatData.privateChatsWith.find(m => m.chatId === senderId || m.employeeId === senderId);\r\n        if (member) {\r\n            return { name: member.name || member.displayName, profile: member.profile || member.employeeImage || null };\r\n        }\r\n        if (selectedChat?.type === 'group' && groupMembersCache[selectedChat.chatId]) {\r\n            member = groupMembersCache[selectedChat.chatId].find(m => m.employeeId === senderId);\r\n        }\r\n\r\n        return member\r\n            ? { name: member.name || member.displayName, profile: member.profile || member.employeeImage || null }\r\n            : { name: 'Unknown User', profile: null };\r\n    };\r\n\r\n    const getFileUrl = (msg) => {\r\n        const baseUrl = chatApi.defaults.baseURL;\r\n\r\n        if (msg.fileUrl && msg.fileUrl.startsWith('blob:')) {\r\n            return msg.fileUrl;\r\n        }\r\n\r\n        if (msg.fileUrl && msg.fileUrl.startsWith('/api')) {\r\n            const origin = new URL(baseUrl).origin;\r\n            return `${origin}${msg.fileUrl}`;\r\n        } else if (msg.fileUrl) {\r\n            return msg.fileUrl;\r\n        }\r\n\r\n        const messageIdForUrl = msg.id || msg.messageId;\r\n        if (messageIdForUrl) {\r\n            return `${baseUrl}/chat/file/${messageIdForUrl}`;\r\n        }\r\n        return msg.content;\r\n    };\r\n\r\n    return (\r\n        <div className={`w-full h-full ${theme === 'dark' ? 'bg-gray-900' : 'bg-gray-100'} font-sans`}>\r\n            <div className=\"flex w-full h-full p-0 md:p-4 md:gap-4\">\r\n                <div className={`relative w-full md:w-[30%] h-full p-4 flex flex-col shadow-xl md:rounded-lg ${isChatOpen ? 'hidden md:flex' : 'flex'} ${theme === 'dark' ? 'bg-gray-800' : 'bg-white'}`}>\r\n                    <div className=\"mb-4 flex-shrink-0\"><input type=\"text\" placeholder=\"Search chats users...\" className={`w-full p-3 rounded-lg border bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 ${theme === 'dark' ? 'bg-gray-700 text-white border-gray-600' : 'bg-gray-50 border-gray-300'}`} value={searchTerm} onChange={e => setSearchTerm(e.target.value)} /></div>\r\n                    <div ref={sidebarScrollRef} onScroll={handleSidebarScroll} className=\"flex-grow space-y-2 pr-2 overflow-y-auto custom-scrollbar\">\r\n                        {isSearching ? (\r\n                            <div className=\"text-center p-4 text-gray-500\">Searching...</div>\r\n                        ) : (\r\n                            chatsToDisplay.map(chat => (\r\n                                <div key={chat.chatId} onClick={() => handleChatSelect(chat)} className={`p-3 flex items-center rounded-lg cursor-pointer group ${selectedChat?.chatId === chat.chatId ? 'bg-blue-100 dark:bg-blue-900/30' : (theme === 'dark' ? 'hover:bg-gray-700' : 'hover:bg-blue-50')}`}>\r\n                                    <div className=\"relative flex-shrink-0\">\r\n                                        {chat.type === 'group' ? (\r\n                                            <div\r\n                                                onClick={(e) => {\r\n                                                    e.stopPropagation();\r\n                                                    setViewingProfile(chat);\r\n                                                }}\r\n                                                className={`w-11 h-11 rounded-full flex items-center justify-center cursor-pointer md:cursor-default ${theme === 'dark' ? 'bg-gray-700' : 'bg-gray-200'}`}\r\n                                            >\r\n                                                <FaUsers className={`text-gray-500`} size={24} />\r\n                                            </div>\r\n                                        ) : chat.profile ? (\r\n                                            <div\r\n                                                onClick={(e) => {\r\n                                                    e.stopPropagation();\r\n                                                    setViewingProfile(chat);\r\n                                                }}\r\n                                                className=\"w-11 h-11 rounded-full cursor-pointer md:cursor-default\"\r\n                                            >\r\n                                                <img src={chat.profile} alt={chat.name} className=\"w-full h-full rounded-full object-cover\" />\r\n                                            </div>\r\n                                        ) : (\r\n                                            <div className={`w-11 h-11 rounded-full flex items-center justify-center ${theme === 'dark' ? 'bg-gray-700' : 'bg-gray-200'}`}>\r\n                                                <FaUser className={`text-gray-500`} size={24} />\r\n                                            </div>\r\n                                        )}\r\n                                        {chat.isOnline && (<span className=\"absolute bottom-0 right-0 block h-3 w-3 rounded-full ring-2 ring-white bg-green-500\"></span>)}\r\n                                    </div>\r\n                                    <div className=\"flex-1 min-w-0 mx-3\"><p className={`font-semibold truncate ${theme === 'dark' ? 'text-white' : 'text-gray-800'}`}>{chat.name}</p><p className={`text-sm truncate ${theme === 'dark' ? 'text-gray-400' : 'text-gray-500'}`}>{chat.lastMessage || 'No messages yet'}</p></div>\r\n                                    {(chat.unreadMessageCount || 0) > 0 && (<div className=\"flex-shrink-0\"><span className=\"bg-blue-600 text-white text-xs font-bold px-2 py-1 rounded-full\">{chat.unreadMessageCount}</span></div>)}\r\n                                </div>\r\n                            ))\r\n                        )}\r\n                        {searchTerm === '' && isFetchingMore && (\r\n                            <div className=\"flex justify-center items-center p-4\">\r\n                                <div className=\"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600\"></div>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n\r\n                <div className={`flex-col shadow-xl fixed inset-0 z-[100] overflow-hidden md:relative md:inset-auto md:z-auto md:w-[70%] md:h-full md:rounded-lg ${isChatOpen ? 'flex' : 'hidden md:flex'} ${theme === 'dark' ? 'bg-gray-800' : 'bg-white'} `}>\r\n                    {!currentChatInfo ? (\r\n                        <div className=\"flex items-center justify-center h-full\">\r\n                            <div className=\"text-center\">\r\n                                <FaUsers className={`mx-auto text-6xl ${theme === 'dark' ? 'text-gray-600' : 'text-gray-300'}`} />\r\n                                <p className={`mt-4 text-xl text-center ${theme === 'dark' ? 'text-gray-400' : 'text-gray-600'}`}>Select a chat to begin</p>\r\n                                <p className={`text-sm ${theme === 'dark' ? 'text-gray-500' : 'text-gray-400'}`}>Start a conversation with your team or colleagues.</p>\r\n                            </div>\r\n                        </div>\r\n                    ) : (\r\n                        <>\r\n                            <div className={`flex-shrink-0 flex items-center justify-between p-4 border-b z-10 ${theme === 'dark' ? 'border-gray-700 bg-gray-800' : 'border-gray-200 bg-white'}`}>\r\n                                <div className=\"flex items-center space-x-3 flex-grow min-w-0\">\r\n                                    <button onClick={closeChat} className={`md:hidden p-2 rounded-full ${theme === 'dark' ? 'hover:bg-gray-700 text-white' : 'hover:bg-gray-100'}`}><FaArrowLeft /></button>\r\n                                    <button onClick={() => currentChatInfo.type !== 'group' && currentChatInfo.profile && setIsProfileModalOpen(true)} className=\"flex-shrink-0\">\r\n                                        {currentChatInfo.type === 'group' ? (\r\n                                            <div className={`w-12 h-12 rounded-full flex items-center justify-center ${theme === 'dark' ? 'bg-gray-700' : 'bg-gray-200'}`}>\r\n                                                <FaUsers className={`text-gray-500`} size={28} />\r\n                                            </div>\r\n                                        ) : currentChatInfo.profile ? (\r\n                                            <img src={currentChatInfo.profile} alt={currentChatInfo.name} className=\"w-12 h-12 rounded-full object-cover\" />\r\n                                        ) : (\r\n                                            <div className={`w-12 h-12 rounded-full flex items-center justify-center ${theme === 'dark' ? 'bg-gray-700' : 'bg-gray-200'}`}>\r\n                                                <FaUser className={`text-gray-500`} size={28} />\r\n                                            </div>\r\n                                        )}\r\n                                    </button>\r\n                                    <div className=\"truncate\">\r\n                                        <button\r\n                                            onClick={() => {\r\n                                                if (currentChatInfo.type === 'private') {\r\n                                                    navigate(`/employees/${currentUser.id}/public/${currentChatInfo.chatId}`);\r\n                                                } else {\r\n                                                    openGroupInfoModal();\r\n                                                }\r\n                                            }}\r\n                                            disabled={!currentChatInfo}\r\n                                            className=\"text-left\"\r\n                                        >\r\n                                            <p className={`font-bold text-lg truncate ${theme === 'dark' ? 'text-white' : 'text-gray-800'}`}>{currentChatInfo.name}</p>\r\n                                        </button>\r\n                                        {currentChatInfo.type === 'private' ? (\r\n                                            <p className={`text-sm ${theme === 'dark' ? 'text-gray-400' : 'text-gray-500'}`}>{currentChatInfo.isOnline ? 'Online' : formatLastSeen(currentChatInfo.lastMessageTimestamp)}</p>\r\n                                        ) : (\r\n                                            <p className={`text-sm ${theme === 'dark' ? 'text-gray-400' : 'text-gray-500'}`}>{currentChatInfo.memberCount || 0} members</p>\r\n                                        )}\r\n                                    </div>\r\n                                </div>\r\n                                <div className=\"flex items-center space-x-2\"><div className=\"relative\"><button ref={chatMenuButtonRef} onClick={() => setShowChatMenu(!showChatMenu)} className={`p-2 rounded-full hover:bg-gray-100 ${theme === 'dark' ? 'text-gray-300 hover:bg-gray-700' : 'text-gray-600'}`}><BsThreeDotsVertical size={20} /></button>{showChatMenu && (<div ref={chatMenuRef} className=\"absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg z-20\"><button onClick={() => { setIsSearchVisible(true); setShowChatMenu(false); }}\r\n                                    className=\"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100\">Search</button><button onClick={() => { setShowClearConfirm(true); setShowChatMenu(false); }} className=\"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100\">Clear chat</button></div>)}</div></div>\r\n                            </div>\r\n\r\n                            {isSearchVisible && (\r\n                                <div className={`flex-shrink-0 flex items-center justify-between p-4 border-b sticky top-0 z-10 ${theme === 'dark' ? 'border-gray-700 bg-gray-800' : 'border-gray-200 bg-white'}`}>\r\n                                    <input\r\n                                        type=\"text\"\r\n                                        placeholder=\"Search messages...\"\r\n                                        className={`w-full p-2 border rounded-lg ${theme === 'dark' ? 'bg-gray-700 text-white' : ''}`}\r\n                                        value={searchQuery}\r\n                                        onChange={handleSearchChange}\r\n                                        autoFocus\r\n                                    />\r\n                                    {searchResults.length > 0 && (\r\n                                        <span className=\"mx-2 text-sm\">{currentResultIndex + 1} of {searchResults.length}</span>\r\n                                    )}\r\n                                    <div className=\"flex\">\r\n                                        <button onClick={handlePrevResult} disabled={currentResultIndex <= 0} className=\"p-2 disabled:opacity-50\"><FaChevronUp /></button>\r\n                                        <button onClick={handleNextResult} disabled={currentResultIndex >= searchResults.length - 1} className=\"p-2 disabled:opacity-50\"><FaChevronDown /></button>\r\n                                        <button onClick={() => { setIsSearchVisible(false); setSearchQuery(''); setSearchResults([]); }} className=\"p-2\"><FaTimes /></button>\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n\r\n                            {pinnedMessage && (\r\n                                <div className={`flex-shrink-0 flex items-center justify-between p-2 border-b bg-gray-50 ${theme === 'dark' ? 'bg-gray-700 border-gray-700' : 'border-gray-200'}`}>\r\n                                    <div className=\"flex items-center gap-2 text-sm overflow-hidden cursor-pointer flex-grow min-w-0\" onClick={handleGoToMessage}>\r\n                                        <FaThumbtack className={`flex-shrink-0 ${theme === 'dark' ? 'text-gray-400' : 'text-gray-500'}`} />\r\n                                        <FileIcon fileName={pinnedMessage.fileName || ''} type={pinnedMessage.messageType} className=\"text-lg flex-shrink-0\" />\r\n                                        <div className=\"truncate\">\r\n                                            <p className={`font-bold text-blue-600`}>Pinned Message</p>\r\n                                            <p className={`truncate ${theme === 'dark' ? 'text-gray-300' : 'text-gray-600'}`}>\r\n                                                {pinnedMessage.messageType === 'text' ? pinnedMessage.content : pinnedMessage.fileName || 'Pinned Media'}\r\n                                            </p>\r\n                                        </div>\r\n                                    </div>\r\n                                    <div className=\"relative flex-shrink-0\">\r\n                                        <button ref={pinnedMenuButtonRef} onClick={() => setShowPinnedMenu(!showPinnedMenu)} className={`p-2 rounded-full ${theme === 'dark' ? 'hover:bg-gray-600 text-gray-300' : 'hover:bg-gray-200'}`}>\r\n                                            <FaChevronDown />\r\n                                        </button>\r\n                                        {showPinnedMenu && (\r\n                                            <div ref={pinnedMenuRef} className={`absolute right-0 mt-2 w-48 rounded-md shadow-lg z-20 text-sm ${theme === 'dark' ? 'bg-gray-700 text-white' : 'bg-white'}`}>\r\n                                                <ul className=\"py-1\">\r\n                                                    <li onClick={handleGoToMessage} className={`px-4 py-2 hover:bg-gray-100 cursor-pointer flex items-center gap-3 ${theme === 'dark' ? 'text-gray-300 hover:bg-gray-600' : 'text-gray-700'}`}>\r\n                                                        <FaAngleDoubleRight /> Go to message\r\n                                                    </li>\r\n                                                    <li onClick={handleUnpin} className={`px-4 py-2 hover:bg-gray-100 cursor-pointer flex items-center gap-3 text-red-600 ${theme === 'dark' ? 'text-red-400 hover:bg-gray-600' : ''}`}>\r\n                                                        <FaTimes /> Unpin\r\n                                                    </li>\r\n                                                </ul>\r\n                                            </div>\r\n                                        )}\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n\r\n                            <div ref={chatContainerRef} onScroll={handleChatScroll} className={`flex-grow p-4 overflow-y-auto min-h-0 ${theme === 'dark' ? 'bg-gray-900' : 'bg-gray-50'}`}>\r\n                                {isSearchVisible ? (\r\n                                    <div className=\"space-y-2\">\r\n                                        {searchResults.length > 0 ? (\r\n                                            searchResults.map(msg => (\r\n                                                <div\r\n                                                    key={msg.messageId}\r\n                                                    onClick={() => handleJumpToMessage(msg)}\r\n                                                    className={`p-3 rounded-lg cursor-pointer ${theme === 'dark' ? 'hover:bg-gray-700' : 'hover:bg-gray-100'}`}\r\n                                                >\r\n                                                    <div className=\"flex justify-between text-xs mb-1\">\r\n                                                        <span className=\"font-bold\">{getSenderInfo(msg.sender).name}</span>\r\n                                                        <span className={`${theme === 'dark' ? 'text-gray-400' : 'text-gray-500'}`}>\r\n                                                            {new Date(msg.timestamp).toLocaleDateString()}\r\n                                                        </span>\r\n                                                    </div>\r\n                                                    <p className={`truncate ${theme === 'dark' ? 'text-gray-300' : 'text-gray-700'}`}>\r\n                                                        {msg.fileName ? ` ${msg.fileName}` : msg.content}\r\n                                                    </p>\r\n                                                </div>\r\n                                            ))\r\n                                        ) : (\r\n                                            <div className=\"text-center text-gray-500 mt-10\">No results found for \"{searchQuery}\"</div>\r\n                                        )}\r\n                                    </div>\r\n                                ) : (\r\n                                    isMessagesLoading ? (\r\n                                        <MessageSkeleton theme={theme} />\r\n                                    ) : (\r\n                                        <div className=\"space-y-2\">\r\n                                            {chatMessages.map((msg, index) => {\r\n                                                const isMyMessage = msg.sender === currentUser?.id;\r\n                                                const msgDate = new Date(msg.timestamp).toDateString();\r\n                                                const showDateHeader = lastMessageDate !== msgDate;\r\n                                                if (showDateHeader) {\r\n                                                    lastMessageDate = msgDate;\r\n                                                }\r\n                                                const senderInfo = !isMyMessage ? getSenderInfo(msg.sender) : null;\r\n\r\n                                                const fileUrl = getFileUrl(msg);\r\n\r\n                                                return (\r\n                                                    <React.Fragment key={msg.messageId || msg.id}>\r\n                                                        {showDateHeader && (\r\n                                                            <div className=\"text-center my-4\">\r\n                                                                <span className={`px-3 py-1 rounded-full text-xs font-semibold ${theme === 'dark' ? 'bg-gray-700 text-gray-300' : 'bg-gray-200 text-gray-600'}`}>{formatDateHeader(msg.timestamp)}</span>\r\n                                                            </div>\r\n                                                        )}\r\n                                                        <div\r\n                                                            id={`msg-${msg.messageId}`}\r\n                                                            data-message-index={index}\r\n                                                            className={`flex items-end gap-2 p-1 rounded-lg transition-all\r\n                                                            ${isMyMessage ? 'justify-end' : 'justify-start'}\r\n                                                            ${searchResults[currentResultIndex]?.messageId === msg.messageId ? 'bg-yellow-400/30' : ''}\r\n                                                        `}\r\n                                                        >\r\n                                                            {!isMyMessage && (() => {\r\n                                                                const profileSrc = currentChatInfo.type === 'group' ? senderInfo?.profile : currentChatInfo.profile;\r\n                                                                const profileName = currentChatInfo.type === 'group' ? senderInfo?.name : currentChatInfo.name;\r\n                                                                return profileSrc ? (\r\n                                                                    <img src={profileSrc} alt={profileName} className=\"w-8 h-8 rounded-full object-cover self-start flex-shrink-0\" />\r\n                                                                ) : (\r\n                                                                    <div className={`w-8 h-8 rounded-full flex items-center justify-center self-start flex-shrink-0 ${theme === 'dark' ? 'bg-gray-700' : 'bg-gray-200'}`}>\r\n                                                                        <FaUser className=\"text-gray-500\" size={18} />\r\n                                                                    </div>\r\n                                                                );\r\n                                                            })()}\r\n                                                            <div className={`flex flex-col ${isMyMessage ? 'items-end' : 'items-start'}`}>\r\n                                                                {currentChatInfo.type === 'group' && !isMyMessage && (\r\n                                                                    <p className={`text-xs text-gray-500 mb-1 ml-2 font-semibold ${theme === 'dark' ? 'text-gray-400' : 'text-gray-500'}`}>{senderInfo?.name}</p>\r\n                                                                )}\r\n                                                                <div onContextMenu={(e) => handleContextMenu(e, msg, index)} className={`rounded-lg max-w-xs md:max-w-md group relative\r\n                                                                ${(msg.type === 'image' || msg.type === 'deleted') ? 'p-0 bg-transparent' : ''}\r\n                                                                ${(msg.type === 'text') ? (isMyMessage ? 'bg-blue-600 text-white p-3' : (theme === 'dark' ? 'bg-gray-700 text-white p-3' : 'bg-gray-200 text-gray-800 p-3')) : ''}\r\n                                                                ${(msg.type === 'audio' || msg.type === 'file') ? (isMyMessage ? 'bg-blue-600' : (theme === 'dark' ? 'bg-gray-700' : 'bg-gray-200')) : ''}\r\n                                                                `}>\r\n                                                                    {msg.type === 'deleted' ? (\r\n                                                                        <div className=\"flex items-center gap-2 italic text-sm opacity-70 p-3\">\r\n                                                                            <span>This message was deleted</span>\r\n                                                                            {lastDeleted?.index === index && <button onClick={handleUndoDelete} className=\"font-semibold hover:underline\">Undo</button>}\r\n                                                                        </div>\r\n                                                                    ) : (\r\n                                                                        <>\r\n                                                                            {msg.isForwarded && <div className=\"flex items-center gap-1.5 text-xs opacity-70 mb-1 font-semibold\"><FaShare /> Forwarded</div>}\r\n\r\n                                                                            {msg.replyTo && (\r\n                                                                                <div className={`p-2 rounded mb-2 text-sm ${isMyMessage ? 'bg-blue-500' : (theme === 'dark' ? 'bg-gray-600' : 'bg-gray-300')}`}>\r\n                                                                                    <p className=\"font-semibold\">{msg.replyTo.sender === currentUser?.id ? 'You' : getSenderInfo(msg.replyTo.sender).name}</p>\r\n                                                                                    <p className=\"opacity-80 truncate\">\r\n                                                                                        {['image', 'audio', 'file'].includes(msg.replyTo.type) ? msg.replyTo.content : msg.replyTo.content}\r\n                                                                                    </p>\r\n                                                                                </div>\r\n                                                                            )}\r\n\r\n                                                                            {msg.type === 'image' ? (\r\n                                                                                <div className=\"relative\">\r\n                                                                                    <button onClick={() => setImageInView(fileUrl)}>\r\n                                                                                        <img src={fileUrl} alt={msg.fileName || 'image'} className=\"rounded-md max-w-full\" style={{ maxHeight: '300px' }} />\r\n                                                                                    </button>\r\n                                                                                    {!isMyMessage && (\r\n                                                                                        <a href={fileUrl} download={msg.fileName} onClick={(e) => e.stopPropagation()} className=\"absolute bottom-2 right-2 bg-black bg-opacity-50 text-white p-2 rounded-full opacity-0 group-hover:opacity-100 transition-opacity\">\r\n                                                                                            <FaDownload />\r\n                                                                                        </a>\r\n                                                                                    )}\r\n                                                                                </div>\r\n                                                                            ) : msg.type === 'audio' ? (\r\n                                                                                <div className={`${isMyMessage ? 'bg-blue-600' : (theme === 'dark' ? 'bg-gray-700' : 'bg-gray-200')} rounded-lg`}>\r\n                                                                                    <AudioPlayer src={fileUrl} fileUrl={fileUrl} isSender={isMyMessage} initialDuration={msg.duration} fileSize={msg.fileSize} theme={theme} />\r\n                                                                                </div>\r\n                                                                            ) : msg.type === 'file' ? (\r\n                                                                                <FileMessage msg={msg} isMyMessage={isMyMessage} theme={theme} />\r\n                                                                            ) : (\r\n                                                                                <p className=\"text-sm break-words\">{msg.content}</p>\r\n                                                                            )}\r\n                                                                        </>\r\n                                                                    )}\r\n                                                                </div>\r\n                                                                <span className={`text-xs mt-1 px-1 ${theme === 'dark' ? 'text-gray-400' : 'text-gray-500'}`}>{msg.status === 'sending' ? 'Sending...' : msg.status === 'failed' ? 'Failed' : formatTimestamp(msg.timestamp)} {msg.isEdited ? '(edited)' : ''}</span>\r\n                                                            </div>\r\n                                                            {isMyMessage && (\r\n                                                                <div className={`relative w-8 h-8 self-start flex-shrink-0`}>\r\n                                                                    <img src={currentUser?.profile || 'https://placehold.co/100x100/E2E8F0/4A5568?text=Me'} alt=\"current user\" className={`w-full h-full rounded-full object-cover ring-2 ${getStatusRingColor(msg.status)}`} />\r\n                                                                </div>\r\n                                                            )}\r\n                                                        </div>\r\n                                                    </React.Fragment>\r\n                                                );\r\n                                            })}\r\n\r\n                                            {typingUsers[selectedChat.chatId] && (\r\n                                                <div className=\"flex items-end gap-2 justify-start\">\r\n                                                    <div className={`w-8 h-8 rounded-full flex items-center justify-center self-start flex-shrink-0 ${theme === 'dark' ? 'bg-gray-700' : 'bg-gray-200'}`}>\r\n                                                        <FaUser className=\"text-gray-500\" size={18} />\r\n                                                    </div>\r\n                                                    <div className=\"flex flex-col items-start\">\r\n                                                        <div className={`p-3 rounded-lg text-gray-800 ${theme === 'dark' ? 'bg-gray-700' : 'bg-gray-200'}`}>\r\n                                                            <div className=\"flex items-center justify-center gap-1.5\">\r\n                                                                <span className=\"h-2 w-2 bg-gray-500 rounded-full animate-bounce [animation-delay:-0.3s]\"></span>\r\n                                                                <span className=\"h-2 w-2 bg-gray-500 rounded-full animate-bounce [animation-delay:-0.15s]\"></span>\r\n                                                                <span className=\"h-2 w-2 bg-gray-500 rounded-full animate-bounce\"></span>\r\n                                                            </div>\r\n                                                        </div>\r\n                                                    </div>\r\n                                                </div>\r\n                                            )}\r\n                                        </div>\r\n                                    )\r\n                                )}\r\n                            </div>\r\n\r\n                            <div className={`flex-shrink-0 flex flex-col p-4 border-t ${theme === 'dark' ? 'bg-gray-800 border-gray-700' : 'bg-white border-gray-200'}`}>\r\n                                {replyingTo && (\r\n                                    <div className={`p-2 rounded-t-lg flex justify-between items-center ${theme === 'dark' ? 'bg-gray-700' : 'bg-gray-100'}`}>\r\n                                        <div className=\"text-sm overflow-hidden\">\r\n                                            <p className=\"font-semibold text-blue-600\">Replying to {replyingTo.sender === currentUser?.id ? 'yourself' : getSenderInfo(replyingTo.sender).name}</p>\r\n                                            <p className={`truncate opacity-80 ${theme === 'dark' ? 'text-gray-300' : 'text-gray-600'}`}>\r\n                                                {['image', 'audio', 'file'].includes(replyingTo.type) ? replyingTo.fileName : replyingTo.content}\r\n                                            </p>\r\n                                        </div>\r\n                                        <button onClick={() => setReplyingTo(null)}><FaTimes /></button>\r\n                                    </div>\r\n                                )}\r\n\r\n                                {editingInfo.index !== null && (<div className={`p-2 rounded-t-lg flex justify-between items-center ${theme === 'dark' ? 'bg-gray-700' : 'bg-gray-100'}`}><div className=\"text-sm overflow-hidden\"><p className=\"font-semibold text-blue-600\">Editing message</p><p className={`truncate opacity-80 ${theme === 'dark' ? 'text-gray-300' : 'text-gray-600'}`}>{editingInfo.originalContent}</p></div><button onClick={cancelEdit}><FaTimes /></button></div>)}\r\n                                {currentChatInfo && (\r\n                                    <div className={`relative flex items-center w-full space-x-2 ${(replyingTo || editingInfo.index !== null) ? 'pt-2' : ''}`}>\r\n                                        {showEmojiPicker && (\r\n                                            <div ref={emojiPickerRef} className=\"absolute bottom-full mb-2 left-0 z-40 w-[95vw] max-w-sm\">\r\n                                                <EmojiPicker onEmojiClick={onEmojiClick} width=\"100%\" height={350} theme={theme} />\r\n                                            </div>\r\n                                        )}\r\n                                        <div className=\"relative flex-grow\">\r\n                                            <input ref={messageInputRef} type=\"text\" placeholder={isRecording ? \"Recording...\" : \"Type a message...\"} className={`w-full p-3 pr-24 rounded-full border bg-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500 ${theme === 'dark' ? 'bg-gray-700 text-white border-gray-600' : 'bg-gray-100 border-gray-300'}`} value={message} onChange={(e) => { setMessage(e.target.value); sendTypingStatus(true); }} onKeyDown={handleKeyDown} disabled={isRecording} />\r\n                                            <div className=\"absolute right-2 top-1/2 -translate-y-1/2 flex items-center\">\r\n                                                <button ref={emojiButtonRef} onClick={() => setShowEmojiPicker(!showEmojiPicker)} className={`p-2 rounded-full hover:bg-gray-100 ${theme === 'dark' ? 'text-gray-300 hover:bg-gray-700' : 'text-gray-500 hover:text-blue-600'}`}><FaSmile size={20} /></button>\r\n                                                <button onClick={handleFileButtonClick} className={`p-2 rounded-full hover:bg-gray-100 ${theme === 'dark' ? 'text-gray-300 hover:bg-gray-700' : 'text-gray-500 hover:text-blue-600'}`}><FaPaperclip size={20} /></button>\r\n                                            </div>\r\n                                        </div>\r\n                                        {message.trim() || editingInfo.index !== null ? (\r\n                                            <button onClick={editingInfo.index !== null ? handleSaveEdit : handleSendMessage} className={`p-3 rounded-full text-white ${editingInfo.index !== null ? 'bg-green-600 hover:bg-green-700' : 'bg-blue-600 hover:bg-blue-700'}`}>\r\n                                                {editingInfo.index !== null ? <FaCheck size={20} /> : <FaPaperPlane size={20} />}\r\n                                            </button>\r\n                                        ) : (\r\n                                            <button onClick={handleMicButtonClick} className={`p-3 rounded-full hover:bg-gray-100 ${isRecording ? 'text-red-500 animate-pulse' : (theme === 'dark' ? 'text-gray-300 hover:bg-gray-700' : 'text-gray-500 hover:text-blue-600')}`}>\r\n                                                {isRecording ? <FaStop size={20} /> : <FaMicrophone size={20} />}\r\n                                            </button>\r\n                                        )}\r\n                                        <input type=\"file\" ref={fileInputRef} onChange={handleFileChange} className=\"hidden\" />\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        </>\r\n                    )}\r\n                </div>\r\n                {showScrollToBottom && (\r\n                    <button\r\n                        onClick={() => scrollToBottom()}\r\n                        className=\"absolute bottom-24 right-8 z-[110] bg-blue-600/80 backdrop-blur-sm text-white rounded-full p-3 shadow-xl hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all transform hover:scale-110 animate-fade-in\"\r\n                        aria-label=\"Scroll to bottom\"\r\n                    >\r\n                        {newMessagesCount > 0 && (\r\n                            <span className=\"absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center\">\r\n                                {newMessagesCount > 9 ? '9+' : newMessagesCount}\r\n                            </span>\r\n                        )}\r\n                        <FaChevronDown size={20} />\r\n                    </button>\r\n                )}\r\n            </div>\r\n\r\n            {viewingProfile && (\r\n                <ContactProfileModal\r\n                    chat={viewingProfile}\r\n                    onClose={() => setViewingProfile(null)}\r\n                    theme={theme}\r\n                />\r\n            )}\r\n\r\n            {contextMenu.visible && (\r\n                <div ref={contextMenuRef} style={{ top: contextMenu.y, left: contextMenu.x }} className={`absolute rounded-md shadow-lg z-50 text-sm ${theme === 'dark' ? 'bg-gray-800' : 'bg-white'}`}>\r\n                    <ul className=\"py-1\">\r\n                        {contextMenu.message.type === 'deleted' ? (\r\n                            <li onClick={() => handleDelete(false)} className={`px-4 py-2 hover:bg-gray-100 cursor-pointer flex items-center gap-3 text-red-600 ${theme === 'dark' ? 'text-red-400 hover:bg-gray-700' : ''}`}><FaTrash /> Delete for me</li>\r\n                        ) : (\r\n                            <>\r\n                                <li onClick={handleReply} className={`px-4 py-2 hover:bg-gray-100 cursor-pointer flex items-center gap-3 ${theme === 'dark' ? 'text-gray-300 hover:bg-gray-700' : 'text-gray-700'}`}><FaReply /> Reply</li>\r\n                                <li onClick={handlePin} className={`px-4 py-2 hover:bg-gray-100 cursor-pointer flex items-center gap-3 ${theme === 'dark' ? 'text-gray-300 hover:bg-gray-700' : 'text-gray-700'}`}><FaThumbtack /> Pin</li>\r\n                                <li onClick={handleForward} className={`px-4 py-2 hover:bg-gray-100 cursor-pointer flex items-center gap-3 ${theme === 'dark' ? 'text-gray-300 hover:bg-gray-700' : 'text-gray-700'}`}><FaShare /> Forward</li>\r\n\r\n                                {contextMenu.message.status !== 'sending' && contextMenu.message.status !== 'failed' && (\r\n                                    <>\r\n                                        {contextMenu.message.sender === currentUser?.id && contextMenu.message.type === 'text' && !contextMenu.message.isForwarded && (new Date() - new Date(contextMenu.message.timestamp) < 15 * 60 * 1000) && (\r\n                                            <li onClick={handleEdit} className={`px-4 py-2 hover:bg-gray-100 cursor-pointer flex items-center gap-3 ${theme === 'dark' ? 'text-gray-300 hover:bg-gray-700' : 'text-gray-700'}`}><FaEdit /> Edit</li>\r\n                                        )}\r\n                                        <hr className={`my-1 ${theme === 'dark' ? 'border-gray-700' : ''}`} />\r\n                                        <li onClick={() => handleDelete(false)} className={`px-4 py-2 hover:bg-gray-100 cursor-pointer flex items-center gap-3 text-red-600 ${theme === 'dark' ? 'text-red-400 hover:bg-gray-700' : ''}`}><FaTrash /> Delete for me</li>\r\n                                        {contextMenu.message.sender === currentUser?.id && (\r\n                                            <li onClick={() => handleDelete(true)} className={`px-4 py-2 hover:bg-gray-100 cursor-pointer flex items-center gap-3 text-red-600 ${theme === 'dark' ? 'text-red-400 hover:bg-gray-700' : ''}`}><FaTrash /> Delete for everyone</li>\r\n                                        )}\r\n                                    </>\r\n                                )}\r\n                            </>\r\n                        )}\r\n                    </ul>\r\n                </div>\r\n            )}\r\n\r\n            {forwardingInfo.visible && (<div className=\"fixed inset-0 bg-opacity-100 flex items-center justify-center z-[100]\"><div className={`rounded-lg shadow-2xl w-full max-w-md ${theme === 'dark' ? 'bg-gray-800 text-white' : 'bg-white'}`}><div className={`p-4 border-b flex justify-between items-center ${theme === 'dark' ? 'border-gray-700' : 'border-gray-200'}`}><h3 className=\"font-bold text-lg\">Forward message to...</h3><button onClick={() => setForwardingInfo({ visible: false, message: null })}><FaTimes /></button></div><div className=\"p-4\"><input type=\"text\" placeholder=\"Search for users or groups\" className={`w-full p-2 border rounded-lg ${theme === 'dark' ? 'bg-gray-700 text-white border-gray-600' : 'bg-gray-100 border-gray-300'}`} value={forwardSearchTerm} onChange={(e) => setForwardSearchTerm(e.target.value)} /></div><div className=\"h-64 overflow-y-auto p-4\">{allChats.filter(c => c.name?.toLowerCase().includes(forwardSearchTerm.toLowerCase())).map(chat => (<div key={chat.chatId} className={`flex items-center p-2 rounded-lg hover:bg-gray-100 ${theme === 'dark' ? 'hover:bg-gray-700' : ''}`}><input type=\"checkbox\" id={`fwd-${chat.chatId}`} className=\"mr-3 h-4 w-4 accent-blue-600\" checked={forwardRecipients.includes(chat.chatId)} onChange={(e) => { if (e.target.checked) setForwardRecipients([...forwardRecipients, chat.chatId]); else setForwardRecipients(forwardRecipients.filter(id => id !== chat.chatId)); }} />\r\n                <label htmlFor={`fwd-${chat.chatId}`} className=\"flex-grow flex items-center gap-3 cursor-pointer\">\r\n                    {chat.type === 'group' ? (\r\n                        <div className={`w-10 h-10 rounded-full flex items-center justify-center ${theme === 'dark' ? 'bg-gray-700' : 'bg-gray-200'}`}><FaUsers className={`text-gray-500`} /></div>\r\n                    ) : (\r\n                        <img src={chat.profile} alt={chat.name} className=\"w-10 h-10 rounded-full object-cover\" onError={(e) => { e.target.src = 'https://placehold.co/100x100/E2E8F0/4A5568?text=U' }} />\r\n                    )}\r\n                    <span className={`${theme === 'dark' ? 'text-gray-300' : 'text-gray-800'}`}>{chat.name}</span>\r\n                </label>\r\n            </div>))}</div><div className={`p-4 border-t text-right ${theme === 'dark' ? 'border-gray-700' : 'border-gray-200'}`}><button onClick={handleConfirmForward} disabled={forwardRecipients.length === 0} className=\"bg-blue-600 text-white px-4 py-2 rounded-lg disabled:bg-gray-400 disabled:cursor-not-allowed cursor-pointer\">Forward</button></div></div></div>)}\r\n\r\n            {isProfileModalOpen && currentChatInfo && currentChatInfo.type !== 'group' && (\r\n                <div className=\"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[151]\" onClick={() => setIsProfileModalOpen(false)}>\r\n                    <img src={currentChatInfo.profile} alt={currentChatInfo.name} className=\"max-w-[80vw] max-h-[90vh] object-contain\" onClick={(e) => e.stopPropagation()} />\r\n                </div>\r\n            )}\r\n\r\n            {isGroupInfoModalOpen && currentChatInfo?.type === 'group' && (\r\n                <div className=\"fixed inset-0 bg-opacity-100 flex items-center justify-center z-[100]\" onClick={() => setIsGroupInfoModalOpen(false)}>\r\n                    <div className={`rounded-lg shadow-2xl w-full max-w-lg h-[80vh] flex flex-col ${theme === 'dark' ? 'bg-gray-800 text-white' : 'bg-white'}`} onClick={(e) => e.stopPropagation()}>\r\n                        <div className={`p-4 border-b flex justify-between items-center flex-shrink-0 ${theme === 'dark' ? 'border-gray-700' : 'border-gray-200'}`}>\r\n                            <h3 className=\"font-bold text-xl\">Group Info</h3>\r\n                            <button onClick={() => setIsGroupInfoModalOpen(false)} className={`p-2 rounded-full ${theme === 'dark' ? 'hover:bg-gray-700 text-gray-300' : 'hover:bg-gray-200'}`}><FaTimes /></button>\r\n                        </div>\r\n                        <div className={`flex border-b flex-shrink-0 ${theme === 'dark' ? 'border-gray-700' : 'border-gray-200'}`}>\r\n                            {['Overview', 'Members', 'Media', 'Files', 'Links'].map(tab => (\r\n                                <button key={tab} onClick={() => setActiveGroupInfoTab(tab)} className={`flex-1 p-3 text-sm font-semibold ${activeGroupInfoTab === tab ? 'text-blue-600 border-b-2 border-blue-600' : (theme === 'dark' ? 'text-gray-400 hover:bg-gray-700' : 'text-gray-500 hover:bg-gray-100')}`}>\r\n                                    {tab}\r\n                                </button>\r\n                            ))}\r\n                        </div>\r\n                        <div className=\"p-4 overflow-y-auto flex-grow\">\r\n                            {activeGroupInfoTab === 'Overview' && (\r\n                                <div className=\"flex flex-col items-center text-center space-y-4\">\r\n                                    <div className={`w-40 h-40 rounded-full flex items-center justify-center ${theme === 'dark' ? 'bg-gray-700' : 'bg-gray-200'}`}>\r\n                                        <FaUsers className=\"text-gray-500\" size={80} />\r\n                                    </div>\r\n                                    <h2 className=\"text-2xl font-bold\">{currentChatInfo.name}</h2>\r\n                                    <p className={`text-gray-600 ${theme === 'dark' ? 'text-gray-400' : ''}`}>{currentChatInfo.memberCount || 0} members</p>\r\n                                </div>\r\n                            )}\r\n                            {activeGroupInfoTab === 'Members' && (\r\n                                <div className=\"space-y-3\">\r\n                                    {isGroupDataLoading ? (\r\n                                        <p className=\"text-center text-gray-500\">Loading members...</p>\r\n                                    ) : (\r\n                                        groupMembers.map((member, i) => (\r\n                                            <div key={member.employeeId || i} className={`flex items-center gap-4 p-2 rounded-lg ${theme === 'dark' ? 'hover:bg-gray-700' : 'hover:bg-gray-50'}`}>\r\n                                                {member.employeeImage ? (\r\n                                                    <img src={member.employeeImage} alt={member.displayName} className=\"w-10 h-10 rounded-full object-cover\" />\r\n                                                ) : (\r\n                                                    <div className={`w-10 h-10 rounded-full flex items-center justify-center ${theme === 'dark' ? 'bg-gray-700' : 'bg-gray-200'}`}>\r\n                                                        <FaUser className={`text-gray-500`} size={20} />\r\n                                                    </div>\r\n                                                )}\r\n                                                <div>\r\n                                                    <span className={`font-semibold ${theme === 'dark' ? 'text-white' : 'text-gray-800'}`}>{member.displayName}</span>\r\n                                                    {member.jobTitlePrimary && <p className={`text-sm ${theme === 'dark' ? 'text-gray-400' : 'text-gray-500'}`}>{member.jobTitlePrimary}</p>}\r\n                                                </div>\r\n                                            </div>\r\n                                        ))\r\n                                    )}\r\n                                </div>\r\n                            )}\r\n                            {activeGroupInfoTab === 'Media' && (\r\n                                isAttachmentLoading ? <p className=\"text-center p-4 text-gray-500\">Loading Media...</p> :\r\n                                    <div className=\"grid grid-cols-3 md:grid-cols-4 gap-2\">\r\n                                        {groupMedia.length > 0 ? groupMedia.map((msg, i) => (\r\n                                            <button key={i} onClick={() => setImageInView(getFileUrl(msg))}>\r\n                                                <img src={getFileUrl(msg)} alt={msg.fileName} className=\"w-full h-24 object-cover rounded-md cursor-pointer hover:opacity-80\" />\r\n                                            </button>\r\n                                        )) : <p className=\"col-span-full text-center p-4 text-gray-500\">No media found.</p>}\r\n                                    </div>\r\n                            )}\r\n\r\n                            {activeGroupInfoTab === 'Files' && (\r\n                                isAttachmentLoading ? <p className=\"text-center p-4 text-gray-500\">Loading Files...</p> :\r\n                                    <div className=\"space-y-3\">\r\n                                        {groupFiles.length > 0 ? groupFiles.map(fileMsg => (\r\n                                            <FileMessage key={fileMsg.id} msg={fileMsg} isMyMessage={false} theme={theme} />\r\n                                        )) : <p className=\"text-center p-4 text-gray-500\">No files found in this chat.</p>}\r\n                                    </div>\r\n                            )}\r\n\r\n                            {activeGroupInfoTab === 'Links' && (\r\n                                isAttachmentLoading ? <p className=\"text-center p-4 text-gray-500\">Loading Links...</p> :\r\n                                    <div className=\"space-y-3\">\r\n                                        {(() => {\r\n                                            const allLinks = groupLinks.flatMap(linkMsg => {\r\n                                                const linkRegex = /(https?:\\/\\/[^\\s]+)/g;\r\n                                                const links = linkMsg.content.match(linkRegex);\r\n                                                return links ? links.map(link => ({\r\n                                                    id: linkMsg.id,\r\n                                                    url: link,\r\n                                                    sender: getSenderInfo(linkMsg.sender).name,\r\n                                                    timestamp: linkMsg.timestamp\r\n                                                })) : [];\r\n                                            });\r\n\r\n                                            return allLinks.length > 0 ? (\r\n                                                allLinks.map((link, index) => (\r\n                                                    <div key={`${link.id}-${index}`} className={`p-3 rounded-lg ${theme === 'dark' ? 'bg-gray-700' : 'bg-gray-100'}`}>\r\n                                                        <a href={link.url} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-blue-600 hover:underline break-all\">{link.url}</a>\r\n                                                        <p className={`text-xs mt-1 ${theme === 'dark' ? 'text-gray-400' : 'text-gray-500'}`}>Shared by {link.sender} on {new Date(link.timestamp).toLocaleDateString()}</p>\r\n                                                    </div>\r\n                                                ))\r\n                                            ) : (\r\n                                                <p className={`text-center p-4 ${theme === 'dark' ? 'text-gray-400' : 'text-gray-500'}`}>No links found in this chat.</p>\r\n                                            );\r\n                                        })()}\r\n                                    </div>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {imageInView && (\r\n                <div className=\"fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-[151]\" onClick={() => setImageInView(null)}>\r\n                    <img src={imageInView} alt=\"Full view\" className=\"max-w-[90vw] max-h-[90vh] object-contain\" onClick={(e) => e.stopPropagation()} />\r\n                </div>\r\n            )}\r\n\r\n            {showClearConfirm && (\r\n                <div className=\"fixed inset-0 bg-opacity-100 flex items-center justify-center z-[110]\">\r\n                    <div className={`rounded-lg shadow-xl p-6 w-full max-w-sm ${theme === 'dark' ? 'bg-gray-800' : 'bg-white'}`}>\r\n                        <h3 className={`text-lg font-bold mb-4 ${theme === 'dark' ? 'text-white' : 'text-gray-800'}`}>Clear Chat?</h3>\r\n                        <p className={`mb-6 ${theme === 'dark' ? 'text-gray-400' : 'text-gray-600'}`}>Are you sure you want to clear all messages in this chat? This action cannot be undone.</p>\r\n                        <div className=\"flex justify-end gap-4\">\r\n                            <button onClick={() => setShowClearConfirm(false)} className={`px-4 py-2 rounded-lg text-gray-700 bg-gray-200 hover:bg-gray-300 ${theme === 'dark' ? 'bg-gray-600 text-white hover:bg-gray-700' : ''}`}>\r\n                                Cancel\r\n                            </button>\r\n                            <button onClick={handleConfirmClearChat} className=\"px-4 py-2 rounded-lg text-white bg-red-600 hover:bg-red-700\">\r\n                                Clear Chat\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default ChatApplication;","import { useEffect, useState, useRef, useContext } from 'react';\r\nimport { useParams } from 'react-router-dom';\r\nimport { getChatOverview } from '../../../../services/apiService';\r\nimport { transformOverviewToChatList } from '../../../../services/dataTransformer';\r\nimport ChatApplication from './ChatApplication';\r\nimport { Context } from '../HrmsContext';\r\n\r\nconst ChatListItemSkeleton = () => (\r\n    <div className=\"flex items-center space-x-4 p-3\">\r\n        <div className=\"w-11 h-11 bg-gray-200 rounded-full animate-pulse\"></div>\r\n        <div className=\"flex-1 space-y-2\">\r\n            <div className=\"h-4 bg-gray-200 rounded w-3/4 animate-pulse\"></div>\r\n            <div className=\"h-3 bg-gray-200 rounded w-1/2 animate-pulse\"></div>\r\n        </div>\r\n    </div>\r\n);\r\n\r\nconst ChatAppSkeleton = ({ theme }) => (\r\n    <div className={`flex w-full h-full p-0 md:p-4 md:gap-4 ${theme === 'dark' ? 'bg-gray-900' : 'bg-gray-100'}`}>\r\n        {/* Sidebar Skeleton */}\r\n        <div className={`w-full md:w-[30%] h-full p-4 flex flex-col shadow-xl md:rounded-lg space-y-4 ${theme === 'dark' ? 'bg-gray-800' : 'bg-white'}`}>\r\n            <div className=\"h-12 bg-gray-200 rounded-lg animate-pulse mb-4\"></div>\r\n            <div className=\"flex-grow space-y-2 pr-2 overflow-hidden\">\r\n                <ChatListItemSkeleton />\r\n                <ChatListItemSkeleton />\r\n                <ChatListItemSkeleton />\r\n                <ChatListItemSkeleton />\r\n                <ChatListItemSkeleton />\r\n                <ChatListItemSkeleton />\r\n                <ChatListItemSkeleton />\r\n            </div>\r\n        </div>\r\n\r\n        {/* This part is hidden on mobile to match the final layout's behavior */}\r\n        <div className={`hidden md:flex flex-col w-[70%] h-full md:rounded-lg shadow-xl ${theme === 'dark' ? 'bg-gray-800' : 'bg-white'}`}>\r\n            <div className=\"flex items-center justify-center h-full\">\r\n                <div className=\"text-center\">\r\n                    <p className={`text-xl ${theme === 'dark' ? 'text-gray-400' : 'text-gray-400'}`}>Loading Chats...</p>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n);\r\n\r\n\r\nfunction ChatApp() {\r\n    const { userId } = useParams();\r\n    const { theme,userData} = useContext(Context);\r\n    const [chatList, setChatList] = useState({ groups: [], privateChatsWith: [] });\r\n    const [isLoading, setIsLoading] = useState(true);\r\n    const [isFetchingMore, setIsFetchingMore] = useState(false);\r\n    const [page, setPage] = useState(0);\r\n    const [hasMore, setHasMore] = useState(true);\r\n\r\n    const fetchingMore = useRef(false);\r\n\r\n    const currentUser = {\r\n        name: userData?.displayName || 'You',\r\n        id: userId,\r\n        profile: userData?.employeeImage || 'https://placehold.co/100x100/E2E8F0/4A5568?text=Me'\r\n    };\r\n\r\n    const loadChats = async (pageNum) => {\r\n        console.log(`%c loadChats function started for page: ${pageNum}`, 'color: blue; font-weight: bold;');\r\n\r\n        if (!hasMore || fetchingMore.current) {\r\n            console.log(`%c Request for page ${pageNum} blocked. hasMore=${hasMore}, fetchingMore.current=${fetchingMore.current}`, 'color: red;');\r\n            return;\r\n        }\r\n\r\n        fetchingMore.current = true;\r\n\r\n        if (pageNum === 0) {\r\n            setIsLoading(true);\r\n        } else {\r\n            setIsFetchingMore(true);\r\n        }\r\n\r\n        try {\r\n            console.log(`%c Sending API request for page: ${pageNum}`, 'color: green;');\r\n            const rawChatListData = await getChatOverview(userId, pageNum, 10);\r\n\r\n            if (rawChatListData.length === 0) {\r\n                setHasMore(false);\r\n                return;\r\n            }\r\n\r\n            const formattedChatList = transformOverviewToChatList(rawChatListData, userId);\r\n\r\n            setChatList(prevChatList => {\r\n                if (pageNum === 0) {\r\n                    return formattedChatList;\r\n                }\r\n                const existingGroupIds = new Set(prevChatList.groups.map(g => g.chatId));\r\n                const existingPrivateIds = new Set(prevChatList.privateChatsWith.map(p => p.chatId));\r\n                const newUniqueGroups = formattedChatList.groups.filter(g => !existingGroupIds.has(g.chatId));\r\n                const newUniquePrivate = formattedChatList.privateChatsWith.filter(p => !existingPrivateIds.has(p.chatId));\r\n                return {\r\n                    groups: [...prevChatList.groups, ...newUniqueGroups],\r\n                    privateChatsWith: [...prevChatList.privateChatsWith, ...newUniquePrivate]\r\n                };\r\n            });\r\n\r\n            if (rawChatListData.length < 10) {\r\n                setHasMore(false);\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Error loading chats:\", error);\r\n        } finally {\r\n            if (pageNum === 0) {\r\n                setIsLoading(false);\r\n            }\r\n            setIsFetchingMore(false);\r\n\r\n            fetchingMore.current = false;\r\n            console.log(`%c Finished fetch for page ${pageNum}. Lock released.`, 'color: orange;');\r\n        }\r\n    };\r\n\r\n    const handleLoadMore = () => {\r\n        console.log(\"handleLoadMore triggered!\");\r\n        if (fetchingMore.current || !hasMore) {\r\n            console.log(\"handleLoadMore blocked by ref lock or no more data.\");\r\n            return;\r\n        }\r\n        const nextPage = page + 1;\r\n        setPage(nextPage);\r\n        loadChats(nextPage);\r\n    };\r\n\r\n    useEffect(() => {\r\n        if (userId) {\r\n            loadChats(0);\r\n        }\r\n    }, [userId]);\r\n\r\n    return (\r\n        <div className={`flex h-full w-full ${theme === 'dark' ? 'bg-gray-900' : 'bg-gray-100'}`}>\r\n            {isLoading ? (\r\n                <ChatAppSkeleton theme={theme} />\r\n            ) : (\r\n                <ChatApplication\r\n                    currentUser={currentUser}\r\n                    chats={chatList}\r\n                    loadMoreChats={handleLoadMore}\r\n                    hasMore={hasMore}\r\n                    isFetchingMore={isFetchingMore}\r\n                    theme={theme}\r\n                />\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default ChatApp;"],"names":["isRefreshing","failedQueue","processQueue","error","token","arguments","length","undefined","forEach","prom","reject","resolve","createAxiosInstance","baseURL","instance","axios","create","interceptors","request","use","config","localStorage","getItem","headers","concat","console","log","Promise","response","async","_error$response","originalRequest","status","_retry","push","then","catch","err","oldToken","refreshResponse","post","withCredentials","accessToken","data","setItem","FormData","formData","newFormData","key","value","entries","append","cloneFormData","newInstance","refreshError","clear","window","location","href","addEventListener","event","newValue","chatApi","getMessages","employeeId","chatId","page","size","get","getGroupMembers","publicinfoApi","teamId","getChatAttachments","type","params","generateChatListPreview","item","currentUserId","lastMessage","lastMessageContent","prefix","lastMessageSenderId","lastMessageType","toUpperCase","match","transformOverviewToChatList","overviewData","Array","isArray","groups","privateChatsWith","chatList","chatItem","name","groupName","employeeName","lastMessageTimestamp","lastSeen","unreadMessageCount","profile","isOnline","memberCount","chatType","transformMessageDTOToUIMessage","msgDto","timestamp","tsString","String","Date","endsWith","toISOString","date","time","e","messageType","fileUrl","fileName","fileType","startsWith","kind","toLowerCase","messageIdForUrl","id","messageId","includes","baseUrl","defaults","isDeleted","finalId","content","sender","seen","isSeen","isEdited","isPinned","pinned","fileSize","duration","clientId","isForwarded","forwarded","forwardedFrom","isReply","replyTo","senderId","originalMessageId","formatFileSize","bytes","i","Math","floor","parseFloat","pow","toFixed","FileIcon","_ref","_fileName$split$pop","className","extension","split","pop","_jsx","FaFilePdf","FaFileWord","FaFilePowerpoint","FaFileExcel","FaFileArchive","FaImage","FaFileAudio","FaFileAlt","FileMessage","_ref2","msg","isMyMessage","theme","downloadUrl","_jsxs","children","onClick","preventDefault","stopPropagation","open","FaDownload","AudioPlayer","_ref3","src","isSender","initialDuration","audioRef","useRef","isPlaying","setIsPlaying","useState","progress","setProgress","setDuration","localSrc","setLocalSrc","isDownloading","setIsDownloading","useEffect","audio","current","setAudioData","Infinity","setAudioTime","currentTime","handleEnded","removeEventListener","handleDownload","fetch","blob","localUrl","URL","createObjectURL","formatTime","minutes","seconds","toString","padStart","progressPercentage","ref","preload","togglePlayPause","pause","play","FaPause","FaPlay","rect","currentTarget","getBoundingClientRect","newTime","clientX","left","width","style","MessageSkeleton","_ref4","ContactProfileModal","_ref5","chat","onClose","isZoomed","setIsZoomed","alt","FaUsers","_ref6","currentUser","chats","initialChats","loadMoreChats","hasMore","isFetchingMore","useLocation","navigate","useNavigate","chatData","setChatData","searchTerm","setSearchTerm","selectedChat","setSelectedChat","message","setMessage","messages","setMessages","isMessagesLoading","setIsMessagesLoading","isChatOpen","setIsChatOpen","showEmojiPicker","setShowEmojiPicker","isRecording","setIsRecording","showChatMenu","setShowChatMenu","downloadedMedia","setDownloadedMedia","contextMenu","setContextMenu","visible","x","y","index","editingInfo","setEditingInfo","originalContent","replyingTo","setReplyingTo","lastDeleted","setLastDeleted","pinnedMessage","setPinnedMessage","forwardingInfo","setForwardingInfo","forwardRecipients","setForwardRecipients","forwardSearchTerm","setForwardSearchTerm","showPinnedMenu","setShowPinnedMenu","isProfileModalOpen","setIsProfileModalOpen","isGroupInfoModalOpen","setIsGroupInfoModalOpen","activeGroupInfoTab","setActiveGroupInfoTab","groupMembers","setGroupMembers","isGroupDataLoading","setIsGroupDataLoading","groupMembersCache","setGroupMembersCache","imageInView","setImageInView","isChatDataReady","setIsChatDataReady","isConnected","setIsConnected","showClearConfirm","setShowClearConfirm","typingUsers","setTypingUsers","messagePages","setMessagePages","hasMoreMessages","setHasMoreMessages","isFetchingMoreMessages","setIsFetchingMoreMessages","showScrollToBottom","setShowScrollToBottom","newMessagesCount","setNewMessagesCount","viewingProfile","setViewingProfile","searchChatResults","setSearchChatResults","isSearching","setIsSearching","groupMedia","setGroupMedia","groupFiles","setGroupFiles","groupLinks","setGroupLinks","isAttachmentLoading","setIsAttachmentLoading","isSearchVisible","setIsSearchVisible","searchQuery","setSearchQuery","searchResults","setSearchResults","currentResultIndex","setCurrentResultIndex","setIsChatWindowVisible","setChatUnreadCount","useContext","Context","sidebarScrollRef","chatContainerRef","stompClient","typingTimeoutRef","fileInputRef","mediaRecorderRef","audioChunksRef","streamRef","emojiPickerRef","emojiButtonRef","chatMenuRef","chatMenuButtonRef","contextMenuRef","messageInputRef","isManuallyClosing","pinnedMenuRef","pinnedMenuButtonRef","onMessageReceivedRef","isFetchingOldMessages","subscriptions","chatIdFromUrl","useMemo","pathname","URLSearchParams","search","trim","timerId","setTimeout","userId","query","searchMessages","results","clearTimeout","messageElement","document","getElementById","scrollIntoView","behavior","block","handleJumpToMessage","contextMessagesRaw","getMessageContext","transformedContext","map","prev","_objectSpread","element","classList","add","remove","scrollToBottom","scrollTo","top","scrollHeight","debounceTimer","searchChatOverview","rawResults","formattedResults","combinedResults","sort","a","b","finally","correctedChats","loadMoreMessages","useCallback","pageNum","rawMessages","transformedMessages","chatContainer","previousScrollHeight","previousScrollTop","scrollTop","requestAnimationFrame","pinnedMsgData","getPinnedMessage","fetchPinnedMessage","updateLastMessage","updateChat","isNewUnread","overviewItem","onMessageReceived","payload","container","shouldScrollOnReceive","clientHeight","parsedData","JSON","parse","body","messageIds","prevMessages","chatKey","groupId","chatMessages","newStatus","updatedMessages","pinnedDto","eventChatId","receiver","unpinPayload","receiverId","receivedMessage","messageChatId","warn","wasLastMessage","newLastMessage","updatedMsg","finalServerId","some","m","newChatMessages","messageProcessed","finalMessageForUpdate","isProperAck","client_id","isBroadcastOfOwnMessage","isIncoming","optimisticIndex","findIndex","transformedServerMessage","findLastIndex","finalMessage","prevCount","allChats","filter","user","totalUnread","reduce","acc","handleTypingEvent","typingUpdate","chatIdKey","senderChatInfo","find","c","senderName","newTypingUsers","typing","p","updated","onSidebarUpdate","updatedChatList","updatedPrivate","updatedGroups","pc","update","upc","g","ug","brokerURL","client","Client","reconnectDelay","onConnect","messageHandler","subscribe","statusUpdate","newPrivateChats","onWebSocketError","onStompError","frame","onWebSocketClose","activate","_stompClient$current","_stompClient$current2","active","destination","publish","deactivate","groupIds","join","_stompClient$current3","requiredGroupIds","Set","currentSubKeys","Object","keys","subscribedGroupIds","replace","has","subId","unsubscribe","typingSubId","openChat","_stompClient$current4","targetChat","stringify","_teamDetailsResponse$","teamDetailsResponse","members","employees","prevCache","newUrl","history","pushState","path","closeChat","_stompClient$current5","handleChatSelect","_stompClient$current6","isGroup","updatedList","handleBeforeUnload","teamDetails","media","files","links","fetchGroupData","handleClickOutside","_emojiButtonRef$curre","_chatMenuButtonRef$cu","_pinnedMenuButtonRef$","contains","target","sendTypingStatus","isTyping","_stompClient$current7","handleSendMessage","now","random","substring","optimisticMessage","replyToMessageId","startRecording","navigator","mediaDevices","getUserMedia","stream","mediaRecorder","MediaRecorder","ondataavailable","onstop","audioBlob","Blob","audioFile","File","lastModified","reader","FileReader","readAsDataURL","onloadend","base64String","result","localPreviewUrl","voiceData","fileData","uploadVoiceMessage","newMessages","start","alert","stopRecording","state","stop","getTracks","track","handleSaveEdit","_stompClient$current8","updatedContent","cancelEdit","currentMessages","messageToEdit","optimisticUpdatedMessage","updatedMessagesList","handleDelete","messageToDelete","forEveryone","deleteMessageForEveryone","deleteMessageForMe","nextMessages","_","handleUndoDelete","handleGoToMessage","messageIndex","querySelector","chatsToDisplay","chatToSelect","_location$state","newChatTarget","prevData","updatedPrivateChats","formatTimestamp","isoString","isNaN","toLocaleTimeString","hour","minute","hour12","formatDateHeader","today","yesterday","setDate","getDate","toDateString","toLocaleDateString","year","month","day","getStatusRingColor","lastMessageDate","currentChatInfo","getSenderInfo","member","displayName","employeeImage","getFileUrl","origin","placeholder","onChange","onScroll","handleSidebarScroll","FaUser","_Fragment","FaArrowLeft","disabled","formatLastSeen","BsThreeDotsVertical","autoFocus","handlePrevResult","FaChevronUp","handleNextResult","FaChevronDown","FaTimes","FaThumbtack","FaAngleDoubleRight","unpinMessage","handleChatScroll","nextPage","isScrolledUp","_searchResults$curren","msgDate","showDateHeader","senderInfo","React","profileSrc","profileName","onContextMenu","handleContextMenu","pageX","pageY","innerWidth","innerHeight","FaShare","maxHeight","download","EmojiPicker","onEmojiClick","emojiObject","emoji","height","onKeyDown","shiftKey","FaSmile","handleFileButtonClick","click","FaPaperclip","FaCheck","FaPaperPlane","handleMicButtonClick","FaStop","FaMicrophone","file","localPreviewContent","uploadFile","FaTrash","handleReply","focus","FaReply","_contextMenu$message","messageIdToPin","pinMessage","handleForward","handleEdit","FaEdit","_c$name","checked","htmlFor","onError","originalMsg","forwardData","forwardMessageId","forwardTo","forwardMessage","newLastMessageObject","tab","jobTitlePrimary","fileMsg","allLinks","flatMap","linkMsg","link","url","rel","clearChatHistory","ChatListItemSkeleton","ChatAppSkeleton","useParams","userData","setChatList","isLoading","setIsLoading","setIsFetchingMore","setPage","setHasMore","fetchingMore","loadChats","rawChatListData","getChatOverview","formattedChatList","prevChatList","existingGroupIds","existingPrivateIds","newUniqueGroups","newUniquePrivate","ChatApplication","handleLoadMore"],"sourceRoot":""}